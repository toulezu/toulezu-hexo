{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/next/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by.svg","path":"images/cc-by.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/loading.gif","path":"images/loading.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/placeholder.gif","path":"images/placeholder.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/quote-r.svg","path":"images/quote-r.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/quote-l.svg","path":"images/quote-l.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/searchicon.png","path":"images/searchicon.png","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/affix.js","path":"js/src/affix.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/algolia-search.js","path":"js/src/algolia-search.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/exturl.js","path":"js/src/exturl.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/bootstrap.js","path":"js/src/bootstrap.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/js.cookie.js","path":"js/src/js.cookie.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/hook-duoshuo.js","path":"js/src/hook-duoshuo.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/motion.js","path":"js/src/motion.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/scroll-cookie.js","path":"js/src/scroll-cookie.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/post-details.js","path":"js/src/post-details.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/utils.js","path":"js/src/utils.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/scrollspy.js","path":"js/src/scrollspy.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.css","path":"lib/algolia-instant-search/instantsearch.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/canvas-ribbon/canvas-ribbon.js","path":"lib/canvas-ribbon/canvas-ribbon.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/bower.json","path":"lib/fastclick/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/README.md","path":"lib/fastclick/README.md","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","path":"lib/font-awesome/HELP-US-OUT.txt","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/LICENSE","path":"lib/fastclick/LICENSE","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/bower.json","path":"lib/font-awesome/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/CONTRIBUTING.md","path":"lib/jquery_lazyload/CONTRIBUTING.md","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/bower.json","path":"lib/jquery_lazyload/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/README.md","path":"lib/jquery_lazyload/README.md","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.scrollstop.js","path":"lib/jquery_lazyload/jquery.scrollstop.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-barber-shop.min.css","path":"lib/pace/pace-theme-barber-shop.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.lazyload.js","path":"lib/jquery_lazyload/jquery.lazyload.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-atom.min.css","path":"lib/pace/pace-theme-center-atom.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-bounce.min.css","path":"lib/pace/pace-theme-bounce.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-radar.min.css","path":"lib/pace/pace-theme-center-radar.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-big-counter.min.css","path":"lib/pace/pace-theme-big-counter.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-fill-left.min.css","path":"lib/pace/pace-theme-fill-left.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-corner-indicator.min.css","path":"lib/pace/pace-theme-corner-indicator.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-simple.min.css","path":"lib/pace/pace-theme-center-simple.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-minimal.min.css","path":"lib/pace/pace-theme-minimal.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-flash.min.css","path":"lib/pace/pace-theme-flash.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-circle.min.css","path":"lib/pace/pace-theme-center-circle.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-mac-osx.min.css","path":"lib/pace/pace-theme-mac-osx.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-loading-bar.min.css","path":"lib/pace/pace-theme-loading-bar.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/pace/pace.min.js","path":"lib/pace/pace.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/canvas_lines.min.js","path":"lib/three/canvas_lines.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/three-waves.min.js","path":"lib/three/three-waves.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/canvas_sphere.min.js","path":"lib/three/canvas_sphere.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest.min.js","path":"lib/canvas-nest/canvas-nest.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/bower.json","path":"lib/velocity/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","path":"lib/velocity/velocity.ui.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery/index.js","path":"lib/jquery/index.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/schemes/pisces.js","path":"js/src/schemes/pisces.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.min.css","path":"lib/Han/dist/han.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/blank.gif","path":"lib/fancybox/source/blank.gif","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading@2x.gif","path":"lib/fancybox/source/fancybox_loading@2x.gif","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading.gif","path":"lib/fancybox/source/fancybox_loading.gif","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.min.js","path":"lib/Han/dist/han.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite@2x.png","path":"lib/fancybox/source/fancybox_sprite@2x.png","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.css","path":"lib/fancybox/source/jquery.fancybox.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite.png","path":"lib/fancybox/source/fancybox_sprite.png","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.js","path":"lib/fancybox/source/jquery.fancybox.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_overlay.png","path":"lib/fancybox/source/fancybox_overlay.png","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.min.js","path":"lib/fastclick/lib/fastclick.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.js","path":"lib/fastclick/lib/fastclick.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.pack.js","path":"lib/fancybox/source/jquery.fancybox.pack.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","path":"lib/font-awesome/css/font-awesome.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","path":"lib/font-awesome/css/font-awesome.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","path":"lib/ua-parser-js/dist/ua-parser.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.js","path":"lib/Han/dist/han.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.css","path":"lib/Han/dist/han.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","path":"lib/font-awesome/fonts/fontawesome-webfont.woff2","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","path":"lib/font-awesome/fonts/fontawesome-webfont.woff","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.js","path":"lib/velocity/velocity.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","path":"lib/font-awesome/css/font-awesome.css.map","modified":0,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","path":"lib/ua-parser-js/dist/ua-parser.pack.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han.otf","path":"lib/Han/dist/font/han.otf","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han-space.woff","path":"lib/Han/dist/font/han-space.woff","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/fancybox_buttons.png","path":"lib/fancybox/source/helpers/fancybox_buttons.png","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","path":"lib/fancybox/source/helpers/jquery.fancybox-buttons.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han-space.otf","path":"lib/Han/dist/font/han-space.otf","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","path":"lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han.woff","path":"lib/Han/dist/font/han.woff","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","path":"lib/font-awesome/fonts/fontawesome-webfont.eot","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/FontAwesome.otf","path":"lib/font-awesome/fonts/FontAwesome.otf","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.ttf","path":"lib/font-awesome/fonts/fontawesome-webfont.ttf","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-media.js","path":"lib/fancybox/source/helpers/jquery.fancybox-media.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","path":"lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","path":"lib/fancybox/source/helpers/jquery.fancybox-buttons.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.js","path":"lib/algolia-instant-search/instantsearch.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/three/three.min.js","path":"lib/three/three.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.svg","path":"lib/font-awesome/fonts/fontawesome-webfont.svg","modified":0,"renderable":1}],"Cache":[{"_id":"themes/next/.gitattributes","hash":"8454b9313cb1a97b63fb87e2d29daee497ce6249","modified":1499076674142},{"_id":"themes/next/.gitignore","hash":"b935cc0e5b099ebd343ca1766e02f65138c13dd0","modified":1499076674172},{"_id":"themes/next/.bowerrc","hash":"334da94ca6f024d60d012cc26ea655681e724ad8","modified":1499076674139},{"_id":"themes/next/.editorconfig","hash":"211d2c92bfdddb3e81ea946f4ca7a539f150f4da","modified":1476067107079},{"_id":"themes/next/.hound.yml","hash":"289dcf5bfe92dbd680d54d6e0668f41c9c9c0c78","modified":1476067107107},{"_id":"themes/next/.javascript_ignore","hash":"74b54cf920cbbf4038a68e54b7138af8b8f45588","modified":1499076674192},{"_id":"themes/next/.jshintrc","hash":"b7d23f2ce8d99fa073f22f9960605f318acd7710","modified":1476067107114},{"_id":"themes/next/README.md","hash":"06aaf1241e9e1619956c86d8b1397a643840a9d1","modified":1476067107135},{"_id":"themes/next/.travis.yml","hash":"360f38044910e74bf628b0799e19db90718b2cbe","modified":1499076674200},{"_id":"themes/next/.stylintrc","hash":"3b7f9785e9ad0dab764e1c535b40df02f4ff5fd6","modified":1499076674196},{"_id":"themes/next/bower.json","hash":"936b9aed1934471bb74cdaacc3fb8031eb01fe23","modified":1499076674218},{"_id":"themes/next/README.en.md","hash":"953873fe2ee79bfc567b16dcdf8f91c1410444f8","modified":1499076674208},{"_id":"themes/next/package.json","hash":"55305ae40690c059cb9140900eb20f9e7f3a7707","modified":1499076674906},{"_id":"themes/next/gulpfile.coffee","hash":"412defab3d93d404b7c26aaa0279e2e586e97454","modified":1499076674222},{"_id":"source/about/index.md","hash":"1150a4a42eabc51fd050f03b616f49b15b3d6af5","modified":1476064686843},{"_id":"themes/next/_config.yml","hash":"ec7a457ea2c77eb478ffbec5d62f35f3dffa46bd","modified":1499134573302},{"_id":"themes/next/LICENSE","hash":"ec44503d7e617144909e54533754f0147845f0c5","modified":1499076674204},{"_id":"source/_posts/Java中的 synchronizd 关键字用法.md","hash":"51f607820bdb4ba3fbf07215ec453e6dff75846b","modified":1476064686772},{"_id":"source/_posts/ELK：安装.md","hash":"5f2e685181557ec0ab6cafd94abfb01a619128a0","modified":1476064686768},{"_id":"source/_posts/PHP 基本语法.md","hash":"b27f6f8199b3eae01b3467bbab3f148593a19086","modified":1500980055560},{"_id":"source/_posts/Log4j向Logstash发送日志实践.md","hash":"57bfd219a21bc89610b2b020c9865409cd87e395","modified":1476064686776},{"_id":"source/_posts/Phabricator 在创建项目的时候自动创建一个 Herald 规则.md","hash":"e49e762c0a85e94e92d60c56d1f5ba1337e69cc3","modified":1500980055641},{"_id":"source/_posts/Swagger2 在 SpringMVC 项目中的应用.md","hash":"f440450cc5188634fcbfde2e7023ebde9ecb2233","modified":1497495217230},{"_id":"source/_posts/hexo的一些使用记录.txt","hash":"e19da419affd4dbce2faa1605571917b11be0d61","modified":1476064686780},{"_id":"source/_posts/mybatis-generator 学习笔记.txt","hash":"6d64bf683e96208cbfa0fd662b5738c4a3e441b6","modified":1476064686780},{"_id":"source/_posts/一个从 Jar 文件中获取所有的类路径的工具类.md","hash":"70123de55606a233f848f4718f8dbd9247edab6f","modified":1495849136412},{"_id":"source/_posts/使用Maven的profile和testResource进行Junit单元测试.md","hash":"c12844f062eace40453ae6d9f17817e3e3623d1d","modified":1476064686781},{"_id":"source/_posts/windows下自动上传war到Linux服务器，自动部署，自动重启Tomcat的系列脚本.md","hash":"e7f094e6a7a286904ca68ba96d0db2e499e290e2","modified":1497410333535},{"_id":"source/_posts/Phabricator 在 Windows 环境上的部署与二次开发.md","hash":"df2d47fa8fd0cbc4cbc6dfb6bf7442e2c893044d","modified":1500980055601},{"_id":"source/_posts/关于Java多线程在提升程序性能上的一些实践.md","hash":"04c5ac9fff38ed7068f848080fa4edeb16d61160","modified":1476064686787},{"_id":"source/_posts/Java 分段从文件中读取数据的一个例子.md","hash":"87b9ad154fa14f9ff203190aeb330ac1eb9bb364","modified":1495849136392},{"_id":"source/_posts/写在github上的第一篇博客.md","hash":"23acd9bfcf6e1c15d48e69bf97bf5cbe22fee3d6","modified":1476064686791},{"_id":"source/_posts/在 Phabricator workborad 的卡片上显示开始和结束时间.md","hash":"17602fe65652f1cfa382e6cdaff0812e1088da9c","modified":1500980016063},{"_id":"source/_posts/在 Phabricator 项目列表中增加任务数和最新任务的链接.md","hash":"0e2b5d3d48f52c04368e7ec364c2f99776d38bd8","modified":1500980055676},{"_id":"source/_posts/基于通过不同数据库之间数据对比来验证业务逻辑是否正常的测试技术.txt","hash":"d661608b6c75bd54685855fa17d6e757d37470a9","modified":1500961722368},{"_id":"source/_posts/在 Linux 上监控 Tomcat 是否关闭, 如果关闭自动重启.md","hash":"b3e94fead9850c663a0d1b2fa5b42480d50c3f0e","modified":1495850370690},{"_id":"source/_posts/关于分布式计算的一些猜想.txt","hash":"1591ed8984abaa4425a0fd911b817768aee2c0e4","modified":1495880886603},{"_id":"source/_posts/在Junit单元测试中通过@PropertySource来获取Bean中的@Value属性值.md","hash":"2f6d5c993ca032f8c5f0f341b6d8362a15277f65","modified":1495849146683},{"_id":"source/_posts/对于缓存的一些认识.txt","hash":"14208c99da46c9eb501ee72d3b8e73aa88594337","modified":1476064686794},{"_id":"source/_posts/对 Spring 中一些常见的 Annotation 的理解.md","hash":"7934d521aac4df2adcfc0930a3248383404e9c79","modified":1497409940727},{"_id":"source/_posts/通过构建对象池来避免new,再通过反射来执行对象的方法.txt","hash":"fe61bfd2ffc87afa21873f02b191ffa4733fc441","modified":1500961842937},{"_id":"source/categories/index.md","hash":"d84141743ecdebfbbfa470778b7bb54c27714119","modified":1476064686850},{"_id":"source/tags/index.md","hash":"001dd6f79652a835368f5279aa9983ceb9565307","modified":1476064686857},{"_id":"source/_posts/对锁的理解.md","hash":"6cb74f30625825c262459a62c889261e206a3e6a","modified":1497409578526},{"_id":"themes/next/.git/FETCH_HEAD","hash":"f57c1ebed03fd74c56e79bc30f0b3cd02b2e9516","modified":1500979841834},{"_id":"source/_posts/总结一下Spring中Bean的单例和多例.md","hash":"51fbc3b37c73acf343a7bb0089fb7b0851f83e29","modified":1476064686795},{"_id":"themes/next/.git/HEAD","hash":"acbaef275e46a7f14c1ef456fff2c8bbe8c84724","modified":1476067107045},{"_id":"themes/next/.git/config","hash":"adc4d53c04f156d5ef2b72f9330c5502fcf6580f","modified":1499134915211},{"_id":"source/_posts/MariaDB 在 RedHat Linux 上的安装过程以及 MySQL 相关命令的使用.md","hash":"07297aa5a447c60462c333775726b0587bc7b0fa","modified":1497410344893},{"_id":"themes/next/.git/index","hash":"2ea5e803757d5ca826c2fcdafd9bf411e54004b4","modified":1499134907790},{"_id":"themes/next/.git/packed-refs","hash":"2b019142afbfebbe883b6603ea96aeefd15e0e82","modified":1476067107030},{"_id":"themes/next/.git/ORIG_HEAD","hash":"6e2c489eb9c499bf49aacfb43dda123adfbc3c62","modified":1499077459813},{"_id":"themes/next/.git/description","hash":"9635f1b7e12c045212819dd934d809ef07efa2f4","modified":1476067052315},{"_id":"themes/next/.git/COMMIT_EDITMSG","hash":"afc8bddd707aaf66f194af3cf944f64afb801f89","modified":1499134907795},{"_id":"themes/next/.github/CONTRIBUTING.md","hash":"5adfad3ef1b870063e621bc0838268eb2c7c697a","modified":1499076674146},{"_id":"themes/next/.github/ISSUE_TEMPLATE.md","hash":"4de856de657a27f340f245eb491a1f52ceba1735","modified":1499076674168},{"_id":"themes/next/languages/de.yml","hash":"4be3e7d296d5592e0d111dfa6cbbff02602c972d","modified":1499076674226},{"_id":"themes/next/languages/default.yml","hash":"d912814caac150da1611c96843371a87714e52f9","modified":1499076674231},{"_id":"themes/next/languages/en.yml","hash":"b3ee45143bc014578db6b8ac0573f7c7b143a743","modified":1499076674235},{"_id":"themes/next/.git/sourcetreeconfig","hash":"297f846cd9c13bb44d804b337d6333d85b781a05","modified":1500861978044},{"_id":"themes/next/languages/ja.yml","hash":"1a608dc799c0f9c36b626bac6fe3404acb45b86d","modified":1499076674270},{"_id":"themes/next/languages/ko.yml","hash":"5c811514aef401317a9ec38b95679d6d2ef0ad42","modified":1499076674288},{"_id":"themes/next/languages/id.yml","hash":"c0848e93bf33a1333ff232905b6b392b1e056dd1","modified":1499076674253},{"_id":"themes/next/languages/fr-FR.yml","hash":"0d5bd8bbbeafb72506124ed35e7509debc753612","modified":1499076674249},{"_id":"themes/next/languages/pt.yml","hash":"943475a7d681f37ede579cd62da9c50568ca0f8d","modified":1499076674296},{"_id":"themes/next/languages/pt-BR.yml","hash":"cc8b5a67ec87b0d5aec6e253bab67ec3cfe3069c","modified":1499076674292},{"_id":"themes/next/languages/ru.yml","hash":"84d41a111e497236b2c1fa16e9b91668a1f37037","modified":1499076674301},{"_id":"themes/next/languages/zh-Hans.yml","hash":"3111ce4cc5f30868b3628f9f805d2aef3b75d1c1","modified":1499076674305},{"_id":"themes/next/layout/_layout.swig","hash":"0f547afe52721ffcbbc32bbf18d1041f1b546685","modified":1499076674348},{"_id":"themes/next/layout/archive.swig","hash":"a1d1e91013baaaeb7deaf35c6d3975971ce38e02","modified":1499076674876},{"_id":"themes/next/languages/zh-tw.yml","hash":"8ce0a32411de111ae39d08e4bc936767dacdeb08","modified":1499076674334},{"_id":"themes/next/languages/zh-hk.yml","hash":"b58c0d85daa4d62b0c9753a59de0739aa0120735","modified":1499076674321},{"_id":"themes/next/layout/category.swig","hash":"f315f12651de8065fdad73b003da4335ef177173","modified":1499076674882},{"_id":"themes/next/layout/page.swig","hash":"22ba721a9688d490fc66f360e5a319288b63b05a","modified":1499076674890},{"_id":"themes/next/layout/index.swig","hash":"4bf29f44ca9519a005671f2f2a79a48a148b435b","modified":1499076674886},{"_id":"themes/next/scripts/merge-configs.js","hash":"3ce1be32bb77ee19da25e8dae7dc04e2afc46ca1","modified":1499076674910},{"_id":"themes/next/scripts/merge.js","hash":"39b84b937b2a9608b94e5872349a47200e1800ff","modified":1499076674915},{"_id":"themes/next/layout/post.swig","hash":"182a99b1f6db0350106c6bb480fede0bbdb7e40f","modified":1499076674894},{"_id":"themes/next/test/helpers.js","hash":"f25e7f3265eb5a6e1ccbb5e5012fa9bebf134105","modified":1476067108422},{"_id":"themes/next/test/.jshintrc","hash":"c9fca43ae0d99718e45a6f5ce736a18ba5fc8fb6","modified":1476067108418},{"_id":"themes/next/layout/tag.swig","hash":"cc9878932580c890f8f3e569225e29bb37e25b49","modified":1499076674903},{"_id":"themes/next/layout/schedule.swig","hash":"8086f1163b10460258ecbbbe48b057b22bb2f02e","modified":1499076674899},{"_id":"themes/next/test/intern.js","hash":"db90b1063356727d72be0d77054fdc32fa882a66","modified":1476067108426},{"_id":"themes/next/source/fonts/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1476067107984},{"_id":"themes/next/.git/hooks/applypatch-msg.sample","hash":"4de88eb95a5e93fd27e78b5fb3b5231a8d8917dd","modified":1476067052319},{"_id":"themes/next/.git/hooks/pre-push.sample","hash":"5c8518bfd1d1d3d2c1a7194994c0a16d8a313a41","modified":1476067052338},{"_id":"themes/next/.git/hooks/pre-commit.sample","hash":"36aed8976dcc08b5076844f0ec645b18bc37758f","modified":1476067052334},{"_id":"themes/next/.git/hooks/pre-receive.sample","hash":"705a17d259e7896f0082fe2e9f2c0c3b127be5ac","modified":1476067052348},{"_id":"themes/next/.git/hooks/pre-applypatch.sample","hash":"f208287c1a92525de9f5462e905a9d31de1e2d75","modified":1476067052330},{"_id":"themes/next/.git/hooks/pre-rebase.sample","hash":"5885a56ab4fca8075a05a562d005e922cde9853b","modified":1476067052343},{"_id":"themes/next/.git/info/exclude","hash":"c879df015d97615050afa7b9641e3352a1e701ac","modified":1476067052361},{"_id":"themes/next/.git/hooks/prepare-commit-msg.sample","hash":"2b6275eda365cad50d167fe3a387c9bc9fedd54f","modified":1476067052352},{"_id":"themes/next/.git/hooks/commit-msg.sample","hash":"ee1ed5aad98a435f2020b6de35c173b75d9affac","modified":1476067052322},{"_id":"themes/next/.git/hooks/update.sample","hash":"e729cd61b27c128951d139de8e7c63d1a3758dde","modified":1476067052356},{"_id":"themes/next/.git/logs/HEAD","hash":"e6b1431e4490b1e3bf7862015994b73c79a2aaee","modified":1499134907814},{"_id":"themes/next/.git/refs/stash","hash":"2dd88fa943bd102d260e509789eec431d490084d","modified":1499076666306},{"_id":"themes/next/layout/_custom/header.swig","hash":"ba8ab5a0280b953aa97435ff8946cbcbb2755a27","modified":1499076674345},{"_id":"themes/next/layout/_custom/sidebar.swig","hash":"ba8ab5a0280b953aa97435ff8946cbcbb2755a27","modified":1499076674346},{"_id":"themes/next/layout/_macro/post-collapse.swig","hash":"8c56dd26157cbc580ae41d97ac34b90ab48ced3f","modified":1499076674352},{"_id":"themes/next/layout/_macro/post.swig","hash":"6f3c6078b9dbc238ccf86fb228c24c0b94f67d47","modified":1499076674378},{"_id":"themes/next/layout/_macro/post-copyright.swig","hash":"506feb56e9b1091187d2014742f63a17758df933","modified":1499076674356},{"_id":"themes/next/layout/_macro/sidebar.swig","hash":"4b029551ddb44c53f895e96cf8ff5ffbe02322fb","modified":1499076674397},{"_id":"themes/next/layout/_macro/reward.swig","hash":"b6cb171f0ed227b82b8f7601814af2df93f3a09a","modified":1476067107251},{"_id":"themes/next/layout/_macro/wechat-subscriber.swig","hash":"c5cc0070ca7c9a8dbd4b09e0398db536c3cdbe8a","modified":1476067107261},{"_id":"themes/next/layout/_partials/comments.swig","hash":"5258c03149aa18e9abfeb8de10e435a406d9c924","modified":1499076674404},{"_id":"themes/next/layout/_partials/page-header.swig","hash":"77c61e0baea3544df361b7338c3cd13dc84dde22","modified":1499076674477},{"_id":"themes/next/layout/_partials/header.swig","hash":"d6bf1d1554d91eaf1bfc40ba8905ae81673e5f45","modified":1499076674464},{"_id":"themes/next/layout/_partials/search.swig","hash":"b4ebe4a52a3b51efe549dd1cdee846103664f5eb","modified":1499076674498},{"_id":"themes/next/layout/_scripts/boostrap.swig","hash":"c0f5a0955f69ca4ed9ee64a2d5f8aa75064935ad","modified":1476067107361},{"_id":"themes/next/layout/_scripts/commons.swig","hash":"931808ad9b8d8390c0dcf9bdeb0954eeb9185d68","modified":1476067107365},{"_id":"themes/next/layout/_partials/pagination.swig","hash":"1634fb887842698e01ff6e632597fe03c75d2d01","modified":1476067107290},{"_id":"themes/next/layout/_scripts/vendors.swig","hash":"53c894e6f3573c662dc4e4f7b5a6f1a32f1a8c94","modified":1499076674519},{"_id":"themes/next/layout/_third-party/duoshuo-hot-articles.swig","hash":"ba75672183d94f1de7c8bd0eeee497a58c70e889","modified":1499076674744},{"_id":"themes/next/layout/_partials/footer.swig","hash":"683616f4a80796051e2346d80acf838a589450b0","modified":1499076674409},{"_id":"themes/next/layout/_partials/head.swig","hash":"09b110f77c415c5b71ebd886771a10bc84b95633","modified":1499076674413},{"_id":"themes/next/layout/_third-party/mathjax.swig","hash":"a0bd3388587fd943baae0d84ca779a707fbcad89","modified":1499076674752},{"_id":"themes/next/layout/_third-party/exturl.swig","hash":"8301c9600bb3e47f7fb98b0e0332ef3c51bb1688","modified":1499076674748},{"_id":"themes/next/layout/_third-party/rating.swig","hash":"554ec568e9d2c71e4a624a8de3cb5929050811d6","modified":1499076674781},{"_id":"themes/next/scripts/tags/button.js","hash":"aaf71be6b483fca7a65cd6296c2cf1c2271c26a6","modified":1499076674924},{"_id":"themes/next/scripts/tags/exturl.js","hash":"5022c0ba9f1d13192677cf1fd66005c57c3d0f53","modified":1499076674938},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"99b66949f18398689b904907af23c013be1b978f","modified":1476067107564},{"_id":"themes/next/scripts/tags/full-image.js","hash":"c9f833158c66bd72f627a0559cf96550e867aa72","modified":1499076674943},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"ac681b0d0d8d39ba3817336c0270c6787c2b6b70","modified":1476067107572},{"_id":"themes/next/scripts/tags/lazy-image.js","hash":"bcba2ff25cd7850ce6da322d8bd85a8dd00b5ceb","modified":1499076674958},{"_id":"themes/next/scripts/tags/note.js","hash":"fc4958427ca7bdb47a7d830077f432ed824973e4","modified":1499076674963},{"_id":"themes/next/layout/_third-party/scroll-cookie.swig","hash":"9a188938d46931d5f3882a140aa1c48b3a893f0c","modified":1499076674797},{"_id":"themes/next/layout/_third-party/schedule.swig","hash":"db15d7e1552aa2d2386a6b8a33b3b3a40bf9e43d","modified":1499076674787},{"_id":"themes/next/source/css/main.styl","hash":"a91dbb7ef799f0a171b5e726c801139efe545176","modified":1476067107980},{"_id":"themes/next/source/images/algolia_logo.svg","hash":"16505f61f19ba65f629dfd033f14ee9abcf18756","modified":1499076675346},{"_id":"themes/next/source/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1476067107985},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","hash":"6f55543d1fb9cbc436c101d24f802dec7b41efc3","modified":1476067107991},{"_id":"themes/next/source/images/cc-by-nc.svg","hash":"6f076713fb9bf934aa2c1046bdf2cf2e37bc1eab","modified":1476067107997},{"_id":"themes/next/source/images/cc-by-sa.svg","hash":"70c1535f43e54e5ff35ca81419e77e4c0c301398","modified":1476067108009},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","hash":"bc3588c9b2d7c68830524783120ff6cf957cf668","modified":1476067107986},{"_id":"themes/next/source/images/cc-by.svg","hash":"e92a33c32d1dac8ed94849b2b4e6456e887efe70","modified":1476067108014},{"_id":"themes/next/source/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1476067108024},{"_id":"themes/next/source/images/cc-zero.svg","hash":"9bfb52b2f63527a7049247bf00d44e6dc1170e7d","modified":1476067108020},{"_id":"themes/next/source/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1476067108025},{"_id":"themes/next/source/images/cc-by-nd.svg","hash":"42cd73da328077ccc92f859bb8f3cf621b3484f8","modified":1476067108003},{"_id":"themes/next/source/images/quote-r.svg","hash":"2a2a250b32a87c69dcc1b1976c74b747bedbfb41","modified":1476067108029},{"_id":"themes/next/source/images/quote-l.svg","hash":"cd108d6f44351cadf8e6742565217f88818a0458","modified":1476067108026},{"_id":"themes/next/.git/hooks/post-update.sample","hash":"b614c2f63da7dca9f1db2e7ade61ef30448fc96c","modified":1476067052327},{"_id":"themes/next/source/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1476067108034},{"_id":"themes/next/layout/_scripts/schemes/mist.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1476067107372},{"_id":"themes/next/layout/_scripts/schemes/muse.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1476067107373},{"_id":"themes/next/source/css/_mixins/Mist.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1476067107855},{"_id":"themes/next/source/css/_mixins/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1476067107855},{"_id":"themes/next/source/css/_mixins/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1476067107862},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1476067107968},{"_id":"themes/next/source/css/_variables/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1476067107979},{"_id":"themes/next/.git/logs/refs/stash","hash":"9e9eab10a34f1780e0fee51f8e8f3be89eca34ca","modified":1499076666312},{"_id":"themes/next/.git/objects/02/49c5c48c9860469d76c14487101d06702b167d","hash":"e7e0ee1014842c0e1d6bc1e8fb176f33d55b5bae","modified":1500765332164},{"_id":"themes/next/.git/objects/02/c79d6e2abfabac5976a0bf91b4da8e4d9e8090","hash":"9dfbf50b386a75d086385dcba3834c39660543f1","modified":1499134907787},{"_id":"themes/next/.git/objects/01/ddd51100a89be32193a2868c7c19ce75881704","hash":"61af57dd323c3bcde29c398c936a7898b3ff7262","modified":1500765332493},{"_id":"themes/next/.git/objects/0a/9fc489f84636ef8713d3b823c549e34fe2eabb","hash":"36ec83e66f3b40c0d206719ebdf53cf438ba1e14","modified":1500894033803},{"_id":"themes/next/.git/objects/06/3cd1472c4c5d6a89a29933c1668e7d2c8b5142","hash":"80b5f1b65ebf194dad4940c0c9fa5aea5f00cdbb","modified":1499823634580},{"_id":"themes/next/.git/objects/0a/ac94f7499ce7ff8546501808085c96933228db","hash":"65b204e71fff37e6374105eda337d44119d0b2f4","modified":1499823634744},{"_id":"themes/next/.git/objects/03/ec627b9328c636fa2cc7db40ba7ce1f7b13899","hash":"55c5bcd6906f94e98e7948569f9c3476721e273c","modified":1500843356770},{"_id":"themes/next/.git/objects/0b/937e9e9dbc247075174c420f741abf5621d516","hash":"d7148ede472c408cc342be5fa9cf74db2a5a45fd","modified":1500772527234},{"_id":"themes/next/.git/objects/05/2b0d8d9bddcdc42e38af0ea054b168cd8ad48a","hash":"42e77eef37b92819deb8a77f562d14432d1ab71c","modified":1499350476395},{"_id":"themes/next/.git/objects/0b/4ce8e3e5fc0c36b85d941a5e5c74e782837f46","hash":"fab9e51ebda07f84234b3c40b71207025790c51a","modified":1499823634857},{"_id":"themes/next/.git/objects/00/f33642d9f47f7b360c348035865cc4f92fe2ba","hash":"6fc14661e43d49a65f1061b46ae6b08171762ad5","modified":1500048912648},{"_id":"themes/next/.git/objects/0d/68e8957974eb4b6d7962c9f3a964ab393595fc","hash":"24fef2b45f3d81bc67882958ddc0726b27e7bfed","modified":1500803137023},{"_id":"themes/next/.git/objects/00/b1d8eb2a9374727d1563b318f24d75c9c9dc53","hash":"6353311dc7ca4ad255f5d53f70219a50ed3bbfba","modified":1500766529594},{"_id":"themes/next/.git/objects/0d/e48a92d9cdd495c6dcf98dda5e18bef5dda169","hash":"fabc693f4c06abec7f3d46c6b3bc0b1e68e6bf5e","modified":1499823634738},{"_id":"themes/next/.git/objects/0f/578aef4aa44c21d4ca3ee9c5af546d3a749b69","hash":"99e6f13408a098634f988aa52d71cd568492dce3","modified":1500770128981},{"_id":"themes/next/.git/objects/10/e682bf763b0cf945f7d4161b1426e9393c4ae1","hash":"c84553a30ca5a4981c92c843623328f2c20fd602","modified":1500904844924},{"_id":"themes/next/.git/objects/0f/9c099c1fdb6a76cdc2b0a2df5e330635f57737","hash":"62d603c561a4fc2736b2cb2434dd533d6a093504","modified":1500045910869},{"_id":"themes/next/.git/objects/11/000079281b58c12f64b3c982004a38c2554153","hash":"62704ec89f2fe456bfd94c9f80fef9a15008399e","modified":1499823634543},{"_id":"themes/next/.git/objects/0f/11cc14a4207401aa8016b905630ee7573be0e1","hash":"0d06d1b3e7483d045471427a05ea8a1b51b7b737","modified":1499909704207},{"_id":"themes/next/.git/objects/12/b874777e44741fe825968481751e31615cde3a","hash":"ba9c2b9d0a047f579ed2b4bccaa59a38ae178c53","modified":1500894033846},{"_id":"themes/next/.git/objects/11/97a574f6eb6b32f5cf4130028d67e9d7159c9f","hash":"4defe1acede4ceb8f2d1e25a52f2138628bd7dd4","modified":1500434708733},{"_id":"themes/next/.git/objects/15/c4d214d23be53d2e2d82fa982a13a173731c04","hash":"d5edf4ebc4e3cbc189fecda56b352ffc5aa07fa8","modified":1499823634598},{"_id":"themes/next/.git/objects/1a/bb54642c5ecd3251287bcb84651ab8a461a71a","hash":"419886a9f9d1bcfd41a72144ddb98beff5cb31bd","modified":1499823634601},{"_id":"themes/next/.git/objects/1a/da1656f16b23651ae9fbadb422ca7765349bd6","hash":"47357fd0cf38307625e0e8f5eb5cbe5adf8397d5","modified":1499077786985},{"_id":"themes/next/.git/objects/17/232d01dda73b2505e73b7ca4a8e4b82c7eb51a","hash":"4acb60dc971c6a4b4d744870cf56a5a7933a4f77","modified":1499350475819},{"_id":"themes/next/.git/objects/13/a3a3ba5631ffb1b545c92dd7fe65d0d18bc889","hash":"3ecc22a84f76990febda4dcfeccda1f21278420a","modified":1499076718536},{"_id":"themes/next/.git/objects/1b/89c5c738549ad133a774c1f587d7246fbc0e7d","hash":"c12e2f61a76718b7d2963c9fcdb9ab0962241f18","modified":1499992501918},{"_id":"themes/next/.git/objects/1c/720f1fe1fdf8a1c9a8fb3e299bf669b3ac35ad","hash":"c7a705a27ea3a7dab1d19d04fc32cddc11e719a2","modified":1500767127021},{"_id":"themes/next/.git/objects/0c/ba32d5f9b0800f293c1d887ab56e5f6c12ffeb","hash":"71e74f7339866840cb8a890582b918c6ea6fd8ae","modified":1500772527238},{"_id":"themes/next/.git/objects/21/69ef48ef95a68faac8f6ba0722383504dc5860","hash":"56ad535bf151be4f0945e83fa5565005b07488c3","modified":1500527709877},{"_id":"themes/next/.git/objects/20/bf59972947fa609b5ab7bb8585ec6d1514df39","hash":"fe19dc06850aa6f68457a8f58930efce2e8f7fff","modified":1499909704210},{"_id":"themes/next/.git/objects/23/18b74778c067ac0f5c13b6aee51c6f985d83a7","hash":"11cf86274e416b8ebf1e44f0acfca4734e00c9c1","modified":1499909704359},{"_id":"themes/next/.git/objects/23/ee43ada2202a7c1c0362d86a6f8c32eac9fa1c","hash":"c085375ce3fb250fb35bc0580f2bbceda718d7c9","modified":1500045910667},{"_id":"themes/next/.git/objects/23/7f1a910bd3e312e0b81f05ba7678aa183ad9b9","hash":"f8cf7dd598c2bd70bb44e237ff4c205d39e49612","modified":1499823634577},{"_id":"themes/next/.git/objects/28/6157d34edb57ea05d433b97838cae09b311eb6","hash":"40253dc91edae3228ba5741d39c07c4d89bc921d","modified":1499823634652},{"_id":"themes/next/.git/objects/29/c753eafb74ec88615f947d25acb4659340747d","hash":"121ade9c10d27107afdf4d18f016f99afd5361bf","modified":1500894033862},{"_id":"themes/next/.git/objects/2a/b8848684f935addd38c55829e81f08cfc2d9cc","hash":"13dbe09c9790ca71d2db519cde44b1f0eea61bf0","modified":1500048912626},{"_id":"themes/next/.git/objects/2b/526832c89b2d655dbc70b1e75273cca3b8c831","hash":"bd41f7660735b8cad1e62f5dadad82d356368ade","modified":1499076666258},{"_id":"themes/next/.git/objects/2c/53a99fb9790b31f5034718dca1ab18fd1e19ac","hash":"f1a06e79a1b554ff88c61b0bc5e47c7796744fda","modified":1500894033853},{"_id":"themes/next/.git/objects/1a/e463a7da37d18ceaa09cf67dcc1310e0eb7cc2","hash":"259e415e4ca27f48ef44853aca52f741cac4dfa4","modified":1499823634816},{"_id":"themes/next/.git/objects/22/2e8c23414a8d9f14176c5903485d8aed28d237","hash":"338d9fe1a4fd8c3bdf078bb06d50dd972b1310f6","modified":1500674112524},{"_id":"themes/next/.git/objects/24/ae587f95827b1a74cc4a40a47fa0e740941426","hash":"d794a9a9aa307fefc6094dcbaf838ba9daefab41","modified":1500434708647},{"_id":"themes/next/.git/objects/30/3a8fd21baa4b1c04c17f03fc96e675f24f97ec","hash":"21a9b4de15c6c02852fb6f6489fbab281a245d65","modified":1500761726056},{"_id":"themes/next/.git/objects/27/bdba70734522ef9326ee94b23ccc4858b64c6b","hash":"6b3ac11365ed7e3d27cf09138c74fca98401e125","modified":1499092453941},{"_id":"themes/next/.git/objects/31/1acb2ca9a0ebc983738888738d7897785573d1","hash":"7d1317a0b167c058b93950ed0aa5fd5ace2922b6","modified":1499909704176},{"_id":"themes/next/.git/objects/32/16c6810024bd7d9f18f5fa5ef543f9bce65613","hash":"6c35fc3c73e24593839a08932e49e36d1e2a400f","modified":1500048912629},{"_id":"themes/next/.git/objects/2f/33e35de3b3604a7eabff9d4456e2a91be9e13d","hash":"f7da3fb625c0e2705a375e836364fa4e667ae70b","modified":1499823634796},{"_id":"themes/next/.git/objects/38/89fad93708b2757371468e05987ea897708b1c","hash":"ba250cba0bb64991ed4cbe379cc27bc8dc59b067","modified":1499823634690},{"_id":"themes/next/.git/objects/3a/3b864f6616f89aaa0c1e92ed0b9f98bd96daf1","hash":"98582cf64f10f65a8b6b350ada65baa41265b80c","modified":1499823634552},{"_id":"themes/next/.git/objects/17/05742f0e4498ce574c94fa2bbdba93970724c9","hash":"42905d9842c2bb2893bfc4190630016221ce7580","modified":1499823634591},{"_id":"themes/next/.git/objects/3a/6f98d788feef477dd83b6d20a67221e5255552","hash":"21b71eee352bba599cb8876dcfe01a6fd1b76f85","modified":1500045910713},{"_id":"themes/next/.git/objects/3b/95b3b79a9b98376124bcc499cc1c07779eede4","hash":"13be11e9cc27b0094cfae1948bc9ca53cc3f96c4","modified":1499823634641},{"_id":"themes/next/.git/objects/33/dc1364586430307155abebd1cca13a0119d92a","hash":"3d8d5aedf3c3c36d1fc3d96c1aaa3f39d721651a","modified":1500533099531},{"_id":"themes/next/.git/objects/40/7b065a69b5a5522dc21b48f923e90e4195c2a0","hash":"7e566c3ecfa61d821e02ecb499ae14cb5564c6cf","modified":1500769527539},{"_id":"themes/next/.git/objects/3c/95747386d35962f60d615be805ec572cab5d7c","hash":"f645af60dce6627b2c62b5367bf453aa2701a7af","modified":1500904844942},{"_id":"themes/next/.git/objects/38/b6a638b507892ccd915655d12b4500b0432794","hash":"b4290b7f5f354fc4efd8700c51554239414b4ac0","modified":1500766529612},{"_id":"themes/next/.git/objects/15/19652af9917a47cb0531323690ad874d94a2c7","hash":"42165ec27864500d1a6a809334df9d37bdfe076f","modified":1499823634612},{"_id":"themes/next/.git/objects/46/9a8f6553a98df5db239ad402b9c75fc941f6c9","hash":"c2c71cd4d3589c7a4414a408a115e7d82f751dde","modified":1500527709911},{"_id":"themes/next/.git/objects/14/6e9b43b903fc1069fbeea5d8a6a68d6ab90c7f","hash":"5aa0cf1711d8967cc87449178c6687ad50632579","modified":1500772527264},{"_id":"themes/next/.git/objects/49/8e1eed6d5658b3af23fdfd5ac2b656c34e3b3b","hash":"2bfc20790c800a9ead51fc7de1201f03f2e0f970","modified":1500045910863},{"_id":"themes/next/.git/objects/4d/85031581dd607bfa251827cc15828b9e138a7f","hash":"c6242a34e190cad135a7f6f5f70898f14163adb0","modified":1500769527548},{"_id":"themes/next/.git/objects/2e/8bb98e4e22fc04fec6758a723cc64ae087ad6a","hash":"ad8e541966da6b63ab16151ec32a932293bee377","modified":1500045910938},{"_id":"themes/next/.git/objects/2e/1dd757a971e8fab65ae01b8593377c37e2dda4","hash":"5af2ecb18ac7bb2a24ee1c3fb353f8faf58811e6","modified":1500761726127},{"_id":"themes/next/.git/objects/4f/0414b4766610aad4d3110c5f825c567f6c9d01","hash":"3e19d3e1664d1ce7935fc2da2a304aabce665dd7","modified":1499092453958},{"_id":"themes/next/.git/objects/47/7ac93544341f9df5e814046ff4bea57f28f60f","hash":"f95ea7ff272c139d203db8ea2123d7cc73d3793b","modified":1499823634853},{"_id":"themes/next/.git/objects/50/96d863ae98edbca541ab0626aef690428f4959","hash":"d564bfe27ca63dbd3bbd1dd716f6f102ea18bd3a","modified":1499823634747},{"_id":"themes/next/.git/objects/52/8138ed517f71ba1a05e33f53c5ca3d25440097","hash":"e2086fb6e3c0937503b17244b01ea4a00e529fd3","modified":1500434708615},{"_id":"themes/next/.git/objects/51/21b501b9f56c9a359e217369d6f3b1d5dede4b","hash":"72f2e4f9002d3ca5aff734b91635b306d9730174","modified":1500434708736},{"_id":"themes/next/.git/objects/56/42d3283cda90b26da0499c7a71420d66630991","hash":"398be81a5c51c79274f4ef0320866cf432f227ed","modified":1499823634545},{"_id":"themes/next/.git/objects/50/8635f48ff34b041a8b765497a57cfdd8a2c63a","hash":"546c98bf4c67478049743cab4fbfcff8ebe8a68e","modified":1499350476481},{"_id":"themes/next/.git/objects/56/3def506845b12336f655d0d7417fd64e1d4d8a","hash":"db7c9d0afd7217754c165d66795751924316bd3e","modified":1499350476398},{"_id":"themes/next/.git/objects/57/1051df278c9f92dfaf381ba5b9d3c4c8362fe3","hash":"0d34220a5a75ade0388f6a2f14467811dfcb130a","modified":1500674112337},{"_id":"themes/next/.git/objects/57/2b9ba859191e14cedd24acdbc80ff2d6e4166f","hash":"098861a9c0f5759424b970a950d46acbcbe7031b","modified":1500533099487},{"_id":"themes/next/.git/objects/59/103b3e789c23eeff502937c2c4ac7e411f27a4","hash":"5a23fb7e0340bd0504eaa0871ab02088b7b06860","modified":1499959509997},{"_id":"themes/next/.git/objects/56/f6294219ed85cb4f8a7939714773c2d5c3a727","hash":"179c23a2f484657b6e0a2a0a1dccebef747f507a","modified":1499823634583},{"_id":"themes/next/.git/objects/54/0d0a1954f527999ce2b5deff425060276d2223","hash":"af6f5e795ed0fdf3e2eb71a345345b1f369c2956","modified":1500894033840},{"_id":"themes/next/.git/objects/52/4e0e6491252961315d6e75692582285da3a313","hash":"7998f102746912b2198ddfc7abd739f19368103c","modified":1500767127052},{"_id":"themes/next/.git/objects/5c/74c0a47658e5c7a22a52efa2d4e75bbcb7df61","hash":"5b7d7974b1c0aded7535321098f5faa691ab14d7","modified":1500786937165},{"_id":"themes/next/.git/objects/4e/73fb3f448b90402ad7e6ef5246c44178d52083","hash":"94296c4d20ddb2edecdf7da2a3399a5c05862275","modified":1500533099504},{"_id":"themes/next/.git/objects/5a/97cd22d20309d6fd4fafaf62dcbfd205d231e0","hash":"8bc8e05817382d8a746a7f5d9db5fb08858d7da9","modified":1500048912642},{"_id":"themes/next/.git/objects/56/68c83aa86b009426a4b39862ff806ddb2140bd","hash":"98ad9291475d89283dcc9cab342f2032de7bb4b4","modified":1500765332167},{"_id":"themes/next/.git/objects/40/806373fcf3fb91b4fa699062c329ea91ca3b38","hash":"c6789817507b817a9ed3b6303dde411da898d8c1","modified":1499163251454},{"_id":"themes/next/.git/objects/39/b820d8c78aaf9be36639edfd0f09c3aadc8e4d","hash":"5c86b6fabc440c109516fab7ae19784333b05887","modified":1499823634684},{"_id":"themes/next/.git/objects/61/8aa9a1e5b5e0d994a84629c1d1022d7bc637e4","hash":"28d306c8a3463661aba90707048319965a285400","modified":1499092453937},{"_id":"themes/next/.git/objects/39/676ed9390a65c127c0e3d83d4ce1bc1cbf454c","hash":"c66a60c14f688ec92a6811a37b6433798ecbb2de","modified":1499823634860},{"_id":"themes/next/.git/objects/61/5838c474d86f8066ba0b270831e708b85e5c40","hash":"f13cdaf5585a4e8e41f9ce541415a8f492411048","modified":1499823634771},{"_id":"themes/next/.git/objects/40/d4f8396cf7caa9bd9d1690abb6983307acddf6","hash":"e3d9534f97ed2d3913e26a6661919a131fb77697","modified":1499077439750},{"_id":"themes/next/.git/objects/39/2b54219bd0744332a9da3b8652e327624fc4ed","hash":"f69f5f43a928872db9154b91d67e3c838c1985f9","modified":1499823634776},{"_id":"themes/next/.git/objects/64/c6166797361e6c7f5ba4404a45cf237c6d258f","hash":"591d193f9ea34060a986b0a58cbb58e1f36ad5c8","modified":1499909704196},{"_id":"themes/next/.git/objects/65/5a250485e94573be2774ed340575f010933a92","hash":"90275b25e34f06569a0dddaf4d8a3d9b2a09480c","modified":1499163251471},{"_id":"themes/next/.git/objects/65/cf438220790efb9ef4def2570267bad6bdf7e0","hash":"be1f0746713b0cba70b1153897ac3d797d3c78fb","modified":1499077786000},{"_id":"themes/next/.git/objects/63/3a32172c5a09bffb7a2196bb9eb4d23541230d","hash":"78cf161006486e8c77e35920cd4c1f88e49e428f","modified":1499077439753},{"_id":"themes/next/.git/objects/67/dc0b63bd6cb5323fdd0234f73740e48b8ecc65","hash":"4a9da1370f36ba48a50a47dcf15bf26c51cd41a7","modified":1499823634658},{"_id":"themes/next/.git/objects/6c/a07f3ab3f1937a5693cd6bbde7f327240e45cc","hash":"640e0737219311dfad932453c3f8aa2f64828b29","modified":1499092453945},{"_id":"themes/next/.git/objects/6a/1db1538352315107c0d66e6a3ee993690f4a40","hash":"b7ba4049031cfb4ead3d3a19db575927a463424d","modified":1499823634644},{"_id":"themes/next/.git/objects/6d/b9513b40d46636e8286f2854cfd3c0aaadcad6","hash":"c53c2340cab48d12d2f603059170d9256f6dc9c1","modified":1499909704187},{"_id":"themes/next/.git/objects/6e/d5115fe384152e7afbf93225d508bac6a16d54","hash":"3acd8f1ce74ea8043ece712b4b0622b969dbed97","modified":1500765332044},{"_id":"themes/next/.git/objects/6d/3b5133cd3f94048a88848c539ae8873776985b","hash":"99c5b4d6094a69e9f966a66c48555f80e06fc493","modified":1500766529615},{"_id":"themes/next/.git/objects/64/fbf0495e87d526ff4263e7ed9c53af390862bc","hash":"d87546f9cc7ac1e76173dc8db07ac1ce79e45efb","modified":1500786937162},{"_id":"themes/next/.git/objects/6f/a8b07ac2d1b8b9ec4ccc3329ef39e8e8426257","hash":"1dae7988a7df447d716b51d1f247efeffa6760a4","modified":1499909704312},{"_id":"themes/next/.git/objects/74/7a3d2ce48cea7e747f4eca9d54b4ab145ec7b9","hash":"7b524d61e6ea7e902e10f8b88cc505cfca9ad3e9","modified":1499163251480},{"_id":"themes/next/.git/objects/73/82adbfaa209a86ca3cf96375410ac1878bd0cc","hash":"5b95979349d77c2bf9f753494a30ebc4be4c5dc8","modified":1499909704337},{"_id":"themes/next/.git/objects/74/8a2530638bfc2c943e2c262eacdd28ace18721","hash":"248b7e3960883a5e7bc86bcaa43286c605c7d5a7","modified":1499350476246},{"_id":"themes/next/.git/objects/76/185e16f553c9087fa1a6d246b8cc2821e7226e","hash":"c3d40e88e5d2d7a6e824c7fd779f502163fa71cd","modified":1499959510022},{"_id":"themes/next/.git/objects/75/4e92c35b6f99524a539a68e032f1138d7bf0e2","hash":"4e3df19e1098548df00e05496e429e0fc4b637fe","modified":1500766529608},{"_id":"themes/next/.git/objects/76/79ddfcf81838b3c68479a23038d6868f6c89d9","hash":"68c9546294ecdb0ccf6c8def4e3433c7788dfb57","modified":1500843356758},{"_id":"themes/next/.git/objects/5d/a9e654507ccc57faa49dca27b7857497e0f410","hash":"dee3b469e4efd5c67f10df3da8dd46749cc497b0","modified":1499823634693},{"_id":"themes/next/.git/objects/76/21e6942fe2285aabfbebff9a36a15a82753a3d","hash":"2881319b1395423a22dc5986ad1fdb44e0e8b3a0","modified":1500434708696},{"_id":"themes/next/.git/objects/6f/392a194f5ce9f4bc8f813e023e23d7a15b2580","hash":"9d2df2510f5db048cff498eb51b01854db8c50f1","modified":1499823634830},{"_id":"themes/next/.git/objects/7d/17770ff6905df84fd0dada6b8b1134cfc5fa23","hash":"55e94bcd99cded663da592e095831470b7fc5df5","modified":1500770128974},{"_id":"themes/next/.git/objects/63/b46d0e7c3c067280b29c3f829b5e0a20689006","hash":"8bf70ea0a95af15d34950f6552aeb359f8ec8b36","modified":1499823634761},{"_id":"themes/next/.git/objects/75/1821cdfea92754a608e24e1f804bb6bb32459f","hash":"1f7a45efbcd4115153048cacc060a603e4b41d05","modified":1500674112409},{"_id":"themes/next/.git/objects/7d/9e9df06e1ba0942ca7700942abc6317f3d6027","hash":"6ed9e2cf763546f661d87b22b4853902bbce3f26","modified":1499350476286},{"_id":"themes/next/.git/objects/81/2c73a2fcc0be9f08dbbfd7e39e60a370772f77","hash":"c90679261be7729880c1f0083109d24031cbfbdd","modified":1499909704191},{"_id":"themes/next/.git/objects/5d/f5e74b24a267ed62932339fc1ad8ddebc0cb4b","hash":"103c283d39f9e461fc3d2719f570daf547312905","modified":1499909704203},{"_id":"themes/next/.git/objects/81/d4f864c279d044d3d22b1638441b6d1c9c03a4","hash":"252c5cfa5de9d8a5bab2e41483b0a5240d444e60","modified":1499992501925},{"_id":"themes/next/.git/objects/81/f0b181f53a082f6606cd71589ad5c15edcc0c7","hash":"edf7f937fe0f94215dae2e1bf6c769bc3f3535e2","modified":1499823634681},{"_id":"themes/next/.git/objects/82/ba9e5a409fbbb539c36c535e2e0946d46ffcef","hash":"fbc4349316ff98aee90f85035006e5566dec08be","modified":1500894033849},{"_id":"themes/next/.git/objects/7b/5a2918763fda3c78122c7944ca84b7d458b212","hash":"dedd3f2793e21ded529caf156bad595e54107fa7","modified":1500674112530},{"_id":"themes/next/.git/objects/83/8a443ebaf7b3b37f391224c585f046725b58ec","hash":"82a544b6bda47abbac32db1e787ca0ad8520c186","modified":1499823634539},{"_id":"themes/next/.git/objects/81/6904c14ac16108df6190e735e433edf722f10a","hash":"d90e2bffad4159bd1d84aa89a6c85061659020e2","modified":1499823634799},{"_id":"themes/next/.git/objects/83/2a020a6aa37421acf8cf7724972fa05992c537","hash":"ebd3b1faa00529a50dd78841f91ddd6c7d4f69ff","modified":1500674112403},{"_id":"themes/next/.git/objects/84/f648612a69d1147f8f21aa755445497aa43f20","hash":"38a2760604838a4329f84c7d8fc07cef9ab66a4c","modified":1499076666129},{"_id":"themes/next/.git/objects/89/5e52243973886d383a63c9e0c359a3412f2487","hash":"ef5443710571c0c0f8427a0a1f3ba9e112daa176","modified":1499350476460},{"_id":"themes/next/.git/objects/89/e2f366140ba004b3c6fcaad74e512ae9331d11","hash":"1d638c75e558f11231cb4a91ca0030c133b3e191","modified":1499350476296},{"_id":"themes/next/.git/objects/89/fafe105182af3a42a7596644ae9cd7f56c71b8","hash":"c016af57cff61c1b3e1b00c622c2180707e553ad","modified":1500772527260},{"_id":"themes/next/.git/objects/7f/b868cf3a13f6721e899c87dff63da941c0aa3f","hash":"e84c0730b5f37d8ff1444bf50acee5e99d43c897","modified":1500527709915},{"_id":"themes/next/.git/objects/8f/42aa2953d5aae0b2ec501a85d64f5a5dff29f8","hash":"4f6511dd0b5b6921c3b3c8426ea5d73537771bb4","modified":1499134907801},{"_id":"themes/next/.git/objects/8d/5103e47ad2bd3502c28002094491b788bbcdfb","hash":"1b1d0fa483a5af7b7f30bd89e3790423269b57be","modified":1500434708739},{"_id":"themes/next/.git/objects/93/5debc26e3615734ee095be78c1da612a008fab","hash":"ac3121286da9f6e320c3af0b1d9cdd5fb810604b","modified":1499077408509},{"_id":"themes/next/.git/objects/96/ea5d3d928c54292fea6b7d57adb5477998e464","hash":"76bcad08f65d0a052942693b8ba34100d36c55fa","modified":1499350476484},{"_id":"themes/next/.git/objects/96/f203f8a36fd4d5e77f5cbfbead5885e53ceb8a","hash":"53fc19e6c168e9408994c0879c7dc048a8487195","modified":1499909704185},{"_id":"themes/next/.git/objects/9b/afab6ef59ce585cbc456d03770e167d2a3c9e2","hash":"247fc0d259c12286c49228d97f033a927a62d57d","modified":1500894033858},{"_id":"themes/next/.git/objects/93/3e33dfaf398fb3426511e078c35ac4b0fa4bc1","hash":"767116b2365acc0e2f14db624d8e04a45fbe9aa3","modified":1500803137019},{"_id":"themes/next/.git/objects/8a/58aa3dcbc3c164c918f05eb93bf0769d54164a","hash":"179b8e58886f4365a7c9bb9ff77b5dc04a4d8833","modified":1499823634741},{"_id":"themes/next/.git/objects/9c/3f927e5a1963fc63a55c25b1fffb6be6722ea2","hash":"cf377987f8c2ff34a4dd592872aee1e4459081fb","modified":1499909704300},{"_id":"themes/next/.git/objects/9e/e8b7b05c4a555e08b0938351230eef7f0550f5","hash":"b69b421007eb36f2266bf2a9b49f30c90664ccb7","modified":1500434708618},{"_id":"themes/next/.git/objects/8f/47dedc290c611f6d85fdb5435e47a9d92790c6","hash":"6c71976596d95b3313d62c4f9a43d44934be75a8","modified":1500048912632},{"_id":"themes/next/.git/objects/9f/9b736faf9cc508afe5d37879ee8c9ddd8153c8","hash":"c6cadf29a8fa4f8900bb9448390f7f6718544169","modified":1500843356766},{"_id":"themes/next/.git/objects/9e/e18bd71745e4bdf7a8d75385a595f6ffb9d4fa","hash":"4262f50bea0e59923acd66810557799651f8e985","modified":1500434708666},{"_id":"themes/next/.git/objects/39/b11fdbfafbf441549cb62aed2152bb448d8624","hash":"aea506ab364218800d73835f558a0a249e5865bc","modified":1499909704383},{"_id":"themes/next/.git/objects/6c/12010eec45987e9e5d7a02fb75d022587aaf8b","hash":"f6324476bd356d7e8079607cdee2d6c0a5963645","modified":1499092453951},{"_id":"themes/next/.git/objects/9e/1e1656302dddfe338effdf18f6b804c62851d1","hash":"6406ee7ccfdd0416561066aad1f45eede54b54f7","modified":1499350476416},{"_id":"themes/next/.git/objects/a6/7838efec5961ddf5a01c8320579b77c6bd462d","hash":"b04dc295dd48326465436427293dce3255c7d6d3","modified":1499092453932},{"_id":"themes/next/.git/objects/7b/93105867060522e42a3b2575ec0a30c06b70fb","hash":"4535345ad38a11d85a4136c78decff3308410dd6","modified":1499163251468},{"_id":"themes/next/.git/objects/a7/0d88d141892cbc4faae1e0d76d691eb64b949e","hash":"d99c9092ebc71b21466a0cbcab050b36cc913bf8","modified":1499350476392},{"_id":"themes/next/.git/objects/a3/569fc1fa990a6e0023b743bfe311ac8b1ba386","hash":"29bb768859654cf54a21d41b8997d00b858e6420","modified":1500767127035},{"_id":"themes/next/.git/objects/a1/c839297032cb603481a526278d91e539ac3554","hash":"8cc6a560de4d2eb581252d992b6cc67a75cff93c","modified":1500904844933},{"_id":"themes/next/.git/objects/a8/a28356f6912c9ec78d3f5bac862c75aac4e1b6","hash":"063dca73fd6625b429ac0818efbdbe8d270827aa","modified":1499909704318},{"_id":"themes/next/.git/objects/a9/b07d81cd5ea343fdccbc211c01e9ef07cab509","hash":"3f112edadbbb3ed4377f9f7ceef45ecc0cefbf05","modified":1499350476299},{"_id":"themes/next/.git/objects/a7/3df2beef82b81370e4efe6dd2ccb9a367e5d9d","hash":"1f6f55c54d9587411419e5f63df240c9e59ee934","modified":1499823634865},{"_id":"themes/next/.git/objects/ac/52b13543072572d0e3f9c9aa7e1f27bd78d45f","hash":"583bd9084a95591f83a04d76dc6f299a417fcc30","modified":1499077459830},{"_id":"themes/next/.git/objects/ac/56db409a8e83ae6080f17ef82740c7f063e3f3","hash":"c82f926646557d782edf8314ce6c4f87ce0227bc","modified":1500045910880},{"_id":"themes/next/.git/objects/5f/dc6c3796dd8bdd094888ba0c83bb5e35b03fb1","hash":"8361b5e182c277cc19090e79198570341428d7ce","modified":1500434708669},{"_id":"themes/next/.git/objects/af/a67d2d86c2020246fc58e01b9a9c7ae58d7c9f","hash":"93aa9a14265fb9dbd485fb890985c94b28f9f198","modified":1499823634869},{"_id":"themes/next/.git/objects/ab/ad2fd1b88c5e36af47ae0880750a04f46aedd3","hash":"253e03a5390f2432a0728847fea9e79467874f95","modified":1499909704386},{"_id":"themes/next/.git/objects/ad/343ceae944d8541afe25090f820b1f3f2cd568","hash":"3bf9ab8e4c0b1939aa26194ad521959c4619c8b5","modified":1500766529632},{"_id":"themes/next/.git/objects/5f/6cd3448efffd52d0541c6f960cadd5f8ba9041","hash":"093117e86169f3f09562e3f925e8878d3dcbcdd0","modified":1499909704412},{"_id":"themes/next/.git/objects/b3/2f255c84a89ee58da6437f88fe5b7d11088ff7","hash":"52726b10cd680aa4f122daa71ae4747567543fe6","modified":1500803137015},{"_id":"themes/next/.git/objects/b3/aab0975bc818d6de8551ad2dfcf3f61d21d2a4","hash":"17aadb1687d22917f90dcb5b974c631ee9cb3fae","modified":1500434708622},{"_id":"themes/next/.git/objects/5f/f9f2c0c911af44c44a3fa4bf3f87ed213f581d","hash":"ce5b39bc5b1ec13b578f8124b6c3d602ca59398e","modified":1499350476320},{"_id":"themes/next/.git/objects/b2/da3cec2d9668d3b7cbf25194bde0b44a776b03","hash":"674ddfc32b6b6c407e190c9e950b637d7048c482","modified":1499823634574},{"_id":"themes/next/.git/objects/af/aa21ff77de7dfa0d35bb26c9e896170101d2a4","hash":"ed31e2722fb63904ad6bd4785af3adc7140a7fc6","modified":1500434708673},{"_id":"themes/next/.git/objects/b1/5e93937ad5e5dd135b4556941df160ab5c08f1","hash":"0fb0dac6c4308c6cc6a32427291dafdafe291198","modified":1499134894846},{"_id":"themes/next/.git/objects/b7/68a90e7ecc96541d0e78324a635d17d5b02149","hash":"cd05d15138ee023c81a621ac1a1224ceca818984","modified":1500533099495},{"_id":"themes/next/.git/objects/b5/c998021ff6acaba90455e230eceba5a2f31724","hash":"4a9f4cac7ac9c8263a638fe5d763c6c1dec3dbaf","modified":1500904844950},{"_id":"themes/next/.git/objects/b9/18fa88693915a83b6b69b0d056ab893409b448","hash":"210170fd292723f2787fa122d5f4745d09377ca7","modified":1499823634588},{"_id":"themes/next/.git/objects/bb/df9db2225f358ef2f6b67287c3b9dd37a504ab","hash":"4feaea6e9ff0e88a04931c219eafaa813a7f54df","modified":1499823634678},{"_id":"themes/next/.git/objects/bd/62293d2651aca77d45dc8601777edead23fa2e","hash":"8c53563b33bd095f392ccfce0675ac4f46986344","modified":1499350476061},{"_id":"themes/next/.git/objects/a4/e43e40f11aa2aed2f789ff4fc20b10ea650332","hash":"773aa542794ec502271193c77c92eeac6cd25ebe","modified":1500770128984},{"_id":"themes/next/.git/objects/87/7aaabc28351b916038183970b72e4f1126422e","hash":"eff505a228ffa89aa863206d37948478b7fa175c","modified":1499909704200},{"_id":"themes/next/.git/objects/bc/6cd2668f8c7dd3b9381efcd2f6c868ec2d5cee","hash":"6434b6ee3dc045cd6948e8268fd28de672b40c06","modified":1500765332327},{"_id":"themes/next/.git/objects/be/6f4ec2d586a0305772038032a9f469e9ef6146","hash":"964bba867e55c8a4c494dd7fd02fb5a20f942708","modified":1500527709908},{"_id":"themes/next/.git/objects/87/c75f7c7243e38654b38846788ab29b89e23646","hash":"feaf6018c56196f29b6d507b384575eafc9b2303","modified":1500048912651},{"_id":"themes/next/.git/objects/c0/35747418b5b3fdd105bd53afcd8808900faf5d","hash":"74175f2b8eacc94409220626c83d254bbf739ad6","modified":1500894033832},{"_id":"themes/next/.git/objects/87/ffe947bbde16f5cada8fdeb425f73d84c2387c","hash":"cdc98764eff032e15ebb7ba83c002ac1ea258ba9","modified":1500434708626},{"_id":"themes/next/.git/objects/c3/2a6f4c5051b16b248c94279dc87578f6d35f28","hash":"874669651d6065ae5c493c64e8ab938c56328366","modified":1499823634603},{"_id":"themes/next/.git/objects/c3/38e71b35448c60d29a615a7a956c20b8250bbd","hash":"6b5bd3c4fa413a37ebdae7ee98360cecb0f6fc99","modified":1500766529565},{"_id":"themes/next/.git/objects/c1/0fdb6ab5a24e02f0d26e9ba5a3a5df08a8d1ea","hash":"4defd77f0cb8362eaed46f784cf5a6be6488d8cc","modified":1499823634606},{"_id":"themes/next/.git/objects/c0/7b7966e26d00d312752f201fc665671264101a","hash":"52dac3f6879be12f072e94273a293543986506a4","modified":1499823634571},{"_id":"themes/next/.git/objects/c3/9736de32fc4a9d89178f31ed4686be3800a10f","hash":"ad3128ff08246e5f4bb8cd5e2e157630a67ced76","modified":1499076666178},{"_id":"themes/next/.git/objects/c0/a5e25e825e77da3bae16b1c747b2ab910e8c4e","hash":"0db5aafbf324b6d321fc5de61d3f086d6556a615","modified":1500786937190},{"_id":"themes/next/.git/objects/ca/519598030f6968dd5868052c08ad29904c5343","hash":"d578490a35488b7f7f464fd28ab20dd2cda76698","modified":1500048912654},{"_id":"themes/next/.git/objects/c8/ba14214c6f91e2648df871ab9082e9de20a5e6","hash":"8b473dbf38dd0b305e0ea9118f4d1771d5c9bbfc","modified":1499823634833},{"_id":"themes/next/.git/objects/cc/e365fa386233b8f5a1567f000d42abf69ad96e","hash":"af31cf9f9147a7063bf93a766fae096ee70fd17b","modified":1500770128978},{"_id":"themes/next/.git/objects/ca/591414a9df3621e43d904d86769645dbad2709","hash":"38c02cd9650f72511bb4a3f73b5366fd21f50e72","modified":1499350476354},{"_id":"themes/next/.git/objects/cb/d00ed2964be4e7005171e7b3254159078d01f5","hash":"4ad2a4bf518fe6ed25b6eb0cb3942c438faeb839","modified":1499823634618},{"_id":"themes/next/.git/objects/cf/73946d67cab4dbc5cd2a1f1cd7181f5064f30b","hash":"561e18e641b0f566aea0ede398df7fcba05917e5","modified":1500761726139},{"_id":"themes/next/.git/objects/d0/02220f7936ee6086f8b55a58d5c504349ef0d0","hash":"83d97ff2b834d114ee219141934eb7611bb48eb1","modified":1499823634548},{"_id":"themes/next/.git/objects/ce/2a976d5e2955f58545b43880d5ddd9696a9ab1","hash":"b87389186a05b2eed52cabf141eca1768307b4a1","modified":1500843356762},{"_id":"themes/next/.git/objects/a5/96b68d8c4f990b4c9d061cd19d058d3f781aa6","hash":"1318f4db701d7aa557e370fa31d65406c2806949","modified":1500769527542},{"_id":"themes/next/.git/objects/d1/bac8ea6b95a03ab88430848f3fd9850859323e","hash":"f07948c4769e9799aa60c4a4c271164a49e92a31","modified":1499909704182},{"_id":"themes/next/.git/objects/d1/e3960319d0e0be311efc4e4381b57cafeab6ba","hash":"8e516916baa2fc34a040cc6d32ef156c5c2dcb52","modified":1500767127049},{"_id":"themes/next/.git/objects/d7/53de016cfa2310fc7f32f012e5429b403268ce","hash":"42a57bc31233bd4e66802ebba26dbce267528201","modified":1500048912646},{"_id":"themes/next/.git/objects/d8/b5a27647751f22daf2dc06cc1c5e29adbe5687","hash":"d0d3bcf39701a607c21639e9f874a655f4691794","modified":1499909704179},{"_id":"themes/next/.git/objects/d9/76a22fa7135e039213e5e38feb090b20cda1ae","hash":"f0a5aa22bb863cc100c3c9b6034ac547e05f287e","modified":1500769527551},{"_id":"themes/next/.git/objects/db/f3e8a853d625f08bfb81f762cd08da132574f2","hash":"b2045ea15dacf74088f1710f537f35dbc9b44c8b","modified":1499350476444},{"_id":"themes/next/.git/objects/c4/b6a06b11437dae93a1024bb9e79378bbf12f55","hash":"750be92ed72c218d06c1dc26a1ef4f4a05a040bc","modified":1499823634827},{"_id":"themes/next/.git/objects/d2/376d65de0814cbf50054dba10ba43c53ff11a2","hash":"604bcc79f2219eef4fda5d09f101ca7283284827","modified":1499350475826},{"_id":"themes/next/.git/objects/ba/5411c56348501fd875d5362f1bf93ab90c011a","hash":"7d16099a8bd7ab02e9b86ab941730294a728eb48","modified":1499909704193},{"_id":"themes/next/.git/objects/df/e032ad5f0a9d806168df17277a466c9afe1bac","hash":"bcc40d4d03e1f82bb3cfad457c8114fb5d481200","modified":1500434708676},{"_id":"themes/next/.git/objects/e1/98d1f5ffb29cf3289ccbceff6804659e69eb7f","hash":"54662e971f17e9e89f52b2ac7f1c570f9c4155be","modified":1500765332680},{"_id":"themes/next/.git/objects/e4/7e577ef103826e8e2705c0b0e28129229fec6e","hash":"a5b19f7bd6344494720793e6109631e20fc5ed5f","modified":1499077439746},{"_id":"themes/next/.git/objects/d0/1b21c609891ab6bb90a62782428a12efa3b9ed","hash":"a00136e8a328fd34a3070bdb2bfbf68995c4c246","modified":1499909704273},{"_id":"themes/next/.git/objects/e1/3a35421092b361b1b4c829385ba1910a2bd72a","hash":"29e7d38b6fac3dc5a076bd57e2a7cd88b343100e","modified":1499077780000},{"_id":"themes/next/.git/objects/e4/9a653ca7ee5525ca3c2be3ad2bb1c7f769a64b","hash":"44554153566456127df68d8b867f834ea99698cb","modified":1500894033807},{"_id":"themes/next/.git/objects/e2/d082fad0f9b2519c5116051125fd727a5a4dcb","hash":"58c975af9e083456cf524c4949b98c0b08d43fe7","modified":1499350475823},{"_id":"themes/next/.git/objects/d0/2f250bdde11cb8c7bc0acb74a60806af3e5558","hash":"84122d4c6909b3eaec1ea5e5c0948deb2c1c82d4","modified":1500434708727},{"_id":"themes/next/.git/objects/e6/ffedcf7295e6ad0326a65c7997e7b13cf389e3","hash":"770fb03fac48308db0fa5647297fc36142a401c6","modified":1500786937136},{"_id":"themes/next/.git/objects/e2/ce004d5f657837b30274a376f90685aaf9fa12","hash":"6dede58f171a304b1e8e951c522b60dd6b9ee4ff","modified":1499823634609},{"_id":"themes/next/.git/objects/de/dcde94b1d84a0168b6ef1be51c1b551e71aa09","hash":"054cfbce28cb074f2a07e296bd873682d53c95e6","modified":1499823634713},{"_id":"themes/next/.git/objects/e8/37e03b31241eb08fb454a44407abf3ee562881","hash":"1ea484c518340e6dcf1927875621ddff3ac43ea9","modified":1500045910671},{"_id":"themes/next/.git/objects/e8/30081ef4f4a9cecf34ef3dcf714b912b50e620","hash":"d7a615ba2c387a4110ef47b637c2b43b7e1e46aa","modified":1499823634655},{"_id":"themes/next/.git/objects/e7/e785dea289c95202f24f843d10d6db46228411","hash":"801e29c6827d8cde17ea7ca5f06d623b526825f6","modified":1499909704432},{"_id":"themes/next/.git/objects/e5/61850bbb665d35429b13425c228f11b28c6d5d","hash":"1e1b77cfae0375d34485e5bbd7674648f476359d","modified":1499823634615},{"_id":"themes/next/.git/objects/ea/8f6a76405b1f2a467e94c4d64839dd34d38ba2","hash":"55451108a29c4259d19f4679ced62cc192b47711","modified":1499350476293},{"_id":"themes/next/.git/objects/ec/c811a23a675b0588e17b16691055f4efbc0c80","hash":"a131456b9b0973db8e89e19698b2829cf9791228","modified":1500766529561},{"_id":"themes/next/.git/objects/eb/835b682e8206e6ea9da45e949a31c7c82045fe","hash":"d91f4cbed4c6a4fbabc563b43923e24cb0e1f16b","modified":1499076665968},{"_id":"themes/next/.git/objects/e6/64359e06f00b916b6bd60827e958f4d6d7655b","hash":"12535200545a83fbbcaf1f7f52aa2fec143352e5","modified":1499092453955},{"_id":"themes/next/.git/objects/ec/8cc8ad64b41e7b1ac9ef5f8e4e5d93fd222598","hash":"6b78c11108f07166bcafe6367652c1393c7fb9ab","modified":1499823634696},{"_id":"themes/next/.git/objects/f0/1480d86a9bce22e3afaa5bf80197e29b62e42e","hash":"b2eeac54832404b98d615513916cf9171ddae219","modified":1499092453948},{"_id":"themes/next/.git/objects/ec/ff5682888f912543907c20b3a9844bfbb4bbe2","hash":"820acbdee51eeaf725d6c375a91ed9d71ef68bb5","modified":1500766529590},{"_id":"themes/next/.git/objects/be/97114c46ac9903c13f96e1ebfc2b298ff3b44b","hash":"19a9ed8001360675c8410ca15f5730cc64ce4d5d","modified":1499909704246},{"_id":"themes/next/.git/objects/ef/41dc9ae15a272c5ff04cce46a676ce3b842bd2","hash":"51e193fef4d365670ac561972e41bbbbc70795b7","modified":1500674112415},{"_id":"themes/next/.git/objects/e5/c75dc0c0598e162593410ee309de1030e4f0f5","hash":"f06e242ee3653d8d92ffaa1e59a195b3f95eba5f","modified":1499909704416},{"_id":"themes/next/.git/objects/f9/51075d9b739d26b42472431995fa68d08796aa","hash":"1ef532d12bcdc1671e31e774b76da2946d82e498","modified":1499163251449},{"_id":"themes/next/.git/objects/f7/5f740266f3bc7ddecce4f5765c95039e4a38f1","hash":"f14f987cc6838cba1873afc23e9f4ff43ac99536","modified":1499350476289},{"_id":"themes/next/.git/objects/f8/95eb75c84f7cc88dc83c47b3c6344a6a58ad6c","hash":"d67bf91523908c6b83fc2d5bc113c3026a1f38c7","modified":1499823634623},{"_id":"themes/next/.git/objects/f5/d6bfe4312c85ee5b7f961b0956649e8d4c81cc","hash":"aad393a534ae528298f6ec3659578f51b525fe5a","modified":1499959510016},{"_id":"themes/next/.git/objects/f8/392ffed5569aaede7891db47c47ebeef5117eb","hash":"5f4ddbe1aa7b69d073b0ab43c4c9d8b928e13531","modified":1500803137027},{"_id":"themes/next/.git/objects/fd/c24a60254a20aac69762133c5c1121b00f0a30","hash":"afd1ce5245972e3481252179e2d24805a08f9a5d","modified":1499823634812},{"_id":"themes/next/.git/refs/heads/master","hash":"e69d71773aa24128bdcdd19d4a4d76c624eafbb0","modified":1499134907808},{"_id":"themes/next/.git/objects/fe/0564624742119159427742e7a641102f92e61d","hash":"a1ba61874dfcb6a353b7916d9041b5e14b369996","modified":1499823634687},{"_id":"themes/next/.git/refs/tags/v5.1.0","hash":"7ec0539e56966d1eaf8b88c1d27165c1f7dfacf5","modified":1499076562774},{"_id":"themes/next/.git/refs/tags/v5.1.1","hash":"3caf2cc30e2bc17ce7c8decb48064104d4845453","modified":1499076562779},{"_id":"themes/next/.git/objects/ae/0bca80af60eee15d1126a37bf918253c3599a5","hash":"e7ecdc7262d0c7a82252349736282f27c21d7659","modified":1500434708687},{"_id":"themes/next/.git/objects/fd/dc0af05ffe298d407b0319d16408b78442c222","hash":"2fb7e7a19b389a58017557348c4dd7956b7f2c19","modified":1500765332669},{"_id":"themes/next/.git/objects/ae/b6f4179da1702108099411985515c4fd35955e","hash":"e2920431770c2395600729424e1305c120286e73","modified":1499823634758},{"_id":"themes/next/.git/objects/ae/f857eb4109a5e5cecd3d9f048a6f68c2a5b80a","hash":"d54f460baccbd3461093c2308e4965f951976f01","modified":1499992501946},{"_id":"themes/next/.git/objects/bf/41514a725992e9817d0ca5048bf267db5fe73a","hash":"22ce92ee205672ca80164aaa014d7e52a88baac8","modified":1499823634632},{"_id":"themes/next/.git/objects/bf/6e473e9953b2bc8e5ef7a817bfe0a6934e564d","hash":"d902a4e598d42792fe1482dea7279abe306b6893","modified":1499823634849},{"_id":"themes/next/.git/objects/4a/615612c2393b3e9841f89c280cbaa51ec9c3af","hash":"0bfdca4981eebfc33b8daa4c33c55c62d626aa65","modified":1500761726160},{"_id":"themes/next/.git/objects/4a/b92733c18ae21fbac4eaa050a191fe630619ad","hash":"72f07e638dcd2361584bee9edb13f4803b27a271","modified":1499909704216},{"_id":"themes/next/.git/objects/bf/e0c7ce285be60801aef84159098050a295ba17","hash":"cb720e16f90222d521493cb9e2ad91aad8ca6ff2","modified":1500045910934},{"_id":"themes/next/.git/objects/4a/5f77e96ccb35d37b3b9f66edf540c5915cc362","hash":"59cf842a870acde39a43032534bf8be9776e1b7f","modified":1500765332648},{"_id":"themes/next/layout/_partials/head/custom-head.swig","hash":"a223919d2e1bf17ca4d6abb2c86f2efca9883dc1","modified":1499076674420},{"_id":"themes/next/layout/_partials/search/localsearch.swig","hash":"b2f0d247b213e4cf8de47af6a304d98070cc7256","modified":1499076674514},{"_id":"themes/next/.git/objects/88/7cd17b3347d2399ac1b0b9c9b437c38f4f378c","hash":"e1ce13d02e1472d6848604296f3ff88aa077565e","modified":1499992501922},{"_id":"themes/next/layout/_partials/search/tinysou.swig","hash":"b25002a83cbd2ca0c4a5df87ad5bff26477c0457","modified":1476067107324},{"_id":"themes/next/layout/_partials/search/swiftype.swig","hash":"a8c7f9ca7c605d039a1f3bf4e4d3183700a3dd62","modified":1476067107302},{"_id":"themes/next/layout/_partials/head/external-fonts.swig","hash":"f5e487b0d213ca0bd94aa30bc23b240d65081627","modified":1476067107282},{"_id":"themes/next/layout/_partials/share/add-this.swig","hash":"9e3d133ac5bcc6cb51702c83b2611a49811abad1","modified":1476067107328},{"_id":"themes/next/layout/_partials/share/duoshuo_share.swig","hash":"d4fbffd7fa8f2090eb32a871872665d90a885fac","modified":1476067107341},{"_id":"themes/next/layout/_scripts/pages/post-details.swig","hash":"9b84ab576982b2c3bb0291da49143bc77fba3cc6","modified":1476067107369},{"_id":"themes/next/layout/_partials/share/jiathis.swig","hash":"12684840de632eb16e53ffa863166306a756fd4f","modified":1476067107347},{"_id":"themes/next/layout/_scripts/schemes/pisces.swig","hash":"a9a3995b9615adfb8d6b127c78c6771627bee19a","modified":1476067107373},{"_id":"themes/next/layout/_partials/share/baidushare.swig","hash":"d9e2d9282f9be6e04eae105964abb81e512bffed","modified":1476067107332},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.swig","hash":"753d262911c27baf663fcaf199267133528656af","modified":1499076674538},{"_id":"themes/next/layout/_third-party/analytics/cnzz-analytics.swig","hash":"a10b7f19d7b5725527514622899df413a34a89db","modified":1499076674549},{"_id":"themes/next/layout/_third-party/analytics/application-insights.swig","hash":"71397a5823e8ec8aad3b68aace13150623b3e19d","modified":1499076674525},{"_id":"themes/next/layout/_third-party/analytics/busuanzi-counter.swig","hash":"7b11eac3a0685fa1ab2ab6ecff60afc4f15f0d16","modified":1499076674545},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.swig","hash":"b1e13df83fb2b1d5d513b30b7aa6158b0837daab","modified":1499076674558},{"_id":"themes/next/layout/_third-party/analytics/facebook-sdk.swig","hash":"a79e7e0d809fcf407593dd7ed9e023db21c3cbd6","modified":1499076674552},{"_id":"themes/next/layout/_third-party/analytics/index.swig","hash":"441f1a1b4e2f652d3b975995bd9d44ff4866f057","modified":1499076674564},{"_id":"themes/next/layout/_third-party/analytics/tencent-analytics.swig","hash":"8a399df90dadba5ad4e781445b58f4765aeb701e","modified":1499076674576},{"_id":"themes/next/layout/_third-party/analytics/vkontakte-api.swig","hash":"f9a1647a8f1866deeb94052d1f87a5df99cb1e70","modified":1499076674633},{"_id":"themes/next/layout/_third-party/analytics/lean-analytics.swig","hash":"e495aed8fb36bf8015ddbd64366270a7debad2b0","modified":1499076674568},{"_id":"themes/next/layout/_third-party/analytics/tencent-mta.swig","hash":"5a8027328f060f965b3014060bebec1d7cf149c1","modified":1499076674582},{"_id":"themes/next/layout/_third-party/comments/gentie.swig","hash":"0f38f053841ef77cdce56a84cfbb4dd4c3329486","modified":1499076674716},{"_id":"themes/next/layout/_third-party/comments/disqus.swig","hash":"b83a51bbe0f1e2ded9819070840b0ea145f003a6","modified":1499076674703},{"_id":"themes/next/layout/_third-party/comments/duoshuo.swig","hash":"1600f340e0225361580c44890568dc07dbcf2c89","modified":1499076674709},{"_id":"themes/next/layout/_third-party/comments/livere.swig","hash":"c75024151fc63220e7d01035d8a1aff9affdecc7","modified":1499076674734},{"_id":"themes/next/layout/_third-party/comments/index.swig","hash":"0399bbdc524ba50930cb6f8e2d5628ff682fc612","modified":1499076674728},{"_id":"themes/next/layout/_third-party/comments/youyan.swig","hash":"de95ec8920d1660680078451008f8bd69f14d082","modified":1499076674740},{"_id":"themes/next/layout/_third-party/comments/changyan.swig","hash":"4c501ea0b9c494181eb3c607c5526a5754e7fbd8","modified":1499076674649},{"_id":"themes/next/layout/_third-party/search/index.swig","hash":"34599633658f3b0ffb487728b7766e1c7b551f5a","modified":1499076674810},{"_id":"themes/next/layout/_third-party/comments/hypercomments.swig","hash":"af7f3e43cbdc4f88c13f101f0f341af96ace3383","modified":1499076674722},{"_id":"themes/next/.git/objects/e8/8785e594c2f6f8656bec8735b847789396ef3b","hash":"eab76c7d7f5afdfefdb50de32cee00ae766de9ae","modified":1499163251465},{"_id":"themes/next/layout/_third-party/seo/baidu-push.swig","hash":"d8c98938719284fa06492c114d99a1904652a555","modified":1499076674835},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"e55265c8a8a6ae0c3c08e3509de92ee62c3cb5f6","modified":1476067107965},{"_id":"themes/next/layout/_third-party/search/localsearch.swig","hash":"93479642fd076a1257fecc25fcf5d20ccdefe509","modified":1499076674814},{"_id":"themes/next/source/css/_variables/base.styl","hash":"dacede1cc110c762e7a5468dc0e34ae1a962d5aa","modified":1499076675341},{"_id":"themes/next/source/css/_custom/custom.styl","hash":"3403fdd8efde1a0afd11ae8a5a97673f5903087f","modified":1476067107853},{"_id":"themes/next/source/js/src/affix.js","hash":"1b509c3b5b290a6f4607f0f06461a0c33acb69b1","modified":1476067108035},{"_id":"themes/next/source/css/_mixins/base.styl","hash":"531934ea21ef4dc9f0978512050f54834f0a6cff","modified":1476067107859},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"09534b68bd1a708729b3cfffe17737e3af457757","modified":1499076675336},{"_id":"themes/next/layout/_third-party/search/tinysou.swig","hash":"fe95dd3d166634c466e19aa756e65ad6e8254d3e","modified":1499076674828},{"_id":"themes/next/source/js/src/algolia-search.js","hash":"cb431b54ba9c692165a1f5a12e4c564a560f8058","modified":1499076675352},{"_id":"themes/next/source/js/src/exturl.js","hash":"a2a0f0de07e46211f74942a468f42ee270aa555c","modified":1499076675361},{"_id":"themes/next/source/js/src/bootstrap.js","hash":"0ec035e20d1f26bf553a79877180ba312bea885c","modified":1499076675356},{"_id":"themes/next/source/js/src/js.cookie.js","hash":"1512c751d219577d338ac0780fb2bbd9075d5298","modified":1499076675365},{"_id":"themes/next/source/js/src/hook-duoshuo.js","hash":"b35a7dc47b634197b93487cea8671a40a9fdffce","modified":1476067108047},{"_id":"themes/next/source/js/src/motion.js","hash":"ff9ea37d05c269e3a140c4ab448af03efc4bcc76","modified":1476067108066},{"_id":"themes/next/source/js/src/scroll-cookie.js","hash":"02cf91514e41200bc9df5d8bdbeb58575ec06074","modified":1499076675416},{"_id":"themes/next/source/js/src/post-details.js","hash":"bfaf52b69aad96566aa21b785973441a2555b4ba","modified":1499076675406},{"_id":"themes/next/source/js/src/utils.js","hash":"c976214b8bbaa9512b886bf3687e94696f705e33","modified":1499076675421},{"_id":"themes/next/source/js/src/scrollspy.js","hash":"b7657be25fc52ec67c75ab5481bdcb483573338b","modified":1476067108093},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.css","hash":"90ef19edc982645b118b095615838d9c5eaba0de","modified":1499076675505},{"_id":"themes/next/source/lib/fancybox/.bower.json","hash":"9be892a4e14e0da18ff9cb962c9ef71f163b1b22","modified":1499076675732},{"_id":"themes/next/source/lib/fancybox/.gitattributes","hash":"672d3b5767e0eacd83bb41b188c913f2cf754793","modified":1499076675736},{"_id":"themes/next/source/lib/canvas-ribbon/canvas-ribbon.js","hash":"68db2c0bf1064176627199394f25f6dc37ea23ad","modified":1499076675714},{"_id":"themes/next/source/lib/fastclick/.bower.json","hash":"bf3eef9d647cd7c9b62feda3bc708c6cdd7c0877","modified":1499076675788},{"_id":"themes/next/source/lib/fastclick/bower.json","hash":"a9b3ee1e4db71a0e4ea6d5bed292d176dd68b261","modified":1499076675912},{"_id":"themes/next/source/lib/fastclick/README.md","hash":"68a9b9d53126405b0fa5f3324f1fb96dbcc547aa","modified":1499076675797},{"_id":"themes/next/source/lib/font-awesome/.gitignore","hash":"03ddbf76c1dd1afb93eed0b670d2eee747472ef1","modified":1499076675977},{"_id":"themes/next/source/lib/font-awesome/.npmignore","hash":"c31ff06a740955e44edd4403902e653ccabfd4db","modified":1499076676039},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","hash":"ee33b2798b1e714b904d663436c6b3521011d1fa","modified":1499076676043},{"_id":"themes/next/source/lib/font-awesome/.bower.json","hash":"b4aefc910578d76b267e86dfffdd5121c8db9aec","modified":1499076675929},{"_id":"themes/next/source/lib/fastclick/LICENSE","hash":"6f474ea75c42442da7bbcf2e9143ce98258efd8d","modified":1499076675792},{"_id":"themes/next/source/lib/font-awesome/bower.json","hash":"71e7183634dc1b9449f590f15ebd7201add22ca7","modified":1499076676044},{"_id":"themes/next/source/lib/jquery/.bower.json","hash":"865d6c1328ab209a4376b9d2b7a7824369565f28","modified":1499076676778},{"_id":"themes/next/source/lib/jquery_lazyload/.bower.json","hash":"90fa628f156d8045357ff11eaf32e61abacf10e8","modified":1499076676789},{"_id":"themes/next/source/lib/jquery_lazyload/CONTRIBUTING.md","hash":"4ded6fee668544778e97e38c2b211fc56c848e77","modified":1499076676793},{"_id":"themes/next/source/lib/jquery_lazyload/bower.json","hash":"e0acf1db27b0cc16128a59c46db1db406b5c4c58","modified":1499076677607},{"_id":"themes/next/source/lib/jquery_lazyload/README.md","hash":"b930297cb98b8e1dbd5abe9bc1ed9d5935d18ce8","modified":1499076676798},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.scrollstop.js","hash":"bf773ad48a0b9aa77681a89d7569eefc0f7b7b18","modified":1499076677618},{"_id":"themes/next/source/lib/pace/pace-theme-barber-shop.min.css","hash":"ee0d51446cb4ffe1bb96bd7bc8c8e046dddfcf46","modified":1499076677623},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.lazyload.js","hash":"f4a570908f6c89c6edfb1c74959e733eaadea4f2","modified":1499076677612},{"_id":"themes/next/source/lib/pace/pace-theme-center-atom.min.css","hash":"dcf79c24fe5350fb73d8038573a104e73639e9d3","modified":1499076677742},{"_id":"themes/next/source/lib/pace/pace-theme-bounce.min.css","hash":"f6bdb9a785b7979dd8ec5c60e278af955ef1e585","modified":1499076677733},{"_id":"themes/next/source/lib/pace/pace-theme-center-radar.min.css","hash":"ab7cba998bf4c03b13df342bf43647fa4f419783","modified":1499076677759},{"_id":"themes/next/source/lib/pace/pace-theme-big-counter.min.css","hash":"5b561dc328af4c4d512e20a76fe964d113a32ba8","modified":1499076677627},{"_id":"themes/next/source/lib/pace/pace-theme-fill-left.min.css","hash":"0bec1e235a4a2cccda3f993b205424e1441a44ae","modified":1499076677816},{"_id":"themes/next/.git/objects/ef/8ecde7a1912d824fb0ae3eca2b5a903491570a","hash":"18b38e957eabf10a5ed047ee3bb8e2b0d012afc7","modified":1499163251459},{"_id":"themes/next/source/lib/pace/pace-theme-corner-indicator.min.css","hash":"b3c64c973f31884e3d8145989476707333406b9a","modified":1499076677774},{"_id":"themes/next/source/lib/pace/pace-theme-center-simple.min.css","hash":"67f44c947548bd4d77e7590d3f59e236cbf9e98a","modified":1499076677766},{"_id":"themes/next/source/lib/pace/pace-theme-minimal.min.css","hash":"9cd783cceb8a191f3c8b5d81f7a430ecc3e489d3","modified":1499076677836},{"_id":"themes/next/source/lib/pace/pace-theme-flash.min.css","hash":"13ace22c40312d7bbd8d9c1e50eff897a7a497d8","modified":1499076677820},{"_id":"themes/next/source/lib/pace/pace-theme-center-circle.min.css","hash":"a4066769c78affbfbc5e30a600e2c7862cd532e0","modified":1499076677751},{"_id":"themes/next/source/lib/pace/pace-theme-mac-osx.min.css","hash":"9f2e7b51b084da407863826b25265b31150b3821","modified":1499076677831},{"_id":"themes/next/source/lib/pace/pace-theme-loading-bar.min.css","hash":"7ee28875dfc1230d76c537f6605766e8d4011e9f","modified":1499076677825},{"_id":"themes/next/source/lib/pace/pace.min.js","hash":"8aaa675f577d5501f5f22d5ccb07c2b76310b690","modified":1499076677880},{"_id":"themes/next/source/lib/three/canvas_lines.min.js","hash":"2d9a9f38c493fdf7c0b833bb9184b6a1645c11b2","modified":1499076677886},{"_id":"themes/next/source/lib/three/three-waves.min.js","hash":"8148492dd49aa876d32bb7d5b728d3f5bf6f5074","modified":1499076677897},{"_id":"themes/next/source/lib/three/canvas_sphere.min.js","hash":"46a50b91c98b639c9a2b9265c5a1e66a5c656881","modified":1499076677891},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest.min.js","hash":"0387e75e23b1db108a755073fe52a0d03eb391a7","modified":1499076675522},{"_id":"themes/next/source/lib/velocity/.bower.json","hash":"63da5e80ebb61bb66a2794d5936315ca44231f0c","modified":1499076677926},{"_id":"themes/next/source/lib/velocity/velocity.min.js","hash":"bf172816a9c57f9040e3d19c24e181a142daf92b","modified":1499076677944},{"_id":"themes/next/source/lib/velocity/bower.json","hash":"92d92860418c4216aa59eb4cb4a556290a7ad9c3","modified":1499076677930},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","hash":"dbbfb50f6502f6b81dcc9fee7b31f1e812da3464","modified":1499076677950},{"_id":"themes/next/.git/objects/85/707849b16e3a1962b3ea3126b90c4048d663ad","hash":"67abb30f9a85c1f49114a03fbeed15b4af2eed8a","modified":1499823634621},{"_id":"themes/next/.git/objects/85/2af8fed606938c29848fc6fe0d88617d76dca2","hash":"9ef094e08bd4c8fe0bc11aaed7962382ce208e28","modified":1499823634750},{"_id":"themes/next/source/css/_mixins/Pisces.styl","hash":"a0f23e75a137d8c996c70e2059e0074f1e97a127","modified":1476067107855},{"_id":"themes/next/.git/objects/pack/pack-e5d68ac6929e48654521f5c7d821096b219ee339.idx","hash":"603770f1431fe73d86f073a883e3fe666fddb552","modified":1499076562433},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","hash":"dde584994ac13dc601836e86f4cf490e418d9723","modified":1499076677956},{"_id":"themes/next/source/lib/jquery/index.js","hash":"17a740d68a1c330876c198b6a4d9319f379f3af2","modified":1499076676782},{"_id":"themes/next/.git/objects/f2/b3fb8bb2b986e39b2f7b1fce9897648837fc41","hash":"3bfefa5906b7dae9f9dfc86056ea03d1d5459bc2","modified":1500045910675},{"_id":"themes/next/.git/objects/pack/pack-118a81b8e2f0b6b9f993c01769c6bea2556fdf75.idx","hash":"450063e2acde4ce5d024fca4e4ca23cacab75144","modified":1476067106807},{"_id":"themes/next/.git/refs/remotes/ckjava-hexo/master","hash":"e69d71773aa24128bdcdd19d4a4d76c624eafbb0","modified":1499134915216},{"_id":"themes/next/.git/refs/remotes/ckjava-hexo/dev","hash":"9d2c0a9ea0a9e1d5378f6aff74f50a11fe3bd73e","modified":1499077440816},{"_id":"themes/next/.git/refs/remotes/ckjava-hexo/servant","hash":"ee903ee2112907f4498fdb13674a640c685e95fb","modified":1499077440833},{"_id":"themes/next/.git/refs/remotes/ckjava-hexo/testing","hash":"15660a56eaab85fc3fd3324de8d61dbc2b09b42a","modified":1499077440841},{"_id":"themes/next/.git/refs/remotes/origin/HEAD","hash":"d9427cda09aba1cdde5c69c2b13c905bddb0bc51","modified":1476067107040},{"_id":"themes/next/.git/refs/remotes/origin/dev","hash":"9d2c0a9ea0a9e1d5378f6aff74f50a11fe3bd73e","modified":1499076562661},{"_id":"themes/next/.git/refs/remotes/origin/master","hash":"bd25d43ad0337112c69c1257c69b84552baaacbe","modified":1500904845009},{"_id":"themes/next/.git/refs/remotes/origin/revert-1724-patch-1","hash":"2aadab4abc674a6de77b735ad6b799a8fd2ab918","modified":1499959510203},{"_id":"themes/next/.git/refs/remotes/origin/servant","hash":"ee903ee2112907f4498fdb13674a640c685e95fb","modified":1499076562670},{"_id":"themes/next/.git/refs/remotes/origin/testing","hash":"15660a56eaab85fc3fd3324de8d61dbc2b09b42a","modified":1499076562679},{"_id":"themes/next/.git/logs/refs/heads/master","hash":"5ecef05d4b68e1b53e8f333ee550eab40f88e717","modified":1499134907833},{"_id":"themes/next/layout/_third-party/search/algolia-search/dom.swig","hash":"2530de0f3125a912756f6c0e9090cd012134a4c5","modified":1499076674806},{"_id":"themes/next/layout/_third-party/search/algolia-search/assets.swig","hash":"218cc936ba3518a3591b2c9eda46bc701edf7710","modified":1499076674802},{"_id":"themes/next/source/css/_common/components/back-to-top-sidebar.styl","hash":"4ba6f2a615693b9b5afc266d9c833697016085fd","modified":1499076674967},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"1dc2ed435e41ca041f43bd9633d5d95139afbb42","modified":1499076674971},{"_id":"themes/next/source/css/_common/components/buttons.styl","hash":"22828f5141c0cecb9ef25a110e194cdfa3a36423","modified":1476067107581},{"_id":"themes/next/source/css/_common/components/pagination.styl","hash":"88559b13ce94311405b170a0506ded91273beceb","modified":1476067107657},{"_id":"themes/next/source/css/_common/components/comments.styl","hash":"ff4489cd582f518bba6909a301ac1292a38b4e96","modified":1476067107584},{"_id":"themes/next/source/css/_common/components/tag-cloud.styl","hash":"6eb4bcc3056bd279d000607e8b4dad50d368ca69","modified":1476067107747},{"_id":"themes/next/source/css/_common/outline/outline.styl","hash":"12662536c7a07fff548abe94171f34b768dd610f","modified":1476067107825},{"_id":"themes/next/source/css/_common/components/components.styl","hash":"7ad4081466b397e2a6204141bb7768b7c01bd93c","modified":1499076674975},{"_id":"themes/next/source/css/_common/scaffolding/scaffolding.styl","hash":"c9218b48c56e52c06af9ce3cc8fbdae737cf16fe","modified":1476067107844},{"_id":"themes/next/source/css/_common/scaffolding/helpers.styl","hash":"1da5c800d025345f212a3bf1be035060f4e5e6ed","modified":1499076675250},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"ea9069645696f86c5df64208490876fe150c8cae","modified":1476067107849},{"_id":"themes/next/source/css/_schemes/Mist/_base.styl","hash":"25d5e45a355ee2093f3b8b8eeac125ebf3905026","modified":1476067107864},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"4998bedff9c84a09a294b8ef36ede2e3644d3528","modified":1499076675233},{"_id":"themes/next/source/css/_schemes/Mist/_logo.styl","hash":"b1025c421406d2c24cc92a02ae28c1915b01e240","modified":1476067107871},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"26666c1f472bf5f3fb9bc62081cca22b4de15ccb","modified":1476067107874},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"d0bfd1bef988c76f7d7dd72d88af6f0908a8b0db","modified":1476067107867},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"3f40e8a9fe8e7bd5cfc4cf4cbbbcb9539462e973","modified":1476067107838},{"_id":"themes/next/source/css/_schemes/Mist/_search.styl","hash":"09c965022c13b84ed8a661fee8ac2a6d550495ae","modified":1476067107882},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"31127dcbf4c7b4ada53ffbf1638b5fe325b7cbc0","modified":1476067107915},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"9b913b73d31d21f057f97115ffab93cfa578b884","modified":1476067107885},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expanded.styl","hash":"ce272226a1570f5f7c70243b751a5b0fe1671a88","modified":1499076675254},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"f23ac53ab901c48859dd29eee6e386b60ff956ba","modified":1499076675280},{"_id":"themes/next/source/css/_schemes/Muse/_search.styl","hash":"09c965022c13b84ed8a661fee8ac2a6d550495ae","modified":1476067107927},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"5dbc0d0c897e46760e5dbee416530d485c747bba","modified":1476067107930},{"_id":"themes/next/source/css/_schemes/Pisces/_brand.styl","hash":"bce344d3a665b4c55230d2a91eac2ad16d6f32fd","modified":1499076675288},{"_id":"themes/next/source/css/_schemes/Pisces/_posts.styl","hash":"1f6e2ce674735269599acc6d77b3ea18d31967fc","modified":1476067107955},{"_id":"themes/next/source/css/_schemes/Muse/_logo.styl","hash":"748dbfbf9c08e719ddc775958003c64b00d39dab","modified":1476067107918},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"86197902dfd3bededba10ba62b8f9f22e0420bde","modified":1499076675332},{"_id":"themes/next/source/js/src/schemes/pisces.js","hash":"c4358416f0a116d7f4037542fa3b385947e80908","modified":1499076675412},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"4642e30010af8b2b037f5b43146b10a934941958","modified":1499076675296},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"416988dca389e6e2fdfa51fa7f4ee07eb53f82fb","modified":1499076675292},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"c48d4a561d047b3705924949b3ab7b57bee94ecd","modified":1499076675301},{"_id":"themes/next/source/lib/Han/dist/han.min.css","hash":"95518d298d3c5c271faec2e4977df9e5dedd5d84","modified":1499076675493},{"_id":"themes/next/source/lib/fancybox/source/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1499076675740},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1499076675742},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1499076675741},{"_id":"themes/next/source/lib/Han/dist/han.min.js","hash":"16b03db23a52623348f37c04544f2792032c1fb6","modified":1499076675500},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1499076675745},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.css","hash":"82f33ad0842aa9c154d029e0dada2497d4eb1d57","modified":1499076675770},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1499076675744},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.js","hash":"d71602cbca33b9ecdb7ab291b7f86a49530f3601","modified":1499076675776},{"_id":"themes/next/source/lib/fancybox/source/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1499076675743},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.min.js","hash":"2cae0f5a6c5d6f3cb993015e6863f9483fc4de18","modified":1499076675923},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.js","hash":"1d6aeda0480d0e4cb6198edf7719d601d4ae2ccc","modified":1499076675916},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.pack.js","hash":"ae6318aeb62ad4ce7a7e9a4cdacd93ffb004f0fb","modified":1499076675782},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","hash":"3655f1fdf1e584c4d8e8d39026093ca306a5a341","modified":1499076676051},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","hash":"88af80502c44cd52ca81ffe7dc7276b7eccb06cf","modified":1499076676070},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","hash":"41ea797c68dbcff2f6fb3aba1d1043a22e7cc0f6","modified":1499076677915},{"_id":"themes/next/source/lib/Han/dist/han.js","hash":"4ac683b2bc8531c84d98f51b86957be0e6f830f3","modified":1499076675488},{"_id":"themes/next/source/lib/Han/dist/han.css","hash":"524cfca7b6ab135d81ea723d8de06fdf0dbe7e56","modified":1499076675442},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1499076676775},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1499076676772},{"_id":"themes/next/source/lib/velocity/velocity.js","hash":"4237c6e9d59da349639de20e559e87c2c0218cfd","modified":1499076677935},{"_id":"themes/next/.git/logs/refs/remotes/ckjava-hexo/servant","hash":"c5fadc5683404f0ecf5a1a8553a4c14a76e341d1","modified":1499077440836},{"_id":"themes/next/.git/logs/refs/remotes/ckjava-hexo/dev","hash":"3c01f985d2b45797f0b7e2c3d62f981db521bed6","modified":1499077440820},{"_id":"themes/next/.git/logs/refs/remotes/ckjava-hexo/testing","hash":"60b0d5eac4cbb882ddd2a01ea1bdde15f871954e","modified":1499077440844},{"_id":"themes/next/.git/logs/refs/remotes/ckjava-hexo/master","hash":"c9ce24f7e2d7114f90b2048d41fe6399fb250a1f","modified":1499134915221},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","hash":"1573904b82807abbb32c97a3632c6c6808eaac50","modified":1499076676057},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"a817b6c158cbc5bab3582713de9fe18a18a80552","modified":1499076677920},{"_id":"themes/next/.git/logs/refs/remotes/origin/HEAD","hash":"b52f0b164599a0a9ca260f8ae6d9adfcf29593fe","modified":1476067107037},{"_id":"themes/next/.git/logs/refs/remotes/origin/dev","hash":"318863adf748db42bada36c6c73d6243019b0c95","modified":1499076562665},{"_id":"themes/next/.git/logs/refs/remotes/origin/revert-1724-patch-1","hash":"5049ee9d8cdbec641bee83eeab7fc4e6ac32636f","modified":1499959510207},{"_id":"themes/next/.git/logs/refs/remotes/origin/servant","hash":"1c1178a610a1b154d47f7ef3e6071269ad9ea09b","modified":1499076562673},{"_id":"themes/next/.git/logs/refs/remotes/origin/testing","hash":"e64ae0c4954f85481067c3055c99b0d8f13d4e66","modified":1499076562682},{"_id":"themes/next/.git/logs/refs/remotes/origin/master","hash":"df8be045b120409017bf8440c92a35addd5566a4","modified":1500904845013},{"_id":"themes/next/source/css/_common/components/header/headerband.styl","hash":"d63e0cacc53dd375fcc113465a4328c59ff5f2c1","modified":1476067107597},{"_id":"themes/next/source/css/_common/components/header/header.styl","hash":"53cde051e0337f4bf42fb8d6d7a79fa3fa6d4ef2","modified":1476067107594},{"_id":"themes/next/source/css/_common/components/header/menu.styl","hash":"1a0d059799a298fe17c49a44298d32cebde93785","modified":1499076674979},{"_id":"themes/next/source/css/_common/components/highlight/diff.styl","hash":"167986d0f649516671ddf7193eebba7b421cd115","modified":1476067107613},{"_id":"themes/next/source/css/_common/components/header/site-nav.styl","hash":"1727702eac5d326b5c81a667944a245016668231","modified":1476067107609},{"_id":"themes/next/source/css/_common/components/header/site-meta.styl","hash":"0656e753f182c9f47fef7304c847b7587a85ef0d","modified":1476067107605},{"_id":"themes/next/source/css/_common/components/pages/archive.styl","hash":"104b5c79cd891506e0beaf938b083685f1da8637","modified":1476067107625},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"7fb593f90d74a99c21840679933b9ef6fdc16a61","modified":1476067107629},{"_id":"themes/next/source/css/_common/components/highlight/highlight.styl","hash":"b3b783511bbd94af7e941abf8ff411885db7395b","modified":1499076674984},{"_id":"themes/next/source/css/_common/components/pages/pages.styl","hash":"f9760ecf186954cee3ba4a149be334e9ba296b89","modified":1499076675006},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"8cf318644acc8b4978537c263290363e21c7f5af","modified":1499076675010},{"_id":"themes/next/source/css/_common/components/pages/post-detail.styl","hash":"4e3838d7ac81d9ad133960f0f7ed58a44a015285","modified":1476067107637},{"_id":"themes/next/source/css/_common/components/post/post-button.styl","hash":"4783f85872bc7e218c1522a5c1c68cd27a5922db","modified":1499076675014},{"_id":"themes/next/source/css/_common/components/footer/footer.styl","hash":"4c4ef6e997d0c6e21de39c2daa0c768e12c8c6fa","modified":1476067107590},{"_id":"themes/next/source/css/_common/components/highlight/theme.styl","hash":"7fe4d4d656e86276c17cb4e48a560cb6a4def703","modified":1499076675001},{"_id":"themes/next/source/css/_common/components/post/post-copyright.styl","hash":"caf263d1928496688c0e1419801eafd7e6919ce5","modified":1499076675058},{"_id":"themes/next/source/css/_common/components/post/post-eof.styl","hash":"a200c0a1c5a895ac9dc41e0641a5dfcd766be99b","modified":1476067107666},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"875cbe88d5c7f6248990e2beb97c9828920e7e24","modified":1499076675018},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"cd9e214e502697f2f2db84eb721bac57a49b0fce","modified":1476067107675},{"_id":"themes/next/source/css/_common/components/post/post-meta.styl","hash":"658accf8e196721f295003da66941e6d1f7b81b0","modified":1499076675067},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"27deb3d3a243d30022055dac7dad851024099a8b","modified":1499076675082},{"_id":"themes/next/source/css/_common/components/post/post-expand.styl","hash":"58f9e6aba94733244a87d2ba5966c5a009486509","modified":1499076675062},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"8355b0e9375b3245508efda0e18acd069c2aa767","modified":1476067107690},{"_id":"themes/next/source/css/_common/components/post/post-tags.styl","hash":"5a982d8ef3b3623ea5f59e63728990f5623c1b57","modified":1476067107694},{"_id":"themes/next/source/css/_common/components/post/post-type.styl","hash":"01567edaea6978628aa5521a122a85434c418bfd","modified":1476067107702},{"_id":"themes/next/source/css/_common/components/post/post-widgets.styl","hash":"2cb09973d29a8e34e2a3425ac6e0938296970d8e","modified":1499076675086},{"_id":"themes/next/source/css/_common/components/post/post-title.styl","hash":"350469437b20ecfd6f3ca45e400478f8e3f71cfb","modified":1476067107698},{"_id":"themes/next/source/css/_common/components/post/post.styl","hash":"bc08cfb2ef2ff44ba3fc7dffdb2deb01a9d17d15","modified":1499076675093},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-blogroll.styl","hash":"ac060861b27b764bc4012fc362a25a332df4045a","modified":1499076675098},{"_id":"themes/next/source/css/_common/components/post/post-wordcount.styl","hash":"268c9704481fdb0b4d1e646196386143990fe235","modified":1499076675089},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author.styl","hash":"761eba9811b050b25d548cc0854de4824b41eb08","modified":1476067107715},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toc.styl","hash":"28a8737c090fbffd188d73a00b42e90b9ee57df2","modified":1499076675102},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toggle.styl","hash":"c9f76d4f6806ef70fa2160c97afa0a0e0ae5373e","modified":1499076675107},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-feed-link.styl","hash":"61f8cea3c01acd600e90e1bc2a07def405503748","modified":1476067107723},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-nav.styl","hash":"1153bb71edf253765145559674390e16dd67c633","modified":1476067107726},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar.styl","hash":"702be9e57dd6ff5fa99642a1f6e3df26215b8805","modified":1476067107738},{"_id":"themes/next/source/css/_common/components/sidebar/site-state.styl","hash":"e71652d3216e289c8548b1ea2357822c1476a425","modified":1476067107743},{"_id":"themes/next/source/css/_common/components/tags/blockquote-center.styl","hash":"2fe76476432b31993338cb45cdb3b29a518b6379","modified":1476067107752},{"_id":"themes/next/source/css/_common/components/tags/exturl.styl","hash":"a3bdd71237afc112b2aa255f278cab6baeb25351","modified":1499076675111},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author-links.styl","hash":"7f2bdd6109614d35408ee5ac3335aad4464c69c7","modified":1476067107711},{"_id":"themes/next/source/css/_common/components/tags/full-image.styl","hash":"3159b55f35c40bd08e55b00148c523760a708c51","modified":1499076675116},{"_id":"themes/next/source/css/_common/components/tags/tags.styl","hash":"e3ad37f2da35e330616a044621ffa50565a20c88","modified":1499076675164},{"_id":"themes/next/source/css/_common/components/tags/group-pictures.styl","hash":"2ad1a2a9bbf6742d1b0762c4c623b68113d1e0fe","modified":1476067107794},{"_id":"themes/next/source/css/_common/components/third-party/baidushare.styl","hash":"5dbeed535d63a50265d96b396a5440f9bb31e4ba","modified":1476067107802},{"_id":"themes/next/source/css/_common/components/tags/note.styl","hash":"74019008ba973ab30f0f4a6b3c2cd33c66d3a4b4","modified":1499076675146},{"_id":"themes/next/source/css/_common/components/third-party/algolia-search.styl","hash":"bba4f3bdb7517cd85376df3e1209b570c0548c69","modified":1499076675168},{"_id":"themes/next/source/css/_common/components/third-party/busuanzi-counter.styl","hash":"a6e7d698702c2e383dde3fde2abde27951679084","modified":1499076675172},{"_id":"themes/next/source/css/_common/components/third-party/jiathis.styl","hash":"15975ba7456b96916b1dbac448a1a0d2c38b8f3d","modified":1476067107814},{"_id":"themes/next/source/css/_common/components/third-party/duoshuo.styl","hash":"717cc7f82be9cc151e23a7678601ff2fd3a7fa1d","modified":1476067107810},{"_id":"themes/next/source/css/_schemes/Mist/sidebar/sidebar-blogroll.styl","hash":"1f09be9bb38411f0629b58c3b23873589a6dbcaa","modified":1499076675276},{"_id":"themes/next/source/css/_common/components/third-party/third-party.styl","hash":"eb45ee16051624c6e36a274c0a9538e961f10c4d","modified":1499076675228},{"_id":"themes/next/source/css/_schemes/Mist/outline/outline.styl","hash":"a07aa12cc36ac5c819670c2a3c17d07ed7a08986","modified":1476067107908},{"_id":"themes/next/source/css/_schemes/Muse/sidebar/sidebar-blogroll.styl","hash":"1f09be9bb38411f0629b58c3b23873589a6dbcaa","modified":1499076675284},{"_id":"themes/next/source/css/_common/components/third-party/gentie.styl","hash":"cd526e814f9323a79fe835085d64867d34b3715d","modified":1499076675177},{"_id":"themes/next/source/css/_common/components/third-party/han.styl","hash":"10599e16414a8b7a76c4e79e6617b5fe3d4d1adf","modified":1499076675181},{"_id":"themes/next/source/css/_common/components/third-party/localsearch.styl","hash":"16087276945fa038f199692e3eabb1c52b8ea633","modified":1499076675224},{"_id":"themes/next/source/lib/Han/dist/font/han.otf","hash":"f1f6bb8f461f5672e000380195d3d2358a28494c","modified":1499076675436},{"_id":"themes/next/source/lib/Han/dist/font/han-space.woff","hash":"7a635062b10bf5662ae1d218ba0980171005d060","modified":1499076675433},{"_id":"themes/next/source/lib/fancybox/source/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1499076675746},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","hash":"ee948b4489aedeb548a77c9e45d8c7c5732fd62d","modified":1499076675752},{"_id":"themes/next/source/lib/Han/dist/font/han-space.otf","hash":"07436f011b44051f61b8329c99de4bec64e86f4b","modified":1499076675428},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","hash":"d22b1629cb23a6181bebb70d0cf653ffe4b835c8","modified":1499076675766},{"_id":"themes/next/source/lib/Han/dist/font/han.woff","hash":"f38ff9b2eecaa17b50b66aa2dae87e9e7436d195","modified":1499076675439},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1499076676082},{"_id":"themes/next/source/lib/font-awesome/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1499076676077},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1499076676768},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-media.js","hash":"51139a4c79573d372a347ef01a493222a1eaf10a","modified":1499076675756},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","hash":"b88b589f5f1aa1b3d87cc7eef34c281ff749b1ae","modified":1499076675761},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","hash":"6394c48092085788a8c0ef72670b0652006231a1","modified":1499076675747},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.js","hash":"90a1b22129efc172e2dfcceeeb76bff58bc3192f","modified":1499076675513},{"_id":"themes/next/source/lib/three/three.min.js","hash":"26273b1cb4914850a89529b48091dc584f2c57b8","modified":1499076677907},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.svg","hash":"b5483b11f8ba213e733b5b8af9927a04fec996f6","modified":1499076676756},{"_id":"themes/next/.git/objects/pack/pack-e5d68ac6929e48654521f5c7d821096b219ee339.pack","hash":"02bb2075cb7768ee81afaa773b38abdc5d7362c1","modified":1499077786000},{"_id":"themes/next/.git/objects/pack/pack-118a81b8e2f0b6b9f993c01769c6bea2556fdf75.pack","hash":"3b2d314fa05528a17a3f98c132b4e9717040965e","modified":1499077786000},{"_id":"public/atom.xml","hash":"fc84e25b9fb4cecaaf57b00fc5021d8399e98f31","modified":1500980088343},{"_id":"public/sitemap.xml","hash":"99421d6333b7a469c7a66b3d9af08cc597317aa4","modified":1500980088343},{"_id":"public/about/index.html","hash":"f3b372bde5faf61f6e6f38c39bc3e43d09f32929","modified":1500980088353},{"_id":"public/categories/index.html","hash":"7db9013d4c75e6dbfdc2ed050329fd3863fa1306","modified":1500980088353},{"_id":"public/tags/index.html","hash":"bc1bd06c48a774a0ee767eb16867f317914ac4f0","modified":1500980088354},{"_id":"public/categories/技术/page/2/index.html","hash":"b27b9c5741ee11a5eddcac82e6cecacc9b9d663e","modified":1500980088354},{"_id":"public/categories/PHP/index.html","hash":"ec4ab09c6e5fd53eddc0da1cc76a0bbe3aaab3d8","modified":1500980088354},{"_id":"public/categories/Phabricator/index.html","hash":"94da1f896b46cd1d983f69424076d14bc692db4c","modified":1500980088354},{"_id":"public/categories/Phabricator/PHP/index.html","hash":"b05870d1015fbdbacaf99bee929ec59a738ebc01","modified":1500980088354},{"_id":"public/categories/多线程/index.html","hash":"53dcc0f940d04e5ee90a27ed6bca52f54260653a","modified":1500980088354},{"_id":"public/categories/生活/index.html","hash":"a5cc117a1eb15db208327360fa3ab6ffe999bdd5","modified":1500980088354},{"_id":"public/categories/Spring/index.html","hash":"ed335c421dd37a4a04fd84df87f6db6ebc664ca4","modified":1500980088354},{"_id":"public/tags/ELK/index.html","hash":"c79411c76e52e123aaacc35d85d3894cf08c991a","modified":1500980088354},{"_id":"public/tags/PHP/index.html","hash":"c9e289dd2c5799c4fff5d7f02507bbd57c845307","modified":1500980088354},{"_id":"public/tags/Log4j/index.html","hash":"88b7f28649824035600e6a98c2f6b93c1a28c72c","modified":1500980088354},{"_id":"public/tags/Logstash/index.html","hash":"481ac3145a33e89cc8e6f3f51edb698f447491cb","modified":1500980088354},{"_id":"public/tags/Phabricator/index.html","hash":"57b3cdd8b9f3a84c687100f99046833cdf8e967d","modified":1500980088354},{"_id":"public/tags/Swagger2/index.html","hash":"7d7b18f7ba14b2973a462b298283c95180f4d80a","modified":1500980088354},{"_id":"public/tags/SpringMVC/index.html","hash":"89ce425b94b33c1eebfe43339f9c73194cdf444d","modified":1500980088355},{"_id":"public/tags/Maven/index.html","hash":"128e166fb11b6d9ba1311fc036ff41832f38a88e","modified":1500980088355},{"_id":"public/tags/Junit/index.html","hash":"83e942d38eda90ac5b84f5289070ddce786e4a5c","modified":1500980088355},{"_id":"public/tags/自动部署/index.html","hash":"f19f72857d6ee4b20d06fd92f57d674dc1489fa0","modified":1500980088355},{"_id":"public/tags/Thread/index.html","hash":"93edb627fb1545e7baad6ddc167f097bc2a04fe1","modified":1500980088355},{"_id":"public/tags/Runnable/index.html","hash":"c0a53a80fe2a7770e96e86711fdba71021c92871","modified":1500980088355},{"_id":"public/tags/Executor/index.html","hash":"c75129bd2a2e2ba563f0778b74f0c2cd79d47d93","modified":1500980088355},{"_id":"public/tags/感想/index.html","hash":"cdb357fdd81a82bccb10b347b75fcab783a56b1e","modified":1500980088355},{"_id":"public/tags/Spring/index.html","hash":"b7ce9dc871a6e003a57928af3f094a2c3af3393e","modified":1500980088355},{"_id":"public/tags/Annotation/index.html","hash":"c02b8feb216d679ad8b10904269ece2d7dff6859","modified":1500980088355},{"_id":"public/tags/synchronized/index.html","hash":"33d8a511806a8c9618001ad985bd2bb45a6d7b64","modified":1500980088355},{"_id":"public/tags/volatile/index.html","hash":"041b76471b3a51b53390475df1e6795a4b97b105","modified":1500980088355},{"_id":"public/tags/锁/index.html","hash":"ab526b37fe64f426e6edc25405e0f776ef576c8b","modified":1500980088355},{"_id":"public/tags/Linux/index.html","hash":"ad2d00cbea2bf7894c3629c35025959e6ddc7220","modified":1500980088355},{"_id":"public/tags/MariaDB/index.html","hash":"962bc45046d29237c26e19abb8a4c80a55cc1987","modified":1500980088355},{"_id":"public/tags/MySql/index.html","hash":"f796f10106ff10347a1e2d92464239d6fd1654d3","modified":1500980088356},{"_id":"public/tags/系统监控/index.html","hash":"898c530000a851bb162b6aa279223112ed315d6b","modified":1500980088356},{"_id":"public/tags/Tomcat/index.html","hash":"c45c91c96eda6bc3a177ab2f071fbf8e6599ef4e","modified":1500980088356},{"_id":"public/2017/07/25/Phabricator-list-item-task/index.html","hash":"50544383dbd65a2a059ce50d03d6156f9e9aff71","modified":1500980088356},{"_id":"public/2017/07/25/Phabricator-workborad-card-task/index.html","hash":"21f7d8041805199368ae6d7dceeb00e82084c72f","modified":1500980088356},{"_id":"public/2017/07/22/Phabricator-project-Herald/index.html","hash":"5d382b1388ef85fc45e98ddacba633eed00d8c29","modified":1500980088356},{"_id":"public/2017/07/03/PHP-basic/index.html","hash":"28e751926517caa6e40da6c6b0362a839446dd0f","modified":1500980088356},{"_id":"public/2017/07/03/Phabricator-Windows-setup/index.html","hash":"153791446b945ebe47443106018127292b377937","modified":1500980088356},{"_id":"public/2017/06/14/Swagger2-SpringMVC/index.html","hash":"57e161727ce0f1002814aaa800f277d16c7d8daf","modified":1500980088356},{"_id":"public/2017/06/09/lock-synchronized-volatile/index.html","hash":"7039f9b8478910cbb3e359e2a771aec46ffe2631","modified":1500980088356},{"_id":"public/2017/05/23/Spring-Annotation/index.html","hash":"df54a37e009ddd84d37a753bcabce426befb4e5e","modified":1500980088356},{"_id":"public/2017/05/15/Linux-MariaDB-setup-MySql/index.html","hash":"b3bc8316c074d00732a0a4aa931f6b656c556426","modified":1500980088356},{"_id":"public/2017/05/15/Linux-monitor-Tomcat/index.html","hash":"ec6cc8a1bb22a153e79aa6cc136ff7529dc6a931","modified":1500980088356},{"_id":"public/2016/12/20/Windows-auto-deploy-war-to-Linux/index.html","hash":"0c55b3f882bfdee1f256be709b2b72d7f52d1fec","modified":1500980088356},{"_id":"public/2016/11/17/load-jar-file-class/index.html","hash":"ff7480ecdf149f362abedeac586c0be8598dc0e2","modified":1500980088357},{"_id":"public/2016/10/31/java-read-file-piece/index.html","hash":"64fee3344ce10ae2328dfcd99a4156189ed9ddf4","modified":1500980088357},{"_id":"public/2016/09/30/Spring-Junit-PropertySource-Value/index.html","hash":"5af0a0521d141f79a0ff5039540b7c22d9510191","modified":1500980088357},{"_id":"public/2016/08/30/Java-Thread-Runnable-Executor-Practice/index.html","hash":"9034cfc67d08243bff6f678a242248942d51a797","modified":1500980088357},{"_id":"public/2016/07/13/Spring-bean-scope-usage/index.html","hash":"54614d27be2f6e341307dc1b8f47492230b5d818","modified":1500980088357},{"_id":"public/2016/07/11/Maven-profiles-testResource-Junit/index.html","hash":"5435fe2a72324056be8656d4293e803f88e5508a","modified":1500980088357},{"_id":"public/2016/07/05/log4j-logstash-practice/index.html","hash":"5cea6cc7d0cd5330f046d952fd42477bc77ce02b","modified":1500980088357},{"_id":"public/2016/06/10/ELK-introduce-setup/index.html","hash":"77d0c2aa27c90be6143b787b760c748a8aa6165c","modified":1500980088357},{"_id":"public/2016/06/07/Java-synchronizd-usage/index.html","hash":"c3df14815fef915ea6dce06b341c168ab500340d","modified":1500980088357},{"_id":"public/2016/06/01/blog-github-some-thinking/index.html","hash":"c6b3936123bdecc91cba31b04d8db9e4cbdff7cd","modified":1500980088357},{"_id":"public/archives/index.html","hash":"dfb2f2381116a558d7a71060049b1dd7f62e9a49","modified":1500980088357},{"_id":"public/categories/技术/index.html","hash":"7f3f49756a1711fcdf5637474fbc4153f0ea87eb","modified":1500980088357},{"_id":"public/index.html","hash":"7c4416b3370863063ce4de68e5b57f2d6ce0e64a","modified":1500980088357},{"_id":"public/page/2/index.html","hash":"a0f78372abace676fe7309c16f771efe1ad2e2cc","modified":1500980088357},{"_id":"public/page/3/index.html","hash":"8fa5e81c643deb20ce43b7af55cb7b0f9aacf88f","modified":1500980088358},{"_id":"public/tags/Java/index.html","hash":"1da55d505f23b774fd4bd437dffcfeef1185cf85","modified":1500980088358},{"_id":"public/images/algolia_logo.svg","hash":"16505f61f19ba65f629dfd033f14ee9abcf18756","modified":1500980088381},{"_id":"public/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1500980088381},{"_id":"public/images/cc-by-nc.svg","hash":"6f076713fb9bf934aa2c1046bdf2cf2e37bc1eab","modified":1500980088381},{"_id":"public/images/cc-by-nc-sa.svg","hash":"6f55543d1fb9cbc436c101d24f802dec7b41efc3","modified":1500980088381},{"_id":"public/images/cc-by-sa.svg","hash":"70c1535f43e54e5ff35ca81419e77e4c0c301398","modified":1500980088381},{"_id":"public/images/cc-by-nc-nd.svg","hash":"bc3588c9b2d7c68830524783120ff6cf957cf668","modified":1500980088381},{"_id":"public/images/cc-by.svg","hash":"e92a33c32d1dac8ed94849b2b4e6456e887efe70","modified":1500980088381},{"_id":"public/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1500980088381},{"_id":"public/images/cc-zero.svg","hash":"9bfb52b2f63527a7049247bf00d44e6dc1170e7d","modified":1500980088381},{"_id":"public/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1500980088381},{"_id":"public/images/cc-by-nd.svg","hash":"42cd73da328077ccc92f859bb8f3cf621b3484f8","modified":1500980088381},{"_id":"public/images/quote-r.svg","hash":"2a2a250b32a87c69dcc1b1976c74b747bedbfb41","modified":1500980088381},{"_id":"public/images/quote-l.svg","hash":"cd108d6f44351cadf8e6742565217f88818a0458","modified":1500980088381},{"_id":"public/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1500980088382},{"_id":"public/lib/font-awesome/HELP-US-OUT.txt","hash":"ee33b2798b1e714b904d663436c6b3521011d1fa","modified":1500980088382},{"_id":"public/lib/fastclick/LICENSE","hash":"6f474ea75c42442da7bbcf2e9143ce98258efd8d","modified":1500980088382},{"_id":"public/lib/fancybox/source/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1500980088382},{"_id":"public/lib/fancybox/source/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1500980088382},{"_id":"public/lib/fancybox/source/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1500980088382},{"_id":"public/lib/fancybox/source/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1500980088382},{"_id":"public/lib/fancybox/source/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1500980088382},{"_id":"public/lib/fancybox/source/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1500980088382},{"_id":"public/lib/font-awesome/css/font-awesome.css.map","hash":"1573904b82807abbb32c97a3632c6c6808eaac50","modified":1500980088382},{"_id":"public/lib/Han/dist/font/han.otf","hash":"f1f6bb8f461f5672e000380195d3d2358a28494c","modified":1500980088382},{"_id":"public/lib/Han/dist/font/han-space.woff","hash":"7a635062b10bf5662ae1d218ba0980171005d060","modified":1500980088382},{"_id":"public/lib/fancybox/source/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1500980088382},{"_id":"public/lib/Han/dist/font/han-space.otf","hash":"07436f011b44051f61b8329c99de4bec64e86f4b","modified":1500980088382},{"_id":"public/lib/Han/dist/font/han.woff","hash":"f38ff9b2eecaa17b50b66aa2dae87e9e7436d195","modified":1500980088382},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1500980092563},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1500980092572},{"_id":"public/js/src/affix.js","hash":"978e0422b5bf1b560236d8d10ebc1adcf66392e3","modified":1500980092589},{"_id":"public/js/src/bootstrap.js","hash":"aab7be0a6e2724b3faa9338db93c19556c559625","modified":1500980092589},{"_id":"public/js/src/algolia-search.js","hash":"b172f697ed339a24b1e80261075232978d164c35","modified":1500980092589},{"_id":"public/js/src/motion.js","hash":"269414e84df544a4ccb88519f6abae4943db3c67","modified":1500980092589},{"_id":"public/js/src/js.cookie.js","hash":"9b37973a90fd50e71ea91682265715e45ae82c75","modified":1500980092590},{"_id":"public/js/src/hook-duoshuo.js","hash":"a6119070c0119f33e08b29da7d2cce2635eb40a0","modified":1500980092590},{"_id":"public/js/src/scroll-cookie.js","hash":"09dc828cbf5f31158ff6250d2bf7c3cde6365c67","modified":1500980092590},{"_id":"public/js/src/post-details.js","hash":"af7a417dd1cb02465a7b98211653e7c6192e6d55","modified":1500980092590},{"_id":"public/js/src/utils.js","hash":"b2ea56de27fddc6d9118051da384f781cd93951d","modified":1500980092590},{"_id":"public/lib/canvas-ribbon/canvas-ribbon.js","hash":"3587602ad777b031628bb5944864d1a4fcfea4ac","modified":1500980092590},{"_id":"public/lib/algolia-instant-search/instantsearch.min.css","hash":"90ef19edc982645b118b095615838d9c5eaba0de","modified":1500980092590},{"_id":"public/lib/fastclick/bower.json","hash":"4dcecf83afddba148464d5339c93f6d0aa9f42e9","modified":1500980092590},{"_id":"public/lib/fastclick/README.html","hash":"da3c74d484c73cc7df565e8abbfa4d6a5a18d4da","modified":1500980092590},{"_id":"public/lib/font-awesome/bower.json","hash":"64394a2a9aa00f8e321d8daa5e51a420f0e96dad","modified":1500980092590},{"_id":"public/js/src/scrollspy.js","hash":"fe4da1b9fe73518226446f5f27d2831e4426fc35","modified":1500980092590},{"_id":"public/lib/jquery_lazyload/CONTRIBUTING.html","hash":"a6358170d346af13b1452ac157b60505bec7015c","modified":1500980092590},{"_id":"public/lib/jquery_lazyload/bower.json","hash":"ae3c3b61e6e7f9e1d7e3585ad854380ecc04cf53","modified":1500980092590},{"_id":"public/lib/jquery_lazyload/README.html","hash":"bde24335f6bc09d8801c0dcd7274f71b466552bd","modified":1500980092591},{"_id":"public/lib/jquery_lazyload/jquery.scrollstop.js","hash":"0e9a81785a011c98be5ea821a8ed7d411818cfd1","modified":1500980092591},{"_id":"public/lib/pace/pace-theme-barber-shop.min.css","hash":"ee0d51446cb4ffe1bb96bd7bc8c8e046dddfcf46","modified":1500980092591},{"_id":"public/js/src/exturl.js","hash":"e42e2aaab7bf4c19a0c8e779140e079c6aa5c0b1","modified":1500980092591},{"_id":"public/lib/pace/pace-theme-center-atom.min.css","hash":"dcf79c24fe5350fb73d8038573a104e73639e9d3","modified":1500980092591},{"_id":"public/lib/jquery_lazyload/jquery.lazyload.js","hash":"481fd478650e12b67c201a0ea41e92743f8b45a3","modified":1500980092591},{"_id":"public/lib/pace/pace-theme-bounce.min.css","hash":"f6bdb9a785b7979dd8ec5c60e278af955ef1e585","modified":1500980092591},{"_id":"public/lib/pace/pace-theme-center-radar.min.css","hash":"ab7cba998bf4c03b13df342bf43647fa4f419783","modified":1500980092591},{"_id":"public/lib/pace/pace-theme-big-counter.min.css","hash":"5b561dc328af4c4d512e20a76fe964d113a32ba8","modified":1500980092591},{"_id":"public/lib/pace/pace-theme-corner-indicator.min.css","hash":"b3c64c973f31884e3d8145989476707333406b9a","modified":1500980092591},{"_id":"public/lib/pace/pace-theme-center-simple.min.css","hash":"67f44c947548bd4d77e7590d3f59e236cbf9e98a","modified":1500980092591},{"_id":"public/lib/pace/pace-theme-minimal.min.css","hash":"9cd783cceb8a191f3c8b5d81f7a430ecc3e489d3","modified":1500980092591},{"_id":"public/lib/pace/pace-theme-center-circle.min.css","hash":"a4066769c78affbfbc5e30a600e2c7862cd532e0","modified":1500980092591},{"_id":"public/lib/pace/pace-theme-mac-osx.min.css","hash":"9f2e7b51b084da407863826b25265b31150b3821","modified":1500980092592},{"_id":"public/lib/pace/pace-theme-fill-left.min.css","hash":"0bec1e235a4a2cccda3f993b205424e1441a44ae","modified":1500980092592},{"_id":"public/lib/pace/pace-theme-flash.min.css","hash":"13ace22c40312d7bbd8d9c1e50eff897a7a497d8","modified":1500980092592},{"_id":"public/lib/pace/pace-theme-loading-bar.min.css","hash":"7ee28875dfc1230d76c537f6605766e8d4011e9f","modified":1500980092592},{"_id":"public/lib/pace/pace.min.js","hash":"9944dfb7814b911090e96446cea4d36e2b487234","modified":1500980092592},{"_id":"public/lib/canvas-nest/canvas-nest.min.js","hash":"0387e75e23b1db108a755073fe52a0d03eb391a7","modified":1500980092592},{"_id":"public/lib/velocity/bower.json","hash":"0ef14e7ccdfba5db6eb3f8fc6aa3b47282c36409","modified":1500980092592},{"_id":"public/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1500980092592},{"_id":"public/js/src/schemes/pisces.js","hash":"79da92119bc246fe05d1626ac98426a83ec90a94","modified":1500980092592},{"_id":"public/lib/fancybox/source/jquery.fancybox.css","hash":"5f163444617b6cf267342f06ac166a237bb62df9","modified":1500980092592},{"_id":"public/lib/ua-parser-js/dist/ua-parser.min.js","hash":"38628e75e4412cc6f11074e03e1c6d257aae495b","modified":1500980092594},{"_id":"public/lib/fastclick/lib/fastclick.min.js","hash":"2cae0f5a6c5d6f3cb993015e6863f9483fc4de18","modified":1500980092594},{"_id":"public/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"214dad442a92d36af77ed0ca1d9092b16687f02f","modified":1500980092594},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","hash":"91e41741c2e93f732c82aaacec4cfc6e3f3ec876","modified":1500980092594},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","hash":"53e194f4a72e649c04fb586dd57762b8c022800b","modified":1500980092594},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1500980092594},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-media.js","hash":"3bdf69ed2469e4fb57f5a95f17300eef891ff90d","modified":1500980092595},{"_id":"public/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1500980092595},{"_id":"public/css/main.css","hash":"46c84cfffa631d2676f6e6e43f2dfaaf3b201e1f","modified":1500980092595},{"_id":"public/lib/three/canvas_lines.min.js","hash":"dce4a3b65f8bf958f973690caa7ec4952f353b0c","modified":1500980092595},{"_id":"public/lib/three/three-waves.min.js","hash":"d968cba6b3a50b3626a02d67b544f349d83b147c","modified":1500980092595},{"_id":"public/lib/three/canvas_sphere.min.js","hash":"d8ea241a53c135a650f7335d2b6982b899fd58a9","modified":1500980092595},{"_id":"public/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1500980092595},{"_id":"public/lib/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1500980092595},{"_id":"public/lib/jquery/index.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1500980092595},{"_id":"public/lib/Han/dist/han.min.css","hash":"d9c0b3dc9158e717fde36f554709e6c3a22b5f85","modified":1500980092595},{"_id":"public/lib/Han/dist/han.min.js","hash":"f559c68a25065a14f47da954a7617d87263e409d","modified":1500980092595},{"_id":"public/lib/fancybox/source/jquery.fancybox.js","hash":"1cf3d47b5ccb7cb6e9019c64f2a88d03a64853e4","modified":1500980092595},{"_id":"public/lib/fancybox/source/jquery.fancybox.pack.js","hash":"53360764b429c212f424399384417ccc233bb3be","modified":1500980092595},{"_id":"public/lib/fastclick/lib/fastclick.js","hash":"06cef196733a710e77ad7e386ced6963f092dc55","modified":1500980092595},{"_id":"public/lib/Han/dist/han.js","hash":"e345397e0585c9fed1449e614ec13e0224acf2ab","modified":1500980092595},{"_id":"public/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1500980092595},{"_id":"public/lib/Han/dist/han.css","hash":"38e48f275ad00daa9dcdcb8d9b44e576acda4707","modified":1500980092596},{"_id":"public/lib/velocity/velocity.js","hash":"9f08181baea0cc0e906703b7e5df9111b9ef3373","modified":1500980092596},{"_id":"public/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1500980092596},{"_id":"public/lib/three/three.min.js","hash":"73f4cdc17e51a72b9bf5b9291f65386d615c483b","modified":1500980092596},{"_id":"public/lib/algolia-instant-search/instantsearch.min.js","hash":"9ccc6f8144f54e86df9a3fd33a18368d81cf3a4f","modified":1500980092596},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1500980092596},{"_id":"public/lib/font-awesome/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1500980092596},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1500980092596},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.svg","hash":"b5483b11f8ba213e733b5b8af9927a04fec996f6","modified":1500980092668}],"Category":[{"name":"技术","_id":"cj5jgsbdh00052cezy35zgfme"},{"name":"PHP","_id":"cj5jgsbe0000g2ceznmylltkq"},{"name":"Phabricator","_id":"cj5jgsbe7000o2cez1xcsxcme"},{"name":"PHP","parent":"cj5jgsbe7000o2cez1xcsxcme","_id":"cj5jgsbeg000y2cezaytqx7d6"},{"name":"多线程","_id":"cj5jgsbes00142cezk56xu3jk"},{"name":"生活","_id":"cj5jgsbex001d2cez94rl1jm4"},{"name":"Spring","_id":"cj5jgsbf3001l2cezsu0qz9i3"}],"Data":[],"Page":[{"title":"关于我","layout":"categories","date":"2016-07-14T02:59:34.000Z","comments":0,"_content":"","source":"about/index.md","raw":"---\ntitle: 关于我\nlayout: categories\ndate: 2016-07-14 10:59:34\ncomments: false\n---\n","updated":"2016-10-10T01:58:06.843Z","path":"about/index.html","_id":"cj5jgsbd100002cezxlfpmakq","content":"","excerpt":"","more":""},{"title":"分类","date":"2016-07-14T02:59:22.000Z","layout":"categories","type":"categories","comments":0,"_content":"","source":"categories/index.md","raw":"---\ntitle: 分类\ndate: 2016-07-14 10:59:22\nlayout: categories\ntype: \"categories\"\ncomments: false\n---\n","updated":"2016-10-10T01:58:06.850Z","path":"categories/index.html","_id":"cj5jgsbd900022cez1tw3i0ya","content":"","excerpt":"","more":""},{"title":"标签","layout":"tags","date":"2016-06-08T10:14:15.000Z","type":"tags","comments":0,"_content":"\n","source":"tags/index.md","raw":"---\ntitle: 标签\nlayout: tags\ndate: 2016-06-08 18:14:15\ntype: \"tags\"\ncomments: false\n---\n\n","updated":"2016-10-10T01:58:06.857Z","path":"tags/index.html","_id":"cj5jgsbdi00062cezwkqm1w89","content":"","excerpt":"","more":""}],"Post":[{"title":"Java 中的 synchronizd 关键字在同步中的使用","title_url":"Java-synchronizd-usage","date":"2016-06-06T16:00:00.000Z","description":"Java 中的 synchronizd 关键字在同步中的使用","_content":"\n### 为什么要线程同步\n\n- 同步的目的是避免在同一个时间点操作同一个数据\n- 这里操作是指`update`，`delete`，数据是指任意对象\n- 每一个对象都有一把锁，`synchronized` 就是为此对象上锁，等到 `synchronized` 方法或`synchronized` 代码块执行完就会自动解锁，所有多线程执行相同带`synchronized`的代码时会检查所操作对象是否上锁，如果已经被锁住，就阻塞等待，直到锁此代码段的线程执行完此代码块。\n\n### synchronized 5种用法\n\n-\t用在普通方法上\n```java\npublic synchronized void test() {\n // 业务代码\n}\n```\n-\t用在静态方法上\n```java\npublic static synchronized void test3() {\n // 业务代码\n}\n```\n-\t用在代码块，括号里面是this\n```java\npublic void test1() {\n    synchronized(this) {\n      // 业务代码\n\t  }\n}\n```\n-\t用在代码块，括号里面是类的一个实例，和this类似\n```java\npublic void test11() {\n  Sync sync = this;\n  synchronized(sync) {\n    // 业务代码\n  }\n}\n```\n-\t用在代码块，括号里面是类\n```java\npublic void test2() {\n  synchronized (Sync.class) {\n      // 业务代码\n  }\n}\n```\n\nsynchronized 锁住的是括号里的对象，而不是代码。对于非静态的 synchronized 方法，锁的就是对象本身也就是this。\n\n当 synchronized 锁住一个对象后，别的线程如果也想拿到这个对象的锁，就必须等待这个线程执行完成释放锁，才能再次给对象加锁，这样才达到线程同步的目的。\n\n```java\npublic class SynchronizedTest {\n\t\n\tPerson p = new Person(\"lin\", 15);\n\t\n\tpublic synchronized void say() {//相当于锁住this，效果和say3()一样，只要多个线程同时访问同一个SynchronizedTest实例（相当于this），就会发生不能同时访问此方法\n\t\tSystem.out.println(p.getName());\n\t}\n\t\n\tpublic void say2() {\n\t\tsynchronized(p) {//相当于锁住p，只要多个线程同时访问此代码块且是同一个p，那么在同一时间，只有一个线程能对P进行操作。\n\t\t\tSystem.out.println(p.getName());\n\t\t}\n\t}\n\t\n\tpublic void say3() {\n\t\tsynchronized(this) {//锁住this，效果和say()一样，只要多个线程同时访问同一个SynchronizedTest实例（this），就会发生不能同时访问此代码块\n\t\t\tSystem.out.println(p.getName());\n\t\t}\n\t}\n}\n\n```\n上面的三种用法都是为了避免在多个线程操作同一个对象的时候同时访问一个代码块或者某个方法。\n\n### 误用 synchronized 的情况\n下面的代码想要防止多个线程同时对某个代码块的访问，但是最后没有做到。\n```java\nclass Sync {  \n  \n    public synchronized void test() {  \n        System.out.println(\"test开始..\");  \n        try {  \n            Thread.sleep(1000);  \n        } catch (InterruptedException e) {  \n            e.printStackTrace();  \n        }  \n        System.out.println(\"test结束..\");  \n    }  \n}  \n  \nclass MyThread extends Thread {  \n  \n    public void run() {  \n        Sync sync = new Sync();  \n        sync.test();  \n    }  \n}  \n  \npublic class Main {  \n  \n    public static void main(String[] args) {  \n        for (int i = 0; i < 3; i++) {  \n            Thread thread = new MyThread();  \n            thread.start();  \n        }  \n    }  \n}  \n```\n```\n运行结果：\ntest开始..\ntest开始..\ntest开始..\ntest结束..\ntest结束..\ntest结束..\n```\n可以看出来，上面的程序起了三个线程，同时运行test方法，虽然test方法加上了synchronized，但是还是同时运行起来，貌似synchronized没起作用。\n\n将test方法改成如下：\n```java\npublic void test() {  \n    synchronized(this){  \n        System.out.println(\"test开始..\");  \n        try {  \n            Thread.sleep(1000);  \n        } catch (InterruptedException e) {  \n            e.printStackTrace();  \n        }  \n        System.out.println(\"test结束..\");  \n    }  \n}  \n```\n```\n运行结果：\ntest开始..\ntest开始..\ntest开始..\ntest结束..\ntest结束..\ntest结束..\n```\n一切还是这么平静，没有看到synchronized 达到想要的结果。为什么？刚才讲到上面的两种方法是为了避免在多个线程操作**同一个对象**的时候同时访问一个代码块或者某个方法，但是在\n```java\nclass MyThread extends Thread {  \n  \n    public void run() {  \n        Sync sync = new Sync();  \n        sync.test();  \n    }  \n}  \n```\n中，每个线程都单独操作一个 Sync 对象，这样线程之间根本不会发生同步。怎么做呢？\n```java\nclass MyThread2 extends Thread {\n\t\n\tprivate Sync sync;\n\t\n\tpublic MyThread2(Sync sync) {\n\t\tthis.sync = sync;\n\t}\n\t  \n    public void run() {\n        sync.test();  \n    }  \n}\n```\n```java\nSync sync = new Sync();\nfor (int i = 0; i < 3; i++) {  \n    Thread thread = new MyThread2(sync);\n    thread.start();  \n}\n```\n输出结果如下：\n```\ntest开始..\ntest结束..\ntest开始..\ntest结束..\ntest开始..\ntest结束..\n```\n这样就达到预期了，多个线程在操作同一个对象的时候只有一个线程能够访问 test 方法。\n\n但是还有其他方法吗？也就是如何避免多个线程执行多个对象的同一个代码块呢。看看下面的代码：\n```java\npublic class Sync {\n\tpublic void test2() {\n\t\tsynchronized (Sync.class) { // 作用于 Sync 类的所有实例\n\t\t\tSystem.out.println(\"test2开始..\");\n\t\t\ttry {\n\t\t\t\tThread.sleep(1000);\n\t\t\t} catch (InterruptedException e) {\n\t\t\t\te.printStackTrace();\n\t\t\t}\n\t\t\tSystem.out.println(\"test2结束..\");\n\t\t}\n\t}\n}\n```\n```java\nclass MyThread3 extends Thread {  \n\t  \n    public void run() {  \n        Sync sync = new Sync();  \n        sync.test2();  \n    }  \n}\n```\n```java\nfor (int i = 0; i < 3; i++) {  \n    Thread thread = new MyThread3();\n    thread.start();  \n}\n```\n输出结果如下：\n```\ntest2开始..\ntest2结束..\ntest2开始..\ntest2结束..\ntest2开始..\ntest2结束..\n```\n这样就满足期望了，关键是\n```java\nsynchronized (Sync.class) { // 作用于 Sync 类的所有实例\n//...\n}\n```\n\n如果synchronized作用于某个静态方法上会有什么效果呢？\n```java\npublic static synchronized void test3() {\n\tSystem.out.println(\"test3开始..\");\n\ttry {\n\t\tThread.sleep(1000);\n\t} catch (InterruptedException e) {\n\t\te.printStackTrace();\n\t}\n\tSystem.out.println(\"test3结束..\");\n}\n```\n```java\nclass MyThread4 extends Thread {  \n\t  \n    public void run() {  \n        Sync.test3();  \n    }  \n}\n```\n```java\nfor (int i = 0; i < 3; i++) {  \n    Thread thread = new MyThread4();\n    thread.start();  \n}\n```\n输出结果如下：\n```\ntest3开始..\ntest3结束..\ntest3开始..\ntest3结束..\ntest3开始..\ntest3结束..\n```\n这同样能够满足期望，从上面的这些例子也很好说明了5种的synchronized区别和相同点。\n\n\n### 对 synchronized 的总结\n\n- 方法同步，锁当前对象（this）\n- 静态同步方法，锁当前类的Class对象\n- 对于同步代码块，锁住的是synchronized括号中的对象，任意对象，当前类对象或者是其他对象。\n\n参考如下：\n[Java:使用synchronized和Lock对象获取对象锁](http://zhangjunhd.blog.51cto.com/113473/70300)\n[线程同步总结--synchronized方法和synchronized代码块](http://991690137.iteye.com/blog/1948882)","source":"_posts/Java中的 synchronizd 关键字用法.md","raw":"---\ntitle: Java 中的 synchronizd 关键字在同步中的使用\ntitle_url: Java-synchronizd-usage\ndate: 2016-06-07\ntags: Java\ncategories: 技术\ndescription: Java 中的 synchronizd 关键字在同步中的使用\n---\n\n### 为什么要线程同步\n\n- 同步的目的是避免在同一个时间点操作同一个数据\n- 这里操作是指`update`，`delete`，数据是指任意对象\n- 每一个对象都有一把锁，`synchronized` 就是为此对象上锁，等到 `synchronized` 方法或`synchronized` 代码块执行完就会自动解锁，所有多线程执行相同带`synchronized`的代码时会检查所操作对象是否上锁，如果已经被锁住，就阻塞等待，直到锁此代码段的线程执行完此代码块。\n\n### synchronized 5种用法\n\n-\t用在普通方法上\n```java\npublic synchronized void test() {\n // 业务代码\n}\n```\n-\t用在静态方法上\n```java\npublic static synchronized void test3() {\n // 业务代码\n}\n```\n-\t用在代码块，括号里面是this\n```java\npublic void test1() {\n    synchronized(this) {\n      // 业务代码\n\t  }\n}\n```\n-\t用在代码块，括号里面是类的一个实例，和this类似\n```java\npublic void test11() {\n  Sync sync = this;\n  synchronized(sync) {\n    // 业务代码\n  }\n}\n```\n-\t用在代码块，括号里面是类\n```java\npublic void test2() {\n  synchronized (Sync.class) {\n      // 业务代码\n  }\n}\n```\n\nsynchronized 锁住的是括号里的对象，而不是代码。对于非静态的 synchronized 方法，锁的就是对象本身也就是this。\n\n当 synchronized 锁住一个对象后，别的线程如果也想拿到这个对象的锁，就必须等待这个线程执行完成释放锁，才能再次给对象加锁，这样才达到线程同步的目的。\n\n```java\npublic class SynchronizedTest {\n\t\n\tPerson p = new Person(\"lin\", 15);\n\t\n\tpublic synchronized void say() {//相当于锁住this，效果和say3()一样，只要多个线程同时访问同一个SynchronizedTest实例（相当于this），就会发生不能同时访问此方法\n\t\tSystem.out.println(p.getName());\n\t}\n\t\n\tpublic void say2() {\n\t\tsynchronized(p) {//相当于锁住p，只要多个线程同时访问此代码块且是同一个p，那么在同一时间，只有一个线程能对P进行操作。\n\t\t\tSystem.out.println(p.getName());\n\t\t}\n\t}\n\t\n\tpublic void say3() {\n\t\tsynchronized(this) {//锁住this，效果和say()一样，只要多个线程同时访问同一个SynchronizedTest实例（this），就会发生不能同时访问此代码块\n\t\t\tSystem.out.println(p.getName());\n\t\t}\n\t}\n}\n\n```\n上面的三种用法都是为了避免在多个线程操作同一个对象的时候同时访问一个代码块或者某个方法。\n\n### 误用 synchronized 的情况\n下面的代码想要防止多个线程同时对某个代码块的访问，但是最后没有做到。\n```java\nclass Sync {  \n  \n    public synchronized void test() {  \n        System.out.println(\"test开始..\");  \n        try {  \n            Thread.sleep(1000);  \n        } catch (InterruptedException e) {  \n            e.printStackTrace();  \n        }  \n        System.out.println(\"test结束..\");  \n    }  \n}  \n  \nclass MyThread extends Thread {  \n  \n    public void run() {  \n        Sync sync = new Sync();  \n        sync.test();  \n    }  \n}  \n  \npublic class Main {  \n  \n    public static void main(String[] args) {  \n        for (int i = 0; i < 3; i++) {  \n            Thread thread = new MyThread();  \n            thread.start();  \n        }  \n    }  \n}  \n```\n```\n运行结果：\ntest开始..\ntest开始..\ntest开始..\ntest结束..\ntest结束..\ntest结束..\n```\n可以看出来，上面的程序起了三个线程，同时运行test方法，虽然test方法加上了synchronized，但是还是同时运行起来，貌似synchronized没起作用。\n\n将test方法改成如下：\n```java\npublic void test() {  \n    synchronized(this){  \n        System.out.println(\"test开始..\");  \n        try {  \n            Thread.sleep(1000);  \n        } catch (InterruptedException e) {  \n            e.printStackTrace();  \n        }  \n        System.out.println(\"test结束..\");  \n    }  \n}  \n```\n```\n运行结果：\ntest开始..\ntest开始..\ntest开始..\ntest结束..\ntest结束..\ntest结束..\n```\n一切还是这么平静，没有看到synchronized 达到想要的结果。为什么？刚才讲到上面的两种方法是为了避免在多个线程操作**同一个对象**的时候同时访问一个代码块或者某个方法，但是在\n```java\nclass MyThread extends Thread {  \n  \n    public void run() {  \n        Sync sync = new Sync();  \n        sync.test();  \n    }  \n}  \n```\n中，每个线程都单独操作一个 Sync 对象，这样线程之间根本不会发生同步。怎么做呢？\n```java\nclass MyThread2 extends Thread {\n\t\n\tprivate Sync sync;\n\t\n\tpublic MyThread2(Sync sync) {\n\t\tthis.sync = sync;\n\t}\n\t  \n    public void run() {\n        sync.test();  \n    }  \n}\n```\n```java\nSync sync = new Sync();\nfor (int i = 0; i < 3; i++) {  \n    Thread thread = new MyThread2(sync);\n    thread.start();  \n}\n```\n输出结果如下：\n```\ntest开始..\ntest结束..\ntest开始..\ntest结束..\ntest开始..\ntest结束..\n```\n这样就达到预期了，多个线程在操作同一个对象的时候只有一个线程能够访问 test 方法。\n\n但是还有其他方法吗？也就是如何避免多个线程执行多个对象的同一个代码块呢。看看下面的代码：\n```java\npublic class Sync {\n\tpublic void test2() {\n\t\tsynchronized (Sync.class) { // 作用于 Sync 类的所有实例\n\t\t\tSystem.out.println(\"test2开始..\");\n\t\t\ttry {\n\t\t\t\tThread.sleep(1000);\n\t\t\t} catch (InterruptedException e) {\n\t\t\t\te.printStackTrace();\n\t\t\t}\n\t\t\tSystem.out.println(\"test2结束..\");\n\t\t}\n\t}\n}\n```\n```java\nclass MyThread3 extends Thread {  \n\t  \n    public void run() {  \n        Sync sync = new Sync();  \n        sync.test2();  \n    }  \n}\n```\n```java\nfor (int i = 0; i < 3; i++) {  \n    Thread thread = new MyThread3();\n    thread.start();  \n}\n```\n输出结果如下：\n```\ntest2开始..\ntest2结束..\ntest2开始..\ntest2结束..\ntest2开始..\ntest2结束..\n```\n这样就满足期望了，关键是\n```java\nsynchronized (Sync.class) { // 作用于 Sync 类的所有实例\n//...\n}\n```\n\n如果synchronized作用于某个静态方法上会有什么效果呢？\n```java\npublic static synchronized void test3() {\n\tSystem.out.println(\"test3开始..\");\n\ttry {\n\t\tThread.sleep(1000);\n\t} catch (InterruptedException e) {\n\t\te.printStackTrace();\n\t}\n\tSystem.out.println(\"test3结束..\");\n}\n```\n```java\nclass MyThread4 extends Thread {  \n\t  \n    public void run() {  \n        Sync.test3();  \n    }  \n}\n```\n```java\nfor (int i = 0; i < 3; i++) {  \n    Thread thread = new MyThread4();\n    thread.start();  \n}\n```\n输出结果如下：\n```\ntest3开始..\ntest3结束..\ntest3开始..\ntest3结束..\ntest3开始..\ntest3结束..\n```\n这同样能够满足期望，从上面的这些例子也很好说明了5种的synchronized区别和相同点。\n\n\n### 对 synchronized 的总结\n\n- 方法同步，锁当前对象（this）\n- 静态同步方法，锁当前类的Class对象\n- 对于同步代码块，锁住的是synchronized括号中的对象，任意对象，当前类对象或者是其他对象。\n\n参考如下：\n[Java:使用synchronized和Lock对象获取对象锁](http://zhangjunhd.blog.51cto.com/113473/70300)\n[线程同步总结--synchronized方法和synchronized代码块](http://991690137.iteye.com/blog/1948882)","slug":"Java中的 synchronizd 关键字用法","published":1,"updated":"2016-10-10T01:58:06.772Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj5jgsbd300012cezk9tsbpd8","content":"<h3 id=\"为什么要线程同步\"><a href=\"#为什么要线程同步\" class=\"headerlink\" title=\"为什么要线程同步\"></a>为什么要线程同步</h3><ul>\n<li>同步的目的是避免在同一个时间点操作同一个数据</li>\n<li>这里操作是指<code>update</code>，<code>delete</code>，数据是指任意对象</li>\n<li>每一个对象都有一把锁，<code>synchronized</code> 就是为此对象上锁，等到 <code>synchronized</code> 方法或<code>synchronized</code> 代码块执行完就会自动解锁，所有多线程执行相同带<code>synchronized</code>的代码时会检查所操作对象是否上锁，如果已经被锁住，就阻塞等待，直到锁此代码段的线程执行完此代码块。</li>\n</ul>\n<h3 id=\"synchronized-5种用法\"><a href=\"#synchronized-5种用法\" class=\"headerlink\" title=\"synchronized 5种用法\"></a>synchronized 5种用法</h3><ul>\n<li><p>用在普通方法上</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">test</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\"> <span class=\"comment\">// 业务代码</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>用在静态方法上</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">test3</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\"> <span class=\"comment\">// 业务代码</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>用在代码块，括号里面是this</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test1</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">synchronized</span>(<span class=\"keyword\">this</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 业务代码</span></span><br><span class=\"line\">\t  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>用在代码块，括号里面是类的一个实例，和this类似</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test11</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  Sync sync = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"keyword\">synchronized</span>(sync) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 业务代码</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>用在代码块，括号里面是类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test2</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">synchronized</span> (Sync.class) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 业务代码</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>synchronized 锁住的是括号里的对象，而不是代码。对于非静态的 synchronized 方法，锁的就是对象本身也就是this。</p>\n<p>当 synchronized 锁住一个对象后，别的线程如果也想拿到这个对象的锁，就必须等待这个线程执行完成释放锁，才能再次给对象加锁，这样才达到线程同步的目的。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SynchronizedTest</span> </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tPerson p = <span class=\"keyword\">new</span> Person(<span class=\"string\">\"lin\"</span>, <span class=\"number\">15</span>);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">say</span><span class=\"params\">()</span> </span>&#123;<span class=\"comment\">//相当于锁住this，效果和say3()一样，只要多个线程同时访问同一个SynchronizedTest实例（相当于this），就会发生不能同时访问此方法</span></span><br><span class=\"line\">\t\tSystem.out.println(p.getName());</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">say2</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">synchronized</span>(p) &#123;<span class=\"comment\">//相当于锁住p，只要多个线程同时访问此代码块且是同一个p，那么在同一时间，只有一个线程能对P进行操作。</span></span><br><span class=\"line\">\t\t\tSystem.out.println(p.getName());</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">say3</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">synchronized</span>(<span class=\"keyword\">this</span>) &#123;<span class=\"comment\">//锁住this，效果和say()一样，只要多个线程同时访问同一个SynchronizedTest实例（this），就会发生不能同时访问此代码块</span></span><br><span class=\"line\">\t\t\tSystem.out.println(p.getName());</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>上面的三种用法都是为了避免在多个线程操作同一个对象的时候同时访问一个代码块或者某个方法。</p>\n<h3 id=\"误用-synchronized-的情况\"><a href=\"#误用-synchronized-的情况\" class=\"headerlink\" title=\"误用 synchronized 的情况\"></a>误用 synchronized 的情况</h3><p>下面的代码想要防止多个线程同时对某个代码块的访问，但是最后没有做到。<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Sync</span> </span>&#123;  </span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">test</span><span class=\"params\">()</span> </span>&#123;  </span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"test开始..\"</span>);  </span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;  </span><br><span class=\"line\">            Thread.sleep(<span class=\"number\">1000</span>);  </span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;  </span><br><span class=\"line\">            e.printStackTrace();  </span><br><span class=\"line\">        &#125;  </span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"test结束..\"</span>);  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyThread</span> <span class=\"keyword\">extends</span> <span class=\"title\">Thread</span> </span>&#123;  </span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;  </span><br><span class=\"line\">        Sync sync = <span class=\"keyword\">new</span> Sync();  </span><br><span class=\"line\">        sync.test();  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Main</span> </span>&#123;  </span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;  </span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; i++) &#123;  </span><br><span class=\"line\">            Thread thread = <span class=\"keyword\">new</span> MyThread();  </span><br><span class=\"line\">            thread.start();  </span><br><span class=\"line\">        &#125;  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">运行结果：</span><br><span class=\"line\">test开始..</span><br><span class=\"line\">test开始..</span><br><span class=\"line\">test开始..</span><br><span class=\"line\">test结束..</span><br><span class=\"line\">test结束..</span><br><span class=\"line\">test结束..</span><br></pre></td></tr></table></figure>\n<p>可以看出来，上面的程序起了三个线程，同时运行test方法，虽然test方法加上了synchronized，但是还是同时运行起来，貌似synchronized没起作用。</p>\n<p>将test方法改成如下：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test</span><span class=\"params\">()</span> </span>&#123;  </span><br><span class=\"line\">    <span class=\"keyword\">synchronized</span>(<span class=\"keyword\">this</span>)&#123;  </span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"test开始..\"</span>);  </span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;  </span><br><span class=\"line\">            Thread.sleep(<span class=\"number\">1000</span>);  </span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;  </span><br><span class=\"line\">            e.printStackTrace();  </span><br><span class=\"line\">        &#125;  </span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"test结束..\"</span>);  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">运行结果：</span><br><span class=\"line\">test开始..</span><br><span class=\"line\">test开始..</span><br><span class=\"line\">test开始..</span><br><span class=\"line\">test结束..</span><br><span class=\"line\">test结束..</span><br><span class=\"line\">test结束..</span><br></pre></td></tr></table></figure>\n<p>一切还是这么平静，没有看到synchronized 达到想要的结果。为什么？刚才讲到上面的两种方法是为了避免在多个线程操作<strong>同一个对象</strong>的时候同时访问一个代码块或者某个方法，但是在<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyThread</span> <span class=\"keyword\">extends</span> <span class=\"title\">Thread</span> </span>&#123;  </span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;  </span><br><span class=\"line\">        Sync sync = <span class=\"keyword\">new</span> Sync();  </span><br><span class=\"line\">        sync.test();  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>中，每个线程都单独操作一个 Sync 对象，这样线程之间根本不会发生同步。怎么做呢？<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyThread2</span> <span class=\"keyword\">extends</span> <span class=\"title\">Thread</span> </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> Sync sync;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">MyThread2</span><span class=\"params\">(Sync sync)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>.sync = sync;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        sync.test();  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Sync sync = <span class=\"keyword\">new</span> Sync();</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; i++) &#123;  </span><br><span class=\"line\">    Thread thread = <span class=\"keyword\">new</span> MyThread2(sync);</span><br><span class=\"line\">    thread.start();  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>输出结果如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test开始..</span><br><span class=\"line\">test结束..</span><br><span class=\"line\">test开始..</span><br><span class=\"line\">test结束..</span><br><span class=\"line\">test开始..</span><br><span class=\"line\">test结束..</span><br></pre></td></tr></table></figure></p>\n<p>这样就达到预期了，多个线程在操作同一个对象的时候只有一个线程能够访问 test 方法。</p>\n<p>但是还有其他方法吗？也就是如何避免多个线程执行多个对象的同一个代码块呢。看看下面的代码：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Sync</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test2</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">synchronized</span> (Sync.class) &#123; <span class=\"comment\">// 作用于 Sync 类的所有实例</span></span><br><span class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"test2开始..\"</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t\tThread.sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">\t\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"test2结束..\"</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyThread3</span> <span class=\"keyword\">extends</span> <span class=\"title\">Thread</span> </span>&#123;  </span><br><span class=\"line\">\t  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;  </span><br><span class=\"line\">        Sync sync = <span class=\"keyword\">new</span> Sync();  </span><br><span class=\"line\">        sync.test2();  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; i++) &#123;  </span><br><span class=\"line\">    Thread thread = <span class=\"keyword\">new</span> MyThread3();</span><br><span class=\"line\">    thread.start();  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>输出结果如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test2开始..</span><br><span class=\"line\">test2结束..</span><br><span class=\"line\">test2开始..</span><br><span class=\"line\">test2结束..</span><br><span class=\"line\">test2开始..</span><br><span class=\"line\">test2结束..</span><br></pre></td></tr></table></figure></p>\n<p>这样就满足期望了，关键是<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">synchronized</span> (Sync.class) &#123; <span class=\"comment\">// 作用于 Sync 类的所有实例</span></span><br><span class=\"line\"><span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>如果synchronized作用于某个静态方法上会有什么效果呢？<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">test3</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\tSystem.out.println(<span class=\"string\">\"test3开始..\"</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\tThread.sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">\t\te.printStackTrace();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tSystem.out.println(<span class=\"string\">\"test3结束..\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyThread4</span> <span class=\"keyword\">extends</span> <span class=\"title\">Thread</span> </span>&#123;  </span><br><span class=\"line\">\t  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;  </span><br><span class=\"line\">        Sync.test3();  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; i++) &#123;  </span><br><span class=\"line\">    Thread thread = <span class=\"keyword\">new</span> MyThread4();</span><br><span class=\"line\">    thread.start();  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>输出结果如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test3开始..</span><br><span class=\"line\">test3结束..</span><br><span class=\"line\">test3开始..</span><br><span class=\"line\">test3结束..</span><br><span class=\"line\">test3开始..</span><br><span class=\"line\">test3结束..</span><br></pre></td></tr></table></figure></p>\n<p>这同样能够满足期望，从上面的这些例子也很好说明了5种的synchronized区别和相同点。</p>\n<h3 id=\"对-synchronized-的总结\"><a href=\"#对-synchronized-的总结\" class=\"headerlink\" title=\"对 synchronized 的总结\"></a>对 synchronized 的总结</h3><ul>\n<li>方法同步，锁当前对象（this）</li>\n<li>静态同步方法，锁当前类的Class对象</li>\n<li>对于同步代码块，锁住的是synchronized括号中的对象，任意对象，当前类对象或者是其他对象。</li>\n</ul>\n<p>参考如下：<br><a href=\"http://zhangjunhd.blog.51cto.com/113473/70300\" target=\"_blank\" rel=\"external\">Java:使用synchronized和Lock对象获取对象锁</a><br><a href=\"http://991690137.iteye.com/blog/1948882\" target=\"_blank\" rel=\"external\">线程同步总结–synchronized方法和synchronized代码块</a></p>\n","excerpt":"","more":"<h3 id=\"为什么要线程同步\"><a href=\"#为什么要线程同步\" class=\"headerlink\" title=\"为什么要线程同步\"></a>为什么要线程同步</h3><ul>\n<li>同步的目的是避免在同一个时间点操作同一个数据</li>\n<li>这里操作是指<code>update</code>，<code>delete</code>，数据是指任意对象</li>\n<li>每一个对象都有一把锁，<code>synchronized</code> 就是为此对象上锁，等到 <code>synchronized</code> 方法或<code>synchronized</code> 代码块执行完就会自动解锁，所有多线程执行相同带<code>synchronized</code>的代码时会检查所操作对象是否上锁，如果已经被锁住，就阻塞等待，直到锁此代码段的线程执行完此代码块。</li>\n</ul>\n<h3 id=\"synchronized-5种用法\"><a href=\"#synchronized-5种用法\" class=\"headerlink\" title=\"synchronized 5种用法\"></a>synchronized 5种用法</h3><ul>\n<li><p>用在普通方法上</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">test</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\"> <span class=\"comment\">// 业务代码</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>用在静态方法上</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">test3</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\"> <span class=\"comment\">// 业务代码</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>用在代码块，括号里面是this</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test1</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">synchronized</span>(<span class=\"keyword\">this</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 业务代码</span></span><br><span class=\"line\">\t  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>用在代码块，括号里面是类的一个实例，和this类似</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test11</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  Sync sync = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"keyword\">synchronized</span>(sync) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 业务代码</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>用在代码块，括号里面是类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test2</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">synchronized</span> (Sync.class) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 业务代码</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>synchronized 锁住的是括号里的对象，而不是代码。对于非静态的 synchronized 方法，锁的就是对象本身也就是this。</p>\n<p>当 synchronized 锁住一个对象后，别的线程如果也想拿到这个对象的锁，就必须等待这个线程执行完成释放锁，才能再次给对象加锁，这样才达到线程同步的目的。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SynchronizedTest</span> </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tPerson p = <span class=\"keyword\">new</span> Person(<span class=\"string\">\"lin\"</span>, <span class=\"number\">15</span>);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">say</span><span class=\"params\">()</span> </span>&#123;<span class=\"comment\">//相当于锁住this，效果和say3()一样，只要多个线程同时访问同一个SynchronizedTest实例（相当于this），就会发生不能同时访问此方法</span></span><br><span class=\"line\">\t\tSystem.out.println(p.getName());</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">say2</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">synchronized</span>(p) &#123;<span class=\"comment\">//相当于锁住p，只要多个线程同时访问此代码块且是同一个p，那么在同一时间，只有一个线程能对P进行操作。</span></span><br><span class=\"line\">\t\t\tSystem.out.println(p.getName());</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">say3</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">synchronized</span>(<span class=\"keyword\">this</span>) &#123;<span class=\"comment\">//锁住this，效果和say()一样，只要多个线程同时访问同一个SynchronizedTest实例（this），就会发生不能同时访问此代码块</span></span><br><span class=\"line\">\t\t\tSystem.out.println(p.getName());</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>上面的三种用法都是为了避免在多个线程操作同一个对象的时候同时访问一个代码块或者某个方法。</p>\n<h3 id=\"误用-synchronized-的情况\"><a href=\"#误用-synchronized-的情况\" class=\"headerlink\" title=\"误用 synchronized 的情况\"></a>误用 synchronized 的情况</h3><p>下面的代码想要防止多个线程同时对某个代码块的访问，但是最后没有做到。<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Sync</span> </span>&#123;  </span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">test</span><span class=\"params\">()</span> </span>&#123;  </span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"test开始..\"</span>);  </span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;  </span><br><span class=\"line\">            Thread.sleep(<span class=\"number\">1000</span>);  </span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;  </span><br><span class=\"line\">            e.printStackTrace();  </span><br><span class=\"line\">        &#125;  </span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"test结束..\"</span>);  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyThread</span> <span class=\"keyword\">extends</span> <span class=\"title\">Thread</span> </span>&#123;  </span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;  </span><br><span class=\"line\">        Sync sync = <span class=\"keyword\">new</span> Sync();  </span><br><span class=\"line\">        sync.test();  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Main</span> </span>&#123;  </span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;  </span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; i++) &#123;  </span><br><span class=\"line\">            Thread thread = <span class=\"keyword\">new</span> MyThread();  </span><br><span class=\"line\">            thread.start();  </span><br><span class=\"line\">        &#125;  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">运行结果：</span><br><span class=\"line\">test开始..</span><br><span class=\"line\">test开始..</span><br><span class=\"line\">test开始..</span><br><span class=\"line\">test结束..</span><br><span class=\"line\">test结束..</span><br><span class=\"line\">test结束..</span><br></pre></td></tr></table></figure>\n<p>可以看出来，上面的程序起了三个线程，同时运行test方法，虽然test方法加上了synchronized，但是还是同时运行起来，貌似synchronized没起作用。</p>\n<p>将test方法改成如下：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test</span><span class=\"params\">()</span> </span>&#123;  </span><br><span class=\"line\">    <span class=\"keyword\">synchronized</span>(<span class=\"keyword\">this</span>)&#123;  </span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"test开始..\"</span>);  </span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;  </span><br><span class=\"line\">            Thread.sleep(<span class=\"number\">1000</span>);  </span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;  </span><br><span class=\"line\">            e.printStackTrace();  </span><br><span class=\"line\">        &#125;  </span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"test结束..\"</span>);  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">运行结果：</span><br><span class=\"line\">test开始..</span><br><span class=\"line\">test开始..</span><br><span class=\"line\">test开始..</span><br><span class=\"line\">test结束..</span><br><span class=\"line\">test结束..</span><br><span class=\"line\">test结束..</span><br></pre></td></tr></table></figure>\n<p>一切还是这么平静，没有看到synchronized 达到想要的结果。为什么？刚才讲到上面的两种方法是为了避免在多个线程操作<strong>同一个对象</strong>的时候同时访问一个代码块或者某个方法，但是在<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyThread</span> <span class=\"keyword\">extends</span> <span class=\"title\">Thread</span> </span>&#123;  </span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;  </span><br><span class=\"line\">        Sync sync = <span class=\"keyword\">new</span> Sync();  </span><br><span class=\"line\">        sync.test();  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>中，每个线程都单独操作一个 Sync 对象，这样线程之间根本不会发生同步。怎么做呢？<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyThread2</span> <span class=\"keyword\">extends</span> <span class=\"title\">Thread</span> </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> Sync sync;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">MyThread2</span><span class=\"params\">(Sync sync)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>.sync = sync;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        sync.test();  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Sync sync = <span class=\"keyword\">new</span> Sync();</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; i++) &#123;  </span><br><span class=\"line\">    Thread thread = <span class=\"keyword\">new</span> MyThread2(sync);</span><br><span class=\"line\">    thread.start();  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>输出结果如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test开始..</span><br><span class=\"line\">test结束..</span><br><span class=\"line\">test开始..</span><br><span class=\"line\">test结束..</span><br><span class=\"line\">test开始..</span><br><span class=\"line\">test结束..</span><br></pre></td></tr></table></figure></p>\n<p>这样就达到预期了，多个线程在操作同一个对象的时候只有一个线程能够访问 test 方法。</p>\n<p>但是还有其他方法吗？也就是如何避免多个线程执行多个对象的同一个代码块呢。看看下面的代码：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Sync</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test2</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">synchronized</span> (Sync.class) &#123; <span class=\"comment\">// 作用于 Sync 类的所有实例</span></span><br><span class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"test2开始..\"</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t\tThread.sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">\t\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"test2结束..\"</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyThread3</span> <span class=\"keyword\">extends</span> <span class=\"title\">Thread</span> </span>&#123;  </span><br><span class=\"line\">\t  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;  </span><br><span class=\"line\">        Sync sync = <span class=\"keyword\">new</span> Sync();  </span><br><span class=\"line\">        sync.test2();  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; i++) &#123;  </span><br><span class=\"line\">    Thread thread = <span class=\"keyword\">new</span> MyThread3();</span><br><span class=\"line\">    thread.start();  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>输出结果如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test2开始..</span><br><span class=\"line\">test2结束..</span><br><span class=\"line\">test2开始..</span><br><span class=\"line\">test2结束..</span><br><span class=\"line\">test2开始..</span><br><span class=\"line\">test2结束..</span><br></pre></td></tr></table></figure></p>\n<p>这样就满足期望了，关键是<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">synchronized</span> (Sync.class) &#123; <span class=\"comment\">// 作用于 Sync 类的所有实例</span></span><br><span class=\"line\"><span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>如果synchronized作用于某个静态方法上会有什么效果呢？<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">test3</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\tSystem.out.println(<span class=\"string\">\"test3开始..\"</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\tThread.sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">\t\te.printStackTrace();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tSystem.out.println(<span class=\"string\">\"test3结束..\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyThread4</span> <span class=\"keyword\">extends</span> <span class=\"title\">Thread</span> </span>&#123;  </span><br><span class=\"line\">\t  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;  </span><br><span class=\"line\">        Sync.test3();  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; i++) &#123;  </span><br><span class=\"line\">    Thread thread = <span class=\"keyword\">new</span> MyThread4();</span><br><span class=\"line\">    thread.start();  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>输出结果如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test3开始..</span><br><span class=\"line\">test3结束..</span><br><span class=\"line\">test3开始..</span><br><span class=\"line\">test3结束..</span><br><span class=\"line\">test3开始..</span><br><span class=\"line\">test3结束..</span><br></pre></td></tr></table></figure></p>\n<p>这同样能够满足期望，从上面的这些例子也很好说明了5种的synchronized区别和相同点。</p>\n<h3 id=\"对-synchronized-的总结\"><a href=\"#对-synchronized-的总结\" class=\"headerlink\" title=\"对 synchronized 的总结\"></a>对 synchronized 的总结</h3><ul>\n<li>方法同步，锁当前对象（this）</li>\n<li>静态同步方法，锁当前类的Class对象</li>\n<li>对于同步代码块，锁住的是synchronized括号中的对象，任意对象，当前类对象或者是其他对象。</li>\n</ul>\n<p>参考如下：<br><a href=\"http://zhangjunhd.blog.51cto.com/113473/70300\">Java:使用synchronized和Lock对象获取对象锁</a><br><a href=\"http://991690137.iteye.com/blog/1948882\">线程同步总结–synchronized方法和synchronized代码块</a></p>\n"},{"title":"ELK：安装","title_url":"ELK-introduce-setup","date":"2016-06-09T16:00:00.000Z","description":"ELK 初步认识和安装","_content":"\n## ELK 简单介绍\n\nELK 是 Elasticsearch,Logstash,Kibana的合称，依赖Java才能运行。\n\n- ElasticSearch 是开源分布式搜索引擎，能够实时处理，分析日志\n\n- Logstash 统一对应用程序日志进行收集管理\n\n- Kibana 是一个为 Logstash 和 ElasticSearch 提供的日志分析的 Web 接口。可使用它对日志进行高效的搜索、可视化、分析等各种操作\n\n他们之间的依赖关系如下：\n\nKibana <- ElasticSearch <- Logstash\n\n## 安装 Java\n\n- 到`http://www.oracle.com/technetwork/java/javase/downloads/index.html`下载`jdk-8u91-linux-x64.gz`\n\n- 上传到`Ubuntu`上的`/usr/local/soft`目录下，执行`tar -xvf jdk-8u91-linux-x64.gz`解压\n\n- 将下面的Java配置追加到`/etc/profile`文件中，然后执行`source /etc/profile`让配置立即生效\n```\n# set Java environment\nJAVA_HOME=/usr/local/soft/jdk1.8.0_91\nPATH=$JAVA_HOME/bin:$PATH\nCLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar\nexport JAVA_HOME\nexport PATH\nexport CLASSPATH\n```\n- 执行`java -version`和`javac -version`都能返回当前安装的Java的版本号，说明安装成功\n\n\n- 如果当前用户对目录没有权限，执行`sudo chown -R dev:dev /usr/local/soft`，其中`dev:dev`表示dev用户在dev用户组。\n\n\n\n## 安装 Elasticsearch\n\n- 到`https://www.elastic.co/downloads/elasticsearch`下载 elasticsearch-2.3.3.tar.gz\n\n- 上传到`Ubuntu`上的`/usr/local/soft`目录下，执行`tar -xvf elasticsearch-2.3.3.tar.gz`解压\n\n- 执行`sh elasticsearch-2.3.3/bin/elasticsearch`\n\n- 打开浏览器输入`http://localhost:9200/`，返回如下内容说明安装成功:\n```\n{\n  \"name\" : \"Earth Lord\",\n  \"cluster_name\" : \"elasticsearch\",\n  \"version\" : {\n    \"number\" : \"2.3.3\",\n    \"build_hash\" : \"218bdf10790eef486ff2c41a3df5cfa32dadcfde\",\n    \"build_timestamp\" : \"2016-05-17T15:40:04Z\",\n    \"build_snapshot\" : false,\n    \"lucene_version\" : \"5.5.0\"\n  },\n  \"tagline\" : \"You Know, for Search\"\n}\n```\n## 安装 Logstash\n\n- 在`https://www.elastic.co/downloads/logstash`下载`logstash-2.3.2.tar.gz`\n\n- 上传到`Ubuntu`上的`/usr/local/soft`目录下，执行`tar -xvf logstash-2.3.2.tar.gz`解压\n\n- 执行`sh logstash-2.3.2/bin/logstash -e 'input { stdin { } } output { stdout {} }'`，提示\n```\nSettings: Default pipeline workers: 1\nPipeline main started\n```\n说明安装成功，输入任意内容将会打印刚才的输入。\n\n## 安装 Kibana\n\n- 在`https://www.elastic.co/downloads/kibana`下载`kibana-4.5.1-linux-x64.tar.gz`\n\n- 上传到`Ubuntu`上的`/usr/local/soft`目录下，执行`tar -xvf kibana-4.5.1-linux-x64.tar.gz`解压\n\n- 编辑`vi kibana-4.5.1-linux-x64/config/kibana.yml`，确保kibana和elasticsearch 关联起来\n```\nelasticsearch.url: \"http://localhost:9200\"\n```\n\n- 编辑`vi elasticsearch-2.3.3/config/elasticsearch.yml`，追加下面一行，并重启elasticsearch服务\n```\nhttp.cors.enabled: true\n```\n\n- 执行`sh kibana-4.5.1-linux-x64/bin/kibana`启动kibana，在浏览器中输入`http://localhost:5601`，即可访问kibana\n\n参考：\n[CentOS下使用ELK套件搭建日志分析和监控平台](http://blog.csdn.net/i_chips/article/details/43309415)\n[http://www.cnblogs.com/danbo/p/5220516.html](ELK日志分析系统)\n[Logstash实践: 分布式系统的日志监控](http://www.cnblogs.com/yiwenshengmei/p/use_logstash_collect_log.html)","source":"_posts/ELK：安装.md","raw":"---\ntitle: ELK：安装\ntitle_url: ELK-introduce-setup\ndate: 2016-06-10\ntags: ELK\ncategories: 技术\ndescription: ELK 初步认识和安装\n---\n\n## ELK 简单介绍\n\nELK 是 Elasticsearch,Logstash,Kibana的合称，依赖Java才能运行。\n\n- ElasticSearch 是开源分布式搜索引擎，能够实时处理，分析日志\n\n- Logstash 统一对应用程序日志进行收集管理\n\n- Kibana 是一个为 Logstash 和 ElasticSearch 提供的日志分析的 Web 接口。可使用它对日志进行高效的搜索、可视化、分析等各种操作\n\n他们之间的依赖关系如下：\n\nKibana <- ElasticSearch <- Logstash\n\n## 安装 Java\n\n- 到`http://www.oracle.com/technetwork/java/javase/downloads/index.html`下载`jdk-8u91-linux-x64.gz`\n\n- 上传到`Ubuntu`上的`/usr/local/soft`目录下，执行`tar -xvf jdk-8u91-linux-x64.gz`解压\n\n- 将下面的Java配置追加到`/etc/profile`文件中，然后执行`source /etc/profile`让配置立即生效\n```\n# set Java environment\nJAVA_HOME=/usr/local/soft/jdk1.8.0_91\nPATH=$JAVA_HOME/bin:$PATH\nCLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar\nexport JAVA_HOME\nexport PATH\nexport CLASSPATH\n```\n- 执行`java -version`和`javac -version`都能返回当前安装的Java的版本号，说明安装成功\n\n\n- 如果当前用户对目录没有权限，执行`sudo chown -R dev:dev /usr/local/soft`，其中`dev:dev`表示dev用户在dev用户组。\n\n\n\n## 安装 Elasticsearch\n\n- 到`https://www.elastic.co/downloads/elasticsearch`下载 elasticsearch-2.3.3.tar.gz\n\n- 上传到`Ubuntu`上的`/usr/local/soft`目录下，执行`tar -xvf elasticsearch-2.3.3.tar.gz`解压\n\n- 执行`sh elasticsearch-2.3.3/bin/elasticsearch`\n\n- 打开浏览器输入`http://localhost:9200/`，返回如下内容说明安装成功:\n```\n{\n  \"name\" : \"Earth Lord\",\n  \"cluster_name\" : \"elasticsearch\",\n  \"version\" : {\n    \"number\" : \"2.3.3\",\n    \"build_hash\" : \"218bdf10790eef486ff2c41a3df5cfa32dadcfde\",\n    \"build_timestamp\" : \"2016-05-17T15:40:04Z\",\n    \"build_snapshot\" : false,\n    \"lucene_version\" : \"5.5.0\"\n  },\n  \"tagline\" : \"You Know, for Search\"\n}\n```\n## 安装 Logstash\n\n- 在`https://www.elastic.co/downloads/logstash`下载`logstash-2.3.2.tar.gz`\n\n- 上传到`Ubuntu`上的`/usr/local/soft`目录下，执行`tar -xvf logstash-2.3.2.tar.gz`解压\n\n- 执行`sh logstash-2.3.2/bin/logstash -e 'input { stdin { } } output { stdout {} }'`，提示\n```\nSettings: Default pipeline workers: 1\nPipeline main started\n```\n说明安装成功，输入任意内容将会打印刚才的输入。\n\n## 安装 Kibana\n\n- 在`https://www.elastic.co/downloads/kibana`下载`kibana-4.5.1-linux-x64.tar.gz`\n\n- 上传到`Ubuntu`上的`/usr/local/soft`目录下，执行`tar -xvf kibana-4.5.1-linux-x64.tar.gz`解压\n\n- 编辑`vi kibana-4.5.1-linux-x64/config/kibana.yml`，确保kibana和elasticsearch 关联起来\n```\nelasticsearch.url: \"http://localhost:9200\"\n```\n\n- 编辑`vi elasticsearch-2.3.3/config/elasticsearch.yml`，追加下面一行，并重启elasticsearch服务\n```\nhttp.cors.enabled: true\n```\n\n- 执行`sh kibana-4.5.1-linux-x64/bin/kibana`启动kibana，在浏览器中输入`http://localhost:5601`，即可访问kibana\n\n参考：\n[CentOS下使用ELK套件搭建日志分析和监控平台](http://blog.csdn.net/i_chips/article/details/43309415)\n[http://www.cnblogs.com/danbo/p/5220516.html](ELK日志分析系统)\n[Logstash实践: 分布式系统的日志监控](http://www.cnblogs.com/yiwenshengmei/p/use_logstash_collect_log.html)","slug":"ELK：安装","published":1,"updated":"2016-10-10T01:58:06.768Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj5jgsbdb00032cez7wj3i85z","content":"<h2 id=\"ELK-简单介绍\"><a href=\"#ELK-简单介绍\" class=\"headerlink\" title=\"ELK 简单介绍\"></a>ELK 简单介绍</h2><p>ELK 是 Elasticsearch,Logstash,Kibana的合称，依赖Java才能运行。</p>\n<ul>\n<li><p>ElasticSearch 是开源分布式搜索引擎，能够实时处理，分析日志</p>\n</li>\n<li><p>Logstash 统一对应用程序日志进行收集管理</p>\n</li>\n<li><p>Kibana 是一个为 Logstash 和 ElasticSearch 提供的日志分析的 Web 接口。可使用它对日志进行高效的搜索、可视化、分析等各种操作</p>\n</li>\n</ul>\n<p>他们之间的依赖关系如下：</p>\n<p>Kibana &lt;- ElasticSearch &lt;- Logstash</p>\n<h2 id=\"安装-Java\"><a href=\"#安装-Java\" class=\"headerlink\" title=\"安装 Java\"></a>安装 Java</h2><ul>\n<li><p>到<code>http://www.oracle.com/technetwork/java/javase/downloads/index.html</code>下载<code>jdk-8u91-linux-x64.gz</code></p>\n</li>\n<li><p>上传到<code>Ubuntu</code>上的<code>/usr/local/soft</code>目录下，执行<code>tar -xvf jdk-8u91-linux-x64.gz</code>解压</p>\n</li>\n<li><p>将下面的Java配置追加到<code>/etc/profile</code>文件中，然后执行<code>source /etc/profile</code>让配置立即生效</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># set Java environment</span><br><span class=\"line\">JAVA_HOME=/usr/local/soft/jdk1.8.0_91</span><br><span class=\"line\">PATH=$JAVA_HOME/bin:$PATH</span><br><span class=\"line\">CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class=\"line\">export JAVA_HOME</span><br><span class=\"line\">export PATH</span><br><span class=\"line\">export CLASSPATH</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>执行<code>java -version</code>和<code>javac -version</code>都能返回当前安装的Java的版本号，说明安装成功</p>\n</li>\n</ul>\n<ul>\n<li>如果当前用户对目录没有权限，执行<code>sudo chown -R dev:dev /usr/local/soft</code>，其中<code>dev:dev</code>表示dev用户在dev用户组。</li>\n</ul>\n<h2 id=\"安装-Elasticsearch\"><a href=\"#安装-Elasticsearch\" class=\"headerlink\" title=\"安装 Elasticsearch\"></a>安装 Elasticsearch</h2><ul>\n<li><p>到<code>https://www.elastic.co/downloads/elasticsearch</code>下载 elasticsearch-2.3.3.tar.gz</p>\n</li>\n<li><p>上传到<code>Ubuntu</code>上的<code>/usr/local/soft</code>目录下，执行<code>tar -xvf elasticsearch-2.3.3.tar.gz</code>解压</p>\n</li>\n<li><p>执行<code>sh elasticsearch-2.3.3/bin/elasticsearch</code></p>\n</li>\n<li><p>打开浏览器输入<code>http://localhost:9200/</code>，返回如下内容说明安装成功:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;name&quot; : &quot;Earth Lord&quot;,</span><br><span class=\"line\">  &quot;cluster_name&quot; : &quot;elasticsearch&quot;,</span><br><span class=\"line\">  &quot;version&quot; : &#123;</span><br><span class=\"line\">    &quot;number&quot; : &quot;2.3.3&quot;,</span><br><span class=\"line\">    &quot;build_hash&quot; : &quot;218bdf10790eef486ff2c41a3df5cfa32dadcfde&quot;,</span><br><span class=\"line\">    &quot;build_timestamp&quot; : &quot;2016-05-17T15:40:04Z&quot;,</span><br><span class=\"line\">    &quot;build_snapshot&quot; : false,</span><br><span class=\"line\">    &quot;lucene_version&quot; : &quot;5.5.0&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;tagline&quot; : &quot;You Know, for Search&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"安装-Logstash\"><a href=\"#安装-Logstash\" class=\"headerlink\" title=\"安装 Logstash\"></a>安装 Logstash</h2><ul>\n<li><p>在<code>https://www.elastic.co/downloads/logstash</code>下载<code>logstash-2.3.2.tar.gz</code></p>\n</li>\n<li><p>上传到<code>Ubuntu</code>上的<code>/usr/local/soft</code>目录下，执行<code>tar -xvf logstash-2.3.2.tar.gz</code>解压</p>\n</li>\n<li><p>执行<code>sh logstash-2.3.2/bin/logstash -e &#39;input { stdin { } } output { stdout {} }&#39;</code>，提示</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Settings: Default pipeline workers: 1</span><br><span class=\"line\">Pipeline main started</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>说明安装成功，输入任意内容将会打印刚才的输入。</p>\n<h2 id=\"安装-Kibana\"><a href=\"#安装-Kibana\" class=\"headerlink\" title=\"安装 Kibana\"></a>安装 Kibana</h2><ul>\n<li><p>在<code>https://www.elastic.co/downloads/kibana</code>下载<code>kibana-4.5.1-linux-x64.tar.gz</code></p>\n</li>\n<li><p>上传到<code>Ubuntu</code>上的<code>/usr/local/soft</code>目录下，执行<code>tar -xvf kibana-4.5.1-linux-x64.tar.gz</code>解压</p>\n</li>\n<li><p>编辑<code>vi kibana-4.5.1-linux-x64/config/kibana.yml</code>，确保kibana和elasticsearch 关联起来</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">elasticsearch.url: &quot;http://localhost:9200&quot;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>编辑<code>vi elasticsearch-2.3.3/config/elasticsearch.yml</code>，追加下面一行，并重启elasticsearch服务</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http.cors.enabled: true</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>执行<code>sh kibana-4.5.1-linux-x64/bin/kibana</code>启动kibana，在浏览器中输入<code>http://localhost:5601</code>，即可访问kibana</p>\n</li>\n</ul>\n<p>参考：<br><a href=\"http://blog.csdn.net/i_chips/article/details/43309415\" target=\"_blank\" rel=\"external\">CentOS下使用ELK套件搭建日志分析和监控平台</a><br><a href=\"ELK日志分析系统\">http://www.cnblogs.com/danbo/p/5220516.html</a><br><a href=\"http://www.cnblogs.com/yiwenshengmei/p/use_logstash_collect_log.html\" target=\"_blank\" rel=\"external\">Logstash实践: 分布式系统的日志监控</a></p>\n","excerpt":"","more":"<h2 id=\"ELK-简单介绍\"><a href=\"#ELK-简单介绍\" class=\"headerlink\" title=\"ELK 简单介绍\"></a>ELK 简单介绍</h2><p>ELK 是 Elasticsearch,Logstash,Kibana的合称，依赖Java才能运行。</p>\n<ul>\n<li><p>ElasticSearch 是开源分布式搜索引擎，能够实时处理，分析日志</p>\n</li>\n<li><p>Logstash 统一对应用程序日志进行收集管理</p>\n</li>\n<li><p>Kibana 是一个为 Logstash 和 ElasticSearch 提供的日志分析的 Web 接口。可使用它对日志进行高效的搜索、可视化、分析等各种操作</p>\n</li>\n</ul>\n<p>他们之间的依赖关系如下：</p>\n<p>Kibana &lt;- ElasticSearch &lt;- Logstash</p>\n<h2 id=\"安装-Java\"><a href=\"#安装-Java\" class=\"headerlink\" title=\"安装 Java\"></a>安装 Java</h2><ul>\n<li><p>到<code>http://www.oracle.com/technetwork/java/javase/downloads/index.html</code>下载<code>jdk-8u91-linux-x64.gz</code></p>\n</li>\n<li><p>上传到<code>Ubuntu</code>上的<code>/usr/local/soft</code>目录下，执行<code>tar -xvf jdk-8u91-linux-x64.gz</code>解压</p>\n</li>\n<li><p>将下面的Java配置追加到<code>/etc/profile</code>文件中，然后执行<code>source /etc/profile</code>让配置立即生效</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># set Java environment</span><br><span class=\"line\">JAVA_HOME=/usr/local/soft/jdk1.8.0_91</span><br><span class=\"line\">PATH=$JAVA_HOME/bin:$PATH</span><br><span class=\"line\">CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class=\"line\">export JAVA_HOME</span><br><span class=\"line\">export PATH</span><br><span class=\"line\">export CLASSPATH</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>执行<code>java -version</code>和<code>javac -version</code>都能返回当前安装的Java的版本号，说明安装成功</p>\n</li>\n</ul>\n<ul>\n<li>如果当前用户对目录没有权限，执行<code>sudo chown -R dev:dev /usr/local/soft</code>，其中<code>dev:dev</code>表示dev用户在dev用户组。</li>\n</ul>\n<h2 id=\"安装-Elasticsearch\"><a href=\"#安装-Elasticsearch\" class=\"headerlink\" title=\"安装 Elasticsearch\"></a>安装 Elasticsearch</h2><ul>\n<li><p>到<code>https://www.elastic.co/downloads/elasticsearch</code>下载 elasticsearch-2.3.3.tar.gz</p>\n</li>\n<li><p>上传到<code>Ubuntu</code>上的<code>/usr/local/soft</code>目录下，执行<code>tar -xvf elasticsearch-2.3.3.tar.gz</code>解压</p>\n</li>\n<li><p>执行<code>sh elasticsearch-2.3.3/bin/elasticsearch</code></p>\n</li>\n<li><p>打开浏览器输入<code>http://localhost:9200/</code>，返回如下内容说明安装成功:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;name&quot; : &quot;Earth Lord&quot;,</span><br><span class=\"line\">  &quot;cluster_name&quot; : &quot;elasticsearch&quot;,</span><br><span class=\"line\">  &quot;version&quot; : &#123;</span><br><span class=\"line\">    &quot;number&quot; : &quot;2.3.3&quot;,</span><br><span class=\"line\">    &quot;build_hash&quot; : &quot;218bdf10790eef486ff2c41a3df5cfa32dadcfde&quot;,</span><br><span class=\"line\">    &quot;build_timestamp&quot; : &quot;2016-05-17T15:40:04Z&quot;,</span><br><span class=\"line\">    &quot;build_snapshot&quot; : false,</span><br><span class=\"line\">    &quot;lucene_version&quot; : &quot;5.5.0&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;tagline&quot; : &quot;You Know, for Search&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"安装-Logstash\"><a href=\"#安装-Logstash\" class=\"headerlink\" title=\"安装 Logstash\"></a>安装 Logstash</h2><ul>\n<li><p>在<code>https://www.elastic.co/downloads/logstash</code>下载<code>logstash-2.3.2.tar.gz</code></p>\n</li>\n<li><p>上传到<code>Ubuntu</code>上的<code>/usr/local/soft</code>目录下，执行<code>tar -xvf logstash-2.3.2.tar.gz</code>解压</p>\n</li>\n<li><p>执行<code>sh logstash-2.3.2/bin/logstash -e &#39;input { stdin { } } output { stdout {} }&#39;</code>，提示</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Settings: Default pipeline workers: 1</span><br><span class=\"line\">Pipeline main started</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>说明安装成功，输入任意内容将会打印刚才的输入。</p>\n<h2 id=\"安装-Kibana\"><a href=\"#安装-Kibana\" class=\"headerlink\" title=\"安装 Kibana\"></a>安装 Kibana</h2><ul>\n<li><p>在<code>https://www.elastic.co/downloads/kibana</code>下载<code>kibana-4.5.1-linux-x64.tar.gz</code></p>\n</li>\n<li><p>上传到<code>Ubuntu</code>上的<code>/usr/local/soft</code>目录下，执行<code>tar -xvf kibana-4.5.1-linux-x64.tar.gz</code>解压</p>\n</li>\n<li><p>编辑<code>vi kibana-4.5.1-linux-x64/config/kibana.yml</code>，确保kibana和elasticsearch 关联起来</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">elasticsearch.url: &quot;http://localhost:9200&quot;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>编辑<code>vi elasticsearch-2.3.3/config/elasticsearch.yml</code>，追加下面一行，并重启elasticsearch服务</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http.cors.enabled: true</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>执行<code>sh kibana-4.5.1-linux-x64/bin/kibana</code>启动kibana，在浏览器中输入<code>http://localhost:5601</code>，即可访问kibana</p>\n</li>\n</ul>\n<p>参考：<br><a href=\"http://blog.csdn.net/i_chips/article/details/43309415\">CentOS下使用ELK套件搭建日志分析和监控平台</a><br><a href=\"ELK日志分析系统\">http://www.cnblogs.com/danbo/p/5220516.html</a><br><a href=\"http://www.cnblogs.com/yiwenshengmei/p/use_logstash_collect_log.html\">Logstash实践: 分布式系统的日志监控</a></p>\n"},{"title":"PHP 基本语法","title_url":"PHP-basic","date":"2017-07-02T16:00:00.000Z","description":"PHP 基本语法","_content":"\n## => 含义\n\n=> 是用来数组赋值时用的，例子：\n```php\n<?php\n$arr = array(\"somearray\" => array(6 => 5, 13 => 9, \"a\" => 42));\necho $arr[\"somearray\"][6];    // 5\necho $arr[\"somearray\"][13];   // 9\necho $arr[\"somearray\"][\"a\"];  // 42\n?> \n\n$_POST = array(\"Peter\"=>\"35\",\"Ben\"=>\"37\",\"Joe\"=>\"43\");\nforeach($_POST AS $key=>$value){\n  echo \"data is \" . $key . $value;\n}\n// foreach是用来遍历数组的.这个是用来遍历$_POST数组.并把数组的键值放到$key中,值放到$value中\n```\n\n## -> 箭头操作符\n\n箭头操作符 -> 是对象里面用的,表示调用，例子：\n\n```php\n<?php\nclass foo {\n    function do_foo() {\n        echo \"Doing foo.\";\n    }\n}\n$bar = new foo();\n$bar->do_foo();\n?>\n```\n\n## .= 的意思\n\n表示字符串累加,类似于 +=，-=\n\n## 类型转换\n\n```php\necho (int)'abc1';  //输出0 \necho (int)'1abc'; //输出1 \necho (int)'2abc'; //输出2 \necho (int)'22abc'; //输出22 \n```\n\n如果将一个字符串强制转换成一个数字.PHP会去搜索这个字符串的开头.如果开头是数字就转换.如果不是就直接返回0.\n\n## . 点号\n\n用于连接字符串,先连接字符串再运算\n\n```php\necho '5+1=' . 1+5; //输出10 \necho '5+1=' . 5+1; //输出6 \necho '1+5=' . 1+5; //输出6 \necho '1+5=' . 5+1; //输出2 \n```\n具体是 `'5+1=' . 1` 连接字符串后变成 `5+11`, `5+11` 转成数字后变成 5, 最后 `5+5` 等于10\n\n## , 逗号\n\n用逗号是 `multiple parameters`. 也就是说是多参数.换句话说.\n逗号分隔开的就相当于是N个参数.也就是说把echo当个函数用.这样的话 echo 会对每个参数先进行计算.最后再进行连接后输出\n\n```php\necho '1+5=' . 1+5;  //输出 6\necho '1+5=' , 5+1;  //输出 1+5=6 \n```\n\n## @ at符号\n\n当php解释器遇到@开头的语句时候，无论本行的语句是否执行成功，都会继续执行后续的语句，而且不会报错。\n\n## :: 双冒号,两个冒号\n\n用于访问静态、const和类中重写的属性与方法, 类不需要实例化, 用箭头操作符`->`必须要将类进行实例化（或者在类的内部调用也可以） 。\n\n```php\n<?php\nclass MyClass {\n    const CONST_VALUE = 'A constant value';\n}\n\n$classname = 'MyClass';\necho $classname::CONST_VALUE; // 自 PHP 5.3.0 起\n\necho MyClass::CONST_VALUE;\n?>\n```\n\n## 构造函数和析构函数\n\n```php\n<?php\nclass MyDestructableClass {\n   function __construct() { // 构造函数\n       print \"In constructor\\n\";\n       $this->name = \"MyDestructableClass\";\n   }\n\n   function __destruct() { // 析构函数\n       print \"Destroying \" . $this->name . \"\\n\";\n   }\n}\n\n$obj = new MyDestructableClass();\n?>\n```\n\n## 命名空间 和 use\n\n```php\nnamespace Album\\Model;\nuse Zend\\InputFilter\\Factory as InputFactory;\nuse Zend\\InputFilter\\InputFilter;\nuse Zend\\InputFilter\\InputFilterAwareInterface;\nuse Zend\\InputFilter\\InputFilterInterface;\nclass Album implements InputFilterAwareInterface {\n\n}\n```\n\n## include 和 include_once\n\n使用方法：include \"文件路径\";\n\n函数作用：引入另一个php脚本文件，并执行里面的代码\n\n推荐使用：include_once \"文件路径\";\n\n```php\n// 自动加载控制器和模型类 \npublic static function loadClass($class) {\n    $frameworks = __DIR__ . '/' . $class . '.php';\n    $controllers = APP_PATH . 'application/controllers/' . $class . '.php';\n    $models = APP_PATH . 'application/models/' . $class . '.php';\n\n    if (file_exists($frameworks)) {\n        // 加载框架核心类\n        include $frameworks;\n    } elseif (file_exists($controllers)) {\n        // 加载应用控制器类\n        include $controllers;\n    } elseif (file_exists($models)) {\n        //加载应用模型类\n        include $models;\n    } else {\n        // 错误代码\n    }\n}\n```\n\n## require 和 require_once\n\n>最大的区别就是：include在引入不存文件时产生一个警告且脚本还会继续执行，require则会导致一个致命性错误且脚本停止执行。\n\n```php\n<?php  \ninclude_once '1.php';  \nrequire_once '1.php';  \ninclude '1.php';  \nrequire '1.php';  \n?>  \n```\n\n## 以下划线(_)开头的变量和方法\n\n加一个为私有的, 加两个一般都是系统默认的，系统预定义的.\n\n```php\n__LINE__ 表示文件中的当前行号。\n\n__FILE__ 表示文件的完整路径和文件名。\n\n__DIR__ 表示文件所在的目录。如果用在被包括文件中，则返回被包括的文件所在的目录。它等价于 dirname(__FILE__)。除非是根目录，否则目录中名不包括末尾的斜杠\n```\n\n另外 php规定以两个下划线（__）开头的方法都保留为**魔术方法**，\n\nPHP中的魔术方法有\n\n```php\n__construct,\n__destruct ,\n__call,\n__callStatic,\n__get, \n__set,\n__isset, \n__unset , \n__sleep,\n__wakeup, \n__toString,\n__set_state, \n__clone, \n__autoload\n```\n\n## array_merge和数组相加（+）\n\n- 键名是字符串：\n\n```php\n$arr1=array('a'=>'PHP');\n$arr2=array('a'=>'JAVA');\n//如果键名为字符，且键名相同，array_merge()后面数组元素值会覆盖前面数组元素值\nprint_r(array_merge($arr1,$arr2));//Array ( [a] => JAVA )\n//如果键名为字符，且键名相同，数组相加会将最先出现的值作为结果\nprint_r($arr1+$arr2);//Array ( [a] => PHP )\n```\n\n- 键名是数字：\n\n```php\n$arr1=array(\"C\",\"PHP\");\n$arr2=array(\"JAVA\",\"PHP\");\n//如果键名为数字，array_merge()不会进行覆盖\nprint_r(array_merge($arr1,$arr2));//Array ( [0] => C [1] => PHP [2] => JAVA [3] => PHP )\n//如果键名为数字，数组相加会将最先出现的值作为结果，后面键名相同的会被抛弃\nprint_r($arr1+$arr2);//Array ( [0] => C [1] => PHP )\n```\n\n## clone 关键字与 __clone() 方法\n\n- `clone` 关键字用于克隆一个完全一样的对象,而且克隆以后，两个对象互不干扰。\n\n- `__clone()` 如果想在克隆后改变克隆对象的内容，需要在类中添加一个特殊的 `__clone()` 方法来重写原本的属性和方法。`__clone()` 方法只会在对象被克隆的时候自动调用。\n\n```php\n<?php\nclass Person {\n    private $name;\n    private $age;\n\n    function __construct($name, $age) {\n        $this->name = $name;\n        $this->age = $age;\n    }\n\n    function say() {\n        echo \"我的名字叫：\".$this->name;\n\t    echo \"我的年龄是：\".$this->age.\"<br />\";\n    }\n    function __clone() {\n        $this->name = \"我是假的\".$this->name;\n        $this->age = 30;\n    }\n}\n\n$p1 = new Person(\"张三\", 20);\n$p1->say();\n$p2 = clone $p1;\n$p2->say();\n?>\n```\n\n运行例子，输出：\n\n```\n我的名字叫：张三 我的年龄是：20\n我的名字叫：我是假的张三 我的年龄是：30\n```\n\n## 参考\n\n- [php中双冒号的应用](http://blog.csdn.net/abandonship/article/details/6459370)\n- [构造函数和析构函数](http://php.net/manual/zh/language.oop5.decon.php#language.oop5.decon)\n- [PHP中用下划线开头的变量含义](http://blog.csdn.net/zlking02/article/details/6752256)\n- [PHP 1、array_merge和数组相加（+）](http://www.jianshu.com/p/43e9263f82c1)\n- [PHP 对象克隆 clone 关键字与 __clone() 方法](http://www.5idev.com/p-php_object_clone.shtml)\n- [PHP基础教程](http://www.5idev.com/php-phpbase.shtml)","source":"_posts/PHP 基本语法.md","raw":"---\ntitle: PHP 基本语法\ntitle_url: PHP-basic\ndate: 2017-07-03\ntags: PHP\ncategories: PHP\ndescription: PHP 基本语法\n---\n\n## => 含义\n\n=> 是用来数组赋值时用的，例子：\n```php\n<?php\n$arr = array(\"somearray\" => array(6 => 5, 13 => 9, \"a\" => 42));\necho $arr[\"somearray\"][6];    // 5\necho $arr[\"somearray\"][13];   // 9\necho $arr[\"somearray\"][\"a\"];  // 42\n?> \n\n$_POST = array(\"Peter\"=>\"35\",\"Ben\"=>\"37\",\"Joe\"=>\"43\");\nforeach($_POST AS $key=>$value){\n  echo \"data is \" . $key . $value;\n}\n// foreach是用来遍历数组的.这个是用来遍历$_POST数组.并把数组的键值放到$key中,值放到$value中\n```\n\n## -> 箭头操作符\n\n箭头操作符 -> 是对象里面用的,表示调用，例子：\n\n```php\n<?php\nclass foo {\n    function do_foo() {\n        echo \"Doing foo.\";\n    }\n}\n$bar = new foo();\n$bar->do_foo();\n?>\n```\n\n## .= 的意思\n\n表示字符串累加,类似于 +=，-=\n\n## 类型转换\n\n```php\necho (int)'abc1';  //输出0 \necho (int)'1abc'; //输出1 \necho (int)'2abc'; //输出2 \necho (int)'22abc'; //输出22 \n```\n\n如果将一个字符串强制转换成一个数字.PHP会去搜索这个字符串的开头.如果开头是数字就转换.如果不是就直接返回0.\n\n## . 点号\n\n用于连接字符串,先连接字符串再运算\n\n```php\necho '5+1=' . 1+5; //输出10 \necho '5+1=' . 5+1; //输出6 \necho '1+5=' . 1+5; //输出6 \necho '1+5=' . 5+1; //输出2 \n```\n具体是 `'5+1=' . 1` 连接字符串后变成 `5+11`, `5+11` 转成数字后变成 5, 最后 `5+5` 等于10\n\n## , 逗号\n\n用逗号是 `multiple parameters`. 也就是说是多参数.换句话说.\n逗号分隔开的就相当于是N个参数.也就是说把echo当个函数用.这样的话 echo 会对每个参数先进行计算.最后再进行连接后输出\n\n```php\necho '1+5=' . 1+5;  //输出 6\necho '1+5=' , 5+1;  //输出 1+5=6 \n```\n\n## @ at符号\n\n当php解释器遇到@开头的语句时候，无论本行的语句是否执行成功，都会继续执行后续的语句，而且不会报错。\n\n## :: 双冒号,两个冒号\n\n用于访问静态、const和类中重写的属性与方法, 类不需要实例化, 用箭头操作符`->`必须要将类进行实例化（或者在类的内部调用也可以） 。\n\n```php\n<?php\nclass MyClass {\n    const CONST_VALUE = 'A constant value';\n}\n\n$classname = 'MyClass';\necho $classname::CONST_VALUE; // 自 PHP 5.3.0 起\n\necho MyClass::CONST_VALUE;\n?>\n```\n\n## 构造函数和析构函数\n\n```php\n<?php\nclass MyDestructableClass {\n   function __construct() { // 构造函数\n       print \"In constructor\\n\";\n       $this->name = \"MyDestructableClass\";\n   }\n\n   function __destruct() { // 析构函数\n       print \"Destroying \" . $this->name . \"\\n\";\n   }\n}\n\n$obj = new MyDestructableClass();\n?>\n```\n\n## 命名空间 和 use\n\n```php\nnamespace Album\\Model;\nuse Zend\\InputFilter\\Factory as InputFactory;\nuse Zend\\InputFilter\\InputFilter;\nuse Zend\\InputFilter\\InputFilterAwareInterface;\nuse Zend\\InputFilter\\InputFilterInterface;\nclass Album implements InputFilterAwareInterface {\n\n}\n```\n\n## include 和 include_once\n\n使用方法：include \"文件路径\";\n\n函数作用：引入另一个php脚本文件，并执行里面的代码\n\n推荐使用：include_once \"文件路径\";\n\n```php\n// 自动加载控制器和模型类 \npublic static function loadClass($class) {\n    $frameworks = __DIR__ . '/' . $class . '.php';\n    $controllers = APP_PATH . 'application/controllers/' . $class . '.php';\n    $models = APP_PATH . 'application/models/' . $class . '.php';\n\n    if (file_exists($frameworks)) {\n        // 加载框架核心类\n        include $frameworks;\n    } elseif (file_exists($controllers)) {\n        // 加载应用控制器类\n        include $controllers;\n    } elseif (file_exists($models)) {\n        //加载应用模型类\n        include $models;\n    } else {\n        // 错误代码\n    }\n}\n```\n\n## require 和 require_once\n\n>最大的区别就是：include在引入不存文件时产生一个警告且脚本还会继续执行，require则会导致一个致命性错误且脚本停止执行。\n\n```php\n<?php  \ninclude_once '1.php';  \nrequire_once '1.php';  \ninclude '1.php';  \nrequire '1.php';  \n?>  \n```\n\n## 以下划线(_)开头的变量和方法\n\n加一个为私有的, 加两个一般都是系统默认的，系统预定义的.\n\n```php\n__LINE__ 表示文件中的当前行号。\n\n__FILE__ 表示文件的完整路径和文件名。\n\n__DIR__ 表示文件所在的目录。如果用在被包括文件中，则返回被包括的文件所在的目录。它等价于 dirname(__FILE__)。除非是根目录，否则目录中名不包括末尾的斜杠\n```\n\n另外 php规定以两个下划线（__）开头的方法都保留为**魔术方法**，\n\nPHP中的魔术方法有\n\n```php\n__construct,\n__destruct ,\n__call,\n__callStatic,\n__get, \n__set,\n__isset, \n__unset , \n__sleep,\n__wakeup, \n__toString,\n__set_state, \n__clone, \n__autoload\n```\n\n## array_merge和数组相加（+）\n\n- 键名是字符串：\n\n```php\n$arr1=array('a'=>'PHP');\n$arr2=array('a'=>'JAVA');\n//如果键名为字符，且键名相同，array_merge()后面数组元素值会覆盖前面数组元素值\nprint_r(array_merge($arr1,$arr2));//Array ( [a] => JAVA )\n//如果键名为字符，且键名相同，数组相加会将最先出现的值作为结果\nprint_r($arr1+$arr2);//Array ( [a] => PHP )\n```\n\n- 键名是数字：\n\n```php\n$arr1=array(\"C\",\"PHP\");\n$arr2=array(\"JAVA\",\"PHP\");\n//如果键名为数字，array_merge()不会进行覆盖\nprint_r(array_merge($arr1,$arr2));//Array ( [0] => C [1] => PHP [2] => JAVA [3] => PHP )\n//如果键名为数字，数组相加会将最先出现的值作为结果，后面键名相同的会被抛弃\nprint_r($arr1+$arr2);//Array ( [0] => C [1] => PHP )\n```\n\n## clone 关键字与 __clone() 方法\n\n- `clone` 关键字用于克隆一个完全一样的对象,而且克隆以后，两个对象互不干扰。\n\n- `__clone()` 如果想在克隆后改变克隆对象的内容，需要在类中添加一个特殊的 `__clone()` 方法来重写原本的属性和方法。`__clone()` 方法只会在对象被克隆的时候自动调用。\n\n```php\n<?php\nclass Person {\n    private $name;\n    private $age;\n\n    function __construct($name, $age) {\n        $this->name = $name;\n        $this->age = $age;\n    }\n\n    function say() {\n        echo \"我的名字叫：\".$this->name;\n\t    echo \"我的年龄是：\".$this->age.\"<br />\";\n    }\n    function __clone() {\n        $this->name = \"我是假的\".$this->name;\n        $this->age = 30;\n    }\n}\n\n$p1 = new Person(\"张三\", 20);\n$p1->say();\n$p2 = clone $p1;\n$p2->say();\n?>\n```\n\n运行例子，输出：\n\n```\n我的名字叫：张三 我的年龄是：20\n我的名字叫：我是假的张三 我的年龄是：30\n```\n\n## 参考\n\n- [php中双冒号的应用](http://blog.csdn.net/abandonship/article/details/6459370)\n- [构造函数和析构函数](http://php.net/manual/zh/language.oop5.decon.php#language.oop5.decon)\n- [PHP中用下划线开头的变量含义](http://blog.csdn.net/zlking02/article/details/6752256)\n- [PHP 1、array_merge和数组相加（+）](http://www.jianshu.com/p/43e9263f82c1)\n- [PHP 对象克隆 clone 关键字与 __clone() 方法](http://www.5idev.com/p-php_object_clone.shtml)\n- [PHP基础教程](http://www.5idev.com/php-phpbase.shtml)","slug":"PHP 基本语法","published":1,"updated":"2017-07-25T10:54:15.560Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj5jgsbdl00072cezed5jklhg","content":"<h2 id=\"gt-含义\"><a href=\"#gt-含义\" class=\"headerlink\" title=\"=&gt; 含义\"></a>=&gt; 含义</h2><p>=&gt; 是用来数组赋值时用的，例子：<br><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$arr = <span class=\"keyword\">array</span>(<span class=\"string\">\"somearray\"</span> =&gt; <span class=\"keyword\">array</span>(<span class=\"number\">6</span> =&gt; <span class=\"number\">5</span>, <span class=\"number\">13</span> =&gt; <span class=\"number\">9</span>, <span class=\"string\">\"a\"</span> =&gt; <span class=\"number\">42</span>));</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $arr[<span class=\"string\">\"somearray\"</span>][<span class=\"number\">6</span>];    <span class=\"comment\">// 5</span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> $arr[<span class=\"string\">\"somearray\"</span>][<span class=\"number\">13</span>];   <span class=\"comment\">// 9</span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> $arr[<span class=\"string\">\"somearray\"</span>][<span class=\"string\">\"a\"</span>];  <span class=\"comment\">// 42</span></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span> </span><br><span class=\"line\"></span><br><span class=\"line\">$_POST = <span class=\"keyword\">array</span>(<span class=\"string\">\"Peter\"</span>=&gt;<span class=\"string\">\"35\"</span>,<span class=\"string\">\"Ben\"</span>=&gt;<span class=\"string\">\"37\"</span>,<span class=\"string\">\"Joe\"</span>=&gt;<span class=\"string\">\"43\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">foreach</span>($_POST <span class=\"keyword\">AS</span> $key=&gt;$value)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">echo</span> <span class=\"string\">\"data is \"</span> . $key . $value;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// foreach是用来遍历数组的.这个是用来遍历$_POST数组.并把数组的键值放到$key中,值放到$value中</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"gt-箭头操作符\"><a href=\"#gt-箭头操作符\" class=\"headerlink\" title=\"-&gt; 箭头操作符\"></a>-&gt; 箭头操作符</h2><p>箭头操作符 -&gt; 是对象里面用的,表示调用，例子：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">foo</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">do_foo</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"Doing foo.\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">$bar = <span class=\"keyword\">new</span> foo();</span><br><span class=\"line\">$bar-&gt;do_foo();</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"的意思\"><a href=\"#的意思\" class=\"headerlink\" title=\".= 的意思\"></a>.= 的意思</h2><p>表示字符串累加,类似于 +=，-=</p>\n<h2 id=\"类型转换\"><a href=\"#类型转换\" class=\"headerlink\" title=\"类型转换\"></a>类型转换</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">echo</span> (int)<span class=\"string\">'abc1'</span>;  <span class=\"comment\">//输出0 </span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> (int)<span class=\"string\">'1abc'</span>; <span class=\"comment\">//输出1 </span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> (int)<span class=\"string\">'2abc'</span>; <span class=\"comment\">//输出2 </span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> (int)<span class=\"string\">'22abc'</span>; <span class=\"comment\">//输出22</span></span><br></pre></td></tr></table></figure>\n<p>如果将一个字符串强制转换成一个数字.PHP会去搜索这个字符串的开头.如果开头是数字就转换.如果不是就直接返回0.</p>\n<h2 id=\"点号\"><a href=\"#点号\" class=\"headerlink\" title=\". 点号\"></a>. 点号</h2><p>用于连接字符串,先连接字符串再运算</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">'5+1='</span> . <span class=\"number\">1</span>+<span class=\"number\">5</span>; <span class=\"comment\">//输出10 </span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">'5+1='</span> . <span class=\"number\">5</span>+<span class=\"number\">1</span>; <span class=\"comment\">//输出6 </span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">'1+5='</span> . <span class=\"number\">1</span>+<span class=\"number\">5</span>; <span class=\"comment\">//输出6 </span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">'1+5='</span> . <span class=\"number\">5</span>+<span class=\"number\">1</span>; <span class=\"comment\">//输出2</span></span><br></pre></td></tr></table></figure>\n<p>具体是 <code>&#39;5+1=&#39; . 1</code> 连接字符串后变成 <code>5+11</code>, <code>5+11</code> 转成数字后变成 5, 最后 <code>5+5</code> 等于10</p>\n<h2 id=\"逗号\"><a href=\"#逗号\" class=\"headerlink\" title=\", 逗号\"></a>, 逗号</h2><p>用逗号是 <code>multiple parameters</code>. 也就是说是多参数.换句话说.<br>逗号分隔开的就相当于是N个参数.也就是说把echo当个函数用.这样的话 echo 会对每个参数先进行计算.最后再进行连接后输出</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">'1+5='</span> . <span class=\"number\">1</span>+<span class=\"number\">5</span>;  <span class=\"comment\">//输出 6</span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">'1+5='</span> , <span class=\"number\">5</span>+<span class=\"number\">1</span>;  <span class=\"comment\">//输出 1+5=6</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"at符号\"><a href=\"#at符号\" class=\"headerlink\" title=\"@ at符号\"></a>@ at符号</h2><p>当php解释器遇到@开头的语句时候，无论本行的语句是否执行成功，都会继续执行后续的语句，而且不会报错。</p>\n<h2 id=\"双冒号-两个冒号\"><a href=\"#双冒号-两个冒号\" class=\"headerlink\" title=\":: 双冒号,两个冒号\"></a>:: 双冒号,两个冒号</h2><p>用于访问静态、const和类中重写的属性与方法, 类不需要实例化, 用箭头操作符<code>-&gt;</code>必须要将类进行实例化（或者在类的内部调用也可以） 。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyClass</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> CONST_VALUE = <span class=\"string\">'A constant value'</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$classname = <span class=\"string\">'MyClass'</span>;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $classname::CONST_VALUE; <span class=\"comment\">// 自 PHP 5.3.0 起</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">echo</span> MyClass::CONST_VALUE;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"构造函数和析构函数\"><a href=\"#构造函数和析构函数\" class=\"headerlink\" title=\"构造函数和析构函数\"></a>构造函数和析构函数</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyDestructableClass</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span> </span>&#123; <span class=\"comment\">// 构造函数</span></span><br><span class=\"line\">       <span class=\"keyword\">print</span> <span class=\"string\">\"In constructor\\n\"</span>;</span><br><span class=\"line\">       <span class=\"keyword\">$this</span>-&gt;name = <span class=\"string\">\"MyDestructableClass\"</span>;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span><span class=\"params\">()</span> </span>&#123; <span class=\"comment\">// 析构函数</span></span><br><span class=\"line\">       <span class=\"keyword\">print</span> <span class=\"string\">\"Destroying \"</span> . <span class=\"keyword\">$this</span>-&gt;name . <span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$obj = <span class=\"keyword\">new</span> MyDestructableClass();</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"命名空间-和-use\"><a href=\"#命名空间-和-use\" class=\"headerlink\" title=\"命名空间 和 use\"></a>命名空间 和 use</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title\">Album</span>\\<span class=\"title\">Model</span>;</span><br><span class=\"line\"><span class=\"keyword\">use</span> <span class=\"title\">Zend</span>\\<span class=\"title\">InputFilter</span>\\<span class=\"title\">Factory</span> <span class=\"title\">as</span> <span class=\"title\">InputFactory</span>;</span><br><span class=\"line\"><span class=\"keyword\">use</span> <span class=\"title\">Zend</span>\\<span class=\"title\">InputFilter</span>\\<span class=\"title\">InputFilter</span>;</span><br><span class=\"line\"><span class=\"keyword\">use</span> <span class=\"title\">Zend</span>\\<span class=\"title\">InputFilter</span>\\<span class=\"title\">InputFilterAwareInterface</span>;</span><br><span class=\"line\"><span class=\"keyword\">use</span> <span class=\"title\">Zend</span>\\<span class=\"title\">InputFilter</span>\\<span class=\"title\">InputFilterInterface</span>;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Album</span> <span class=\"keyword\">implements</span> <span class=\"title\">InputFilterAwareInterface</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"include-和-include-once\"><a href=\"#include-和-include-once\" class=\"headerlink\" title=\"include 和 include_once\"></a>include 和 include_once</h2><p>使用方法：include “文件路径”;</p>\n<p>函数作用：引入另一个php脚本文件，并执行里面的代码</p>\n<p>推荐使用：include_once “文件路径”;</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 自动加载控制器和模型类 </span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">loadClass</span><span class=\"params\">($class)</span> </span>&#123;</span><br><span class=\"line\">    $frameworks = <span class=\"keyword\">__DIR__</span> . <span class=\"string\">'/'</span> . $class . <span class=\"string\">'.php'</span>;</span><br><span class=\"line\">    $controllers = APP_PATH . <span class=\"string\">'application/controllers/'</span> . $class . <span class=\"string\">'.php'</span>;</span><br><span class=\"line\">    $models = APP_PATH . <span class=\"string\">'application/models/'</span> . $class . <span class=\"string\">'.php'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (file_exists($frameworks)) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 加载框架核心类</span></span><br><span class=\"line\">        <span class=\"keyword\">include</span> $frameworks;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">elseif</span> (file_exists($controllers)) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 加载应用控制器类</span></span><br><span class=\"line\">        <span class=\"keyword\">include</span> $controllers;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">elseif</span> (file_exists($models)) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//加载应用模型类</span></span><br><span class=\"line\">        <span class=\"keyword\">include</span> $models;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 错误代码</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"require-和-require-once\"><a href=\"#require-和-require-once\" class=\"headerlink\" title=\"require 和 require_once\"></a>require 和 require_once</h2><blockquote>\n<p>最大的区别就是：include在引入不存文件时产生一个警告且脚本还会继续执行，require则会导致一个致命性错误且脚本停止执行。</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span>  </span><br><span class=\"line\"><span class=\"keyword\">include_once</span> <span class=\"string\">'1.php'</span>;  </span><br><span class=\"line\"><span class=\"keyword\">require_once</span> <span class=\"string\">'1.php'</span>;  </span><br><span class=\"line\"><span class=\"keyword\">include</span> <span class=\"string\">'1.php'</span>;  </span><br><span class=\"line\"><span class=\"keyword\">require</span> <span class=\"string\">'1.php'</span>;  </span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"以下划线-开头的变量和方法\"><a href=\"#以下划线-开头的变量和方法\" class=\"headerlink\" title=\"以下划线(_)开头的变量和方法\"></a>以下划线(_)开头的变量和方法</h2><p>加一个为私有的, 加两个一般都是系统默认的，系统预定义的.</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">__LINE__</span> 表示文件中的当前行号。</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">__FILE__</span> 表示文件的完整路径和文件名。</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">__DIR__</span> 表示文件所在的目录。如果用在被包括文件中，则返回被包括的文件所在的目录。它等价于 dirname(<span class=\"keyword\">__FILE__</span>)。除非是根目录，否则目录中名不包括末尾的斜杠</span><br></pre></td></tr></table></figure>\n<p>另外 php规定以两个下划线（__）开头的方法都保留为<strong>魔术方法</strong>，</p>\n<p>PHP中的魔术方法有</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">__construct,</span><br><span class=\"line\">__destruct ,</span><br><span class=\"line\">__call,</span><br><span class=\"line\">__callStatic,</span><br><span class=\"line\">__get, </span><br><span class=\"line\">__set,</span><br><span class=\"line\">__isset, </span><br><span class=\"line\">__unset , </span><br><span class=\"line\">__sleep,</span><br><span class=\"line\">__wakeup, </span><br><span class=\"line\">__toString,</span><br><span class=\"line\">__set_state, </span><br><span class=\"line\">__clone, </span><br><span class=\"line\">__autoload</span><br></pre></td></tr></table></figure>\n<h2 id=\"array-merge和数组相加（-）\"><a href=\"#array-merge和数组相加（-）\" class=\"headerlink\" title=\"array_merge和数组相加（+）\"></a>array_merge和数组相加（+）</h2><ul>\n<li>键名是字符串：</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$arr1=<span class=\"keyword\">array</span>(<span class=\"string\">'a'</span>=&gt;<span class=\"string\">'PHP'</span>);</span><br><span class=\"line\">$arr2=<span class=\"keyword\">array</span>(<span class=\"string\">'a'</span>=&gt;<span class=\"string\">'JAVA'</span>);</span><br><span class=\"line\"><span class=\"comment\">//如果键名为字符，且键名相同，array_merge()后面数组元素值会覆盖前面数组元素值</span></span><br><span class=\"line\">print_r(array_merge($arr1,$arr2));<span class=\"comment\">//Array ( [a] =&gt; JAVA )</span></span><br><span class=\"line\"><span class=\"comment\">//如果键名为字符，且键名相同，数组相加会将最先出现的值作为结果</span></span><br><span class=\"line\">print_r($arr1+$arr2);<span class=\"comment\">//Array ( [a] =&gt; PHP )</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>键名是数字：</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$arr1=<span class=\"keyword\">array</span>(<span class=\"string\">\"C\"</span>,<span class=\"string\">\"PHP\"</span>);</span><br><span class=\"line\">$arr2=<span class=\"keyword\">array</span>(<span class=\"string\">\"JAVA\"</span>,<span class=\"string\">\"PHP\"</span>);</span><br><span class=\"line\"><span class=\"comment\">//如果键名为数字，array_merge()不会进行覆盖</span></span><br><span class=\"line\">print_r(array_merge($arr1,$arr2));<span class=\"comment\">//Array ( [0] =&gt; C [1] =&gt; PHP [2] =&gt; JAVA [3] =&gt; PHP )</span></span><br><span class=\"line\"><span class=\"comment\">//如果键名为数字，数组相加会将最先出现的值作为结果，后面键名相同的会被抛弃</span></span><br><span class=\"line\">print_r($arr1+$arr2);<span class=\"comment\">//Array ( [0] =&gt; C [1] =&gt; PHP )</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"clone-关键字与-clone-方法\"><a href=\"#clone-关键字与-clone-方法\" class=\"headerlink\" title=\"clone 关键字与 __clone() 方法\"></a>clone 关键字与 __clone() 方法</h2><ul>\n<li><p><code>clone</code> 关键字用于克隆一个完全一样的对象,而且克隆以后，两个对象互不干扰。</p>\n</li>\n<li><p><code>__clone()</code> 如果想在克隆后改变克隆对象的内容，需要在类中添加一个特殊的 <code>__clone()</code> 方法来重写原本的属性和方法。<code>__clone()</code> 方法只会在对象被克隆的时候自动调用。</p>\n</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> $name;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> $age;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name, $age)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;name = $name;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;age = $age;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">say</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"我的名字叫：\"</span>.<span class=\"keyword\">$this</span>-&gt;name;</span><br><span class=\"line\">\t    <span class=\"keyword\">echo</span> <span class=\"string\">\"我的年龄是：\"</span>.<span class=\"keyword\">$this</span>-&gt;age.<span class=\"string\">\"&lt;br /&gt;\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__clone</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;name = <span class=\"string\">\"我是假的\"</span>.<span class=\"keyword\">$this</span>-&gt;name;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;age = <span class=\"number\">30</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$p1 = <span class=\"keyword\">new</span> Person(<span class=\"string\">\"张三\"</span>, <span class=\"number\">20</span>);</span><br><span class=\"line\">$p1-&gt;say();</span><br><span class=\"line\">$p2 = <span class=\"keyword\">clone</span> $p1;</span><br><span class=\"line\">$p2-&gt;say();</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<p>运行例子，输出：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">我的名字叫：张三 我的年龄是：20</span><br><span class=\"line\">我的名字叫：我是假的张三 我的年龄是：30</span><br></pre></td></tr></table></figure>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ul>\n<li><a href=\"http://blog.csdn.net/abandonship/article/details/6459370\" target=\"_blank\" rel=\"external\">php中双冒号的应用</a></li>\n<li><a href=\"http://php.net/manual/zh/language.oop5.decon.php#language.oop5.decon\" target=\"_blank\" rel=\"external\">构造函数和析构函数</a></li>\n<li><a href=\"http://blog.csdn.net/zlking02/article/details/6752256\" target=\"_blank\" rel=\"external\">PHP中用下划线开头的变量含义</a></li>\n<li><a href=\"http://www.jianshu.com/p/43e9263f82c1\" target=\"_blank\" rel=\"external\">PHP 1、array_merge和数组相加（+）</a></li>\n<li><a href=\"http://www.5idev.com/p-php_object_clone.shtml\" target=\"_blank\" rel=\"external\">PHP 对象克隆 clone 关键字与 __clone() 方法</a></li>\n<li><a href=\"http://www.5idev.com/php-phpbase.shtml\" target=\"_blank\" rel=\"external\">PHP基础教程</a></li>\n</ul>\n","excerpt":"","more":"<h2 id=\"gt-含义\"><a href=\"#gt-含义\" class=\"headerlink\" title=\"=&gt; 含义\"></a>=&gt; 含义</h2><p>=&gt; 是用来数组赋值时用的，例子：<br><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$arr = <span class=\"keyword\">array</span>(<span class=\"string\">\"somearray\"</span> =&gt; <span class=\"keyword\">array</span>(<span class=\"number\">6</span> =&gt; <span class=\"number\">5</span>, <span class=\"number\">13</span> =&gt; <span class=\"number\">9</span>, <span class=\"string\">\"a\"</span> =&gt; <span class=\"number\">42</span>));</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $arr[<span class=\"string\">\"somearray\"</span>][<span class=\"number\">6</span>];    <span class=\"comment\">// 5</span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> $arr[<span class=\"string\">\"somearray\"</span>][<span class=\"number\">13</span>];   <span class=\"comment\">// 9</span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> $arr[<span class=\"string\">\"somearray\"</span>][<span class=\"string\">\"a\"</span>];  <span class=\"comment\">// 42</span></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span> </span><br><span class=\"line\"></span><br><span class=\"line\">$_POST = <span class=\"keyword\">array</span>(<span class=\"string\">\"Peter\"</span>=&gt;<span class=\"string\">\"35\"</span>,<span class=\"string\">\"Ben\"</span>=&gt;<span class=\"string\">\"37\"</span>,<span class=\"string\">\"Joe\"</span>=&gt;<span class=\"string\">\"43\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">foreach</span>($_POST <span class=\"keyword\">AS</span> $key=&gt;$value)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">echo</span> <span class=\"string\">\"data is \"</span> . $key . $value;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// foreach是用来遍历数组的.这个是用来遍历$_POST数组.并把数组的键值放到$key中,值放到$value中</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"gt-箭头操作符\"><a href=\"#gt-箭头操作符\" class=\"headerlink\" title=\"-&gt; 箭头操作符\"></a>-&gt; 箭头操作符</h2><p>箭头操作符 -&gt; 是对象里面用的,表示调用，例子：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">foo</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">do_foo</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"Doing foo.\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">$bar = <span class=\"keyword\">new</span> foo();</span><br><span class=\"line\">$bar-&gt;do_foo();</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"的意思\"><a href=\"#的意思\" class=\"headerlink\" title=\".= 的意思\"></a>.= 的意思</h2><p>表示字符串累加,类似于 +=，-=</p>\n<h2 id=\"类型转换\"><a href=\"#类型转换\" class=\"headerlink\" title=\"类型转换\"></a>类型转换</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">echo</span> (int)<span class=\"string\">'abc1'</span>;  <span class=\"comment\">//输出0 </span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> (int)<span class=\"string\">'1abc'</span>; <span class=\"comment\">//输出1 </span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> (int)<span class=\"string\">'2abc'</span>; <span class=\"comment\">//输出2 </span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> (int)<span class=\"string\">'22abc'</span>; <span class=\"comment\">//输出22</span></span><br></pre></td></tr></table></figure>\n<p>如果将一个字符串强制转换成一个数字.PHP会去搜索这个字符串的开头.如果开头是数字就转换.如果不是就直接返回0.</p>\n<h2 id=\"点号\"><a href=\"#点号\" class=\"headerlink\" title=\". 点号\"></a>. 点号</h2><p>用于连接字符串,先连接字符串再运算</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">'5+1='</span> . <span class=\"number\">1</span>+<span class=\"number\">5</span>; <span class=\"comment\">//输出10 </span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">'5+1='</span> . <span class=\"number\">5</span>+<span class=\"number\">1</span>; <span class=\"comment\">//输出6 </span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">'1+5='</span> . <span class=\"number\">1</span>+<span class=\"number\">5</span>; <span class=\"comment\">//输出6 </span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">'1+5='</span> . <span class=\"number\">5</span>+<span class=\"number\">1</span>; <span class=\"comment\">//输出2</span></span><br></pre></td></tr></table></figure>\n<p>具体是 <code>&#39;5+1=&#39; . 1</code> 连接字符串后变成 <code>5+11</code>, <code>5+11</code> 转成数字后变成 5, 最后 <code>5+5</code> 等于10</p>\n<h2 id=\"逗号\"><a href=\"#逗号\" class=\"headerlink\" title=\", 逗号\"></a>, 逗号</h2><p>用逗号是 <code>multiple parameters</code>. 也就是说是多参数.换句话说.<br>逗号分隔开的就相当于是N个参数.也就是说把echo当个函数用.这样的话 echo 会对每个参数先进行计算.最后再进行连接后输出</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">'1+5='</span> . <span class=\"number\">1</span>+<span class=\"number\">5</span>;  <span class=\"comment\">//输出 6</span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">'1+5='</span> , <span class=\"number\">5</span>+<span class=\"number\">1</span>;  <span class=\"comment\">//输出 1+5=6</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"at符号\"><a href=\"#at符号\" class=\"headerlink\" title=\"@ at符号\"></a>@ at符号</h2><p>当php解释器遇到@开头的语句时候，无论本行的语句是否执行成功，都会继续执行后续的语句，而且不会报错。</p>\n<h2 id=\"双冒号-两个冒号\"><a href=\"#双冒号-两个冒号\" class=\"headerlink\" title=\":: 双冒号,两个冒号\"></a>:: 双冒号,两个冒号</h2><p>用于访问静态、const和类中重写的属性与方法, 类不需要实例化, 用箭头操作符<code>-&gt;</code>必须要将类进行实例化（或者在类的内部调用也可以） 。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyClass</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> CONST_VALUE = <span class=\"string\">'A constant value'</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$classname = <span class=\"string\">'MyClass'</span>;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $classname::CONST_VALUE; <span class=\"comment\">// 自 PHP 5.3.0 起</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">echo</span> MyClass::CONST_VALUE;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"构造函数和析构函数\"><a href=\"#构造函数和析构函数\" class=\"headerlink\" title=\"构造函数和析构函数\"></a>构造函数和析构函数</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyDestructableClass</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">()</span> </span>&#123; <span class=\"comment\">// 构造函数</span></span><br><span class=\"line\">       <span class=\"keyword\">print</span> <span class=\"string\">\"In constructor\\n\"</span>;</span><br><span class=\"line\">       <span class=\"keyword\">$this</span>-&gt;name = <span class=\"string\">\"MyDestructableClass\"</span>;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span><span class=\"params\">()</span> </span>&#123; <span class=\"comment\">// 析构函数</span></span><br><span class=\"line\">       <span class=\"keyword\">print</span> <span class=\"string\">\"Destroying \"</span> . <span class=\"keyword\">$this</span>-&gt;name . <span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$obj = <span class=\"keyword\">new</span> MyDestructableClass();</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"命名空间-和-use\"><a href=\"#命名空间-和-use\" class=\"headerlink\" title=\"命名空间 和 use\"></a>命名空间 和 use</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title\">Album</span>\\<span class=\"title\">Model</span>;</span><br><span class=\"line\"><span class=\"keyword\">use</span> <span class=\"title\">Zend</span>\\<span class=\"title\">InputFilter</span>\\<span class=\"title\">Factory</span> <span class=\"title\">as</span> <span class=\"title\">InputFactory</span>;</span><br><span class=\"line\"><span class=\"keyword\">use</span> <span class=\"title\">Zend</span>\\<span class=\"title\">InputFilter</span>\\<span class=\"title\">InputFilter</span>;</span><br><span class=\"line\"><span class=\"keyword\">use</span> <span class=\"title\">Zend</span>\\<span class=\"title\">InputFilter</span>\\<span class=\"title\">InputFilterAwareInterface</span>;</span><br><span class=\"line\"><span class=\"keyword\">use</span> <span class=\"title\">Zend</span>\\<span class=\"title\">InputFilter</span>\\<span class=\"title\">InputFilterInterface</span>;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Album</span> <span class=\"keyword\">implements</span> <span class=\"title\">InputFilterAwareInterface</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"include-和-include-once\"><a href=\"#include-和-include-once\" class=\"headerlink\" title=\"include 和 include_once\"></a>include 和 include_once</h2><p>使用方法：include “文件路径”;</p>\n<p>函数作用：引入另一个php脚本文件，并执行里面的代码</p>\n<p>推荐使用：include_once “文件路径”;</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 自动加载控制器和模型类 </span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">loadClass</span><span class=\"params\">($class)</span> </span>&#123;</span><br><span class=\"line\">    $frameworks = <span class=\"keyword\">__DIR__</span> . <span class=\"string\">'/'</span> . $class . <span class=\"string\">'.php'</span>;</span><br><span class=\"line\">    $controllers = APP_PATH . <span class=\"string\">'application/controllers/'</span> . $class . <span class=\"string\">'.php'</span>;</span><br><span class=\"line\">    $models = APP_PATH . <span class=\"string\">'application/models/'</span> . $class . <span class=\"string\">'.php'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (file_exists($frameworks)) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 加载框架核心类</span></span><br><span class=\"line\">        <span class=\"keyword\">include</span> $frameworks;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">elseif</span> (file_exists($controllers)) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 加载应用控制器类</span></span><br><span class=\"line\">        <span class=\"keyword\">include</span> $controllers;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">elseif</span> (file_exists($models)) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//加载应用模型类</span></span><br><span class=\"line\">        <span class=\"keyword\">include</span> $models;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 错误代码</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"require-和-require-once\"><a href=\"#require-和-require-once\" class=\"headerlink\" title=\"require 和 require_once\"></a>require 和 require_once</h2><blockquote>\n<p>最大的区别就是：include在引入不存文件时产生一个警告且脚本还会继续执行，require则会导致一个致命性错误且脚本停止执行。</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span>  </span><br><span class=\"line\"><span class=\"keyword\">include_once</span> <span class=\"string\">'1.php'</span>;  </span><br><span class=\"line\"><span class=\"keyword\">require_once</span> <span class=\"string\">'1.php'</span>;  </span><br><span class=\"line\"><span class=\"keyword\">include</span> <span class=\"string\">'1.php'</span>;  </span><br><span class=\"line\"><span class=\"keyword\">require</span> <span class=\"string\">'1.php'</span>;  </span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"以下划线-开头的变量和方法\"><a href=\"#以下划线-开头的变量和方法\" class=\"headerlink\" title=\"以下划线(_)开头的变量和方法\"></a>以下划线(_)开头的变量和方法</h2><p>加一个为私有的, 加两个一般都是系统默认的，系统预定义的.</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">__LINE__</span> 表示文件中的当前行号。</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">__FILE__</span> 表示文件的完整路径和文件名。</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">__DIR__</span> 表示文件所在的目录。如果用在被包括文件中，则返回被包括的文件所在的目录。它等价于 dirname(<span class=\"keyword\">__FILE__</span>)。除非是根目录，否则目录中名不包括末尾的斜杠</span><br></pre></td></tr></table></figure>\n<p>另外 php规定以两个下划线（__）开头的方法都保留为<strong>魔术方法</strong>，</p>\n<p>PHP中的魔术方法有</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">__construct,</span><br><span class=\"line\">__destruct ,</span><br><span class=\"line\">__call,</span><br><span class=\"line\">__callStatic,</span><br><span class=\"line\">__get, </span><br><span class=\"line\">__set,</span><br><span class=\"line\">__isset, </span><br><span class=\"line\">__unset , </span><br><span class=\"line\">__sleep,</span><br><span class=\"line\">__wakeup, </span><br><span class=\"line\">__toString,</span><br><span class=\"line\">__set_state, </span><br><span class=\"line\">__clone, </span><br><span class=\"line\">__autoload</span><br></pre></td></tr></table></figure>\n<h2 id=\"array-merge和数组相加（-）\"><a href=\"#array-merge和数组相加（-）\" class=\"headerlink\" title=\"array_merge和数组相加（+）\"></a>array_merge和数组相加（+）</h2><ul>\n<li>键名是字符串：</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$arr1=<span class=\"keyword\">array</span>(<span class=\"string\">'a'</span>=&gt;<span class=\"string\">'PHP'</span>);</span><br><span class=\"line\">$arr2=<span class=\"keyword\">array</span>(<span class=\"string\">'a'</span>=&gt;<span class=\"string\">'JAVA'</span>);</span><br><span class=\"line\"><span class=\"comment\">//如果键名为字符，且键名相同，array_merge()后面数组元素值会覆盖前面数组元素值</span></span><br><span class=\"line\">print_r(array_merge($arr1,$arr2));<span class=\"comment\">//Array ( [a] =&gt; JAVA )</span></span><br><span class=\"line\"><span class=\"comment\">//如果键名为字符，且键名相同，数组相加会将最先出现的值作为结果</span></span><br><span class=\"line\">print_r($arr1+$arr2);<span class=\"comment\">//Array ( [a] =&gt; PHP )</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>键名是数字：</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$arr1=<span class=\"keyword\">array</span>(<span class=\"string\">\"C\"</span>,<span class=\"string\">\"PHP\"</span>);</span><br><span class=\"line\">$arr2=<span class=\"keyword\">array</span>(<span class=\"string\">\"JAVA\"</span>,<span class=\"string\">\"PHP\"</span>);</span><br><span class=\"line\"><span class=\"comment\">//如果键名为数字，array_merge()不会进行覆盖</span></span><br><span class=\"line\">print_r(array_merge($arr1,$arr2));<span class=\"comment\">//Array ( [0] =&gt; C [1] =&gt; PHP [2] =&gt; JAVA [3] =&gt; PHP )</span></span><br><span class=\"line\"><span class=\"comment\">//如果键名为数字，数组相加会将最先出现的值作为结果，后面键名相同的会被抛弃</span></span><br><span class=\"line\">print_r($arr1+$arr2);<span class=\"comment\">//Array ( [0] =&gt; C [1] =&gt; PHP )</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"clone-关键字与-clone-方法\"><a href=\"#clone-关键字与-clone-方法\" class=\"headerlink\" title=\"clone 关键字与 __clone() 方法\"></a>clone 关键字与 __clone() 方法</h2><ul>\n<li><p><code>clone</code> 关键字用于克隆一个完全一样的对象,而且克隆以后，两个对象互不干扰。</p>\n</li>\n<li><p><code>__clone()</code> 如果想在克隆后改变克隆对象的内容，需要在类中添加一个特殊的 <code>__clone()</code> 方法来重写原本的属性和方法。<code>__clone()</code> 方法只会在对象被克隆的时候自动调用。</p>\n</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> $name;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> $age;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($name, $age)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;name = $name;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;age = $age;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">say</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">\"我的名字叫：\"</span>.<span class=\"keyword\">$this</span>-&gt;name;</span><br><span class=\"line\">\t    <span class=\"keyword\">echo</span> <span class=\"string\">\"我的年龄是：\"</span>.<span class=\"keyword\">$this</span>-&gt;age.<span class=\"string\">\"&lt;br /&gt;\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__clone</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;name = <span class=\"string\">\"我是假的\"</span>.<span class=\"keyword\">$this</span>-&gt;name;</span><br><span class=\"line\">        <span class=\"keyword\">$this</span>-&gt;age = <span class=\"number\">30</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$p1 = <span class=\"keyword\">new</span> Person(<span class=\"string\">\"张三\"</span>, <span class=\"number\">20</span>);</span><br><span class=\"line\">$p1-&gt;say();</span><br><span class=\"line\">$p2 = <span class=\"keyword\">clone</span> $p1;</span><br><span class=\"line\">$p2-&gt;say();</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<p>运行例子，输出：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">我的名字叫：张三 我的年龄是：20</span><br><span class=\"line\">我的名字叫：我是假的张三 我的年龄是：30</span><br></pre></td></tr></table></figure>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ul>\n<li><a href=\"http://blog.csdn.net/abandonship/article/details/6459370\">php中双冒号的应用</a></li>\n<li><a href=\"http://php.net/manual/zh/language.oop5.decon.php#language.oop5.decon\">构造函数和析构函数</a></li>\n<li><a href=\"http://blog.csdn.net/zlking02/article/details/6752256\">PHP中用下划线开头的变量含义</a></li>\n<li><a href=\"http://www.jianshu.com/p/43e9263f82c1\">PHP 1、array_merge和数组相加（+）</a></li>\n<li><a href=\"http://www.5idev.com/p-php_object_clone.shtml\">PHP 对象克隆 clone 关键字与 __clone() 方法</a></li>\n<li><a href=\"http://www.5idev.com/php-phpbase.shtml\">PHP基础教程</a></li>\n</ul>\n"},{"title":"Log4j向Logstash发送日志实践","title_url":"log4j-logstash-practice","date":"2016-07-04T16:00:00.000Z","description":"Log4j向Logstash发送日志实践","_content":"\n## 在logstash中配置log4j\n\n- 在logstash的配置文件中增加如下配置\n```\ninput {\n  stdin {\n  }\n  log4j {\n    type => \"log4j-test\"\n    port => 4560\n  }\n}\n\nfilter {\n  grok {\n    match => { \"message\" => \"%{COMBINEDAPACHELOG}\" }\n  }\n}\n\noutput {\n  elasticsearch {\n        hosts => [\"localhost:9200\"]\n        index => \"logstash-%{type}-%{+YYYY.MM.dd}\"\n\t\tdocument_type => \"%{type}\"\n  }\n  stdout { codec => rubydebug }\n}\n```\n- 其中`input`下的`port`表示本机开放4560端口接收网络中其他主机应用程序中log4j发送过来的日志，也可以指定其他未被占用的端口，`type` 为接收的日志起的别名\n\n- `output`下的`elasticsearch`部分表示logstash将接收的日志发送给本机的elasticsearch，其端口为9200，`index` 表示生成索引的名称\n\n- 这里的配置是服务器模式，也就是logstash作为日志服务器开放一个端口，网络中其他主机主动发送日志\n\n## 在应用中配置 log4j\n\n- log4j用SocketAppender将日志发送到指定的主机和端口，在log4j.xml中配置如下\n```xml\n<appender name=\"LOGSTASH\" class=\"org.apache.log4j.net.SocketAppender\">\n\t<param name=\"RemoteHost\" value=\"192.168.37.118\"/>\n\t<param name=\"Port\" value=\"4560\"/>\t\n\t<param name=\"ReconnectionDelay\" value=\"10000\"/>\n\t<param name=\"LocationInfo\" value=\"true\"/>\n\t<param name=\"Threshold\" value=\"INFO\"/>\n\t<param name=\"Application\" value=\"web-api\" />\n</appender>\n```\n\n- 其中`RemoteHost`和`Port`表示logstash主机的ip和开放的端口，`Threshold` 表示将何种等级的日志发送到logstash，`Application`表示日志来源于哪个应用\n\n- 如果使用log4j.properties文件，配置如下\n```\nlog4j.appender.socket=org.apache.log4j.net.SocketAppender  \nlog4j.appender.socket.RemoteHost=192.168.37.118\nlog4j.appender.socket.Port=4560\nlog4j.appender.socket.ReconnectionDelay=10000\nlog4j.appender.socket.LocationInfo=true\nlog4j.appender.socket.Threshold=INFO\nlog4j.appender.socket.Application=web-api\n```\n\n- 关于`SocketAppender`中的`RemoteHost`和`Port`等字段的含义参考`SocketAppender`的源码\n\n\n参考如下：\n\n[logstash的log4j插件使用说明](https://www.elastic.co/guide/en/logstash/current/plugins-inputs-log4j.html)\n\n","source":"_posts/Log4j向Logstash发送日志实践.md","raw":"---\ntitle: Log4j向Logstash发送日志实践\ntitle_url: log4j-logstash-practice\ndate: 2016-07-05\ntags: [Log4j,Logstash]\ncategories: 技术\ndescription: Log4j向Logstash发送日志实践\n---\n\n## 在logstash中配置log4j\n\n- 在logstash的配置文件中增加如下配置\n```\ninput {\n  stdin {\n  }\n  log4j {\n    type => \"log4j-test\"\n    port => 4560\n  }\n}\n\nfilter {\n  grok {\n    match => { \"message\" => \"%{COMBINEDAPACHELOG}\" }\n  }\n}\n\noutput {\n  elasticsearch {\n        hosts => [\"localhost:9200\"]\n        index => \"logstash-%{type}-%{+YYYY.MM.dd}\"\n\t\tdocument_type => \"%{type}\"\n  }\n  stdout { codec => rubydebug }\n}\n```\n- 其中`input`下的`port`表示本机开放4560端口接收网络中其他主机应用程序中log4j发送过来的日志，也可以指定其他未被占用的端口，`type` 为接收的日志起的别名\n\n- `output`下的`elasticsearch`部分表示logstash将接收的日志发送给本机的elasticsearch，其端口为9200，`index` 表示生成索引的名称\n\n- 这里的配置是服务器模式，也就是logstash作为日志服务器开放一个端口，网络中其他主机主动发送日志\n\n## 在应用中配置 log4j\n\n- log4j用SocketAppender将日志发送到指定的主机和端口，在log4j.xml中配置如下\n```xml\n<appender name=\"LOGSTASH\" class=\"org.apache.log4j.net.SocketAppender\">\n\t<param name=\"RemoteHost\" value=\"192.168.37.118\"/>\n\t<param name=\"Port\" value=\"4560\"/>\t\n\t<param name=\"ReconnectionDelay\" value=\"10000\"/>\n\t<param name=\"LocationInfo\" value=\"true\"/>\n\t<param name=\"Threshold\" value=\"INFO\"/>\n\t<param name=\"Application\" value=\"web-api\" />\n</appender>\n```\n\n- 其中`RemoteHost`和`Port`表示logstash主机的ip和开放的端口，`Threshold` 表示将何种等级的日志发送到logstash，`Application`表示日志来源于哪个应用\n\n- 如果使用log4j.properties文件，配置如下\n```\nlog4j.appender.socket=org.apache.log4j.net.SocketAppender  \nlog4j.appender.socket.RemoteHost=192.168.37.118\nlog4j.appender.socket.Port=4560\nlog4j.appender.socket.ReconnectionDelay=10000\nlog4j.appender.socket.LocationInfo=true\nlog4j.appender.socket.Threshold=INFO\nlog4j.appender.socket.Application=web-api\n```\n\n- 关于`SocketAppender`中的`RemoteHost`和`Port`等字段的含义参考`SocketAppender`的源码\n\n\n参考如下：\n\n[logstash的log4j插件使用说明](https://www.elastic.co/guide/en/logstash/current/plugins-inputs-log4j.html)\n\n","slug":"Log4j向Logstash发送日志实践","published":1,"updated":"2016-10-10T01:58:06.776Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj5jgsbdn00082cezkzihore4","content":"<h2 id=\"在logstash中配置log4j\"><a href=\"#在logstash中配置log4j\" class=\"headerlink\" title=\"在logstash中配置log4j\"></a>在logstash中配置log4j</h2><ul>\n<li><p>在logstash的配置文件中增加如下配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">input &#123;</span><br><span class=\"line\">  stdin &#123;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  log4j &#123;</span><br><span class=\"line\">    type =&gt; &quot;log4j-test&quot;</span><br><span class=\"line\">    port =&gt; 4560</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">filter &#123;</span><br><span class=\"line\">  grok &#123;</span><br><span class=\"line\">    match =&gt; &#123; &quot;message&quot; =&gt; &quot;%&#123;COMBINEDAPACHELOG&#125;&quot; &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">output &#123;</span><br><span class=\"line\">  elasticsearch &#123;</span><br><span class=\"line\">        hosts =&gt; [&quot;localhost:9200&quot;]</span><br><span class=\"line\">        index =&gt; &quot;logstash-%&#123;type&#125;-%&#123;+YYYY.MM.dd&#125;&quot;</span><br><span class=\"line\">\t\tdocument_type =&gt; &quot;%&#123;type&#125;&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  stdout &#123; codec =&gt; rubydebug &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>其中<code>input</code>下的<code>port</code>表示本机开放4560端口接收网络中其他主机应用程序中log4j发送过来的日志，也可以指定其他未被占用的端口，<code>type</code> 为接收的日志起的别名</p>\n</li>\n<li><p><code>output</code>下的<code>elasticsearch</code>部分表示logstash将接收的日志发送给本机的elasticsearch，其端口为9200，<code>index</code> 表示生成索引的名称</p>\n</li>\n<li><p>这里的配置是服务器模式，也就是logstash作为日志服务器开放一个端口，网络中其他主机主动发送日志</p>\n</li>\n</ul>\n<h2 id=\"在应用中配置-log4j\"><a href=\"#在应用中配置-log4j\" class=\"headerlink\" title=\"在应用中配置 log4j\"></a>在应用中配置 log4j</h2><ul>\n<li><p>log4j用SocketAppender将日志发送到指定的主机和端口，在log4j.xml中配置如下</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">\"LOGSTASH\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.apache.log4j.net.SocketAppender\"</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"RemoteHost\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"192.168.37.118\"</span>/&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"Port\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"4560\"</span>/&gt;</span>\t</span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"ReconnectionDelay\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"10000\"</span>/&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"LocationInfo\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span>/&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"Threshold\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"INFO\"</span>/&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"Application\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"web-api\"</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>其中<code>RemoteHost</code>和<code>Port</code>表示logstash主机的ip和开放的端口，<code>Threshold</code> 表示将何种等级的日志发送到logstash，<code>Application</code>表示日志来源于哪个应用</p>\n</li>\n<li><p>如果使用log4j.properties文件，配置如下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">log4j.appender.socket=org.apache.log4j.net.SocketAppender  </span><br><span class=\"line\">log4j.appender.socket.RemoteHost=192.168.37.118</span><br><span class=\"line\">log4j.appender.socket.Port=4560</span><br><span class=\"line\">log4j.appender.socket.ReconnectionDelay=10000</span><br><span class=\"line\">log4j.appender.socket.LocationInfo=true</span><br><span class=\"line\">log4j.appender.socket.Threshold=INFO</span><br><span class=\"line\">log4j.appender.socket.Application=web-api</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>关于<code>SocketAppender</code>中的<code>RemoteHost</code>和<code>Port</code>等字段的含义参考<code>SocketAppender</code>的源码</p>\n</li>\n</ul>\n<p>参考如下：</p>\n<p><a href=\"https://www.elastic.co/guide/en/logstash/current/plugins-inputs-log4j.html\" target=\"_blank\" rel=\"external\">logstash的log4j插件使用说明</a></p>\n","excerpt":"","more":"<h2 id=\"在logstash中配置log4j\"><a href=\"#在logstash中配置log4j\" class=\"headerlink\" title=\"在logstash中配置log4j\"></a>在logstash中配置log4j</h2><ul>\n<li><p>在logstash的配置文件中增加如下配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">input &#123;</span><br><span class=\"line\">  stdin &#123;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  log4j &#123;</span><br><span class=\"line\">    type =&gt; &quot;log4j-test&quot;</span><br><span class=\"line\">    port =&gt; 4560</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">filter &#123;</span><br><span class=\"line\">  grok &#123;</span><br><span class=\"line\">    match =&gt; &#123; &quot;message&quot; =&gt; &quot;%&#123;COMBINEDAPACHELOG&#125;&quot; &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">output &#123;</span><br><span class=\"line\">  elasticsearch &#123;</span><br><span class=\"line\">        hosts =&gt; [&quot;localhost:9200&quot;]</span><br><span class=\"line\">        index =&gt; &quot;logstash-%&#123;type&#125;-%&#123;+YYYY.MM.dd&#125;&quot;</span><br><span class=\"line\">\t\tdocument_type =&gt; &quot;%&#123;type&#125;&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  stdout &#123; codec =&gt; rubydebug &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>其中<code>input</code>下的<code>port</code>表示本机开放4560端口接收网络中其他主机应用程序中log4j发送过来的日志，也可以指定其他未被占用的端口，<code>type</code> 为接收的日志起的别名</p>\n</li>\n<li><p><code>output</code>下的<code>elasticsearch</code>部分表示logstash将接收的日志发送给本机的elasticsearch，其端口为9200，<code>index</code> 表示生成索引的名称</p>\n</li>\n<li><p>这里的配置是服务器模式，也就是logstash作为日志服务器开放一个端口，网络中其他主机主动发送日志</p>\n</li>\n</ul>\n<h2 id=\"在应用中配置-log4j\"><a href=\"#在应用中配置-log4j\" class=\"headerlink\" title=\"在应用中配置 log4j\"></a>在应用中配置 log4j</h2><ul>\n<li><p>log4j用SocketAppender将日志发送到指定的主机和端口，在log4j.xml中配置如下</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">\"LOGSTASH\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.apache.log4j.net.SocketAppender\"</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"RemoteHost\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"192.168.37.118\"</span>/&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"Port\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"4560\"</span>/&gt;</span>\t</span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"ReconnectionDelay\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"10000\"</span>/&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"LocationInfo\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span>/&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"Threshold\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"INFO\"</span>/&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"Application\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"web-api\"</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>其中<code>RemoteHost</code>和<code>Port</code>表示logstash主机的ip和开放的端口，<code>Threshold</code> 表示将何种等级的日志发送到logstash，<code>Application</code>表示日志来源于哪个应用</p>\n</li>\n<li><p>如果使用log4j.properties文件，配置如下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">log4j.appender.socket=org.apache.log4j.net.SocketAppender  </span><br><span class=\"line\">log4j.appender.socket.RemoteHost=192.168.37.118</span><br><span class=\"line\">log4j.appender.socket.Port=4560</span><br><span class=\"line\">log4j.appender.socket.ReconnectionDelay=10000</span><br><span class=\"line\">log4j.appender.socket.LocationInfo=true</span><br><span class=\"line\">log4j.appender.socket.Threshold=INFO</span><br><span class=\"line\">log4j.appender.socket.Application=web-api</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>关于<code>SocketAppender</code>中的<code>RemoteHost</code>和<code>Port</code>等字段的含义参考<code>SocketAppender</code>的源码</p>\n</li>\n</ul>\n<p>参考如下：</p>\n<p><a href=\"https://www.elastic.co/guide/en/logstash/current/plugins-inputs-log4j.html\">logstash的log4j插件使用说明</a></p>\n"},{"title":"Phabricator 在创建项目的时候自动创建一个 Herald 规则","title_url":"Phabricator-project-Herald","date":"2017-07-21T16:00:00.000Z","description":"Phabricator 在创建项目的时候自动创建一个 Herald 规则","_content":"\n## 问题描述\n\nPhabricator 默认在添加一个新的项目成员的时候是不会给新成员发生邮件的，需要手工创建一个 Herald 规则。\n所以为了便于维护，需要扩展一个功能，具体就是：Phabricator 在创建项目的时候自动创建一个 Herald 规则。这个规则具体如下\n\n![herald1](http://7xt8a6.com1.z0.glb.clouddn.com/herald1.PNG)\n\n从代码角度理解如下\n\n```php\n// 手动插入规则信息, $object 是保存成功后的项目对象\n$projectInfo = array($object->getPHID() => $object->getDisplayName());\n$data['conditions'] = array(array(\"projects.exact\",\"any\",$projectInfo));\n$data['actions'] = array(array(\"email.other\", $projectInfo));\n```\n\n## 解决\n\n- 具体就是要在项目保存成功后获取到新项目的id和名称，然后再保存一个 Herald 规则\n\n- 并且项目更新的时候避免再新增 Herald 规则\n\n在 Phabricator 现有的代码基础上新增的代码如下\n\n![herald2](http://7xt8a6.com1.z0.glb.clouddn.com/herald3.PNG)\n\n新增的 saveProjectNotificationRule 方法具体如下：\n\n```php\n/**\n * 新增加项目的时候自动增加一个通知规则 herald\n *\n * author ck\n *\n * @param AphrontRequest $request\n * @param PhabricatorUser $viewer\n * @param PhabricatorProject $object\n * @return array\n */\nprivate function saveProjectNotificationRule(AphrontRequest $request, PhabricatorUser $viewer, PhabricatorProject $object) {\n  $adapter = HeraldAdapter::getAdapterForContentType('PhabricatorProjectHeraldAdapter');\n\n  // 手动构造一个form请求\n  $request_data = array();\n  $request_data['name'] = 'herald_rule_for_'.$object->getDisplayName();\n  $request_data['must_match'] = 'all';\n  $request_data['repetition_policy'] = 'every';\n  $request_data['__csrf__'] = $request->getRequestData()['__csrf__']; //保留token否则添加失败\n\n  // 手动构造一个通知规则\n  $rule = new HeraldRule();\n  $rule->setAuthorPHID($viewer->getPHID());\n  $rule->setMustMatchAll(1);\n  $rule->setContentType('PhabricatorProjectHeraldAdapter');\n  $rule->setRuleType('global');\n  $rule->setConfigVersion(38);\n\n  $rule_conditions = $rule->loadConditions();\n  $rule_actions = $rule->loadActions();\n\n  $rule->attachConditions($rule_conditions);\n  $rule->attachActions($rule_actions);\n      \n  $request->setRequestData($request_data);\n  \n  $new_name = $request->getStr('name');\n  $match_all = ($request->getStr('must_match') == 'all');\n  \n  $repetition_policy_param = $request->getStr('repetition_policy');\n  \n  $e_name = true;\n  $errors = array();\n\n  // 手动插入规则信息\n  $projectInfo = array($object->getPHID() => $object->getDisplayName());\n  $data['conditions'] = array(array(\"projects.exact\",\"any\",$projectInfo));\n  $data['actions'] = array(array(\"email.other\", $projectInfo));\n\n  $conditions = array();\n  foreach ($data['conditions'] as $condition) {\n      if ($condition === null) {\n          // We manage this as a sparse array on the client, so may receive\n          // NULL if conditions have been removed.\n          continue;\n      }\n\n      $obj = new HeraldCondition();\n      $obj->setFieldName($condition[0]);\n      $obj->setFieldCondition($condition[1]);\n\n      if (is_array($condition[2])) {\n          $obj->setValue(array_keys($condition[2]));\n      } else {\n          $obj->setValue($condition[2]);\n      }\n\n      try {\n          $adapter->willSaveCondition($obj);\n      } catch (HeraldInvalidConditionException $ex) {\n          $errors[] = $ex->getMessage();\n      }\n\n      $conditions[] = $obj;\n  }\n\n  $actions = array();\n  foreach ($data['actions'] as $action) {\n      if ($action === null) {\n          // Sparse on the client; removals can give us NULLs.\n          continue;\n      }\n\n      if (!isset($action[1])) {\n          // Legitimate for any action which doesn't need a target, like\n          // \"Do nothing\".\n          $action[1] = null;\n      }\n\n      $obj = new HeraldActionRecord();\n      $obj->setAction($action[0]);\n      $obj->setTarget($action[1]);\n\n      try {\n          $adapter->willSaveAction($rule, $obj);\n      } catch (HeraldInvalidActionException $ex) {\n          $errors[] = $ex->getMessage();\n      }\n\n      $actions[] = $obj;\n  }\n\n  if (!$errors) {\n      $new_state = id(new HeraldRuleSerializer())->serializeRuleComponents(\n          $match_all,\n          $conditions,\n          $actions,\n          $repetition_policy_param);\n\n      $xactions = array();\n      $xactions[] = id(new HeraldRuleTransaction())\n      ->setTransactionType(HeraldRuleTransaction::TYPE_EDIT)\n      ->setNewValue($new_state);\n      $xactions[] = id(new HeraldRuleTransaction())\n      ->setTransactionType(HeraldRuleTransaction::TYPE_NAME)\n      ->setNewValue($new_name);\n\n      try {\n          id(new HeraldRuleEditor())\n          ->setActor($viewer)\n          ->setContinueOnNoEffect(true)\n          ->setContentSourceFromRequest($request)\n          ->applyTransactions($rule, $xactions);\n          return array(null, null);\n      } catch (Exception $ex) {\n          $errors[] = $ex->getMessage();\n      }\n  }\n\n  return array($e_name, $errors);\n}\n```\n\n在完成这个功能的时候具体需要了解 Herald 规则的具体创建过程，具体参考 `phabricator\\src\\applications\\herald\\controller\\HeraldRuleController.php` 中的 `saveRule` 方法。\n\n## 遇到的问题\n\n在所有的工作快完成的时候遇到了如下的一个问题\n\n```\nYou are trying to save some data to Phabricator, but the request your browser made included an incorrect token. Reload the page and try again. You may need to clear your cookies.\nThis was a Web request.\nThis request had no CSRF token.\nTo avoid this error, use phabricator_form() to construct forms. If you are already using phabricator_form(), make sure the form 'action' uses a relative URI (i.e., begins with a '/'). Forms using absolute URIs do not include CSRF tokens, to prevent leaking tokens to external sites.\n\nIf this page performs writes which do not require CSRF protection (usually, filling caches or logging), you can use AphrontWriteGuard::beginScopedUnguardedWrites() to temporarily bypass CSRF protection while writing. You should use this only for writes which can not be protected with normal CSRF mechanisms.\n\nSome UI elements (like PhabricatorActionListView) also have methods which will allow you to render links as forms (like setRenderAsForm(true)).\n```\n\n具体出现在\n\n```php\ntry {\n  id(new HeraldRuleEditor())\n  ->setActor($viewer)\n  ->setContinueOnNoEffect(true)\n  ->setContentSourceFromRequest($request)\n  ->applyTransactions($rule, $xactions);\n  return array(null, null);\n} catch (Exception $ex) {\n  $errors[] = $ex->getMessage();\n}\n```\n\n找了很多地方，最终发现 `$request` 对象的 `$request_data` 数组中缺少了 `__csrf__`, 通过如下的方式加上后不再报错\n\n```php\n$request_data['__csrf__'] = $request->getRequestData()['__csrf__']; //保留token否则添加失败\n```\n\n本人猜测这个属性在保存对象的时候与请求绑定，并不与具体的对象绑定，因为这个请求是本来是用来保存项目对象的。\n\n## 具体的代码\n\n- [提交](https://github.com/toulezu/phabricator/commit/99ac508712b39e316ce07597acc6208b3b6193dc)","source":"_posts/Phabricator 在创建项目的时候自动创建一个 Herald 规则.md","raw":"---\ntitle: Phabricator 在创建项目的时候自动创建一个 Herald 规则\ntitle_url: Phabricator-project-Herald\ndate: 2017-07-22\ntags: [Phabricator]\ncategories: Phabricator\ndescription: Phabricator 在创建项目的时候自动创建一个 Herald 规则\n---\n\n## 问题描述\n\nPhabricator 默认在添加一个新的项目成员的时候是不会给新成员发生邮件的，需要手工创建一个 Herald 规则。\n所以为了便于维护，需要扩展一个功能，具体就是：Phabricator 在创建项目的时候自动创建一个 Herald 规则。这个规则具体如下\n\n![herald1](http://7xt8a6.com1.z0.glb.clouddn.com/herald1.PNG)\n\n从代码角度理解如下\n\n```php\n// 手动插入规则信息, $object 是保存成功后的项目对象\n$projectInfo = array($object->getPHID() => $object->getDisplayName());\n$data['conditions'] = array(array(\"projects.exact\",\"any\",$projectInfo));\n$data['actions'] = array(array(\"email.other\", $projectInfo));\n```\n\n## 解决\n\n- 具体就是要在项目保存成功后获取到新项目的id和名称，然后再保存一个 Herald 规则\n\n- 并且项目更新的时候避免再新增 Herald 规则\n\n在 Phabricator 现有的代码基础上新增的代码如下\n\n![herald2](http://7xt8a6.com1.z0.glb.clouddn.com/herald3.PNG)\n\n新增的 saveProjectNotificationRule 方法具体如下：\n\n```php\n/**\n * 新增加项目的时候自动增加一个通知规则 herald\n *\n * author ck\n *\n * @param AphrontRequest $request\n * @param PhabricatorUser $viewer\n * @param PhabricatorProject $object\n * @return array\n */\nprivate function saveProjectNotificationRule(AphrontRequest $request, PhabricatorUser $viewer, PhabricatorProject $object) {\n  $adapter = HeraldAdapter::getAdapterForContentType('PhabricatorProjectHeraldAdapter');\n\n  // 手动构造一个form请求\n  $request_data = array();\n  $request_data['name'] = 'herald_rule_for_'.$object->getDisplayName();\n  $request_data['must_match'] = 'all';\n  $request_data['repetition_policy'] = 'every';\n  $request_data['__csrf__'] = $request->getRequestData()['__csrf__']; //保留token否则添加失败\n\n  // 手动构造一个通知规则\n  $rule = new HeraldRule();\n  $rule->setAuthorPHID($viewer->getPHID());\n  $rule->setMustMatchAll(1);\n  $rule->setContentType('PhabricatorProjectHeraldAdapter');\n  $rule->setRuleType('global');\n  $rule->setConfigVersion(38);\n\n  $rule_conditions = $rule->loadConditions();\n  $rule_actions = $rule->loadActions();\n\n  $rule->attachConditions($rule_conditions);\n  $rule->attachActions($rule_actions);\n      \n  $request->setRequestData($request_data);\n  \n  $new_name = $request->getStr('name');\n  $match_all = ($request->getStr('must_match') == 'all');\n  \n  $repetition_policy_param = $request->getStr('repetition_policy');\n  \n  $e_name = true;\n  $errors = array();\n\n  // 手动插入规则信息\n  $projectInfo = array($object->getPHID() => $object->getDisplayName());\n  $data['conditions'] = array(array(\"projects.exact\",\"any\",$projectInfo));\n  $data['actions'] = array(array(\"email.other\", $projectInfo));\n\n  $conditions = array();\n  foreach ($data['conditions'] as $condition) {\n      if ($condition === null) {\n          // We manage this as a sparse array on the client, so may receive\n          // NULL if conditions have been removed.\n          continue;\n      }\n\n      $obj = new HeraldCondition();\n      $obj->setFieldName($condition[0]);\n      $obj->setFieldCondition($condition[1]);\n\n      if (is_array($condition[2])) {\n          $obj->setValue(array_keys($condition[2]));\n      } else {\n          $obj->setValue($condition[2]);\n      }\n\n      try {\n          $adapter->willSaveCondition($obj);\n      } catch (HeraldInvalidConditionException $ex) {\n          $errors[] = $ex->getMessage();\n      }\n\n      $conditions[] = $obj;\n  }\n\n  $actions = array();\n  foreach ($data['actions'] as $action) {\n      if ($action === null) {\n          // Sparse on the client; removals can give us NULLs.\n          continue;\n      }\n\n      if (!isset($action[1])) {\n          // Legitimate for any action which doesn't need a target, like\n          // \"Do nothing\".\n          $action[1] = null;\n      }\n\n      $obj = new HeraldActionRecord();\n      $obj->setAction($action[0]);\n      $obj->setTarget($action[1]);\n\n      try {\n          $adapter->willSaveAction($rule, $obj);\n      } catch (HeraldInvalidActionException $ex) {\n          $errors[] = $ex->getMessage();\n      }\n\n      $actions[] = $obj;\n  }\n\n  if (!$errors) {\n      $new_state = id(new HeraldRuleSerializer())->serializeRuleComponents(\n          $match_all,\n          $conditions,\n          $actions,\n          $repetition_policy_param);\n\n      $xactions = array();\n      $xactions[] = id(new HeraldRuleTransaction())\n      ->setTransactionType(HeraldRuleTransaction::TYPE_EDIT)\n      ->setNewValue($new_state);\n      $xactions[] = id(new HeraldRuleTransaction())\n      ->setTransactionType(HeraldRuleTransaction::TYPE_NAME)\n      ->setNewValue($new_name);\n\n      try {\n          id(new HeraldRuleEditor())\n          ->setActor($viewer)\n          ->setContinueOnNoEffect(true)\n          ->setContentSourceFromRequest($request)\n          ->applyTransactions($rule, $xactions);\n          return array(null, null);\n      } catch (Exception $ex) {\n          $errors[] = $ex->getMessage();\n      }\n  }\n\n  return array($e_name, $errors);\n}\n```\n\n在完成这个功能的时候具体需要了解 Herald 规则的具体创建过程，具体参考 `phabricator\\src\\applications\\herald\\controller\\HeraldRuleController.php` 中的 `saveRule` 方法。\n\n## 遇到的问题\n\n在所有的工作快完成的时候遇到了如下的一个问题\n\n```\nYou are trying to save some data to Phabricator, but the request your browser made included an incorrect token. Reload the page and try again. You may need to clear your cookies.\nThis was a Web request.\nThis request had no CSRF token.\nTo avoid this error, use phabricator_form() to construct forms. If you are already using phabricator_form(), make sure the form 'action' uses a relative URI (i.e., begins with a '/'). Forms using absolute URIs do not include CSRF tokens, to prevent leaking tokens to external sites.\n\nIf this page performs writes which do not require CSRF protection (usually, filling caches or logging), you can use AphrontWriteGuard::beginScopedUnguardedWrites() to temporarily bypass CSRF protection while writing. You should use this only for writes which can not be protected with normal CSRF mechanisms.\n\nSome UI elements (like PhabricatorActionListView) also have methods which will allow you to render links as forms (like setRenderAsForm(true)).\n```\n\n具体出现在\n\n```php\ntry {\n  id(new HeraldRuleEditor())\n  ->setActor($viewer)\n  ->setContinueOnNoEffect(true)\n  ->setContentSourceFromRequest($request)\n  ->applyTransactions($rule, $xactions);\n  return array(null, null);\n} catch (Exception $ex) {\n  $errors[] = $ex->getMessage();\n}\n```\n\n找了很多地方，最终发现 `$request` 对象的 `$request_data` 数组中缺少了 `__csrf__`, 通过如下的方式加上后不再报错\n\n```php\n$request_data['__csrf__'] = $request->getRequestData()['__csrf__']; //保留token否则添加失败\n```\n\n本人猜测这个属性在保存对象的时候与请求绑定，并不与具体的对象绑定，因为这个请求是本来是用来保存项目对象的。\n\n## 具体的代码\n\n- [提交](https://github.com/toulezu/phabricator/commit/99ac508712b39e316ce07597acc6208b3b6193dc)","slug":"Phabricator 在创建项目的时候自动创建一个 Herald 规则","published":1,"updated":"2017-07-25T10:54:15.641Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj5jgsbdp000a2cezlp7wfa8n","content":"<h2 id=\"问题描述\"><a href=\"#问题描述\" class=\"headerlink\" title=\"问题描述\"></a>问题描述</h2><p>Phabricator 默认在添加一个新的项目成员的时候是不会给新成员发生邮件的，需要手工创建一个 Herald 规则。<br>所以为了便于维护，需要扩展一个功能，具体就是：Phabricator 在创建项目的时候自动创建一个 Herald 规则。这个规则具体如下</p>\n<p><img src=\"http://7xt8a6.com1.z0.glb.clouddn.com/herald1.PNG\" alt=\"herald1\"></p>\n<p>从代码角度理解如下</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 手动插入规则信息, $object 是保存成功后的项目对象</span></span><br><span class=\"line\">$projectInfo = <span class=\"keyword\">array</span>($object-&gt;getPHID() =&gt; $object-&gt;getDisplayName());</span><br><span class=\"line\">$data[<span class=\"string\">'conditions'</span>] = <span class=\"keyword\">array</span>(<span class=\"keyword\">array</span>(<span class=\"string\">\"projects.exact\"</span>,<span class=\"string\">\"any\"</span>,$projectInfo));</span><br><span class=\"line\">$data[<span class=\"string\">'actions'</span>] = <span class=\"keyword\">array</span>(<span class=\"keyword\">array</span>(<span class=\"string\">\"email.other\"</span>, $projectInfo));</span><br></pre></td></tr></table></figure>\n<h2 id=\"解决\"><a href=\"#解决\" class=\"headerlink\" title=\"解决\"></a>解决</h2><ul>\n<li><p>具体就是要在项目保存成功后获取到新项目的id和名称，然后再保存一个 Herald 规则</p>\n</li>\n<li><p>并且项目更新的时候避免再新增 Herald 规则</p>\n</li>\n</ul>\n<p>在 Phabricator 现有的代码基础上新增的代码如下</p>\n<p><img src=\"http://7xt8a6.com1.z0.glb.clouddn.com/herald3.PNG\" alt=\"herald2\"></p>\n<p>新增的 saveProjectNotificationRule 方法具体如下：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span><br><span class=\"line\"> * 新增加项目的时候自动增加一个通知规则 herald</span><br><span class=\"line\"> *</span><br><span class=\"line\"> * author ck</span><br><span class=\"line\"> *</span><br><span class=\"line\"> * <span class=\"doctag\">@param</span> AphrontRequest $request</span><br><span class=\"line\"> * <span class=\"doctag\">@param</span> PhabricatorUser $viewer</span><br><span class=\"line\"> * <span class=\"doctag\">@param</span> PhabricatorProject $object</span><br><span class=\"line\"> * <span class=\"doctag\">@return</span> array</span><br><span class=\"line\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">saveProjectNotificationRule</span><span class=\"params\">(AphrontRequest $request, PhabricatorUser $viewer, PhabricatorProject $object)</span> </span>&#123;</span><br><span class=\"line\">  $adapter = HeraldAdapter::getAdapterForContentType(<span class=\"string\">'PhabricatorProjectHeraldAdapter'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 手动构造一个form请求</span></span><br><span class=\"line\">  $request_data = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">  $request_data[<span class=\"string\">'name'</span>] = <span class=\"string\">'herald_rule_for_'</span>.$object-&gt;getDisplayName();</span><br><span class=\"line\">  $request_data[<span class=\"string\">'must_match'</span>] = <span class=\"string\">'all'</span>;</span><br><span class=\"line\">  $request_data[<span class=\"string\">'repetition_policy'</span>] = <span class=\"string\">'every'</span>;</span><br><span class=\"line\">  $request_data[<span class=\"string\">'__csrf__'</span>] = $request-&gt;getRequestData()[<span class=\"string\">'__csrf__'</span>]; <span class=\"comment\">//保留token否则添加失败</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 手动构造一个通知规则</span></span><br><span class=\"line\">  $rule = <span class=\"keyword\">new</span> HeraldRule();</span><br><span class=\"line\">  $rule-&gt;setAuthorPHID($viewer-&gt;getPHID());</span><br><span class=\"line\">  $rule-&gt;setMustMatchAll(<span class=\"number\">1</span>);</span><br><span class=\"line\">  $rule-&gt;setContentType(<span class=\"string\">'PhabricatorProjectHeraldAdapter'</span>);</span><br><span class=\"line\">  $rule-&gt;setRuleType(<span class=\"string\">'global'</span>);</span><br><span class=\"line\">  $rule-&gt;setConfigVersion(<span class=\"number\">38</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  $rule_conditions = $rule-&gt;loadConditions();</span><br><span class=\"line\">  $rule_actions = $rule-&gt;loadActions();</span><br><span class=\"line\"></span><br><span class=\"line\">  $rule-&gt;attachConditions($rule_conditions);</span><br><span class=\"line\">  $rule-&gt;attachActions($rule_actions);</span><br><span class=\"line\">      </span><br><span class=\"line\">  $request-&gt;setRequestData($request_data);</span><br><span class=\"line\">  </span><br><span class=\"line\">  $new_name = $request-&gt;getStr(<span class=\"string\">'name'</span>);</span><br><span class=\"line\">  $match_all = ($request-&gt;getStr(<span class=\"string\">'must_match'</span>) == <span class=\"string\">'all'</span>);</span><br><span class=\"line\">  </span><br><span class=\"line\">  $repetition_policy_param = $request-&gt;getStr(<span class=\"string\">'repetition_policy'</span>);</span><br><span class=\"line\">  </span><br><span class=\"line\">  $e_name = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">  $errors = <span class=\"keyword\">array</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 手动插入规则信息</span></span><br><span class=\"line\">  $projectInfo = <span class=\"keyword\">array</span>($object-&gt;getPHID() =&gt; $object-&gt;getDisplayName());</span><br><span class=\"line\">  $data[<span class=\"string\">'conditions'</span>] = <span class=\"keyword\">array</span>(<span class=\"keyword\">array</span>(<span class=\"string\">\"projects.exact\"</span>,<span class=\"string\">\"any\"</span>,$projectInfo));</span><br><span class=\"line\">  $data[<span class=\"string\">'actions'</span>] = <span class=\"keyword\">array</span>(<span class=\"keyword\">array</span>(<span class=\"string\">\"email.other\"</span>, $projectInfo));</span><br><span class=\"line\"></span><br><span class=\"line\">  $conditions = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">  <span class=\"keyword\">foreach</span> ($data[<span class=\"string\">'conditions'</span>] <span class=\"keyword\">as</span> $condition) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> ($condition === <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">          <span class=\"comment\">// We manage this as a sparse array on the client, so may receive</span></span><br><span class=\"line\">          <span class=\"comment\">// NULL if conditions have been removed.</span></span><br><span class=\"line\">          <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      $obj = <span class=\"keyword\">new</span> HeraldCondition();</span><br><span class=\"line\">      $obj-&gt;setFieldName($condition[<span class=\"number\">0</span>]);</span><br><span class=\"line\">      $obj-&gt;setFieldCondition($condition[<span class=\"number\">1</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (is_array($condition[<span class=\"number\">2</span>])) &#123;</span><br><span class=\"line\">          $obj-&gt;setValue(array_keys($condition[<span class=\"number\">2</span>]));</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          $obj-&gt;setValue($condition[<span class=\"number\">2</span>]);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">          $adapter-&gt;willSaveCondition($obj);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (HeraldInvalidConditionException $ex) &#123;</span><br><span class=\"line\">          $errors[] = $ex-&gt;getMessage();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      $conditions[] = $obj;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  $actions = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">  <span class=\"keyword\">foreach</span> ($data[<span class=\"string\">'actions'</span>] <span class=\"keyword\">as</span> $action) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> ($action === <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">          <span class=\"comment\">// Sparse on the client; removals can give us NULLs.</span></span><br><span class=\"line\">          <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!<span class=\"keyword\">isset</span>($action[<span class=\"number\">1</span>])) &#123;</span><br><span class=\"line\">          <span class=\"comment\">// Legitimate for any action which doesn't need a target, like</span></span><br><span class=\"line\">          <span class=\"comment\">// \"Do nothing\".</span></span><br><span class=\"line\">          $action[<span class=\"number\">1</span>] = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      $obj = <span class=\"keyword\">new</span> HeraldActionRecord();</span><br><span class=\"line\">      $obj-&gt;setAction($action[<span class=\"number\">0</span>]);</span><br><span class=\"line\">      $obj-&gt;setTarget($action[<span class=\"number\">1</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">          $adapter-&gt;willSaveAction($rule, $obj);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (HeraldInvalidActionException $ex) &#123;</span><br><span class=\"line\">          $errors[] = $ex-&gt;getMessage();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      $actions[] = $obj;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!$errors) &#123;</span><br><span class=\"line\">      $new_state = id(<span class=\"keyword\">new</span> HeraldRuleSerializer())-&gt;serializeRuleComponents(</span><br><span class=\"line\">          $match_all,</span><br><span class=\"line\">          $conditions,</span><br><span class=\"line\">          $actions,</span><br><span class=\"line\">          $repetition_policy_param);</span><br><span class=\"line\"></span><br><span class=\"line\">      $xactions = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">      $xactions[] = id(<span class=\"keyword\">new</span> HeraldRuleTransaction())</span><br><span class=\"line\">      -&gt;setTransactionType(HeraldRuleTransaction::TYPE_EDIT)</span><br><span class=\"line\">      -&gt;setNewValue($new_state);</span><br><span class=\"line\">      $xactions[] = id(<span class=\"keyword\">new</span> HeraldRuleTransaction())</span><br><span class=\"line\">      -&gt;setTransactionType(HeraldRuleTransaction::TYPE_NAME)</span><br><span class=\"line\">      -&gt;setNewValue($new_name);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">          id(<span class=\"keyword\">new</span> HeraldRuleEditor())</span><br><span class=\"line\">          -&gt;setActor($viewer)</span><br><span class=\"line\">          -&gt;setContinueOnNoEffect(<span class=\"keyword\">true</span>)</span><br><span class=\"line\">          -&gt;setContentSourceFromRequest($request)</span><br><span class=\"line\">          -&gt;applyTransactions($rule, $xactions);</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"keyword\">array</span>(<span class=\"keyword\">null</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (<span class=\"keyword\">Exception</span> $ex) &#123;</span><br><span class=\"line\">          $errors[] = $ex-&gt;getMessage();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">array</span>($e_name, $errors);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在完成这个功能的时候具体需要了解 Herald 规则的具体创建过程，具体参考 <code>phabricator\\src\\applications\\herald\\controller\\HeraldRuleController.php</code> 中的 <code>saveRule</code> 方法。</p>\n<h2 id=\"遇到的问题\"><a href=\"#遇到的问题\" class=\"headerlink\" title=\"遇到的问题\"></a>遇到的问题</h2><p>在所有的工作快完成的时候遇到了如下的一个问题</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">You are trying to save some data to Phabricator, but the request your browser made included an incorrect token. Reload the page and try again. You may need to clear your cookies.</span><br><span class=\"line\">This was a Web request.</span><br><span class=\"line\">This request had no CSRF token.</span><br><span class=\"line\">To avoid this error, use phabricator_form() to construct forms. If you are already using phabricator_form(), make sure the form &apos;action&apos; uses a relative URI (i.e., begins with a &apos;/&apos;). Forms using absolute URIs do not include CSRF tokens, to prevent leaking tokens to external sites.</span><br><span class=\"line\"></span><br><span class=\"line\">If this page performs writes which do not require CSRF protection (usually, filling caches or logging), you can use AphrontWriteGuard::beginScopedUnguardedWrites() to temporarily bypass CSRF protection while writing. You should use this only for writes which can not be protected with normal CSRF mechanisms.</span><br><span class=\"line\"></span><br><span class=\"line\">Some UI elements (like PhabricatorActionListView) also have methods which will allow you to render links as forms (like setRenderAsForm(true)).</span><br></pre></td></tr></table></figure>\n<p>具体出现在</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">  id(<span class=\"keyword\">new</span> HeraldRuleEditor())</span><br><span class=\"line\">  -&gt;setActor($viewer)</span><br><span class=\"line\">  -&gt;setContinueOnNoEffect(<span class=\"keyword\">true</span>)</span><br><span class=\"line\">  -&gt;setContentSourceFromRequest($request)</span><br><span class=\"line\">  -&gt;applyTransactions($rule, $xactions);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">array</span>(<span class=\"keyword\">null</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (<span class=\"keyword\">Exception</span> $ex) &#123;</span><br><span class=\"line\">  $errors[] = $ex-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>找了很多地方，最终发现 <code>$request</code> 对象的 <code>$request_data</code> 数组中缺少了 <code>__csrf__</code>, 通过如下的方式加上后不再报错</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$request_data[<span class=\"string\">'__csrf__'</span>] = $request-&gt;getRequestData()[<span class=\"string\">'__csrf__'</span>]; <span class=\"comment\">//保留token否则添加失败</span></span><br></pre></td></tr></table></figure>\n<p>本人猜测这个属性在保存对象的时候与请求绑定，并不与具体的对象绑定，因为这个请求是本来是用来保存项目对象的。</p>\n<h2 id=\"具体的代码\"><a href=\"#具体的代码\" class=\"headerlink\" title=\"具体的代码\"></a>具体的代码</h2><ul>\n<li><a href=\"https://github.com/toulezu/phabricator/commit/99ac508712b39e316ce07597acc6208b3b6193dc\" target=\"_blank\" rel=\"external\">提交</a></li>\n</ul>\n","excerpt":"","more":"<h2 id=\"问题描述\"><a href=\"#问题描述\" class=\"headerlink\" title=\"问题描述\"></a>问题描述</h2><p>Phabricator 默认在添加一个新的项目成员的时候是不会给新成员发生邮件的，需要手工创建一个 Herald 规则。<br>所以为了便于维护，需要扩展一个功能，具体就是：Phabricator 在创建项目的时候自动创建一个 Herald 规则。这个规则具体如下</p>\n<p><img src=\"http://7xt8a6.com1.z0.glb.clouddn.com/herald1.PNG\" alt=\"herald1\"></p>\n<p>从代码角度理解如下</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 手动插入规则信息, $object 是保存成功后的项目对象</span></span><br><span class=\"line\">$projectInfo = <span class=\"keyword\">array</span>($object-&gt;getPHID() =&gt; $object-&gt;getDisplayName());</span><br><span class=\"line\">$data[<span class=\"string\">'conditions'</span>] = <span class=\"keyword\">array</span>(<span class=\"keyword\">array</span>(<span class=\"string\">\"projects.exact\"</span>,<span class=\"string\">\"any\"</span>,$projectInfo));</span><br><span class=\"line\">$data[<span class=\"string\">'actions'</span>] = <span class=\"keyword\">array</span>(<span class=\"keyword\">array</span>(<span class=\"string\">\"email.other\"</span>, $projectInfo));</span><br></pre></td></tr></table></figure>\n<h2 id=\"解决\"><a href=\"#解决\" class=\"headerlink\" title=\"解决\"></a>解决</h2><ul>\n<li><p>具体就是要在项目保存成功后获取到新项目的id和名称，然后再保存一个 Herald 规则</p>\n</li>\n<li><p>并且项目更新的时候避免再新增 Herald 规则</p>\n</li>\n</ul>\n<p>在 Phabricator 现有的代码基础上新增的代码如下</p>\n<p><img src=\"http://7xt8a6.com1.z0.glb.clouddn.com/herald3.PNG\" alt=\"herald2\"></p>\n<p>新增的 saveProjectNotificationRule 方法具体如下：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span><br><span class=\"line\"> * 新增加项目的时候自动增加一个通知规则 herald</span><br><span class=\"line\"> *</span><br><span class=\"line\"> * author ck</span><br><span class=\"line\"> *</span><br><span class=\"line\"> * <span class=\"doctag\">@param</span> AphrontRequest $request</span><br><span class=\"line\"> * <span class=\"doctag\">@param</span> PhabricatorUser $viewer</span><br><span class=\"line\"> * <span class=\"doctag\">@param</span> PhabricatorProject $object</span><br><span class=\"line\"> * <span class=\"doctag\">@return</span> array</span><br><span class=\"line\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">saveProjectNotificationRule</span><span class=\"params\">(AphrontRequest $request, PhabricatorUser $viewer, PhabricatorProject $object)</span> </span>&#123;</span><br><span class=\"line\">  $adapter = HeraldAdapter::getAdapterForContentType(<span class=\"string\">'PhabricatorProjectHeraldAdapter'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 手动构造一个form请求</span></span><br><span class=\"line\">  $request_data = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">  $request_data[<span class=\"string\">'name'</span>] = <span class=\"string\">'herald_rule_for_'</span>.$object-&gt;getDisplayName();</span><br><span class=\"line\">  $request_data[<span class=\"string\">'must_match'</span>] = <span class=\"string\">'all'</span>;</span><br><span class=\"line\">  $request_data[<span class=\"string\">'repetition_policy'</span>] = <span class=\"string\">'every'</span>;</span><br><span class=\"line\">  $request_data[<span class=\"string\">'__csrf__'</span>] = $request-&gt;getRequestData()[<span class=\"string\">'__csrf__'</span>]; <span class=\"comment\">//保留token否则添加失败</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 手动构造一个通知规则</span></span><br><span class=\"line\">  $rule = <span class=\"keyword\">new</span> HeraldRule();</span><br><span class=\"line\">  $rule-&gt;setAuthorPHID($viewer-&gt;getPHID());</span><br><span class=\"line\">  $rule-&gt;setMustMatchAll(<span class=\"number\">1</span>);</span><br><span class=\"line\">  $rule-&gt;setContentType(<span class=\"string\">'PhabricatorProjectHeraldAdapter'</span>);</span><br><span class=\"line\">  $rule-&gt;setRuleType(<span class=\"string\">'global'</span>);</span><br><span class=\"line\">  $rule-&gt;setConfigVersion(<span class=\"number\">38</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  $rule_conditions = $rule-&gt;loadConditions();</span><br><span class=\"line\">  $rule_actions = $rule-&gt;loadActions();</span><br><span class=\"line\"></span><br><span class=\"line\">  $rule-&gt;attachConditions($rule_conditions);</span><br><span class=\"line\">  $rule-&gt;attachActions($rule_actions);</span><br><span class=\"line\">      </span><br><span class=\"line\">  $request-&gt;setRequestData($request_data);</span><br><span class=\"line\">  </span><br><span class=\"line\">  $new_name = $request-&gt;getStr(<span class=\"string\">'name'</span>);</span><br><span class=\"line\">  $match_all = ($request-&gt;getStr(<span class=\"string\">'must_match'</span>) == <span class=\"string\">'all'</span>);</span><br><span class=\"line\">  </span><br><span class=\"line\">  $repetition_policy_param = $request-&gt;getStr(<span class=\"string\">'repetition_policy'</span>);</span><br><span class=\"line\">  </span><br><span class=\"line\">  $e_name = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">  $errors = <span class=\"keyword\">array</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 手动插入规则信息</span></span><br><span class=\"line\">  $projectInfo = <span class=\"keyword\">array</span>($object-&gt;getPHID() =&gt; $object-&gt;getDisplayName());</span><br><span class=\"line\">  $data[<span class=\"string\">'conditions'</span>] = <span class=\"keyword\">array</span>(<span class=\"keyword\">array</span>(<span class=\"string\">\"projects.exact\"</span>,<span class=\"string\">\"any\"</span>,$projectInfo));</span><br><span class=\"line\">  $data[<span class=\"string\">'actions'</span>] = <span class=\"keyword\">array</span>(<span class=\"keyword\">array</span>(<span class=\"string\">\"email.other\"</span>, $projectInfo));</span><br><span class=\"line\"></span><br><span class=\"line\">  $conditions = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">  <span class=\"keyword\">foreach</span> ($data[<span class=\"string\">'conditions'</span>] <span class=\"keyword\">as</span> $condition) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> ($condition === <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">          <span class=\"comment\">// We manage this as a sparse array on the client, so may receive</span></span><br><span class=\"line\">          <span class=\"comment\">// NULL if conditions have been removed.</span></span><br><span class=\"line\">          <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      $obj = <span class=\"keyword\">new</span> HeraldCondition();</span><br><span class=\"line\">      $obj-&gt;setFieldName($condition[<span class=\"number\">0</span>]);</span><br><span class=\"line\">      $obj-&gt;setFieldCondition($condition[<span class=\"number\">1</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (is_array($condition[<span class=\"number\">2</span>])) &#123;</span><br><span class=\"line\">          $obj-&gt;setValue(array_keys($condition[<span class=\"number\">2</span>]));</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          $obj-&gt;setValue($condition[<span class=\"number\">2</span>]);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">          $adapter-&gt;willSaveCondition($obj);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (HeraldInvalidConditionException $ex) &#123;</span><br><span class=\"line\">          $errors[] = $ex-&gt;getMessage();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      $conditions[] = $obj;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  $actions = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">  <span class=\"keyword\">foreach</span> ($data[<span class=\"string\">'actions'</span>] <span class=\"keyword\">as</span> $action) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> ($action === <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">          <span class=\"comment\">// Sparse on the client; removals can give us NULLs.</span></span><br><span class=\"line\">          <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!<span class=\"keyword\">isset</span>($action[<span class=\"number\">1</span>])) &#123;</span><br><span class=\"line\">          <span class=\"comment\">// Legitimate for any action which doesn't need a target, like</span></span><br><span class=\"line\">          <span class=\"comment\">// \"Do nothing\".</span></span><br><span class=\"line\">          $action[<span class=\"number\">1</span>] = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      $obj = <span class=\"keyword\">new</span> HeraldActionRecord();</span><br><span class=\"line\">      $obj-&gt;setAction($action[<span class=\"number\">0</span>]);</span><br><span class=\"line\">      $obj-&gt;setTarget($action[<span class=\"number\">1</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">          $adapter-&gt;willSaveAction($rule, $obj);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (HeraldInvalidActionException $ex) &#123;</span><br><span class=\"line\">          $errors[] = $ex-&gt;getMessage();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      $actions[] = $obj;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!$errors) &#123;</span><br><span class=\"line\">      $new_state = id(<span class=\"keyword\">new</span> HeraldRuleSerializer())-&gt;serializeRuleComponents(</span><br><span class=\"line\">          $match_all,</span><br><span class=\"line\">          $conditions,</span><br><span class=\"line\">          $actions,</span><br><span class=\"line\">          $repetition_policy_param);</span><br><span class=\"line\"></span><br><span class=\"line\">      $xactions = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">      $xactions[] = id(<span class=\"keyword\">new</span> HeraldRuleTransaction())</span><br><span class=\"line\">      -&gt;setTransactionType(HeraldRuleTransaction::TYPE_EDIT)</span><br><span class=\"line\">      -&gt;setNewValue($new_state);</span><br><span class=\"line\">      $xactions[] = id(<span class=\"keyword\">new</span> HeraldRuleTransaction())</span><br><span class=\"line\">      -&gt;setTransactionType(HeraldRuleTransaction::TYPE_NAME)</span><br><span class=\"line\">      -&gt;setNewValue($new_name);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">          id(<span class=\"keyword\">new</span> HeraldRuleEditor())</span><br><span class=\"line\">          -&gt;setActor($viewer)</span><br><span class=\"line\">          -&gt;setContinueOnNoEffect(<span class=\"keyword\">true</span>)</span><br><span class=\"line\">          -&gt;setContentSourceFromRequest($request)</span><br><span class=\"line\">          -&gt;applyTransactions($rule, $xactions);</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"keyword\">array</span>(<span class=\"keyword\">null</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (<span class=\"keyword\">Exception</span> $ex) &#123;</span><br><span class=\"line\">          $errors[] = $ex-&gt;getMessage();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">array</span>($e_name, $errors);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在完成这个功能的时候具体需要了解 Herald 规则的具体创建过程，具体参考 <code>phabricator\\src\\applications\\herald\\controller\\HeraldRuleController.php</code> 中的 <code>saveRule</code> 方法。</p>\n<h2 id=\"遇到的问题\"><a href=\"#遇到的问题\" class=\"headerlink\" title=\"遇到的问题\"></a>遇到的问题</h2><p>在所有的工作快完成的时候遇到了如下的一个问题</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">You are trying to save some data to Phabricator, but the request your browser made included an incorrect token. Reload the page and try again. You may need to clear your cookies.</span><br><span class=\"line\">This was a Web request.</span><br><span class=\"line\">This request had no CSRF token.</span><br><span class=\"line\">To avoid this error, use phabricator_form() to construct forms. If you are already using phabricator_form(), make sure the form &apos;action&apos; uses a relative URI (i.e., begins with a &apos;/&apos;). Forms using absolute URIs do not include CSRF tokens, to prevent leaking tokens to external sites.</span><br><span class=\"line\"></span><br><span class=\"line\">If this page performs writes which do not require CSRF protection (usually, filling caches or logging), you can use AphrontWriteGuard::beginScopedUnguardedWrites() to temporarily bypass CSRF protection while writing. You should use this only for writes which can not be protected with normal CSRF mechanisms.</span><br><span class=\"line\"></span><br><span class=\"line\">Some UI elements (like PhabricatorActionListView) also have methods which will allow you to render links as forms (like setRenderAsForm(true)).</span><br></pre></td></tr></table></figure>\n<p>具体出现在</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">  id(<span class=\"keyword\">new</span> HeraldRuleEditor())</span><br><span class=\"line\">  -&gt;setActor($viewer)</span><br><span class=\"line\">  -&gt;setContinueOnNoEffect(<span class=\"keyword\">true</span>)</span><br><span class=\"line\">  -&gt;setContentSourceFromRequest($request)</span><br><span class=\"line\">  -&gt;applyTransactions($rule, $xactions);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">array</span>(<span class=\"keyword\">null</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (<span class=\"keyword\">Exception</span> $ex) &#123;</span><br><span class=\"line\">  $errors[] = $ex-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>找了很多地方，最终发现 <code>$request</code> 对象的 <code>$request_data</code> 数组中缺少了 <code>__csrf__</code>, 通过如下的方式加上后不再报错</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$request_data[<span class=\"string\">'__csrf__'</span>] = $request-&gt;getRequestData()[<span class=\"string\">'__csrf__'</span>]; <span class=\"comment\">//保留token否则添加失败</span></span><br></pre></td></tr></table></figure>\n<p>本人猜测这个属性在保存对象的时候与请求绑定，并不与具体的对象绑定，因为这个请求是本来是用来保存项目对象的。</p>\n<h2 id=\"具体的代码\"><a href=\"#具体的代码\" class=\"headerlink\" title=\"具体的代码\"></a>具体的代码</h2><ul>\n<li><a href=\"https://github.com/toulezu/phabricator/commit/99ac508712b39e316ce07597acc6208b3b6193dc\">提交</a></li>\n</ul>\n"},{"title":"Swagger2 在 SpringMVC 项目中的应用","title_url":"Swagger2-SpringMVC","date":"2017-06-13T16:00:00.000Z","description":"Swagger2 在 SpringMVC 项目中的应用","_content":"\n## 添加 Maven 依赖\n\n```xml\n<dependency>\n\t<groupId>io.springfox</groupId>\n\t<artifactId>springfox-swagger2</artifactId>\n\t<version>2.5.0</version>\n</dependency> \n<dependency>\n\t<groupId>io.springfox</groupId>\n\t<artifactId>springfox-swagger-ui</artifactId>\n\t<version>2.5.0</version>\n</dependency>\n\n<dependency>\n\t<groupId>com.fasterxml.jackson.core</groupId>\n\t<artifactId>jackson-annotations</artifactId>\n\t<version>2.7.4</version>\n</dependency>\n<dependency>\n\t<groupId>com.fasterxml.jackson.core</groupId>\n\t<artifactId>jackson-databind</artifactId>\n\t<version>2.7.4</version>\n</dependency>\n<dependency>\n\t<groupId>com.fasterxml.jackson.core</groupId>\n\t<artifactId>jackson-core</artifactId>\n\t<version>2.7.4</version>\n</dependency>\n```\n\n其中 `springfox-swagger2` 用于在访问 `http://myapp/v2/api-docs` 时生成API的 json 数据, `springfox-swagger-ui`则用于将 json 数据以 HTML 的形式将API展示出来,便于在线调试. \n\n`v2/api-docs` 这个路径定义在 `springfox-swagger2` 项目中的 [Swagger2Controller](https://github.com/springfox/springfox/blob/master/springfox-swagger2/src/main/java/springfox/documentation/swagger2/web/Swagger2Controller.java) 类中, 每次访问 `http://myapp/v2/api-docs` 都将生成一个 Swagger 对象,并使用 jackson 的 ObjectMapper 对象将 Swagger 对象转成 json 返回给浏览器,因此这里也要添加 jackson 的相关依赖.\n\nspringfox 的相关仓库地址如下\n\n- Release\n\n```xml\n<repositories>\n    <repository>\n      <id>jcenter-Release</id>\n      <name>jcenter</name>\n      <url>https://jcenter.bintray.com/</url>\n    </repository>\n</repositories>\n```\n\n- Snapshots\n\n```xml\n<repositories>\n    <repository>\n      <id>jcenter-snapshots</id>\n      <name>jcenter</name>\n      <url>http://oss.jfrog.org/artifactory/oss-snapshot-local/</url>\n    </repository>\n</repositories>\n```\n\n## 添加 SwaggerConfig 配置类\n\n```java\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.ComponentScan;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.web.servlet.config.annotation.EnableWebMvc;\n\nimport com.ckjava.test.web.ApiController;\n\nimport io.swagger.annotations.Api;\nimport springfox.documentation.builders.ApiInfoBuilder;\nimport springfox.documentation.builders.PathSelectors;\nimport springfox.documentation.builders.RequestHandlerSelectors;\nimport springfox.documentation.service.ApiInfo;\nimport springfox.documentation.spi.DocumentationType;\nimport springfox.documentation.spring.web.plugins.Docket;\nimport springfox.documentation.swagger2.annotations.EnableSwagger2;\n\n@Configuration\n@EnableWebMvc\n@EnableSwagger2\n/* @ComponentScan(basePackageClasses = { ApiController.class }) */\n@ComponentScan(basePackages = \"com.ckjava.test.web\")\npublic class SwaggerConfig {\n\n    @Bean\n    public Docket api(){\n        return new Docket(DocumentationType.SWAGGER_2)\n            .select()\n            .apis(RequestHandlerSelectors.withClassAnnotation(Api.class))\n            .paths(PathSelectors.any())\n            .build()\n            .apiInfo(apiInfo());\n    }\n\n    private ApiInfo apiInfo() {\n        return new ApiInfoBuilder()\n            .title(\"TITLE\")\n            .description(\"DESCRIPTION\")\n            .version(\"VERSION\")\n            .termsOfServiceUrl(\"http://terms-of-services.url\")\n            .license(\"LICENSE\")\n            .licenseUrl(\"http://url-to-license.com\")\n            .build();\n    }\n\n}\n```\n\n- 其中 `@ComponentScan(basePackages = \"com.ckjava.test.web\")` 指出 `@Controller` 类所在的包名.\n- 也可以通过 `@ComponentScan(basePackageClasses = { ApiController.class })` 指出具体的 `@Controller` 类\n- 其中 `RequestHandlerSelectors.withClassAnnotation(Api.class)` 指出只扫描带有 `io.swagger.annotations.Api` 注解的类\n\n- WebAppConfig 配置类用于配置展示 Swagger 的 UI, 具体如下\n\n```java\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.web.servlet.config.annotation.EnableWebMvc;\nimport org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;\nimport org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;\n\n@Configuration\n@EnableWebMvc\npublic class WebAppConfig extends WebMvcConfigurerAdapter {\n\n    @Override \n    public void addResourceHandlers(ResourceHandlerRegistry registry) {\n        registry.addResourceHandler(\"swagger-ui.html\").addResourceLocations(\"classpath:/META-INF/resources/\");\n        registry.addResourceHandler(\"/webjars/**\").addResourceLocations(\"classpath:/META-INF/resources/webjars/\");\n    }\n\n}\n```\n\n- 等项目启动后可以通过 `http://myapp/swagger-ui.html` 访问到开放的API\n\n## 可能遇到的问题\n\n- 项目启动中遇到 `java.lang.NoClassDefFoundError: com/fasterxml/classmate/members/ResolvedParameterizedMember` 异常\n\n原因如下:\n由于在 springfox-swagger2 中依赖了 classmate-1.3.1.jar 而项目中使用了 hibernate-validator 其中又依赖了 classmate-1.0.0.jar,需要在 hibernate-validator 排除 classmate 依赖\n\n解决如下:\n```xml\n<dependency>\n\t<groupId>org.hibernate</groupId>\n\t<artifactId>hibernate-validator</artifactId>\n\t<version>${validator.version}</version>\n\t<exclusions>\n\t\t<exclusion>\n\t\t\t<groupId>com.fasterxml</groupId>\n\t\t\t<artifactId>classmate</artifactId>\n\t\t</exclusion>\n\t</exclusions>\n</dependency>\n```\n\n## 使用的Demo\n\n- [plainWebApi](https://github.com/toulezu/play/tree/master/plainWebApi)\n\n## 参考\n\n- [A 'simple' way to implement Swagger in a Spring MVC application](https://stackoverflow.com/questions/26720090/a-simple-way-to-implement-swagger-in-a-spring-mvc-application)\n- [springfox docs](http://springfox.github.io/springfox/docs/current/)\n","source":"_posts/Swagger2 在 SpringMVC 项目中的应用.md","raw":"---\ntitle: Swagger2 在 SpringMVC 项目中的应用\ntitle_url: Swagger2-SpringMVC\ndate: 2017-06-14\ntags: [Swagger2,SpringMVC]\ncategories: 技术\ndescription: Swagger2 在 SpringMVC 项目中的应用\n---\n\n## 添加 Maven 依赖\n\n```xml\n<dependency>\n\t<groupId>io.springfox</groupId>\n\t<artifactId>springfox-swagger2</artifactId>\n\t<version>2.5.0</version>\n</dependency> \n<dependency>\n\t<groupId>io.springfox</groupId>\n\t<artifactId>springfox-swagger-ui</artifactId>\n\t<version>2.5.0</version>\n</dependency>\n\n<dependency>\n\t<groupId>com.fasterxml.jackson.core</groupId>\n\t<artifactId>jackson-annotations</artifactId>\n\t<version>2.7.4</version>\n</dependency>\n<dependency>\n\t<groupId>com.fasterxml.jackson.core</groupId>\n\t<artifactId>jackson-databind</artifactId>\n\t<version>2.7.4</version>\n</dependency>\n<dependency>\n\t<groupId>com.fasterxml.jackson.core</groupId>\n\t<artifactId>jackson-core</artifactId>\n\t<version>2.7.4</version>\n</dependency>\n```\n\n其中 `springfox-swagger2` 用于在访问 `http://myapp/v2/api-docs` 时生成API的 json 数据, `springfox-swagger-ui`则用于将 json 数据以 HTML 的形式将API展示出来,便于在线调试. \n\n`v2/api-docs` 这个路径定义在 `springfox-swagger2` 项目中的 [Swagger2Controller](https://github.com/springfox/springfox/blob/master/springfox-swagger2/src/main/java/springfox/documentation/swagger2/web/Swagger2Controller.java) 类中, 每次访问 `http://myapp/v2/api-docs` 都将生成一个 Swagger 对象,并使用 jackson 的 ObjectMapper 对象将 Swagger 对象转成 json 返回给浏览器,因此这里也要添加 jackson 的相关依赖.\n\nspringfox 的相关仓库地址如下\n\n- Release\n\n```xml\n<repositories>\n    <repository>\n      <id>jcenter-Release</id>\n      <name>jcenter</name>\n      <url>https://jcenter.bintray.com/</url>\n    </repository>\n</repositories>\n```\n\n- Snapshots\n\n```xml\n<repositories>\n    <repository>\n      <id>jcenter-snapshots</id>\n      <name>jcenter</name>\n      <url>http://oss.jfrog.org/artifactory/oss-snapshot-local/</url>\n    </repository>\n</repositories>\n```\n\n## 添加 SwaggerConfig 配置类\n\n```java\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.ComponentScan;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.web.servlet.config.annotation.EnableWebMvc;\n\nimport com.ckjava.test.web.ApiController;\n\nimport io.swagger.annotations.Api;\nimport springfox.documentation.builders.ApiInfoBuilder;\nimport springfox.documentation.builders.PathSelectors;\nimport springfox.documentation.builders.RequestHandlerSelectors;\nimport springfox.documentation.service.ApiInfo;\nimport springfox.documentation.spi.DocumentationType;\nimport springfox.documentation.spring.web.plugins.Docket;\nimport springfox.documentation.swagger2.annotations.EnableSwagger2;\n\n@Configuration\n@EnableWebMvc\n@EnableSwagger2\n/* @ComponentScan(basePackageClasses = { ApiController.class }) */\n@ComponentScan(basePackages = \"com.ckjava.test.web\")\npublic class SwaggerConfig {\n\n    @Bean\n    public Docket api(){\n        return new Docket(DocumentationType.SWAGGER_2)\n            .select()\n            .apis(RequestHandlerSelectors.withClassAnnotation(Api.class))\n            .paths(PathSelectors.any())\n            .build()\n            .apiInfo(apiInfo());\n    }\n\n    private ApiInfo apiInfo() {\n        return new ApiInfoBuilder()\n            .title(\"TITLE\")\n            .description(\"DESCRIPTION\")\n            .version(\"VERSION\")\n            .termsOfServiceUrl(\"http://terms-of-services.url\")\n            .license(\"LICENSE\")\n            .licenseUrl(\"http://url-to-license.com\")\n            .build();\n    }\n\n}\n```\n\n- 其中 `@ComponentScan(basePackages = \"com.ckjava.test.web\")` 指出 `@Controller` 类所在的包名.\n- 也可以通过 `@ComponentScan(basePackageClasses = { ApiController.class })` 指出具体的 `@Controller` 类\n- 其中 `RequestHandlerSelectors.withClassAnnotation(Api.class)` 指出只扫描带有 `io.swagger.annotations.Api` 注解的类\n\n- WebAppConfig 配置类用于配置展示 Swagger 的 UI, 具体如下\n\n```java\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.web.servlet.config.annotation.EnableWebMvc;\nimport org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;\nimport org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;\n\n@Configuration\n@EnableWebMvc\npublic class WebAppConfig extends WebMvcConfigurerAdapter {\n\n    @Override \n    public void addResourceHandlers(ResourceHandlerRegistry registry) {\n        registry.addResourceHandler(\"swagger-ui.html\").addResourceLocations(\"classpath:/META-INF/resources/\");\n        registry.addResourceHandler(\"/webjars/**\").addResourceLocations(\"classpath:/META-INF/resources/webjars/\");\n    }\n\n}\n```\n\n- 等项目启动后可以通过 `http://myapp/swagger-ui.html` 访问到开放的API\n\n## 可能遇到的问题\n\n- 项目启动中遇到 `java.lang.NoClassDefFoundError: com/fasterxml/classmate/members/ResolvedParameterizedMember` 异常\n\n原因如下:\n由于在 springfox-swagger2 中依赖了 classmate-1.3.1.jar 而项目中使用了 hibernate-validator 其中又依赖了 classmate-1.0.0.jar,需要在 hibernate-validator 排除 classmate 依赖\n\n解决如下:\n```xml\n<dependency>\n\t<groupId>org.hibernate</groupId>\n\t<artifactId>hibernate-validator</artifactId>\n\t<version>${validator.version}</version>\n\t<exclusions>\n\t\t<exclusion>\n\t\t\t<groupId>com.fasterxml</groupId>\n\t\t\t<artifactId>classmate</artifactId>\n\t\t</exclusion>\n\t</exclusions>\n</dependency>\n```\n\n## 使用的Demo\n\n- [plainWebApi](https://github.com/toulezu/play/tree/master/plainWebApi)\n\n## 参考\n\n- [A 'simple' way to implement Swagger in a Spring MVC application](https://stackoverflow.com/questions/26720090/a-simple-way-to-implement-swagger-in-a-spring-mvc-application)\n- [springfox docs](http://springfox.github.io/springfox/docs/current/)\n","slug":"Swagger2 在 SpringMVC 项目中的应用","published":1,"updated":"2017-06-15T02:53:37.230Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj5jgsbdu000d2cez7sngc8zy","content":"<h2 id=\"添加-Maven-依赖\"><a href=\"#添加-Maven-依赖\" class=\"headerlink\" title=\"添加 Maven 依赖\"></a>添加 Maven 依赖</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>io.springfox<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>springfox-swagger2<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.5.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>io.springfox<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>springfox-swagger-ui<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.5.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jackson-annotations<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.7.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jackson-databind<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.7.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jackson-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.7.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>其中 <code>springfox-swagger2</code> 用于在访问 <code>http://myapp/v2/api-docs</code> 时生成API的 json 数据, <code>springfox-swagger-ui</code>则用于将 json 数据以 HTML 的形式将API展示出来,便于在线调试. </p>\n<p><code>v2/api-docs</code> 这个路径定义在 <code>springfox-swagger2</code> 项目中的 <a href=\"https://github.com/springfox/springfox/blob/master/springfox-swagger2/src/main/java/springfox/documentation/swagger2/web/Swagger2Controller.java\" target=\"_blank\" rel=\"external\">Swagger2Controller</a> 类中, 每次访问 <code>http://myapp/v2/api-docs</code> 都将生成一个 Swagger 对象,并使用 jackson 的 ObjectMapper 对象将 Swagger 对象转成 json 返回给浏览器,因此这里也要添加 jackson 的相关依赖.</p>\n<p>springfox 的相关仓库地址如下</p>\n<ul>\n<li>Release</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>jcenter-Release<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>jcenter<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://jcenter.bintray.com/<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">repositories</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>Snapshots</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>jcenter-snapshots<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>jcenter<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>http://oss.jfrog.org/artifactory/oss-snapshot-local/<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">repositories</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"添加-SwaggerConfig-配置类\"><a href=\"#添加-SwaggerConfig-配置类\" class=\"headerlink\" title=\"添加 SwaggerConfig 配置类\"></a>添加 SwaggerConfig 配置类</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.config.annotation.EnableWebMvc;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.ckjava.test.web.ApiController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> io.swagger.annotations.Api;</span><br><span class=\"line\"><span class=\"keyword\">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class=\"line\"><span class=\"keyword\">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class=\"line\"><span class=\"keyword\">import</span> springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class=\"line\"><span class=\"keyword\">import</span> springfox.documentation.service.ApiInfo;</span><br><span class=\"line\"><span class=\"keyword\">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class=\"line\"><span class=\"keyword\">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class=\"line\"><span class=\"keyword\">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@EnableWebMvc</span></span><br><span class=\"line\"><span class=\"meta\">@EnableSwagger</span>2</span><br><span class=\"line\"><span class=\"comment\">/* @ComponentScan(basePackageClasses = &#123; ApiController.class &#125;) */</span></span><br><span class=\"line\"><span class=\"meta\">@ComponentScan</span>(basePackages = <span class=\"string\">\"com.ckjava.test.web\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SwaggerConfig</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Docket <span class=\"title\">api</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class=\"line\">            .select()</span><br><span class=\"line\">            .apis(RequestHandlerSelectors.withClassAnnotation(Api.class))</span><br><span class=\"line\">            .paths(PathSelectors.any())</span><br><span class=\"line\">            .build()</span><br><span class=\"line\">            .apiInfo(apiInfo());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> ApiInfo <span class=\"title\">apiInfo</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ApiInfoBuilder()</span><br><span class=\"line\">            .title(<span class=\"string\">\"TITLE\"</span>)</span><br><span class=\"line\">            .description(<span class=\"string\">\"DESCRIPTION\"</span>)</span><br><span class=\"line\">            .version(<span class=\"string\">\"VERSION\"</span>)</span><br><span class=\"line\">            .termsOfServiceUrl(<span class=\"string\">\"http://terms-of-services.url\"</span>)</span><br><span class=\"line\">            .license(<span class=\"string\">\"LICENSE\"</span>)</span><br><span class=\"line\">            .licenseUrl(<span class=\"string\">\"http://url-to-license.com\"</span>)</span><br><span class=\"line\">            .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>其中 <code>@ComponentScan(basePackages = &quot;com.ckjava.test.web&quot;)</code> 指出 <code>@Controller</code> 类所在的包名.</li>\n<li>也可以通过 <code>@ComponentScan(basePackageClasses = { ApiController.class })</code> 指出具体的 <code>@Controller</code> 类</li>\n<li><p>其中 <code>RequestHandlerSelectors.withClassAnnotation(Api.class)</code> 指出只扫描带有 <code>io.swagger.annotations.Api</code> 注解的类</p>\n</li>\n<li><p>WebAppConfig 配置类用于配置展示 Swagger 的 UI, 具体如下</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.config.annotation.EnableWebMvc;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@EnableWebMvc</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WebAppConfig</span> <span class=\"keyword\">extends</span> <span class=\"title\">WebMvcConfigurerAdapter</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span> </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">addResourceHandlers</span><span class=\"params\">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class=\"line\">        registry.addResourceHandler(<span class=\"string\">\"swagger-ui.html\"</span>).addResourceLocations(<span class=\"string\">\"classpath:/META-INF/resources/\"</span>);</span><br><span class=\"line\">        registry.addResourceHandler(<span class=\"string\">\"/webjars/**\"</span>).addResourceLocations(<span class=\"string\">\"classpath:/META-INF/resources/webjars/\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>等项目启动后可以通过 <code>http://myapp/swagger-ui.html</code> 访问到开放的API</li>\n</ul>\n<h2 id=\"可能遇到的问题\"><a href=\"#可能遇到的问题\" class=\"headerlink\" title=\"可能遇到的问题\"></a>可能遇到的问题</h2><ul>\n<li>项目启动中遇到 <code>java.lang.NoClassDefFoundError: com/fasterxml/classmate/members/ResolvedParameterizedMember</code> 异常</li>\n</ul>\n<p>原因如下:<br>由于在 springfox-swagger2 中依赖了 classmate-1.3.1.jar 而项目中使用了 hibernate-validator 其中又依赖了 classmate-1.0.0.jar,需要在 hibernate-validator 排除 classmate 依赖</p>\n<p>解决如下:<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.hibernate<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>hibernate-validator<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;validator.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fasterxml<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>classmate<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"使用的Demo\"><a href=\"#使用的Demo\" class=\"headerlink\" title=\"使用的Demo\"></a>使用的Demo</h2><ul>\n<li><a href=\"https://github.com/toulezu/play/tree/master/plainWebApi\" target=\"_blank\" rel=\"external\">plainWebApi</a></li>\n</ul>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ul>\n<li><a href=\"https://stackoverflow.com/questions/26720090/a-simple-way-to-implement-swagger-in-a-spring-mvc-application\" target=\"_blank\" rel=\"external\">A ‘simple’ way to implement Swagger in a Spring MVC application</a></li>\n<li><a href=\"http://springfox.github.io/springfox/docs/current/\" target=\"_blank\" rel=\"external\">springfox docs</a></li>\n</ul>\n","excerpt":"","more":"<h2 id=\"添加-Maven-依赖\"><a href=\"#添加-Maven-依赖\" class=\"headerlink\" title=\"添加 Maven 依赖\"></a>添加 Maven 依赖</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>io.springfox<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>springfox-swagger2<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.5.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>io.springfox<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>springfox-swagger-ui<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.5.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jackson-annotations<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.7.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jackson-databind<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.7.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jackson-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.7.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>其中 <code>springfox-swagger2</code> 用于在访问 <code>http://myapp/v2/api-docs</code> 时生成API的 json 数据, <code>springfox-swagger-ui</code>则用于将 json 数据以 HTML 的形式将API展示出来,便于在线调试. </p>\n<p><code>v2/api-docs</code> 这个路径定义在 <code>springfox-swagger2</code> 项目中的 <a href=\"https://github.com/springfox/springfox/blob/master/springfox-swagger2/src/main/java/springfox/documentation/swagger2/web/Swagger2Controller.java\">Swagger2Controller</a> 类中, 每次访问 <code>http://myapp/v2/api-docs</code> 都将生成一个 Swagger 对象,并使用 jackson 的 ObjectMapper 对象将 Swagger 对象转成 json 返回给浏览器,因此这里也要添加 jackson 的相关依赖.</p>\n<p>springfox 的相关仓库地址如下</p>\n<ul>\n<li>Release</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>jcenter-Release<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>jcenter<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://jcenter.bintray.com/<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">repositories</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>Snapshots</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>jcenter-snapshots<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>jcenter<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>http://oss.jfrog.org/artifactory/oss-snapshot-local/<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">repositories</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"添加-SwaggerConfig-配置类\"><a href=\"#添加-SwaggerConfig-配置类\" class=\"headerlink\" title=\"添加 SwaggerConfig 配置类\"></a>添加 SwaggerConfig 配置类</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.config.annotation.EnableWebMvc;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.ckjava.test.web.ApiController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> io.swagger.annotations.Api;</span><br><span class=\"line\"><span class=\"keyword\">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class=\"line\"><span class=\"keyword\">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class=\"line\"><span class=\"keyword\">import</span> springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class=\"line\"><span class=\"keyword\">import</span> springfox.documentation.service.ApiInfo;</span><br><span class=\"line\"><span class=\"keyword\">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class=\"line\"><span class=\"keyword\">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class=\"line\"><span class=\"keyword\">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@EnableWebMvc</span></span><br><span class=\"line\"><span class=\"meta\">@EnableSwagger</span>2</span><br><span class=\"line\"><span class=\"comment\">/* @ComponentScan(basePackageClasses = &#123; ApiController.class &#125;) */</span></span><br><span class=\"line\"><span class=\"meta\">@ComponentScan</span>(basePackages = <span class=\"string\">\"com.ckjava.test.web\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SwaggerConfig</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Docket <span class=\"title\">api</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class=\"line\">            .select()</span><br><span class=\"line\">            .apis(RequestHandlerSelectors.withClassAnnotation(Api.class))</span><br><span class=\"line\">            .paths(PathSelectors.any())</span><br><span class=\"line\">            .build()</span><br><span class=\"line\">            .apiInfo(apiInfo());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> ApiInfo <span class=\"title\">apiInfo</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ApiInfoBuilder()</span><br><span class=\"line\">            .title(<span class=\"string\">\"TITLE\"</span>)</span><br><span class=\"line\">            .description(<span class=\"string\">\"DESCRIPTION\"</span>)</span><br><span class=\"line\">            .version(<span class=\"string\">\"VERSION\"</span>)</span><br><span class=\"line\">            .termsOfServiceUrl(<span class=\"string\">\"http://terms-of-services.url\"</span>)</span><br><span class=\"line\">            .license(<span class=\"string\">\"LICENSE\"</span>)</span><br><span class=\"line\">            .licenseUrl(<span class=\"string\">\"http://url-to-license.com\"</span>)</span><br><span class=\"line\">            .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>其中 <code>@ComponentScan(basePackages = &quot;com.ckjava.test.web&quot;)</code> 指出 <code>@Controller</code> 类所在的包名.</li>\n<li>也可以通过 <code>@ComponentScan(basePackageClasses = { ApiController.class })</code> 指出具体的 <code>@Controller</code> 类</li>\n<li><p>其中 <code>RequestHandlerSelectors.withClassAnnotation(Api.class)</code> 指出只扫描带有 <code>io.swagger.annotations.Api</code> 注解的类</p>\n</li>\n<li><p>WebAppConfig 配置类用于配置展示 Swagger 的 UI, 具体如下</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.config.annotation.EnableWebMvc;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@EnableWebMvc</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WebAppConfig</span> <span class=\"keyword\">extends</span> <span class=\"title\">WebMvcConfigurerAdapter</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span> </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">addResourceHandlers</span><span class=\"params\">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class=\"line\">        registry.addResourceHandler(<span class=\"string\">\"swagger-ui.html\"</span>).addResourceLocations(<span class=\"string\">\"classpath:/META-INF/resources/\"</span>);</span><br><span class=\"line\">        registry.addResourceHandler(<span class=\"string\">\"/webjars/**\"</span>).addResourceLocations(<span class=\"string\">\"classpath:/META-INF/resources/webjars/\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>等项目启动后可以通过 <code>http://myapp/swagger-ui.html</code> 访问到开放的API</li>\n</ul>\n<h2 id=\"可能遇到的问题\"><a href=\"#可能遇到的问题\" class=\"headerlink\" title=\"可能遇到的问题\"></a>可能遇到的问题</h2><ul>\n<li>项目启动中遇到 <code>java.lang.NoClassDefFoundError: com/fasterxml/classmate/members/ResolvedParameterizedMember</code> 异常</li>\n</ul>\n<p>原因如下:<br>由于在 springfox-swagger2 中依赖了 classmate-1.3.1.jar 而项目中使用了 hibernate-validator 其中又依赖了 classmate-1.0.0.jar,需要在 hibernate-validator 排除 classmate 依赖</p>\n<p>解决如下:<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.hibernate<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>hibernate-validator<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;validator.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fasterxml<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>classmate<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"使用的Demo\"><a href=\"#使用的Demo\" class=\"headerlink\" title=\"使用的Demo\"></a>使用的Demo</h2><ul>\n<li><a href=\"https://github.com/toulezu/play/tree/master/plainWebApi\">plainWebApi</a></li>\n</ul>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ul>\n<li><a href=\"https://stackoverflow.com/questions/26720090/a-simple-way-to-implement-swagger-in-a-spring-mvc-application\">A ‘simple’ way to implement Swagger in a Spring MVC application</a></li>\n<li><a href=\"http://springfox.github.io/springfox/docs/current/\">springfox docs</a></li>\n</ul>\n"},{"title":"一个从 Jar 文件中获取所有的类路径的工具类","title_url":"load-jar-file-class","date":"2016-11-16T16:00:00.000Z","description":"一个从 Jar 文件中获取所有的类路径的工具类","_content":"\n```java\nimport java.io.File;\nimport java.io.IOException;\nimport java.lang.reflect.Modifier;\nimport java.util.ArrayList;\nimport java.util.Enumeration;\nimport java.util.List;\nimport java.util.Set;\nimport java.util.TreeSet;\nimport java.util.zip.ZipEntry;\nimport java.util.zip.ZipFile;\n\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\n/**\n * 关于类的工具类\n * 参考 @see org.apache.jorphan.reflect.ClassFinder\n * \n * @author chen_k\n *\n * 2016年11月17日-上午10:30:59\n */\npublic class ClassUtil {\n\t\n\tprivate static final Logger log = LoggerFactory.getLogger(ClassUtil.class);\n\t\n\tprivate static final String DOT_CLASS = \".class\";\n\tprivate static final int DOT_CLASS_LEN = DOT_CLASS.length();\n\n\t/**\n\t * 从指定的 jar 文件中获取类的路径列表\n\t * @param jarFile File jar 文件对象\n\t * @param parents Class<?>[] 继承或者实现的接口\n\t * @param inner 是否包含内部类\n\t * @param contain 类路径中含有的字符串，比如 .function.\n\t * @param notContain 类路径中不含有的字符串 .gui.\n\t * @return List<String>\n\t * @throws IOException\n\t */\n\tpublic static List<String> getClassList(File jarFile, Class<?>[] parents, boolean inner, String contain, String notContain) throws IOException {\n\t\tSet<String> listClasses = new TreeSet<>();\n\n\t\tZipFile zipFile = null;\n\t\ttry {\n\t\t\tzipFile = new ZipFile(jarFile);\n\t\t\tEnumeration<? extends ZipEntry> entries = zipFile.entries();\n\t\t\twhile (entries.hasMoreElements()) {\n\t\t\t\tString strEntry = entries.nextElement().toString();\n\t\t\t\tif (strEntry.endsWith(DOT_CLASS)) {\n\t\t\t\t\tString fixedClassName = fixClassName(strEntry);\n\t\t\t\t\tif (accept(parents, fixedClassName, contain, notContain, inner)) {\n\t\t\t\t\t\tlistClasses.add(fixedClassName);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (IOException e) {\n\t\t\tthrow e;\n\t\t} finally {\n\t\t\tif (zipFile != null) {\n\t\t\t\ttry {\n\t\t\t\t\tzipFile.close();\n\t\t\t\t} catch (Exception e) {\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn new ArrayList<>(listClasses);\n\t}\n\t\n\tpublic static String fixClassName(String strClassName) {\n\t\tstrClassName = strClassName.replace('\\\\', '.');\n\t\tstrClassName = strClassName.replace('/', '.');\n\t\t// remove \".class\"\n\t\tstrClassName = strClassName.substring(0, strClassName.length() - DOT_CLASS_LEN);\n\t\treturn strClassName;\n\t}\n\n\tpublic static boolean accept(Class<?>[] parents, String className, String contains, String notContains,\n\t\t\tboolean inner) {\n\n\t\tif (contains != null && !className.contains(contains)) {\n\t\t\treturn false; // It does not contain a required string\n\t\t}\n\t\tif (notContains != null && className.contains(notContains)) {\n\t\t\treturn false; // It contains a banned string\n\t\t}\n\t\tif (!className.contains(\"$\") || inner) { // $NON-NLS-1$\n\t\t\tif (isChildOf(parents, className, Thread.currentThread().getContextClassLoader())) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic static boolean isChildOf(Class<?>[] parentClasses, String strClassName, ClassLoader contextClassLoader) {\n\t\t// might throw an exception, assume this is ignorable\n\t\ttry {\n\t\t\tClass<?> c = Class.forName(strClassName, false, contextClassLoader);\n\n\t\t\tif (!c.isInterface() && !Modifier.isAbstract(c.getModifiers())) {\n\t\t\t\tfor (Class<?> parentClass : parentClasses) {\n\t\t\t\t\tif (parentClass.isAssignableFrom(c)) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (UnsupportedClassVersionError | ClassNotFoundException | NoClassDefFoundError e) {\n\t\t\tlog.debug(e.getLocalizedMessage());\n\t\t}\n\t\treturn false;\n\t}\n\n}\n\n```\n\n比如 jar 文件在 `D:/soft/apache-jmeter-3.0/lib/ext/ApacheJMeter_functions.jar`\n``` java\nList<String> classes = ClassUtil.getClassList(new File(\"D:/soft/apache-jmeter-3.0/lib/ext/ApacheJMeter_functions.jar\"), new Class[] { Function.class }, true, \".functions.\", \".gui.\");\n// Function.class 是 org.apache.jmeter.functions.Function\n```\n\n打印 classes，输出如下：\n```\norg.apache.jmeter.functions.BeanShell\norg.apache.jmeter.functions.CSVRead\norg.apache.jmeter.functions.CharFunction\norg.apache.jmeter.functions.EscapeHtml\norg.apache.jmeter.functions.EscapeOroRegexpChars\norg.apache.jmeter.functions.EvalFunction\norg.apache.jmeter.functions.EvalVarFunction\norg.apache.jmeter.functions.FileToString\norg.apache.jmeter.functions.IntSum\norg.apache.jmeter.functions.IterationCounter\norg.apache.jmeter.functions.JavaScript\norg.apache.jmeter.functions.Jexl2Function\norg.apache.jmeter.functions.Jexl3Function\norg.apache.jmeter.functions.JexlFunction\norg.apache.jmeter.functions.LogFunction\norg.apache.jmeter.functions.LogFunction2\norg.apache.jmeter.functions.LongSum\norg.apache.jmeter.functions.MachineIP\norg.apache.jmeter.functions.MachineName\norg.apache.jmeter.functions.Property\norg.apache.jmeter.functions.Property2\norg.apache.jmeter.functions.Random\norg.apache.jmeter.functions.RandomString\norg.apache.jmeter.functions.RegexFunction\norg.apache.jmeter.functions.SamplerName\norg.apache.jmeter.functions.SetProperty\norg.apache.jmeter.functions.SplitFunction\norg.apache.jmeter.functions.StringFromFile\norg.apache.jmeter.functions.TestPlanName\norg.apache.jmeter.functions.ThreadNumber\norg.apache.jmeter.functions.TimeFunction\norg.apache.jmeter.functions.UnEscape\norg.apache.jmeter.functions.UnEscapeHtml\norg.apache.jmeter.functions.UrlDecode\norg.apache.jmeter.functions.UrlEncode\norg.apache.jmeter.functions.Uuid\norg.apache.jmeter.functions.Variable\norg.apache.jmeter.functions.XPath\n```","source":"_posts/一个从 Jar 文件中获取所有的类路径的工具类.md","raw":"---\ntitle: 一个从 Jar 文件中获取所有的类路径的工具类\ntitle_url: load-jar-file-class\ndate: 2016-11-17\ntags: [Java]\ncategories: 技术\ndescription: 一个从 Jar 文件中获取所有的类路径的工具类\n---\n\n```java\nimport java.io.File;\nimport java.io.IOException;\nimport java.lang.reflect.Modifier;\nimport java.util.ArrayList;\nimport java.util.Enumeration;\nimport java.util.List;\nimport java.util.Set;\nimport java.util.TreeSet;\nimport java.util.zip.ZipEntry;\nimport java.util.zip.ZipFile;\n\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\n/**\n * 关于类的工具类\n * 参考 @see org.apache.jorphan.reflect.ClassFinder\n * \n * @author chen_k\n *\n * 2016年11月17日-上午10:30:59\n */\npublic class ClassUtil {\n\t\n\tprivate static final Logger log = LoggerFactory.getLogger(ClassUtil.class);\n\t\n\tprivate static final String DOT_CLASS = \".class\";\n\tprivate static final int DOT_CLASS_LEN = DOT_CLASS.length();\n\n\t/**\n\t * 从指定的 jar 文件中获取类的路径列表\n\t * @param jarFile File jar 文件对象\n\t * @param parents Class<?>[] 继承或者实现的接口\n\t * @param inner 是否包含内部类\n\t * @param contain 类路径中含有的字符串，比如 .function.\n\t * @param notContain 类路径中不含有的字符串 .gui.\n\t * @return List<String>\n\t * @throws IOException\n\t */\n\tpublic static List<String> getClassList(File jarFile, Class<?>[] parents, boolean inner, String contain, String notContain) throws IOException {\n\t\tSet<String> listClasses = new TreeSet<>();\n\n\t\tZipFile zipFile = null;\n\t\ttry {\n\t\t\tzipFile = new ZipFile(jarFile);\n\t\t\tEnumeration<? extends ZipEntry> entries = zipFile.entries();\n\t\t\twhile (entries.hasMoreElements()) {\n\t\t\t\tString strEntry = entries.nextElement().toString();\n\t\t\t\tif (strEntry.endsWith(DOT_CLASS)) {\n\t\t\t\t\tString fixedClassName = fixClassName(strEntry);\n\t\t\t\t\tif (accept(parents, fixedClassName, contain, notContain, inner)) {\n\t\t\t\t\t\tlistClasses.add(fixedClassName);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (IOException e) {\n\t\t\tthrow e;\n\t\t} finally {\n\t\t\tif (zipFile != null) {\n\t\t\t\ttry {\n\t\t\t\t\tzipFile.close();\n\t\t\t\t} catch (Exception e) {\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn new ArrayList<>(listClasses);\n\t}\n\t\n\tpublic static String fixClassName(String strClassName) {\n\t\tstrClassName = strClassName.replace('\\\\', '.');\n\t\tstrClassName = strClassName.replace('/', '.');\n\t\t// remove \".class\"\n\t\tstrClassName = strClassName.substring(0, strClassName.length() - DOT_CLASS_LEN);\n\t\treturn strClassName;\n\t}\n\n\tpublic static boolean accept(Class<?>[] parents, String className, String contains, String notContains,\n\t\t\tboolean inner) {\n\n\t\tif (contains != null && !className.contains(contains)) {\n\t\t\treturn false; // It does not contain a required string\n\t\t}\n\t\tif (notContains != null && className.contains(notContains)) {\n\t\t\treturn false; // It contains a banned string\n\t\t}\n\t\tif (!className.contains(\"$\") || inner) { // $NON-NLS-1$\n\t\t\tif (isChildOf(parents, className, Thread.currentThread().getContextClassLoader())) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic static boolean isChildOf(Class<?>[] parentClasses, String strClassName, ClassLoader contextClassLoader) {\n\t\t// might throw an exception, assume this is ignorable\n\t\ttry {\n\t\t\tClass<?> c = Class.forName(strClassName, false, contextClassLoader);\n\n\t\t\tif (!c.isInterface() && !Modifier.isAbstract(c.getModifiers())) {\n\t\t\t\tfor (Class<?> parentClass : parentClasses) {\n\t\t\t\t\tif (parentClass.isAssignableFrom(c)) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (UnsupportedClassVersionError | ClassNotFoundException | NoClassDefFoundError e) {\n\t\t\tlog.debug(e.getLocalizedMessage());\n\t\t}\n\t\treturn false;\n\t}\n\n}\n\n```\n\n比如 jar 文件在 `D:/soft/apache-jmeter-3.0/lib/ext/ApacheJMeter_functions.jar`\n``` java\nList<String> classes = ClassUtil.getClassList(new File(\"D:/soft/apache-jmeter-3.0/lib/ext/ApacheJMeter_functions.jar\"), new Class[] { Function.class }, true, \".functions.\", \".gui.\");\n// Function.class 是 org.apache.jmeter.functions.Function\n```\n\n打印 classes，输出如下：\n```\norg.apache.jmeter.functions.BeanShell\norg.apache.jmeter.functions.CSVRead\norg.apache.jmeter.functions.CharFunction\norg.apache.jmeter.functions.EscapeHtml\norg.apache.jmeter.functions.EscapeOroRegexpChars\norg.apache.jmeter.functions.EvalFunction\norg.apache.jmeter.functions.EvalVarFunction\norg.apache.jmeter.functions.FileToString\norg.apache.jmeter.functions.IntSum\norg.apache.jmeter.functions.IterationCounter\norg.apache.jmeter.functions.JavaScript\norg.apache.jmeter.functions.Jexl2Function\norg.apache.jmeter.functions.Jexl3Function\norg.apache.jmeter.functions.JexlFunction\norg.apache.jmeter.functions.LogFunction\norg.apache.jmeter.functions.LogFunction2\norg.apache.jmeter.functions.LongSum\norg.apache.jmeter.functions.MachineIP\norg.apache.jmeter.functions.MachineName\norg.apache.jmeter.functions.Property\norg.apache.jmeter.functions.Property2\norg.apache.jmeter.functions.Random\norg.apache.jmeter.functions.RandomString\norg.apache.jmeter.functions.RegexFunction\norg.apache.jmeter.functions.SamplerName\norg.apache.jmeter.functions.SetProperty\norg.apache.jmeter.functions.SplitFunction\norg.apache.jmeter.functions.StringFromFile\norg.apache.jmeter.functions.TestPlanName\norg.apache.jmeter.functions.ThreadNumber\norg.apache.jmeter.functions.TimeFunction\norg.apache.jmeter.functions.UnEscape\norg.apache.jmeter.functions.UnEscapeHtml\norg.apache.jmeter.functions.UrlDecode\norg.apache.jmeter.functions.UrlEncode\norg.apache.jmeter.functions.Uuid\norg.apache.jmeter.functions.Variable\norg.apache.jmeter.functions.XPath\n```","slug":"一个从 Jar 文件中获取所有的类路径的工具类","published":1,"updated":"2017-05-27T01:38:56.412Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj5jgsbdy000f2cez8xj1bwlg","content":"<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.io.File;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Modifier;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Enumeration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Set;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.TreeSet;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.zip.ZipEntry;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.zip.ZipFile;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.Logger;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.LoggerFactory;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span><br><span class=\"line\"> * 关于类的工具类</span><br><span class=\"line\"> * 参考 <span class=\"doctag\">@see</span> org.apache.jorphan.reflect.ClassFinder</span><br><span class=\"line\"> * </span><br><span class=\"line\"> * <span class=\"doctag\">@author</span> chen_k</span><br><span class=\"line\"> *</span><br><span class=\"line\"> * 2016年11月17日-上午10:30:59</span><br><span class=\"line\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ClassUtil</span> </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Logger log = LoggerFactory.getLogger(ClassUtil.class);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String DOT_CLASS = <span class=\"string\">\".class\"</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> DOT_CLASS_LEN = DOT_CLASS.length();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span><br><span class=\"line\">\t * 从指定的 jar 文件中获取类的路径列表</span><br><span class=\"line\">\t * <span class=\"doctag\">@param</span> jarFile File jar 文件对象</span><br><span class=\"line\">\t * <span class=\"doctag\">@param</span> parents Class&lt;?&gt;[] 继承或者实现的接口</span><br><span class=\"line\">\t * <span class=\"doctag\">@param</span> inner 是否包含内部类</span><br><span class=\"line\">\t * <span class=\"doctag\">@param</span> contain 类路径中含有的字符串，比如 .function.</span><br><span class=\"line\">\t * <span class=\"doctag\">@param</span> notContain 类路径中不含有的字符串 .gui.</span><br><span class=\"line\">\t * <span class=\"doctag\">@return</span> List&lt;String&gt;</span><br><span class=\"line\">\t * <span class=\"doctag\">@throws</span> IOException</span><br><span class=\"line\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> List&lt;String&gt; <span class=\"title\">getClassList</span><span class=\"params\">(File jarFile, Class&lt;?&gt;[] parents, <span class=\"keyword\">boolean</span> inner, String contain, String notContain)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">\t\tSet&lt;String&gt; listClasses = <span class=\"keyword\">new</span> TreeSet&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tZipFile zipFile = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tzipFile = <span class=\"keyword\">new</span> ZipFile(jarFile);</span><br><span class=\"line\">\t\t\tEnumeration&lt;? extends ZipEntry&gt; entries = zipFile.entries();</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> (entries.hasMoreElements()) &#123;</span><br><span class=\"line\">\t\t\t\tString strEntry = entries.nextElement().toString();</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (strEntry.endsWith(DOT_CLASS)) &#123;</span><br><span class=\"line\">\t\t\t\t\tString fixedClassName = fixClassName(strEntry);</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (accept(parents, fixedClassName, contain, notContain, inner)) &#123;</span><br><span class=\"line\">\t\t\t\t\t\tlistClasses.add(fixedClassName);</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">throw</span> e;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (zipFile != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t\t\tzipFile.close();</span><br><span class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ArrayList&lt;&gt;(listClasses);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title\">fixClassName</span><span class=\"params\">(String strClassName)</span> </span>&#123;</span><br><span class=\"line\">\t\tstrClassName = strClassName.replace(<span class=\"string\">'\\\\'</span>, <span class=\"string\">'.'</span>);</span><br><span class=\"line\">\t\tstrClassName = strClassName.replace(<span class=\"string\">'/'</span>, <span class=\"string\">'.'</span>);</span><br><span class=\"line\">\t\t<span class=\"comment\">// remove \".class\"</span></span><br><span class=\"line\">\t\tstrClassName = strClassName.substring(<span class=\"number\">0</span>, strClassName.length() - DOT_CLASS_LEN);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> strClassName;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">boolean</span> <span class=\"title\">accept</span><span class=\"params\">(Class&lt;?&gt;[] parents, String className, String contains, String notContains,</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">boolean</span> inner)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (contains != <span class=\"keyword\">null</span> &amp;&amp; !className.contains(contains)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>; <span class=\"comment\">// It does not contain a required string</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (notContains != <span class=\"keyword\">null</span> &amp;&amp; className.contains(notContains)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>; <span class=\"comment\">// It contains a banned string</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!className.contains(<span class=\"string\">\"$\"</span>) || inner) &#123; <span class=\"comment\">// $NON-NLS-1$</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (isChildOf(parents, className, Thread.currentThread().getContextClassLoader())) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isChildOf</span><span class=\"params\">(Class&lt;?&gt;[] parentClasses, String strClassName, ClassLoader contextClassLoader)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// might throw an exception, assume this is ignorable</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tClass&lt;?&gt; c = Class.forName(strClassName, <span class=\"keyword\">false</span>, contextClassLoader);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (!c.isInterface() &amp;&amp; !Modifier.isAbstract(c.getModifiers())) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (Class&lt;?&gt; parentClass : parentClasses) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (parentClass.isAssignableFrom(c)) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (UnsupportedClassVersionError | ClassNotFoundException | NoClassDefFoundError e) &#123;</span><br><span class=\"line\">\t\t\tlog.debug(e.getLocalizedMessage());</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>比如 jar 文件在 <code>D:/soft/apache-jmeter-3.0/lib/ext/ApacheJMeter_functions.jar</code><br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">List&lt;String&gt; classes = ClassUtil.getClassList(<span class=\"keyword\">new</span> File(<span class=\"string\">\"D:/soft/apache-jmeter-3.0/lib/ext/ApacheJMeter_functions.jar\"</span>), <span class=\"keyword\">new</span> Class[] &#123; Function.class &#125;, <span class=\"keyword\">true</span>, <span class=\"string\">\".functions.\"</span>, <span class=\"string\">\".gui.\"</span>);</span><br><span class=\"line\"><span class=\"comment\">// Function.class 是 org.apache.jmeter.functions.Function</span></span><br></pre></td></tr></table></figure></p>\n<p>打印 classes，输出如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">org.apache.jmeter.functions.BeanShell</span><br><span class=\"line\">org.apache.jmeter.functions.CSVRead</span><br><span class=\"line\">org.apache.jmeter.functions.CharFunction</span><br><span class=\"line\">org.apache.jmeter.functions.EscapeHtml</span><br><span class=\"line\">org.apache.jmeter.functions.EscapeOroRegexpChars</span><br><span class=\"line\">org.apache.jmeter.functions.EvalFunction</span><br><span class=\"line\">org.apache.jmeter.functions.EvalVarFunction</span><br><span class=\"line\">org.apache.jmeter.functions.FileToString</span><br><span class=\"line\">org.apache.jmeter.functions.IntSum</span><br><span class=\"line\">org.apache.jmeter.functions.IterationCounter</span><br><span class=\"line\">org.apache.jmeter.functions.JavaScript</span><br><span class=\"line\">org.apache.jmeter.functions.Jexl2Function</span><br><span class=\"line\">org.apache.jmeter.functions.Jexl3Function</span><br><span class=\"line\">org.apache.jmeter.functions.JexlFunction</span><br><span class=\"line\">org.apache.jmeter.functions.LogFunction</span><br><span class=\"line\">org.apache.jmeter.functions.LogFunction2</span><br><span class=\"line\">org.apache.jmeter.functions.LongSum</span><br><span class=\"line\">org.apache.jmeter.functions.MachineIP</span><br><span class=\"line\">org.apache.jmeter.functions.MachineName</span><br><span class=\"line\">org.apache.jmeter.functions.Property</span><br><span class=\"line\">org.apache.jmeter.functions.Property2</span><br><span class=\"line\">org.apache.jmeter.functions.Random</span><br><span class=\"line\">org.apache.jmeter.functions.RandomString</span><br><span class=\"line\">org.apache.jmeter.functions.RegexFunction</span><br><span class=\"line\">org.apache.jmeter.functions.SamplerName</span><br><span class=\"line\">org.apache.jmeter.functions.SetProperty</span><br><span class=\"line\">org.apache.jmeter.functions.SplitFunction</span><br><span class=\"line\">org.apache.jmeter.functions.StringFromFile</span><br><span class=\"line\">org.apache.jmeter.functions.TestPlanName</span><br><span class=\"line\">org.apache.jmeter.functions.ThreadNumber</span><br><span class=\"line\">org.apache.jmeter.functions.TimeFunction</span><br><span class=\"line\">org.apache.jmeter.functions.UnEscape</span><br><span class=\"line\">org.apache.jmeter.functions.UnEscapeHtml</span><br><span class=\"line\">org.apache.jmeter.functions.UrlDecode</span><br><span class=\"line\">org.apache.jmeter.functions.UrlEncode</span><br><span class=\"line\">org.apache.jmeter.functions.Uuid</span><br><span class=\"line\">org.apache.jmeter.functions.Variable</span><br><span class=\"line\">org.apache.jmeter.functions.XPath</span><br></pre></td></tr></table></figure></p>\n","excerpt":"","more":"<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.io.File;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Modifier;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Enumeration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Set;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.TreeSet;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.zip.ZipEntry;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.zip.ZipFile;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.Logger;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.LoggerFactory;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span><br><span class=\"line\"> * 关于类的工具类</span><br><span class=\"line\"> * 参考 <span class=\"doctag\">@see</span> org.apache.jorphan.reflect.ClassFinder</span><br><span class=\"line\"> * </span><br><span class=\"line\"> * <span class=\"doctag\">@author</span> chen_k</span><br><span class=\"line\"> *</span><br><span class=\"line\"> * 2016年11月17日-上午10:30:59</span><br><span class=\"line\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ClassUtil</span> </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Logger log = LoggerFactory.getLogger(ClassUtil.class);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String DOT_CLASS = <span class=\"string\">\".class\"</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> DOT_CLASS_LEN = DOT_CLASS.length();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span><br><span class=\"line\">\t * 从指定的 jar 文件中获取类的路径列表</span><br><span class=\"line\">\t * <span class=\"doctag\">@param</span> jarFile File jar 文件对象</span><br><span class=\"line\">\t * <span class=\"doctag\">@param</span> parents Class&lt;?&gt;[] 继承或者实现的接口</span><br><span class=\"line\">\t * <span class=\"doctag\">@param</span> inner 是否包含内部类</span><br><span class=\"line\">\t * <span class=\"doctag\">@param</span> contain 类路径中含有的字符串，比如 .function.</span><br><span class=\"line\">\t * <span class=\"doctag\">@param</span> notContain 类路径中不含有的字符串 .gui.</span><br><span class=\"line\">\t * <span class=\"doctag\">@return</span> List&lt;String&gt;</span><br><span class=\"line\">\t * <span class=\"doctag\">@throws</span> IOException</span><br><span class=\"line\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> List&lt;String&gt; <span class=\"title\">getClassList</span><span class=\"params\">(File jarFile, Class&lt;?&gt;[] parents, <span class=\"keyword\">boolean</span> inner, String contain, String notContain)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">\t\tSet&lt;String&gt; listClasses = <span class=\"keyword\">new</span> TreeSet&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tZipFile zipFile = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tzipFile = <span class=\"keyword\">new</span> ZipFile(jarFile);</span><br><span class=\"line\">\t\t\tEnumeration&lt;? extends ZipEntry&gt; entries = zipFile.entries();</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> (entries.hasMoreElements()) &#123;</span><br><span class=\"line\">\t\t\t\tString strEntry = entries.nextElement().toString();</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (strEntry.endsWith(DOT_CLASS)) &#123;</span><br><span class=\"line\">\t\t\t\t\tString fixedClassName = fixClassName(strEntry);</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (accept(parents, fixedClassName, contain, notContain, inner)) &#123;</span><br><span class=\"line\">\t\t\t\t\t\tlistClasses.add(fixedClassName);</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">throw</span> e;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (zipFile != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t\t\tzipFile.close();</span><br><span class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ArrayList&lt;&gt;(listClasses);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title\">fixClassName</span><span class=\"params\">(String strClassName)</span> </span>&#123;</span><br><span class=\"line\">\t\tstrClassName = strClassName.replace(<span class=\"string\">'\\\\'</span>, <span class=\"string\">'.'</span>);</span><br><span class=\"line\">\t\tstrClassName = strClassName.replace(<span class=\"string\">'/'</span>, <span class=\"string\">'.'</span>);</span><br><span class=\"line\">\t\t<span class=\"comment\">// remove \".class\"</span></span><br><span class=\"line\">\t\tstrClassName = strClassName.substring(<span class=\"number\">0</span>, strClassName.length() - DOT_CLASS_LEN);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> strClassName;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">boolean</span> <span class=\"title\">accept</span><span class=\"params\">(Class&lt;?&gt;[] parents, String className, String contains, String notContains,</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">boolean</span> inner)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (contains != <span class=\"keyword\">null</span> &amp;&amp; !className.contains(contains)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>; <span class=\"comment\">// It does not contain a required string</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (notContains != <span class=\"keyword\">null</span> &amp;&amp; className.contains(notContains)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>; <span class=\"comment\">// It contains a banned string</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!className.contains(<span class=\"string\">\"$\"</span>) || inner) &#123; <span class=\"comment\">// $NON-NLS-1$</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (isChildOf(parents, className, Thread.currentThread().getContextClassLoader())) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isChildOf</span><span class=\"params\">(Class&lt;?&gt;[] parentClasses, String strClassName, ClassLoader contextClassLoader)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// might throw an exception, assume this is ignorable</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tClass&lt;?&gt; c = Class.forName(strClassName, <span class=\"keyword\">false</span>, contextClassLoader);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (!c.isInterface() &amp;&amp; !Modifier.isAbstract(c.getModifiers())) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (Class&lt;?&gt; parentClass : parentClasses) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (parentClass.isAssignableFrom(c)) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (UnsupportedClassVersionError | ClassNotFoundException | NoClassDefFoundError e) &#123;</span><br><span class=\"line\">\t\t\tlog.debug(e.getLocalizedMessage());</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>比如 jar 文件在 <code>D:/soft/apache-jmeter-3.0/lib/ext/ApacheJMeter_functions.jar</code><br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">List&lt;String&gt; classes = ClassUtil.getClassList(<span class=\"keyword\">new</span> File(<span class=\"string\">\"D:/soft/apache-jmeter-3.0/lib/ext/ApacheJMeter_functions.jar\"</span>), <span class=\"keyword\">new</span> Class[] &#123; Function.class &#125;, <span class=\"keyword\">true</span>, <span class=\"string\">\".functions.\"</span>, <span class=\"string\">\".gui.\"</span>);</span><br><span class=\"line\"><span class=\"comment\">// Function.class 是 org.apache.jmeter.functions.Function</span></span><br></pre></td></tr></table></figure></p>\n<p>打印 classes，输出如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">org.apache.jmeter.functions.BeanShell</span><br><span class=\"line\">org.apache.jmeter.functions.CSVRead</span><br><span class=\"line\">org.apache.jmeter.functions.CharFunction</span><br><span class=\"line\">org.apache.jmeter.functions.EscapeHtml</span><br><span class=\"line\">org.apache.jmeter.functions.EscapeOroRegexpChars</span><br><span class=\"line\">org.apache.jmeter.functions.EvalFunction</span><br><span class=\"line\">org.apache.jmeter.functions.EvalVarFunction</span><br><span class=\"line\">org.apache.jmeter.functions.FileToString</span><br><span class=\"line\">org.apache.jmeter.functions.IntSum</span><br><span class=\"line\">org.apache.jmeter.functions.IterationCounter</span><br><span class=\"line\">org.apache.jmeter.functions.JavaScript</span><br><span class=\"line\">org.apache.jmeter.functions.Jexl2Function</span><br><span class=\"line\">org.apache.jmeter.functions.Jexl3Function</span><br><span class=\"line\">org.apache.jmeter.functions.JexlFunction</span><br><span class=\"line\">org.apache.jmeter.functions.LogFunction</span><br><span class=\"line\">org.apache.jmeter.functions.LogFunction2</span><br><span class=\"line\">org.apache.jmeter.functions.LongSum</span><br><span class=\"line\">org.apache.jmeter.functions.MachineIP</span><br><span class=\"line\">org.apache.jmeter.functions.MachineName</span><br><span class=\"line\">org.apache.jmeter.functions.Property</span><br><span class=\"line\">org.apache.jmeter.functions.Property2</span><br><span class=\"line\">org.apache.jmeter.functions.Random</span><br><span class=\"line\">org.apache.jmeter.functions.RandomString</span><br><span class=\"line\">org.apache.jmeter.functions.RegexFunction</span><br><span class=\"line\">org.apache.jmeter.functions.SamplerName</span><br><span class=\"line\">org.apache.jmeter.functions.SetProperty</span><br><span class=\"line\">org.apache.jmeter.functions.SplitFunction</span><br><span class=\"line\">org.apache.jmeter.functions.StringFromFile</span><br><span class=\"line\">org.apache.jmeter.functions.TestPlanName</span><br><span class=\"line\">org.apache.jmeter.functions.ThreadNumber</span><br><span class=\"line\">org.apache.jmeter.functions.TimeFunction</span><br><span class=\"line\">org.apache.jmeter.functions.UnEscape</span><br><span class=\"line\">org.apache.jmeter.functions.UnEscapeHtml</span><br><span class=\"line\">org.apache.jmeter.functions.UrlDecode</span><br><span class=\"line\">org.apache.jmeter.functions.UrlEncode</span><br><span class=\"line\">org.apache.jmeter.functions.Uuid</span><br><span class=\"line\">org.apache.jmeter.functions.Variable</span><br><span class=\"line\">org.apache.jmeter.functions.XPath</span><br></pre></td></tr></table></figure></p>\n"},{"title":"使用Maven的profiles和testResource进行Junit单元测试","title_url":"Maven-profiles-testResource-Junit","date":"2016-07-10T16:00:00.000Z","description":"使用Maven的profiles和testResource进行Junit单元测试","_content":"\n## Maven的profiles配置使用\n\nMaven的profiles可根据不同的环境将POM的配置应用到配置文件中的`${}`变量中，具体步骤如下：\n\n- POM的profiles配置如下\n```xml\n<project>\n\t\n\t<profiles>\n\t\t<profile>\n\t\t\t<id>dev</id>\n\t\t\t<activation>\n\t\t\t\t<activeByDefault>true</activeByDefault>\n\t\t\t</activation>\n\t\t\t<properties>\n\t\t\t\t<!-- 日志 -->\n\t\t\t\t<log.root.level>DEBUG</log.root.level>\n\t\t\t\t<log.root.name>Service</log.root.name>\n\t\t\t\t<log.special>Console</log.special>\n\t\t\t</properties>\n\t\t</profile>\n\t\t<profile>\n\t\t\t<id>test</id>\n\t\t\t<properties>\n\t\t\t\t<!-- 日志 -->\n\t\t\t\t<log.root.level>DEBUG</log.root.level>\n\t\t\t\t<log.root.name>Service</log.root.name>\n\t\t\t\t<log.special>Console</log.special>\n\t\t\t</properties>\n\t\t</profile>\n\t</profiles>\n</project>\n```\n\n- 为了在编译的时候就将POM的配置应用到文件中的`${}`变量中需要加入如下配置，具体会将profiles中的配置应用到`src/main/resources`目录下含有`${}`变量，\n这些变量可以在xml或者properties文件中\n```xml\n<project>\n\n\t<build>\n\t\t<resources>\n\t\t\t<resource>\n\t\t\t\t<directory>src/main/resources</directory>\n\t\t\t\t<includes>\n\t\t\t\t\t<include>*/*</include>\n\t\t\t\t\t<include>*</include>\n\t\t\t\t</includes>\n\t\t\t\t<filtering>true</filtering>\n\t\t\t</resource>\n\t\t</resources>\n\t</build>\n</project>\n```\n\n比如在`src/main/resources/log4j.properties`中有如下配置\n```\nlog4j.rootLogger=${log.root.level},${log.root.name},${log.special}\n\n#Console\nlog4j.appender.Console=org.apache.log4j.ConsoleAppender\nlog4j.appender.Console.layout=org.apache.log4j.PatternLayout\nlog4j.appender.Console.layout.ConversionPattern=%d{dd\\u65e5 HH:mm:ss,SSS} : %-5p %C{1}.%M() - %m%n\n```\n\n那么编译后在`target\\classes\\log4j.properties`文件中的内容如下：\n```\nlog4j.rootLogger=DEBUG,Service,Console\n\n#Console\nlog4j.appender.Console=org.apache.log4j.ConsoleAppender\nlog4j.appender.Console.layout=org.apache.log4j.PatternLayout\nlog4j.appender.Console.layout.ConversionPattern=%d{dd\\u65e5 HH:mm:ss,SSS} : %-5p %C{1}.%M() - %m%n\n```\n\n## 在Junit单元测试中利用profiles配置来区分不同环境\n\n在上面的介绍中是通过profiles配置来区分不同环境方便打包发布，这里介绍通过profiles配置区分不同环境进行单元测试，确保系统在发布前不仅能通过本地环境的单元测试，还能够通过线上环境的单元测试。\n\n- POM的profiles配置和上面的一样\n\n- 在`build`节点下新增`testResources`，确保在本地执行`mvn test -Ptest` 的时候将profiles配置应用到`src/test/resources`目录下含有`${}`变量并执行Junit单元测试\n```xml\n<project>\n\n\t<build>\n\t\t<testResources>\n\t\t\t<testResource>\n\t\t\t\t<directory>src/test/resources</directory>\n\t\t\t\t<includes>\n\t\t\t\t\t<include>*/*</include>\n\t\t\t\t\t<include>*</include>\n\t\t\t\t</includes>\n\t\t\t\t<filtering>true</filtering>\n\t\t\t</testResource>\n\t\t</testResources>\n\t</build>\n</project>\n```\n\n- 在`src/test/resources`目录下新建`test`文件夹，将properties文件移到该目录下，Maven在执行单元测试的时候默认从该目录读取properties文件\n\n- **注意**，在 Eclipse 中右键项目执行`Maven->Update Maven Project`后，需要右键项目在`Java Build Path`节点中选择`Source`选项卡，\n选中`src/main/resources`和`src/test/resources`下的`Excluded`选项点击右边的`Remove`按钮，最后点击下面的`Ok`按钮，才能将相关资源文件编译到`target`目录下\n\n## 编写一个Spring MVC的Controller层Junit单元测试\n\n- Controller层Junit单元测试与Service层有所不同，需要引入spring-test和spring-mock\n```xml\n<dependency>\n\t<groupId>org.springframework</groupId>\n\t<artifactId>spring-test</artifactId>\n\t<version>3.2.8.RELEASE</version>\n</dependency>\n<dependency>\n\t<groupId>org.springframework</groupId>\n\t<artifactId>spring-mock</artifactId>\n\t<version>2.0.8</version>\n</dependency>\n```\n\n- Controller层代码如下\n```java\n@ResponseBody\n@ApiOperation(value = \"获取用户信息\", notes = \"获取用户信息\", response = JsonResponses.class)\n@RequestMapping(value = \"/user_info\", method = RequestMethod.GET, produces = \"application/json; charset=utf-8\")\npublic void getUserInfo(@ModelAttribute BasicInfoBean basicInfo, \n\t\tHttpServletResponse response, HttpServletRequest request) throws Exception {\n\t\n\t// 验证uid是否存在\n\tInteger uid = basicInfo.getUid();\n\tif (uid == null) {\n\t\tHttpUtil.returnJson(new JsonResponses(API.CODE.kCodeParamsError, API.MESSAGE.PARAM_FAILED.concat(\":uid为空\")), response);\n\t\treturn;\n\t}\n\t\n\tUsers user = userServicebyUC.getUsersByUid(uid);\n\tfinal Map<String, Object> dataMap = new LinkedHashMap<>();\n\tsetUserModelMap(user, dataMap, basicInfo);\n\t\n\tHttpUtil.returnJson(new JsonResponses(API.CODE.kCodeSuccess, API.MESSAGE.SUCCESS, dataMap), response);\n}\n```\n\n- Junit代码如下\n```java\n@RunWith(SpringJUnit4ClassRunner.class)\n@WebAppConfiguration\n@ContextConfiguration(locations = { \"classpath:spring/*-config.xml\", \"classpath:spring/*-servlet.xml\" })\npublic class BaseController {\n\t\n\tprotected static String uid;\n\t\n\tstatic {\n\t\t// 加载配置文件\n\t\tProperties config = new Properties();\n\t\tInputStream input = null;\n\t\ttry {\n\t\t\tinput = API.class.getClassLoader().getResourceAsStream(\"test/test.properties\");\n\t\t\tReader reader = new InputStreamReader(input, \"UTF-8\");\n\t\t\tconfig.load(reader);\n\n\t\t\tuid = config.getProperty(\"uid\");\n\n\t\t} catch (Exception e) {\n\t\t\te.printStackTrace();\n\t\t} finally {\n\t\t\tif (null != input) {\n\t\t\t\ttry {\n\t\t\t\t\tinput.close();\n\t\t\t\t} catch (IOException e) {\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// @Autowired\n\t// private WebApplicationContext wac;\n\t\n}\n\npublic class TestUserController extends BaseController {\n\t\n\tprivate Logger logger = LoggerFactory.getLogger(this.getClass());\n\t\n\t@Autowired\n\tprotected UserController userController;\n\n\tprotected MockMvc mockMvc;\n\n\t@Before\n\tpublic void setup() {\n\t\tmockMvc = MockMvcBuilders.standaloneSetup(userController).build();\n\t}\n\n\t@Test\n\tpublic void testFindPageUsers() throws Exception {\n\t\tlogger.info(\"uid is {}\", uid);\n\t\t\n\t\tResultActions ra = mockMvc.perform(MockMvcRequestBuilders.get(\"/user/user_info\")\n\t\t\t\t.accept(MediaType.APPLICATION_JSON).param(\"test\", \"1\").param(\"uid\", uid));\n\t\tMvcResult mr = ra.andReturn();\n\t\tMockHttpServletResponse resp = mr.getResponse();\n\t\tAssert.assertEquals(resp.getStatus(), 200);\n\t\t\n\t\tJSONObject obj = JSONObject.parseObject(resp.getContentAsString());\n\t\tJSONObject dataObj = obj.getJSONObject(\"data\");\n\t\tAssert.assertEquals(StringUtil.getStr(dataObj.get(\"uid\")), uid);\n\t}\n\n}\n```\n\n## 如何去掉单元测试\n\n- 在执行Maven命令的时候加上`-Dmaven.test.skip=true`即可，比如`clean install -Dmaven.test.skip=true`，这样就会在执行的过程中跳过单元测试 `[INFO] Tests are skipped.`，也可以在profiles的properties中增加`<maven.test.skip>true</maven.test.skip>`，具体如下\n```xml\n<project>\n\t\n\t<profiles>\n\t\t<profile>\n\t\t\t<id>dev</id>\n\t\t\t<activation>\n\t\t\t\t<activeByDefault>true</activeByDefault>\n\t\t\t</activation>\n\t\t\t<properties>\n\t\t\t\t<maven.test.skip>false</maven.test.skip>\n\t\t\t\t<!-- 日志 -->\n\t\t\t\t<log.root.level>DEBUG</log.root.level>\n\t\t\t\t<log.root.name>Service</log.root.name>\n\t\t\t\t<log.special>Console</log.special>\n\t\t\t</properties>\n\t\t</profile>\n\t\t<profile>\n\t\t\t<id>test</id>\n\t\t\t<properties>\n\t\t\t\t<maven.test.skip>true</maven.test.skip>\n\t\t\t\t<!-- 日志 -->\n\t\t\t\t<log.root.level>DEBUG</log.root.level>\n\t\t\t\t<log.root.name>Service</log.root.name>\n\t\t\t\t<log.special>Console</log.special>\n\t\t\t</properties>\n\t\t</profile>\n\t</profiles>\n</project>\n```\n\n## 参考如下\n- [Maven的profiles介绍](https://maven.apache.org/guides/introduction/introduction-to-profiles.html)\n- [MAVEN 属性定义与使用](http://www.tmser.com/post-178.html)\n- [Maven的生命周期和插件](http://www.open-open.com/lib/view/open1452138592011.html)\n- [利用maven中resources插件的copy-resources目标进行资源copy和过滤](http://xigua366.iteye.com/blog/2080668?utm_source=tuicool&utm_medium=referral)","source":"_posts/使用Maven的profile和testResource进行Junit单元测试.md","raw":"---\ntitle: 使用Maven的profiles和testResource进行Junit单元测试\ntitle_url: Maven-profiles-testResource-Junit\ndate: 2016-07-11\ntags: [Maven,Junit]\ncategories: 技术\ndescription: 使用Maven的profiles和testResource进行Junit单元测试\n---\n\n## Maven的profiles配置使用\n\nMaven的profiles可根据不同的环境将POM的配置应用到配置文件中的`${}`变量中，具体步骤如下：\n\n- POM的profiles配置如下\n```xml\n<project>\n\t\n\t<profiles>\n\t\t<profile>\n\t\t\t<id>dev</id>\n\t\t\t<activation>\n\t\t\t\t<activeByDefault>true</activeByDefault>\n\t\t\t</activation>\n\t\t\t<properties>\n\t\t\t\t<!-- 日志 -->\n\t\t\t\t<log.root.level>DEBUG</log.root.level>\n\t\t\t\t<log.root.name>Service</log.root.name>\n\t\t\t\t<log.special>Console</log.special>\n\t\t\t</properties>\n\t\t</profile>\n\t\t<profile>\n\t\t\t<id>test</id>\n\t\t\t<properties>\n\t\t\t\t<!-- 日志 -->\n\t\t\t\t<log.root.level>DEBUG</log.root.level>\n\t\t\t\t<log.root.name>Service</log.root.name>\n\t\t\t\t<log.special>Console</log.special>\n\t\t\t</properties>\n\t\t</profile>\n\t</profiles>\n</project>\n```\n\n- 为了在编译的时候就将POM的配置应用到文件中的`${}`变量中需要加入如下配置，具体会将profiles中的配置应用到`src/main/resources`目录下含有`${}`变量，\n这些变量可以在xml或者properties文件中\n```xml\n<project>\n\n\t<build>\n\t\t<resources>\n\t\t\t<resource>\n\t\t\t\t<directory>src/main/resources</directory>\n\t\t\t\t<includes>\n\t\t\t\t\t<include>*/*</include>\n\t\t\t\t\t<include>*</include>\n\t\t\t\t</includes>\n\t\t\t\t<filtering>true</filtering>\n\t\t\t</resource>\n\t\t</resources>\n\t</build>\n</project>\n```\n\n比如在`src/main/resources/log4j.properties`中有如下配置\n```\nlog4j.rootLogger=${log.root.level},${log.root.name},${log.special}\n\n#Console\nlog4j.appender.Console=org.apache.log4j.ConsoleAppender\nlog4j.appender.Console.layout=org.apache.log4j.PatternLayout\nlog4j.appender.Console.layout.ConversionPattern=%d{dd\\u65e5 HH:mm:ss,SSS} : %-5p %C{1}.%M() - %m%n\n```\n\n那么编译后在`target\\classes\\log4j.properties`文件中的内容如下：\n```\nlog4j.rootLogger=DEBUG,Service,Console\n\n#Console\nlog4j.appender.Console=org.apache.log4j.ConsoleAppender\nlog4j.appender.Console.layout=org.apache.log4j.PatternLayout\nlog4j.appender.Console.layout.ConversionPattern=%d{dd\\u65e5 HH:mm:ss,SSS} : %-5p %C{1}.%M() - %m%n\n```\n\n## 在Junit单元测试中利用profiles配置来区分不同环境\n\n在上面的介绍中是通过profiles配置来区分不同环境方便打包发布，这里介绍通过profiles配置区分不同环境进行单元测试，确保系统在发布前不仅能通过本地环境的单元测试，还能够通过线上环境的单元测试。\n\n- POM的profiles配置和上面的一样\n\n- 在`build`节点下新增`testResources`，确保在本地执行`mvn test -Ptest` 的时候将profiles配置应用到`src/test/resources`目录下含有`${}`变量并执行Junit单元测试\n```xml\n<project>\n\n\t<build>\n\t\t<testResources>\n\t\t\t<testResource>\n\t\t\t\t<directory>src/test/resources</directory>\n\t\t\t\t<includes>\n\t\t\t\t\t<include>*/*</include>\n\t\t\t\t\t<include>*</include>\n\t\t\t\t</includes>\n\t\t\t\t<filtering>true</filtering>\n\t\t\t</testResource>\n\t\t</testResources>\n\t</build>\n</project>\n```\n\n- 在`src/test/resources`目录下新建`test`文件夹，将properties文件移到该目录下，Maven在执行单元测试的时候默认从该目录读取properties文件\n\n- **注意**，在 Eclipse 中右键项目执行`Maven->Update Maven Project`后，需要右键项目在`Java Build Path`节点中选择`Source`选项卡，\n选中`src/main/resources`和`src/test/resources`下的`Excluded`选项点击右边的`Remove`按钮，最后点击下面的`Ok`按钮，才能将相关资源文件编译到`target`目录下\n\n## 编写一个Spring MVC的Controller层Junit单元测试\n\n- Controller层Junit单元测试与Service层有所不同，需要引入spring-test和spring-mock\n```xml\n<dependency>\n\t<groupId>org.springframework</groupId>\n\t<artifactId>spring-test</artifactId>\n\t<version>3.2.8.RELEASE</version>\n</dependency>\n<dependency>\n\t<groupId>org.springframework</groupId>\n\t<artifactId>spring-mock</artifactId>\n\t<version>2.0.8</version>\n</dependency>\n```\n\n- Controller层代码如下\n```java\n@ResponseBody\n@ApiOperation(value = \"获取用户信息\", notes = \"获取用户信息\", response = JsonResponses.class)\n@RequestMapping(value = \"/user_info\", method = RequestMethod.GET, produces = \"application/json; charset=utf-8\")\npublic void getUserInfo(@ModelAttribute BasicInfoBean basicInfo, \n\t\tHttpServletResponse response, HttpServletRequest request) throws Exception {\n\t\n\t// 验证uid是否存在\n\tInteger uid = basicInfo.getUid();\n\tif (uid == null) {\n\t\tHttpUtil.returnJson(new JsonResponses(API.CODE.kCodeParamsError, API.MESSAGE.PARAM_FAILED.concat(\":uid为空\")), response);\n\t\treturn;\n\t}\n\t\n\tUsers user = userServicebyUC.getUsersByUid(uid);\n\tfinal Map<String, Object> dataMap = new LinkedHashMap<>();\n\tsetUserModelMap(user, dataMap, basicInfo);\n\t\n\tHttpUtil.returnJson(new JsonResponses(API.CODE.kCodeSuccess, API.MESSAGE.SUCCESS, dataMap), response);\n}\n```\n\n- Junit代码如下\n```java\n@RunWith(SpringJUnit4ClassRunner.class)\n@WebAppConfiguration\n@ContextConfiguration(locations = { \"classpath:spring/*-config.xml\", \"classpath:spring/*-servlet.xml\" })\npublic class BaseController {\n\t\n\tprotected static String uid;\n\t\n\tstatic {\n\t\t// 加载配置文件\n\t\tProperties config = new Properties();\n\t\tInputStream input = null;\n\t\ttry {\n\t\t\tinput = API.class.getClassLoader().getResourceAsStream(\"test/test.properties\");\n\t\t\tReader reader = new InputStreamReader(input, \"UTF-8\");\n\t\t\tconfig.load(reader);\n\n\t\t\tuid = config.getProperty(\"uid\");\n\n\t\t} catch (Exception e) {\n\t\t\te.printStackTrace();\n\t\t} finally {\n\t\t\tif (null != input) {\n\t\t\t\ttry {\n\t\t\t\t\tinput.close();\n\t\t\t\t} catch (IOException e) {\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// @Autowired\n\t// private WebApplicationContext wac;\n\t\n}\n\npublic class TestUserController extends BaseController {\n\t\n\tprivate Logger logger = LoggerFactory.getLogger(this.getClass());\n\t\n\t@Autowired\n\tprotected UserController userController;\n\n\tprotected MockMvc mockMvc;\n\n\t@Before\n\tpublic void setup() {\n\t\tmockMvc = MockMvcBuilders.standaloneSetup(userController).build();\n\t}\n\n\t@Test\n\tpublic void testFindPageUsers() throws Exception {\n\t\tlogger.info(\"uid is {}\", uid);\n\t\t\n\t\tResultActions ra = mockMvc.perform(MockMvcRequestBuilders.get(\"/user/user_info\")\n\t\t\t\t.accept(MediaType.APPLICATION_JSON).param(\"test\", \"1\").param(\"uid\", uid));\n\t\tMvcResult mr = ra.andReturn();\n\t\tMockHttpServletResponse resp = mr.getResponse();\n\t\tAssert.assertEquals(resp.getStatus(), 200);\n\t\t\n\t\tJSONObject obj = JSONObject.parseObject(resp.getContentAsString());\n\t\tJSONObject dataObj = obj.getJSONObject(\"data\");\n\t\tAssert.assertEquals(StringUtil.getStr(dataObj.get(\"uid\")), uid);\n\t}\n\n}\n```\n\n## 如何去掉单元测试\n\n- 在执行Maven命令的时候加上`-Dmaven.test.skip=true`即可，比如`clean install -Dmaven.test.skip=true`，这样就会在执行的过程中跳过单元测试 `[INFO] Tests are skipped.`，也可以在profiles的properties中增加`<maven.test.skip>true</maven.test.skip>`，具体如下\n```xml\n<project>\n\t\n\t<profiles>\n\t\t<profile>\n\t\t\t<id>dev</id>\n\t\t\t<activation>\n\t\t\t\t<activeByDefault>true</activeByDefault>\n\t\t\t</activation>\n\t\t\t<properties>\n\t\t\t\t<maven.test.skip>false</maven.test.skip>\n\t\t\t\t<!-- 日志 -->\n\t\t\t\t<log.root.level>DEBUG</log.root.level>\n\t\t\t\t<log.root.name>Service</log.root.name>\n\t\t\t\t<log.special>Console</log.special>\n\t\t\t</properties>\n\t\t</profile>\n\t\t<profile>\n\t\t\t<id>test</id>\n\t\t\t<properties>\n\t\t\t\t<maven.test.skip>true</maven.test.skip>\n\t\t\t\t<!-- 日志 -->\n\t\t\t\t<log.root.level>DEBUG</log.root.level>\n\t\t\t\t<log.root.name>Service</log.root.name>\n\t\t\t\t<log.special>Console</log.special>\n\t\t\t</properties>\n\t\t</profile>\n\t</profiles>\n</project>\n```\n\n## 参考如下\n- [Maven的profiles介绍](https://maven.apache.org/guides/introduction/introduction-to-profiles.html)\n- [MAVEN 属性定义与使用](http://www.tmser.com/post-178.html)\n- [Maven的生命周期和插件](http://www.open-open.com/lib/view/open1452138592011.html)\n- [利用maven中resources插件的copy-resources目标进行资源copy和过滤](http://xigua366.iteye.com/blog/2080668?utm_source=tuicool&utm_medium=referral)","slug":"使用Maven的profile和testResource进行Junit单元测试","published":1,"updated":"2016-10-10T01:58:06.781Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj5jgsbe2000k2cez89yjen7c","content":"<h2 id=\"Maven的profiles配置使用\"><a href=\"#Maven的profiles配置使用\" class=\"headerlink\" title=\"Maven的profiles配置使用\"></a>Maven的profiles配置使用</h2><p>Maven的profiles可根据不同的环境将POM的配置应用到配置文件中的<code>${}</code>变量中，具体步骤如下：</p>\n<ul>\n<li><p>POM的profiles配置如下</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">profiles</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">profile</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>dev<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">activation</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">activeByDefault</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">activeByDefault</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">activation</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">&lt;!-- 日志 --&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">log.root.level</span>&gt;</span>DEBUG<span class=\"tag\">&lt;/<span class=\"name\">log.root.level</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">log.root.name</span>&gt;</span>Service<span class=\"tag\">&lt;/<span class=\"name\">log.root.name</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">log.special</span>&gt;</span>Console<span class=\"tag\">&lt;/<span class=\"name\">log.special</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">profile</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">profile</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">&lt;!-- 日志 --&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">log.root.level</span>&gt;</span>DEBUG<span class=\"tag\">&lt;/<span class=\"name\">log.root.level</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">log.root.name</span>&gt;</span>Service<span class=\"tag\">&lt;/<span class=\"name\">log.root.name</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">log.special</span>&gt;</span>Console<span class=\"tag\">&lt;/<span class=\"name\">log.special</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">profile</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">profiles</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>为了在编译的时候就将POM的配置应用到文件中的<code>${}</code>变量中需要加入如下配置，具体会将profiles中的配置应用到<code>src/main/resources</code>目录下含有<code>${}</code>变量，<br>这些变量可以在xml或者properties文件中</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">resources</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">resource</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">directory</span>&gt;</span>src/main/resources<span class=\"tag\">&lt;/<span class=\"name\">directory</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">includes</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">include</span>&gt;</span>*/*<span class=\"tag\">&lt;/<span class=\"name\">include</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">include</span>&gt;</span>*<span class=\"tag\">&lt;/<span class=\"name\">include</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">includes</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">filtering</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">filtering</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">resource</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">resources</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>比如在<code>src/main/resources/log4j.properties</code>中有如下配置<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">log4j.rootLogger=$&#123;log.root.level&#125;,$&#123;log.root.name&#125;,$&#123;log.special&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">#Console</span><br><span class=\"line\">log4j.appender.Console=org.apache.log4j.ConsoleAppender</span><br><span class=\"line\">log4j.appender.Console.layout=org.apache.log4j.PatternLayout</span><br><span class=\"line\">log4j.appender.Console.layout.ConversionPattern=%d&#123;dd\\u65e5 HH:mm:ss,SSS&#125; : %-5p %C&#123;1&#125;.%M() - %m%n</span><br></pre></td></tr></table></figure></p>\n<p>那么编译后在<code>target\\classes\\log4j.properties</code>文件中的内容如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">log4j.rootLogger=DEBUG,Service,Console</span><br><span class=\"line\"></span><br><span class=\"line\">#Console</span><br><span class=\"line\">log4j.appender.Console=org.apache.log4j.ConsoleAppender</span><br><span class=\"line\">log4j.appender.Console.layout=org.apache.log4j.PatternLayout</span><br><span class=\"line\">log4j.appender.Console.layout.ConversionPattern=%d&#123;dd\\u65e5 HH:mm:ss,SSS&#125; : %-5p %C&#123;1&#125;.%M() - %m%n</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"在Junit单元测试中利用profiles配置来区分不同环境\"><a href=\"#在Junit单元测试中利用profiles配置来区分不同环境\" class=\"headerlink\" title=\"在Junit单元测试中利用profiles配置来区分不同环境\"></a>在Junit单元测试中利用profiles配置来区分不同环境</h2><p>在上面的介绍中是通过profiles配置来区分不同环境方便打包发布，这里介绍通过profiles配置区分不同环境进行单元测试，确保系统在发布前不仅能通过本地环境的单元测试，还能够通过线上环境的单元测试。</p>\n<ul>\n<li><p>POM的profiles配置和上面的一样</p>\n</li>\n<li><p>在<code>build</code>节点下新增<code>testResources</code>，确保在本地执行<code>mvn test -Ptest</code> 的时候将profiles配置应用到<code>src/test/resources</code>目录下含有<code>${}</code>变量并执行Junit单元测试</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">testResources</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">testResource</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">directory</span>&gt;</span>src/test/resources<span class=\"tag\">&lt;/<span class=\"name\">directory</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">includes</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">include</span>&gt;</span>*/*<span class=\"tag\">&lt;/<span class=\"name\">include</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">include</span>&gt;</span>*<span class=\"tag\">&lt;/<span class=\"name\">include</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">includes</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">filtering</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">filtering</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">testResource</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">testResources</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>在<code>src/test/resources</code>目录下新建<code>test</code>文件夹，将properties文件移到该目录下，Maven在执行单元测试的时候默认从该目录读取properties文件</p>\n</li>\n<li><p><strong>注意</strong>，在 Eclipse 中右键项目执行<code>Maven-&gt;Update Maven Project</code>后，需要右键项目在<code>Java Build Path</code>节点中选择<code>Source</code>选项卡，<br>选中<code>src/main/resources</code>和<code>src/test/resources</code>下的<code>Excluded</code>选项点击右边的<code>Remove</code>按钮，最后点击下面的<code>Ok</code>按钮，才能将相关资源文件编译到<code>target</code>目录下</p>\n</li>\n</ul>\n<h2 id=\"编写一个Spring-MVC的Controller层Junit单元测试\"><a href=\"#编写一个Spring-MVC的Controller层Junit单元测试\" class=\"headerlink\" title=\"编写一个Spring MVC的Controller层Junit单元测试\"></a>编写一个Spring MVC的Controller层Junit单元测试</h2><ul>\n<li><p>Controller层Junit单元测试与Service层有所不同，需要引入spring-test和spring-mock</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.2.8.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-mock<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0.8<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Controller层代码如下</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\"><span class=\"meta\">@ApiOperation</span>(value = <span class=\"string\">\"获取用户信息\"</span>, notes = <span class=\"string\">\"获取用户信息\"</span>, response = JsonResponses.class)</span><br><span class=\"line\"><span class=\"meta\">@RequestMapping</span>(value = <span class=\"string\">\"/user_info\"</span>, method = RequestMethod.GET, produces = <span class=\"string\">\"application/json; charset=utf-8\"</span>)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getUserInfo</span><span class=\"params\">(@ModelAttribute BasicInfoBean basicInfo, </span><br><span class=\"line\">\t\tHttpServletResponse response, HttpServletRequest request)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">// 验证uid是否存在</span></span><br><span class=\"line\">\tInteger uid = basicInfo.getUid();</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (uid == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\tHttpUtil.returnJson(<span class=\"keyword\">new</span> JsonResponses(API.CODE.kCodeParamsError, API.MESSAGE.PARAM_FAILED.concat(<span class=\"string\">\":uid为空\"</span>)), response);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tUsers user = userServicebyUC.getUsersByUid(uid);</span><br><span class=\"line\">\t<span class=\"keyword\">final</span> Map&lt;String, Object&gt; dataMap = <span class=\"keyword\">new</span> LinkedHashMap&lt;&gt;();</span><br><span class=\"line\">\tsetUserModelMap(user, dataMap, basicInfo);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tHttpUtil.returnJson(<span class=\"keyword\">new</span> JsonResponses(API.CODE.kCodeSuccess, API.MESSAGE.SUCCESS, dataMap), response);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Junit代码如下</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class=\"line\"><span class=\"meta\">@WebAppConfiguration</span></span><br><span class=\"line\"><span class=\"meta\">@ContextConfiguration</span>(locations = &#123; <span class=\"string\">\"classpath:spring/*-config.xml\"</span>, <span class=\"string\">\"classpath:spring/*-servlet.xml\"</span> &#125;)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BaseController</span> </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"keyword\">static</span> String uid;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 加载配置文件</span></span><br><span class=\"line\">\t\tProperties config = <span class=\"keyword\">new</span> Properties();</span><br><span class=\"line\">\t\tInputStream input = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tinput = API.class.getClassLoader().getResourceAsStream(<span class=\"string\">\"test/test.properties\"</span>);</span><br><span class=\"line\">\t\t\tReader reader = <span class=\"keyword\">new</span> InputStreamReader(input, <span class=\"string\">\"UTF-8\"</span>);</span><br><span class=\"line\">\t\t\tconfig.load(reader);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tuid = config.getProperty(<span class=\"string\">\"uid\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> != input) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t\t\tinput.close();</span><br><span class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// @Autowired</span></span><br><span class=\"line\">\t<span class=\"comment\">// private WebApplicationContext wac;</span></span><br><span class=\"line\">\t</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestUserController</span> <span class=\"keyword\">extends</span> <span class=\"title\">BaseController</span> </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> Logger logger = LoggerFactory.getLogger(<span class=\"keyword\">this</span>.getClass());</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@Autowired</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> UserController userController;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> MockMvc mockMvc;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Before</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setup</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tmockMvc = MockMvcBuilders.standaloneSetup(userController).build();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Test</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testFindPageUsers</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">\t\tlogger.info(<span class=\"string\">\"uid is &#123;&#125;\"</span>, uid);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\tResultActions ra = mockMvc.perform(MockMvcRequestBuilders.get(<span class=\"string\">\"/user/user_info\"</span>)</span><br><span class=\"line\">\t\t\t\t.accept(MediaType.APPLICATION_JSON).param(<span class=\"string\">\"test\"</span>, <span class=\"string\">\"1\"</span>).param(<span class=\"string\">\"uid\"</span>, uid));</span><br><span class=\"line\">\t\tMvcResult mr = ra.andReturn();</span><br><span class=\"line\">\t\tMockHttpServletResponse resp = mr.getResponse();</span><br><span class=\"line\">\t\tAssert.assertEquals(resp.getStatus(), <span class=\"number\">200</span>);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\tJSONObject obj = JSONObject.parseObject(resp.getContentAsString());</span><br><span class=\"line\">\t\tJSONObject dataObj = obj.getJSONObject(<span class=\"string\">\"data\"</span>);</span><br><span class=\"line\">\t\tAssert.assertEquals(StringUtil.getStr(dataObj.get(<span class=\"string\">\"uid\"</span>)), uid);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"如何去掉单元测试\"><a href=\"#如何去掉单元测试\" class=\"headerlink\" title=\"如何去掉单元测试\"></a>如何去掉单元测试</h2><ul>\n<li>在执行Maven命令的时候加上<code>-Dmaven.test.skip=true</code>即可，比如<code>clean install -Dmaven.test.skip=true</code>，这样就会在执行的过程中跳过单元测试 <code>[INFO] Tests are skipped.</code>，也可以在profiles的properties中增加<code>&lt;maven.test.skip&gt;true&lt;/maven.test.skip&gt;</code>，具体如下<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">profiles</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">profile</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>dev<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">activation</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">activeByDefault</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">activeByDefault</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">activation</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">maven.test.skip</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">maven.test.skip</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">&lt;!-- 日志 --&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">log.root.level</span>&gt;</span>DEBUG<span class=\"tag\">&lt;/<span class=\"name\">log.root.level</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">log.root.name</span>&gt;</span>Service<span class=\"tag\">&lt;/<span class=\"name\">log.root.name</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">log.special</span>&gt;</span>Console<span class=\"tag\">&lt;/<span class=\"name\">log.special</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">profile</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">profile</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">maven.test.skip</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">maven.test.skip</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">&lt;!-- 日志 --&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">log.root.level</span>&gt;</span>DEBUG<span class=\"tag\">&lt;/<span class=\"name\">log.root.level</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">log.root.name</span>&gt;</span>Service<span class=\"tag\">&lt;/<span class=\"name\">log.root.name</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">log.special</span>&gt;</span>Console<span class=\"tag\">&lt;/<span class=\"name\">log.special</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">profile</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">profiles</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"参考如下\"><a href=\"#参考如下\" class=\"headerlink\" title=\"参考如下\"></a>参考如下</h2><ul>\n<li><a href=\"https://maven.apache.org/guides/introduction/introduction-to-profiles.html\" target=\"_blank\" rel=\"external\">Maven的profiles介绍</a></li>\n<li><a href=\"http://www.tmser.com/post-178.html\" target=\"_blank\" rel=\"external\">MAVEN 属性定义与使用</a></li>\n<li><a href=\"http://www.open-open.com/lib/view/open1452138592011.html\" target=\"_blank\" rel=\"external\">Maven的生命周期和插件</a></li>\n<li><a href=\"http://xigua366.iteye.com/blog/2080668?utm_source=tuicool&amp;utm_medium=referral\" target=\"_blank\" rel=\"external\">利用maven中resources插件的copy-resources目标进行资源copy和过滤</a></li>\n</ul>\n","excerpt":"","more":"<h2 id=\"Maven的profiles配置使用\"><a href=\"#Maven的profiles配置使用\" class=\"headerlink\" title=\"Maven的profiles配置使用\"></a>Maven的profiles配置使用</h2><p>Maven的profiles可根据不同的环境将POM的配置应用到配置文件中的<code>${}</code>变量中，具体步骤如下：</p>\n<ul>\n<li><p>POM的profiles配置如下</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">profiles</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">profile</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>dev<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">activation</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">activeByDefault</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">activeByDefault</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">activation</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">&lt;!-- 日志 --&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">log.root.level</span>&gt;</span>DEBUG<span class=\"tag\">&lt;/<span class=\"name\">log.root.level</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">log.root.name</span>&gt;</span>Service<span class=\"tag\">&lt;/<span class=\"name\">log.root.name</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">log.special</span>&gt;</span>Console<span class=\"tag\">&lt;/<span class=\"name\">log.special</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">profile</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">profile</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">&lt;!-- 日志 --&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">log.root.level</span>&gt;</span>DEBUG<span class=\"tag\">&lt;/<span class=\"name\">log.root.level</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">log.root.name</span>&gt;</span>Service<span class=\"tag\">&lt;/<span class=\"name\">log.root.name</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">log.special</span>&gt;</span>Console<span class=\"tag\">&lt;/<span class=\"name\">log.special</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">profile</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">profiles</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>为了在编译的时候就将POM的配置应用到文件中的<code>${}</code>变量中需要加入如下配置，具体会将profiles中的配置应用到<code>src/main/resources</code>目录下含有<code>${}</code>变量，<br>这些变量可以在xml或者properties文件中</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">resources</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">resource</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">directory</span>&gt;</span>src/main/resources<span class=\"tag\">&lt;/<span class=\"name\">directory</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">includes</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">include</span>&gt;</span>*/*<span class=\"tag\">&lt;/<span class=\"name\">include</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">include</span>&gt;</span>*<span class=\"tag\">&lt;/<span class=\"name\">include</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">includes</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">filtering</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">filtering</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">resource</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">resources</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>比如在<code>src/main/resources/log4j.properties</code>中有如下配置<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">log4j.rootLogger=$&#123;log.root.level&#125;,$&#123;log.root.name&#125;,$&#123;log.special&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">#Console</span><br><span class=\"line\">log4j.appender.Console=org.apache.log4j.ConsoleAppender</span><br><span class=\"line\">log4j.appender.Console.layout=org.apache.log4j.PatternLayout</span><br><span class=\"line\">log4j.appender.Console.layout.ConversionPattern=%d&#123;dd\\u65e5 HH:mm:ss,SSS&#125; : %-5p %C&#123;1&#125;.%M() - %m%n</span><br></pre></td></tr></table></figure></p>\n<p>那么编译后在<code>target\\classes\\log4j.properties</code>文件中的内容如下：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">log4j.rootLogger=DEBUG,Service,Console</span><br><span class=\"line\"></span><br><span class=\"line\">#Console</span><br><span class=\"line\">log4j.appender.Console=org.apache.log4j.ConsoleAppender</span><br><span class=\"line\">log4j.appender.Console.layout=org.apache.log4j.PatternLayout</span><br><span class=\"line\">log4j.appender.Console.layout.ConversionPattern=%d&#123;dd\\u65e5 HH:mm:ss,SSS&#125; : %-5p %C&#123;1&#125;.%M() - %m%n</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"在Junit单元测试中利用profiles配置来区分不同环境\"><a href=\"#在Junit单元测试中利用profiles配置来区分不同环境\" class=\"headerlink\" title=\"在Junit单元测试中利用profiles配置来区分不同环境\"></a>在Junit单元测试中利用profiles配置来区分不同环境</h2><p>在上面的介绍中是通过profiles配置来区分不同环境方便打包发布，这里介绍通过profiles配置区分不同环境进行单元测试，确保系统在发布前不仅能通过本地环境的单元测试，还能够通过线上环境的单元测试。</p>\n<ul>\n<li><p>POM的profiles配置和上面的一样</p>\n</li>\n<li><p>在<code>build</code>节点下新增<code>testResources</code>，确保在本地执行<code>mvn test -Ptest</code> 的时候将profiles配置应用到<code>src/test/resources</code>目录下含有<code>${}</code>变量并执行Junit单元测试</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">testResources</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">testResource</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">directory</span>&gt;</span>src/test/resources<span class=\"tag\">&lt;/<span class=\"name\">directory</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">includes</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">include</span>&gt;</span>*/*<span class=\"tag\">&lt;/<span class=\"name\">include</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">include</span>&gt;</span>*<span class=\"tag\">&lt;/<span class=\"name\">include</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">includes</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">filtering</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">filtering</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">testResource</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">testResources</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>在<code>src/test/resources</code>目录下新建<code>test</code>文件夹，将properties文件移到该目录下，Maven在执行单元测试的时候默认从该目录读取properties文件</p>\n</li>\n<li><p><strong>注意</strong>，在 Eclipse 中右键项目执行<code>Maven-&gt;Update Maven Project</code>后，需要右键项目在<code>Java Build Path</code>节点中选择<code>Source</code>选项卡，<br>选中<code>src/main/resources</code>和<code>src/test/resources</code>下的<code>Excluded</code>选项点击右边的<code>Remove</code>按钮，最后点击下面的<code>Ok</code>按钮，才能将相关资源文件编译到<code>target</code>目录下</p>\n</li>\n</ul>\n<h2 id=\"编写一个Spring-MVC的Controller层Junit单元测试\"><a href=\"#编写一个Spring-MVC的Controller层Junit单元测试\" class=\"headerlink\" title=\"编写一个Spring MVC的Controller层Junit单元测试\"></a>编写一个Spring MVC的Controller层Junit单元测试</h2><ul>\n<li><p>Controller层Junit单元测试与Service层有所不同，需要引入spring-test和spring-mock</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.2.8.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-mock<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0.8<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Controller层代码如下</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\"><span class=\"meta\">@ApiOperation</span>(value = <span class=\"string\">\"获取用户信息\"</span>, notes = <span class=\"string\">\"获取用户信息\"</span>, response = JsonResponses.class)</span><br><span class=\"line\"><span class=\"meta\">@RequestMapping</span>(value = <span class=\"string\">\"/user_info\"</span>, method = RequestMethod.GET, produces = <span class=\"string\">\"application/json; charset=utf-8\"</span>)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getUserInfo</span><span class=\"params\">(@ModelAttribute BasicInfoBean basicInfo, </span><br><span class=\"line\">\t\tHttpServletResponse response, HttpServletRequest request)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">// 验证uid是否存在</span></span><br><span class=\"line\">\tInteger uid = basicInfo.getUid();</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (uid == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\tHttpUtil.returnJson(<span class=\"keyword\">new</span> JsonResponses(API.CODE.kCodeParamsError, API.MESSAGE.PARAM_FAILED.concat(<span class=\"string\">\":uid为空\"</span>)), response);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tUsers user = userServicebyUC.getUsersByUid(uid);</span><br><span class=\"line\">\t<span class=\"keyword\">final</span> Map&lt;String, Object&gt; dataMap = <span class=\"keyword\">new</span> LinkedHashMap&lt;&gt;();</span><br><span class=\"line\">\tsetUserModelMap(user, dataMap, basicInfo);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tHttpUtil.returnJson(<span class=\"keyword\">new</span> JsonResponses(API.CODE.kCodeSuccess, API.MESSAGE.SUCCESS, dataMap), response);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Junit代码如下</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class=\"line\"><span class=\"meta\">@WebAppConfiguration</span></span><br><span class=\"line\"><span class=\"meta\">@ContextConfiguration</span>(locations = &#123; <span class=\"string\">\"classpath:spring/*-config.xml\"</span>, <span class=\"string\">\"classpath:spring/*-servlet.xml\"</span> &#125;)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BaseController</span> </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> <span class=\"keyword\">static</span> String uid;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 加载配置文件</span></span><br><span class=\"line\">\t\tProperties config = <span class=\"keyword\">new</span> Properties();</span><br><span class=\"line\">\t\tInputStream input = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tinput = API.class.getClassLoader().getResourceAsStream(<span class=\"string\">\"test/test.properties\"</span>);</span><br><span class=\"line\">\t\t\tReader reader = <span class=\"keyword\">new</span> InputStreamReader(input, <span class=\"string\">\"UTF-8\"</span>);</span><br><span class=\"line\">\t\t\tconfig.load(reader);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tuid = config.getProperty(<span class=\"string\">\"uid\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> != input) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t\t\tinput.close();</span><br><span class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// @Autowired</span></span><br><span class=\"line\">\t<span class=\"comment\">// private WebApplicationContext wac;</span></span><br><span class=\"line\">\t</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestUserController</span> <span class=\"keyword\">extends</span> <span class=\"title\">BaseController</span> </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> Logger logger = LoggerFactory.getLogger(<span class=\"keyword\">this</span>.getClass());</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@Autowired</span></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> UserController userController;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">protected</span> MockMvc mockMvc;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Before</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setup</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tmockMvc = MockMvcBuilders.standaloneSetup(userController).build();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Test</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testFindPageUsers</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">\t\tlogger.info(<span class=\"string\">\"uid is &#123;&#125;\"</span>, uid);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\tResultActions ra = mockMvc.perform(MockMvcRequestBuilders.get(<span class=\"string\">\"/user/user_info\"</span>)</span><br><span class=\"line\">\t\t\t\t.accept(MediaType.APPLICATION_JSON).param(<span class=\"string\">\"test\"</span>, <span class=\"string\">\"1\"</span>).param(<span class=\"string\">\"uid\"</span>, uid));</span><br><span class=\"line\">\t\tMvcResult mr = ra.andReturn();</span><br><span class=\"line\">\t\tMockHttpServletResponse resp = mr.getResponse();</span><br><span class=\"line\">\t\tAssert.assertEquals(resp.getStatus(), <span class=\"number\">200</span>);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\tJSONObject obj = JSONObject.parseObject(resp.getContentAsString());</span><br><span class=\"line\">\t\tJSONObject dataObj = obj.getJSONObject(<span class=\"string\">\"data\"</span>);</span><br><span class=\"line\">\t\tAssert.assertEquals(StringUtil.getStr(dataObj.get(<span class=\"string\">\"uid\"</span>)), uid);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"如何去掉单元测试\"><a href=\"#如何去掉单元测试\" class=\"headerlink\" title=\"如何去掉单元测试\"></a>如何去掉单元测试</h2><ul>\n<li>在执行Maven命令的时候加上<code>-Dmaven.test.skip=true</code>即可，比如<code>clean install -Dmaven.test.skip=true</code>，这样就会在执行的过程中跳过单元测试 <code>[INFO] Tests are skipped.</code>，也可以在profiles的properties中增加<code>&lt;maven.test.skip&gt;true&lt;/maven.test.skip&gt;</code>，具体如下<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">profiles</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">profile</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>dev<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">activation</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">activeByDefault</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">activeByDefault</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">activation</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">maven.test.skip</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">maven.test.skip</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">&lt;!-- 日志 --&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">log.root.level</span>&gt;</span>DEBUG<span class=\"tag\">&lt;/<span class=\"name\">log.root.level</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">log.root.name</span>&gt;</span>Service<span class=\"tag\">&lt;/<span class=\"name\">log.root.name</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">log.special</span>&gt;</span>Console<span class=\"tag\">&lt;/<span class=\"name\">log.special</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">profile</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">profile</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">maven.test.skip</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">maven.test.skip</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">&lt;!-- 日志 --&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">log.root.level</span>&gt;</span>DEBUG<span class=\"tag\">&lt;/<span class=\"name\">log.root.level</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">log.root.name</span>&gt;</span>Service<span class=\"tag\">&lt;/<span class=\"name\">log.root.name</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">log.special</span>&gt;</span>Console<span class=\"tag\">&lt;/<span class=\"name\">log.special</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">profile</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">profiles</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"参考如下\"><a href=\"#参考如下\" class=\"headerlink\" title=\"参考如下\"></a>参考如下</h2><ul>\n<li><a href=\"https://maven.apache.org/guides/introduction/introduction-to-profiles.html\">Maven的profiles介绍</a></li>\n<li><a href=\"http://www.tmser.com/post-178.html\">MAVEN 属性定义与使用</a></li>\n<li><a href=\"http://www.open-open.com/lib/view/open1452138592011.html\">Maven的生命周期和插件</a></li>\n<li><a href=\"http://xigua366.iteye.com/blog/2080668?utm_source=tuicool&amp;utm_medium=referral\">利用maven中resources插件的copy-resources目标进行资源copy和过滤</a></li>\n</ul>\n"},{"title":"Windows下自动上传war到Linux服务器，自动部署，自动重启Tomcat的系列脚本","title_url":"Windows-auto-deploy-war-to-Linux","date":"2016-12-19T16:00:00.000Z","description":"Windows下自动上传war到Linux服务器，自动部署，自动重启Tomcat的系列脚本,用于本地自动化部署","_content":"\n## Windows 下自动上传 war 到 Linux 服务器\n\n- 下面的 cmd 脚本通过 Maven 命令执行打包，生成 war\n- 通过 pscp 将 war 上传到服务器\n- 通过 plink 远程调用 Linux 上的 shell 脚本\n- 其中 pscp 来自 PUTTY\n- putty_privatekey 用于 plink 无密码登录 Linux，也可以通过用户名和密码的方式\n- 其中 test-web-deploy.sh 用于自动部署 war\n\n```\n@echo off\nset project_path=D:\\svn-workspace\\test-web\nset local_file=%project_path%\\target\\test-web.war\nset putty_privatekey=D:\\soft\\keys\\test-privatekey.ppk\nset deploy-shell=test-web-deploy.sh\n \nset server_user_1=dev\nset server_passwd_1=123\nset server_ip_1=10.32.22.61\n \nset server_path=/usr/local/apps\n\necho ---------------------------------------------- execute mvn clean install\nD:\ncd %project_path%\ncall mvn clean install -Dmaven.test.skip=true -Ptest\n \necho ---------------------------------------------- upload war file to server \ncall pscp -l %server_user_1% -pw %server_passwd_1% -r %local_file% %server_ip_1%:%server_path%\n\necho ---------------------------------------------- execute %deploy-shell%\ncall plink -i %putty_privatekey% %server_user_1%@%server_ip_1% sh %deploy-shell%\n \npause\n```\n\n## Linux 自动部署 war\n\n- 在下面的脚本是 test-web-deploy.sh，会调用 tomcat_restart.sh，用于重启 Tomcat\n\n```\n#!/bin/bash\napp_name=test-web\napp_path=/usr/local/apps\ntomcat_path=/usr/local/soft/tomcat-test-web\n\ncd $app_path\nif [ -f ${app_name}.war ];then\n    echo find ${app_name}.war, unpack the file then restart the tomcat\n    rm -rvf ./${app_name}/*\n    mv ./${app_name}.war $app_path/${app_name}/\n    cd $app_path/${app_name}\n    jar -xvf ${app_name}.war\n    rm -rvf ${app_name}.war\n  else\n    echo not find ${app_name}.war, only restart the tomcat\nfi\n\ncd $tomcat_path\nsh tomcat_restart.sh\n```\n\n## 自动重启 Tomcat\n\n- 下面的脚本是 tomcat_restart.sh，基本思路是通过 Tomcat 安装路径找到进程pid，杀死后再重启\n\n```\n#!/bin/bash\n# 首先找到tomcat根目录， 确保当前脚本在tomcat根目录下\ntomcat_path=/usr/local/soft/tomcat-test-web\necho tomcat path is $tomcat_path\n\n# 找到tomcat的进程id\ntomcat_pid=$(ps -ef|grep $tomcat_path|gawk '$0 !~/grep/ {print $2}' |tr -s '\\n' ' ')\nif [ \"$tomcat_pid\" ];then\n  echo tomcat process id is $tomcat_pid\n  # 杀掉tomcat进程\n  if\n    kill -9 $tomcat_pid\n  then\n    echo kill tomcat process success\n  else\n   echo kill tomcat process fail\n  fi\nelse\n  echo tomcat is already dead\nfi\n\n# 启动tomcat并重定向到日志输出\nsh $tomcat_path/bin/startup.sh\ntail -f $tomcat_path/logs/catalina.out\n```\n\n## 可能遇到的问题\n\n### 执行 `jar -xvf xxx.war` 的时候提示:`/bin/bash: jar: command not found`\n### 解决如下\n\n```\ncd /usr/bin\nsudo ln -s -f /usr/lib/jvm/jdk1.6.0_30/bin/jar\n```\n**jdk安装目录按自己实际情况更改**\n\n如果提示`javah：commond not found`，于是照葫芦画瓢，输入命令\n\n```\ncd /usr/bin\nln -s -f /usr/lib/jvm/jdk1.6.0_30/bin/javah\n```\n\n## 总结\n\n- 该系列脚本解决了自动部署问题，非常适用于敏捷开发\n- 基于该系列脚本可以实现自动发布系统的开发 :)","source":"_posts/windows下自动上传war到Linux服务器，自动部署，自动重启Tomcat的系列脚本.md","raw":"---\ntitle: Windows下自动上传war到Linux服务器，自动部署，自动重启Tomcat的系列脚本\ntitle_url: Windows-auto-deploy-war-to-Linux\ndate: 2016-12-20\ntags: [自动部署]\ncategories: 技术\ndescription: Windows下自动上传war到Linux服务器，自动部署，自动重启Tomcat的系列脚本,用于本地自动化部署\n---\n\n## Windows 下自动上传 war 到 Linux 服务器\n\n- 下面的 cmd 脚本通过 Maven 命令执行打包，生成 war\n- 通过 pscp 将 war 上传到服务器\n- 通过 plink 远程调用 Linux 上的 shell 脚本\n- 其中 pscp 来自 PUTTY\n- putty_privatekey 用于 plink 无密码登录 Linux，也可以通过用户名和密码的方式\n- 其中 test-web-deploy.sh 用于自动部署 war\n\n```\n@echo off\nset project_path=D:\\svn-workspace\\test-web\nset local_file=%project_path%\\target\\test-web.war\nset putty_privatekey=D:\\soft\\keys\\test-privatekey.ppk\nset deploy-shell=test-web-deploy.sh\n \nset server_user_1=dev\nset server_passwd_1=123\nset server_ip_1=10.32.22.61\n \nset server_path=/usr/local/apps\n\necho ---------------------------------------------- execute mvn clean install\nD:\ncd %project_path%\ncall mvn clean install -Dmaven.test.skip=true -Ptest\n \necho ---------------------------------------------- upload war file to server \ncall pscp -l %server_user_1% -pw %server_passwd_1% -r %local_file% %server_ip_1%:%server_path%\n\necho ---------------------------------------------- execute %deploy-shell%\ncall plink -i %putty_privatekey% %server_user_1%@%server_ip_1% sh %deploy-shell%\n \npause\n```\n\n## Linux 自动部署 war\n\n- 在下面的脚本是 test-web-deploy.sh，会调用 tomcat_restart.sh，用于重启 Tomcat\n\n```\n#!/bin/bash\napp_name=test-web\napp_path=/usr/local/apps\ntomcat_path=/usr/local/soft/tomcat-test-web\n\ncd $app_path\nif [ -f ${app_name}.war ];then\n    echo find ${app_name}.war, unpack the file then restart the tomcat\n    rm -rvf ./${app_name}/*\n    mv ./${app_name}.war $app_path/${app_name}/\n    cd $app_path/${app_name}\n    jar -xvf ${app_name}.war\n    rm -rvf ${app_name}.war\n  else\n    echo not find ${app_name}.war, only restart the tomcat\nfi\n\ncd $tomcat_path\nsh tomcat_restart.sh\n```\n\n## 自动重启 Tomcat\n\n- 下面的脚本是 tomcat_restart.sh，基本思路是通过 Tomcat 安装路径找到进程pid，杀死后再重启\n\n```\n#!/bin/bash\n# 首先找到tomcat根目录， 确保当前脚本在tomcat根目录下\ntomcat_path=/usr/local/soft/tomcat-test-web\necho tomcat path is $tomcat_path\n\n# 找到tomcat的进程id\ntomcat_pid=$(ps -ef|grep $tomcat_path|gawk '$0 !~/grep/ {print $2}' |tr -s '\\n' ' ')\nif [ \"$tomcat_pid\" ];then\n  echo tomcat process id is $tomcat_pid\n  # 杀掉tomcat进程\n  if\n    kill -9 $tomcat_pid\n  then\n    echo kill tomcat process success\n  else\n   echo kill tomcat process fail\n  fi\nelse\n  echo tomcat is already dead\nfi\n\n# 启动tomcat并重定向到日志输出\nsh $tomcat_path/bin/startup.sh\ntail -f $tomcat_path/logs/catalina.out\n```\n\n## 可能遇到的问题\n\n### 执行 `jar -xvf xxx.war` 的时候提示:`/bin/bash: jar: command not found`\n### 解决如下\n\n```\ncd /usr/bin\nsudo ln -s -f /usr/lib/jvm/jdk1.6.0_30/bin/jar\n```\n**jdk安装目录按自己实际情况更改**\n\n如果提示`javah：commond not found`，于是照葫芦画瓢，输入命令\n\n```\ncd /usr/bin\nln -s -f /usr/lib/jvm/jdk1.6.0_30/bin/javah\n```\n\n## 总结\n\n- 该系列脚本解决了自动部署问题，非常适用于敏捷开发\n- 基于该系列脚本可以实现自动发布系统的开发 :)","slug":"windows下自动上传war到Linux服务器，自动部署，自动重启Tomcat的系列脚本","published":1,"updated":"2017-06-14T03:18:53.535Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj5jgsbe5000n2cezydance39","content":"<h2 id=\"Windows-下自动上传-war-到-Linux-服务器\"><a href=\"#Windows-下自动上传-war-到-Linux-服务器\" class=\"headerlink\" title=\"Windows 下自动上传 war 到 Linux 服务器\"></a>Windows 下自动上传 war 到 Linux 服务器</h2><ul>\n<li>下面的 cmd 脚本通过 Maven 命令执行打包，生成 war</li>\n<li>通过 pscp 将 war 上传到服务器</li>\n<li>通过 plink 远程调用 Linux 上的 shell 脚本</li>\n<li>其中 pscp 来自 PUTTY</li>\n<li>putty_privatekey 用于 plink 无密码登录 Linux，也可以通过用户名和密码的方式</li>\n<li>其中 test-web-deploy.sh 用于自动部署 war</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@echo off</span><br><span class=\"line\">set project_path=D:\\svn-workspace\\test-web</span><br><span class=\"line\">set local_file=%project_path%\\target\\test-web.war</span><br><span class=\"line\">set putty_privatekey=D:\\soft\\keys\\test-privatekey.ppk</span><br><span class=\"line\">set deploy-shell=test-web-deploy.sh</span><br><span class=\"line\"> </span><br><span class=\"line\">set server_user_1=dev</span><br><span class=\"line\">set server_passwd_1=123</span><br><span class=\"line\">set server_ip_1=10.32.22.61</span><br><span class=\"line\"> </span><br><span class=\"line\">set server_path=/usr/local/apps</span><br><span class=\"line\"></span><br><span class=\"line\">echo ---------------------------------------------- execute mvn clean install</span><br><span class=\"line\">D:</span><br><span class=\"line\">cd %project_path%</span><br><span class=\"line\">call mvn clean install -Dmaven.test.skip=true -Ptest</span><br><span class=\"line\"> </span><br><span class=\"line\">echo ---------------------------------------------- upload war file to server </span><br><span class=\"line\">call pscp -l %server_user_1% -pw %server_passwd_1% -r %local_file% %server_ip_1%:%server_path%</span><br><span class=\"line\"></span><br><span class=\"line\">echo ---------------------------------------------- execute %deploy-shell%</span><br><span class=\"line\">call plink -i %putty_privatekey% %server_user_1%@%server_ip_1% sh %deploy-shell%</span><br><span class=\"line\"> </span><br><span class=\"line\">pause</span><br></pre></td></tr></table></figure>\n<h2 id=\"Linux-自动部署-war\"><a href=\"#Linux-自动部署-war\" class=\"headerlink\" title=\"Linux 自动部署 war\"></a>Linux 自动部署 war</h2><ul>\n<li>在下面的脚本是 test-web-deploy.sh，会调用 tomcat_restart.sh，用于重启 Tomcat</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\">app_name=test-web</span><br><span class=\"line\">app_path=/usr/local/apps</span><br><span class=\"line\">tomcat_path=/usr/local/soft/tomcat-test-web</span><br><span class=\"line\"></span><br><span class=\"line\">cd $app_path</span><br><span class=\"line\">if [ -f $&#123;app_name&#125;.war ];then</span><br><span class=\"line\">    echo find $&#123;app_name&#125;.war, unpack the file then restart the tomcat</span><br><span class=\"line\">    rm -rvf ./$&#123;app_name&#125;/*</span><br><span class=\"line\">    mv ./$&#123;app_name&#125;.war $app_path/$&#123;app_name&#125;/</span><br><span class=\"line\">    cd $app_path/$&#123;app_name&#125;</span><br><span class=\"line\">    jar -xvf $&#123;app_name&#125;.war</span><br><span class=\"line\">    rm -rvf $&#123;app_name&#125;.war</span><br><span class=\"line\">  else</span><br><span class=\"line\">    echo not find $&#123;app_name&#125;.war, only restart the tomcat</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\">cd $tomcat_path</span><br><span class=\"line\">sh tomcat_restart.sh</span><br></pre></td></tr></table></figure>\n<h2 id=\"自动重启-Tomcat\"><a href=\"#自动重启-Tomcat\" class=\"headerlink\" title=\"自动重启 Tomcat\"></a>自动重启 Tomcat</h2><ul>\n<li>下面的脚本是 tomcat_restart.sh，基本思路是通过 Tomcat 安装路径找到进程pid，杀死后再重启</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\"># 首先找到tomcat根目录， 确保当前脚本在tomcat根目录下</span><br><span class=\"line\">tomcat_path=/usr/local/soft/tomcat-test-web</span><br><span class=\"line\">echo tomcat path is $tomcat_path</span><br><span class=\"line\"></span><br><span class=\"line\"># 找到tomcat的进程id</span><br><span class=\"line\">tomcat_pid=$(ps -ef|grep $tomcat_path|gawk &apos;$0 !~/grep/ &#123;print $2&#125;&apos; |tr -s &apos;\\n&apos; &apos; &apos;)</span><br><span class=\"line\">if [ &quot;$tomcat_pid&quot; ];then</span><br><span class=\"line\">  echo tomcat process id is $tomcat_pid</span><br><span class=\"line\">  # 杀掉tomcat进程</span><br><span class=\"line\">  if</span><br><span class=\"line\">    kill -9 $tomcat_pid</span><br><span class=\"line\">  then</span><br><span class=\"line\">    echo kill tomcat process success</span><br><span class=\"line\">  else</span><br><span class=\"line\">   echo kill tomcat process fail</span><br><span class=\"line\">  fi</span><br><span class=\"line\">else</span><br><span class=\"line\">  echo tomcat is already dead</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\"># 启动tomcat并重定向到日志输出</span><br><span class=\"line\">sh $tomcat_path/bin/startup.sh</span><br><span class=\"line\">tail -f $tomcat_path/logs/catalina.out</span><br></pre></td></tr></table></figure>\n<h2 id=\"可能遇到的问题\"><a href=\"#可能遇到的问题\" class=\"headerlink\" title=\"可能遇到的问题\"></a>可能遇到的问题</h2><h3 id=\"执行-jar-xvf-xxx-war-的时候提示-bin-bash-jar-command-not-found\"><a href=\"#执行-jar-xvf-xxx-war-的时候提示-bin-bash-jar-command-not-found\" class=\"headerlink\" title=\"执行 jar -xvf xxx.war 的时候提示:/bin/bash: jar: command not found\"></a>执行 <code>jar -xvf xxx.war</code> 的时候提示:<code>/bin/bash: jar: command not found</code></h3><h3 id=\"解决如下\"><a href=\"#解决如下\" class=\"headerlink\" title=\"解决如下\"></a>解决如下</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /usr/bin</span><br><span class=\"line\">sudo ln -s -f /usr/lib/jvm/jdk1.6.0_30/bin/jar</span><br></pre></td></tr></table></figure>\n<p><strong>jdk安装目录按自己实际情况更改</strong></p>\n<p>如果提示<code>javah：commond not found</code>，于是照葫芦画瓢，输入命令</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /usr/bin</span><br><span class=\"line\">ln -s -f /usr/lib/jvm/jdk1.6.0_30/bin/javah</span><br></pre></td></tr></table></figure>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><ul>\n<li>该系列脚本解决了自动部署问题，非常适用于敏捷开发</li>\n<li>基于该系列脚本可以实现自动发布系统的开发 :)</li>\n</ul>\n","excerpt":"","more":"<h2 id=\"Windows-下自动上传-war-到-Linux-服务器\"><a href=\"#Windows-下自动上传-war-到-Linux-服务器\" class=\"headerlink\" title=\"Windows 下自动上传 war 到 Linux 服务器\"></a>Windows 下自动上传 war 到 Linux 服务器</h2><ul>\n<li>下面的 cmd 脚本通过 Maven 命令执行打包，生成 war</li>\n<li>通过 pscp 将 war 上传到服务器</li>\n<li>通过 plink 远程调用 Linux 上的 shell 脚本</li>\n<li>其中 pscp 来自 PUTTY</li>\n<li>putty_privatekey 用于 plink 无密码登录 Linux，也可以通过用户名和密码的方式</li>\n<li>其中 test-web-deploy.sh 用于自动部署 war</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@echo off</span><br><span class=\"line\">set project_path=D:\\svn-workspace\\test-web</span><br><span class=\"line\">set local_file=%project_path%\\target\\test-web.war</span><br><span class=\"line\">set putty_privatekey=D:\\soft\\keys\\test-privatekey.ppk</span><br><span class=\"line\">set deploy-shell=test-web-deploy.sh</span><br><span class=\"line\"> </span><br><span class=\"line\">set server_user_1=dev</span><br><span class=\"line\">set server_passwd_1=123</span><br><span class=\"line\">set server_ip_1=10.32.22.61</span><br><span class=\"line\"> </span><br><span class=\"line\">set server_path=/usr/local/apps</span><br><span class=\"line\"></span><br><span class=\"line\">echo ---------------------------------------------- execute mvn clean install</span><br><span class=\"line\">D:</span><br><span class=\"line\">cd %project_path%</span><br><span class=\"line\">call mvn clean install -Dmaven.test.skip=true -Ptest</span><br><span class=\"line\"> </span><br><span class=\"line\">echo ---------------------------------------------- upload war file to server </span><br><span class=\"line\">call pscp -l %server_user_1% -pw %server_passwd_1% -r %local_file% %server_ip_1%:%server_path%</span><br><span class=\"line\"></span><br><span class=\"line\">echo ---------------------------------------------- execute %deploy-shell%</span><br><span class=\"line\">call plink -i %putty_privatekey% %server_user_1%@%server_ip_1% sh %deploy-shell%</span><br><span class=\"line\"> </span><br><span class=\"line\">pause</span><br></pre></td></tr></table></figure>\n<h2 id=\"Linux-自动部署-war\"><a href=\"#Linux-自动部署-war\" class=\"headerlink\" title=\"Linux 自动部署 war\"></a>Linux 自动部署 war</h2><ul>\n<li>在下面的脚本是 test-web-deploy.sh，会调用 tomcat_restart.sh，用于重启 Tomcat</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\">app_name=test-web</span><br><span class=\"line\">app_path=/usr/local/apps</span><br><span class=\"line\">tomcat_path=/usr/local/soft/tomcat-test-web</span><br><span class=\"line\"></span><br><span class=\"line\">cd $app_path</span><br><span class=\"line\">if [ -f $&#123;app_name&#125;.war ];then</span><br><span class=\"line\">    echo find $&#123;app_name&#125;.war, unpack the file then restart the tomcat</span><br><span class=\"line\">    rm -rvf ./$&#123;app_name&#125;/*</span><br><span class=\"line\">    mv ./$&#123;app_name&#125;.war $app_path/$&#123;app_name&#125;/</span><br><span class=\"line\">    cd $app_path/$&#123;app_name&#125;</span><br><span class=\"line\">    jar -xvf $&#123;app_name&#125;.war</span><br><span class=\"line\">    rm -rvf $&#123;app_name&#125;.war</span><br><span class=\"line\">  else</span><br><span class=\"line\">    echo not find $&#123;app_name&#125;.war, only restart the tomcat</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\">cd $tomcat_path</span><br><span class=\"line\">sh tomcat_restart.sh</span><br></pre></td></tr></table></figure>\n<h2 id=\"自动重启-Tomcat\"><a href=\"#自动重启-Tomcat\" class=\"headerlink\" title=\"自动重启 Tomcat\"></a>自动重启 Tomcat</h2><ul>\n<li>下面的脚本是 tomcat_restart.sh，基本思路是通过 Tomcat 安装路径找到进程pid，杀死后再重启</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\"># 首先找到tomcat根目录， 确保当前脚本在tomcat根目录下</span><br><span class=\"line\">tomcat_path=/usr/local/soft/tomcat-test-web</span><br><span class=\"line\">echo tomcat path is $tomcat_path</span><br><span class=\"line\"></span><br><span class=\"line\"># 找到tomcat的进程id</span><br><span class=\"line\">tomcat_pid=$(ps -ef|grep $tomcat_path|gawk &apos;$0 !~/grep/ &#123;print $2&#125;&apos; |tr -s &apos;\\n&apos; &apos; &apos;)</span><br><span class=\"line\">if [ &quot;$tomcat_pid&quot; ];then</span><br><span class=\"line\">  echo tomcat process id is $tomcat_pid</span><br><span class=\"line\">  # 杀掉tomcat进程</span><br><span class=\"line\">  if</span><br><span class=\"line\">    kill -9 $tomcat_pid</span><br><span class=\"line\">  then</span><br><span class=\"line\">    echo kill tomcat process success</span><br><span class=\"line\">  else</span><br><span class=\"line\">   echo kill tomcat process fail</span><br><span class=\"line\">  fi</span><br><span class=\"line\">else</span><br><span class=\"line\">  echo tomcat is already dead</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\"># 启动tomcat并重定向到日志输出</span><br><span class=\"line\">sh $tomcat_path/bin/startup.sh</span><br><span class=\"line\">tail -f $tomcat_path/logs/catalina.out</span><br></pre></td></tr></table></figure>\n<h2 id=\"可能遇到的问题\"><a href=\"#可能遇到的问题\" class=\"headerlink\" title=\"可能遇到的问题\"></a>可能遇到的问题</h2><h3 id=\"执行-jar-xvf-xxx-war-的时候提示-bin-bash-jar-command-not-found\"><a href=\"#执行-jar-xvf-xxx-war-的时候提示-bin-bash-jar-command-not-found\" class=\"headerlink\" title=\"执行 jar -xvf xxx.war 的时候提示:/bin/bash: jar: command not found\"></a>执行 <code>jar -xvf xxx.war</code> 的时候提示:<code>/bin/bash: jar: command not found</code></h3><h3 id=\"解决如下\"><a href=\"#解决如下\" class=\"headerlink\" title=\"解决如下\"></a>解决如下</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /usr/bin</span><br><span class=\"line\">sudo ln -s -f /usr/lib/jvm/jdk1.6.0_30/bin/jar</span><br></pre></td></tr></table></figure>\n<p><strong>jdk安装目录按自己实际情况更改</strong></p>\n<p>如果提示<code>javah：commond not found</code>，于是照葫芦画瓢，输入命令</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /usr/bin</span><br><span class=\"line\">ln -s -f /usr/lib/jvm/jdk1.6.0_30/bin/javah</span><br></pre></td></tr></table></figure>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><ul>\n<li>该系列脚本解决了自动部署问题，非常适用于敏捷开发</li>\n<li>基于该系列脚本可以实现自动发布系统的开发 :)</li>\n</ul>\n"},{"title":"Phabricator 在 Windows 环境上的部署与二次开发","title_url":"Phabricator-Windows-setup","date":"2017-07-02T16:00:00.000Z","description":"Phabricator 在 Windows 环境上的部署与二次开发","_content":"\n## 基本开发工具\n\n- [eclipse-php-oxygen-R-win32-x86_64.zip](http://mirror.rise.ph/eclipse/technology/epp/downloads/release/oxygen/R/eclipse-php-oxygen-R-win32-x86_64.zip)\n- [wampserver3.0.6_x64_apache2.4.23_mysql5.7.14_php5.6.25-7.0.10.exe](https://wampserver-64bit.en.softonic.com/)\n- [git-for-windows-2.13.2](https://git-for-windows.github.io/)\n\n其中 wampserver 安装在 `C:\\wamp64`\n\neclipse-php 需要在 `Window -> Preferences -> PHP` 设置安装好的 PHP,Debug,Execution Environments 等信息,具体参考->[这里](http://tiame.iteye.com/blog/1454234)\n\n- 这里最终推荐使用 PhpStorm 来二次开发 Phabricator，因为本人在使用 eclipse-php 和 xdebug 来 debug Phabricator 的时候 eclipse-php 很容易崩溃，而 PhpStorm 就没有任何问题，总之，花钱的东西就是好用。\n\n## Phabricator 部署\n\n在 eclipse-php 中新建一个 php 项目, 地址在 `D:\\php-workspace\\phabricator`, 在 Git Bash 中进入该目录, 执行如下命令拉取 Phabricator 代码\n\n```\ngit clone https://github.com/phacility/libphutil.git\ngit clone https://github.com/phacility/arcanist.git\ngit clone https://github.com/phacility/phabricator.git\n```\n\n完毕后, 将 arcanist, libphutil, phabricator 三个文件夹 以 File System 的形式导入到php项目中\n\n启动 wampserver, 在浏览器中打开 `http://localhost/index.php` 进入 WampServer 管理页面,在下面的 Tools 栏中点击 `Add a Virtual Host` 链接创建一个VirtualHost, \n\n第一栏填写 test.pha.com\n第二栏不填\n第三栏填写 D:\\php-workspace\\phabricator\\phabricator\\webroot\n\n点击保存, 成功后会在 WampServer 主页下面的 Your VirtualHost 栏中增加 test.pha.com 站点, 这时候在 `C:\\Windows\\System32\\drivers\\etc` 中会增加如下信息\n\n```\n::1 test.pha.com\n```\n\n在 `C:\\wamp64\\bin\\apache\\apache2.4.23\\conf\\extra\\httpd-vhosts.conf` 中会增加如下信息\n\n```\n<VirtualHost *:80>\n\tServerName test.pha.com\n\tDocumentRoot \"d:/php-workspace/phabricator/phabricator/webroot\"\n\t\n\tRewriteEngine on\n    RewriteRule ^(.*)$          /index.php?__path__=$1  [B,L,QSA]\n\t<Directory  \"d:/php-workspace/phabricator/phabricator/webroot/\">\n\t\tOptions +Indexes +Includes +FollowSymLinks +MultiViews\n\t\tAllowOverride All\n\t\tRequire local\n\t</Directory>\n</VirtualHost>\n```\n\n这个时候就可以通过 `test.pha.com` 访问 Phabricator 了,如果提示数据库未配置,或者需要执行 `upgrade` 操作\n\n那么通过 Git Bash cd 到 `D:\\php-workspace\\phabricator\\phabricator` 目录, 执行如下命令来设置 mysql 的相关信息\n\n```\nphp scripts/setup/manage_config.php set mysql.host localhost\nphp scripts/setup/manage_config.php set mysql.port 3306\nphp scripts/setup/manage_config.php set mysql.user root\nphp scripts/setup/manage_config.php set mysql.pass 123\n```\n\n通过如下命令进行 upgrade\n\n```\nphp scripts/sql/manage_storage.php upgrade\n```\n\n这里之所以不能和官方wiki那样通过 `./bin/config set mysql.host localhost` 的原因是 bin 目录下面在 Linux 环境中都是符号链接, 通过 Git Clone 到 Windows 环境后变成了文件\n\n## 扩展phabricator验证\n\n- [扩展phabricator验证](https://popozhu.github.io/2016/05/31/扩展phabricator验证/)\n\n## 参考\n\n- [Phabricator 用户手册](https://admin.phacility.com/book/phacility/)\n- [VirtualHost 配置参考](https://httpd.apache.org/docs/2.4/vhosts/examples.html)\n- [Eclipse集成PDT+XDebug调试PHP脚本](http://pjdong1990.iteye.com/blog/1610305)\n- [Phabricator 技术文档](https://secure.phabricator.com/diviner/)\n- [Phabricator 二次开发入门](https://secure.phabricator.com/book/phabcontrib/)\n- [Phabricator 基本代码结构](https://secure.phabricator.com/book/phabcontrib/article/phabricator_code_layout/)\n- [xdebug 配置向导](https://xdebug.org/wizard.php)\n","source":"_posts/Phabricator 在 Windows 环境上的部署与二次开发.md","raw":"---\ntitle: Phabricator 在 Windows 环境上的部署与二次开发\ntitle_url: Phabricator-Windows-setup\ndate: 2017-07-03\ntags: Phabricator\ncategories: [Phabricator,PHP]\ndescription: Phabricator 在 Windows 环境上的部署与二次开发\n---\n\n## 基本开发工具\n\n- [eclipse-php-oxygen-R-win32-x86_64.zip](http://mirror.rise.ph/eclipse/technology/epp/downloads/release/oxygen/R/eclipse-php-oxygen-R-win32-x86_64.zip)\n- [wampserver3.0.6_x64_apache2.4.23_mysql5.7.14_php5.6.25-7.0.10.exe](https://wampserver-64bit.en.softonic.com/)\n- [git-for-windows-2.13.2](https://git-for-windows.github.io/)\n\n其中 wampserver 安装在 `C:\\wamp64`\n\neclipse-php 需要在 `Window -> Preferences -> PHP` 设置安装好的 PHP,Debug,Execution Environments 等信息,具体参考->[这里](http://tiame.iteye.com/blog/1454234)\n\n- 这里最终推荐使用 PhpStorm 来二次开发 Phabricator，因为本人在使用 eclipse-php 和 xdebug 来 debug Phabricator 的时候 eclipse-php 很容易崩溃，而 PhpStorm 就没有任何问题，总之，花钱的东西就是好用。\n\n## Phabricator 部署\n\n在 eclipse-php 中新建一个 php 项目, 地址在 `D:\\php-workspace\\phabricator`, 在 Git Bash 中进入该目录, 执行如下命令拉取 Phabricator 代码\n\n```\ngit clone https://github.com/phacility/libphutil.git\ngit clone https://github.com/phacility/arcanist.git\ngit clone https://github.com/phacility/phabricator.git\n```\n\n完毕后, 将 arcanist, libphutil, phabricator 三个文件夹 以 File System 的形式导入到php项目中\n\n启动 wampserver, 在浏览器中打开 `http://localhost/index.php` 进入 WampServer 管理页面,在下面的 Tools 栏中点击 `Add a Virtual Host` 链接创建一个VirtualHost, \n\n第一栏填写 test.pha.com\n第二栏不填\n第三栏填写 D:\\php-workspace\\phabricator\\phabricator\\webroot\n\n点击保存, 成功后会在 WampServer 主页下面的 Your VirtualHost 栏中增加 test.pha.com 站点, 这时候在 `C:\\Windows\\System32\\drivers\\etc` 中会增加如下信息\n\n```\n::1 test.pha.com\n```\n\n在 `C:\\wamp64\\bin\\apache\\apache2.4.23\\conf\\extra\\httpd-vhosts.conf` 中会增加如下信息\n\n```\n<VirtualHost *:80>\n\tServerName test.pha.com\n\tDocumentRoot \"d:/php-workspace/phabricator/phabricator/webroot\"\n\t\n\tRewriteEngine on\n    RewriteRule ^(.*)$          /index.php?__path__=$1  [B,L,QSA]\n\t<Directory  \"d:/php-workspace/phabricator/phabricator/webroot/\">\n\t\tOptions +Indexes +Includes +FollowSymLinks +MultiViews\n\t\tAllowOverride All\n\t\tRequire local\n\t</Directory>\n</VirtualHost>\n```\n\n这个时候就可以通过 `test.pha.com` 访问 Phabricator 了,如果提示数据库未配置,或者需要执行 `upgrade` 操作\n\n那么通过 Git Bash cd 到 `D:\\php-workspace\\phabricator\\phabricator` 目录, 执行如下命令来设置 mysql 的相关信息\n\n```\nphp scripts/setup/manage_config.php set mysql.host localhost\nphp scripts/setup/manage_config.php set mysql.port 3306\nphp scripts/setup/manage_config.php set mysql.user root\nphp scripts/setup/manage_config.php set mysql.pass 123\n```\n\n通过如下命令进行 upgrade\n\n```\nphp scripts/sql/manage_storage.php upgrade\n```\n\n这里之所以不能和官方wiki那样通过 `./bin/config set mysql.host localhost` 的原因是 bin 目录下面在 Linux 环境中都是符号链接, 通过 Git Clone 到 Windows 环境后变成了文件\n\n## 扩展phabricator验证\n\n- [扩展phabricator验证](https://popozhu.github.io/2016/05/31/扩展phabricator验证/)\n\n## 参考\n\n- [Phabricator 用户手册](https://admin.phacility.com/book/phacility/)\n- [VirtualHost 配置参考](https://httpd.apache.org/docs/2.4/vhosts/examples.html)\n- [Eclipse集成PDT+XDebug调试PHP脚本](http://pjdong1990.iteye.com/blog/1610305)\n- [Phabricator 技术文档](https://secure.phabricator.com/diviner/)\n- [Phabricator 二次开发入门](https://secure.phabricator.com/book/phabcontrib/)\n- [Phabricator 基本代码结构](https://secure.phabricator.com/book/phabcontrib/article/phabricator_code_layout/)\n- [xdebug 配置向导](https://xdebug.org/wizard.php)\n","slug":"Phabricator 在 Windows 环境上的部署与二次开发","published":1,"updated":"2017-07-25T10:54:15.601Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj5jgsbe9000r2cezscscfhln","content":"<h2 id=\"基本开发工具\"><a href=\"#基本开发工具\" class=\"headerlink\" title=\"基本开发工具\"></a>基本开发工具</h2><ul>\n<li><a href=\"http://mirror.rise.ph/eclipse/technology/epp/downloads/release/oxygen/R/eclipse-php-oxygen-R-win32-x86_64.zip\" target=\"_blank\" rel=\"external\">eclipse-php-oxygen-R-win32-x86_64.zip</a></li>\n<li><a href=\"https://wampserver-64bit.en.softonic.com/\" target=\"_blank\" rel=\"external\">wampserver3.0.6_x64_apache2.4.23_mysql5.7.14_php5.6.25-7.0.10.exe</a></li>\n<li><a href=\"https://git-for-windows.github.io/\" target=\"_blank\" rel=\"external\">git-for-windows-2.13.2</a></li>\n</ul>\n<p>其中 wampserver 安装在 <code>C:\\wamp64</code></p>\n<p>eclipse-php 需要在 <code>Window -&gt; Preferences -&gt; PHP</code> 设置安装好的 PHP,Debug,Execution Environments 等信息,具体参考-&gt;<a href=\"http://tiame.iteye.com/blog/1454234\" target=\"_blank\" rel=\"external\">这里</a></p>\n<ul>\n<li>这里最终推荐使用 PhpStorm 来二次开发 Phabricator，因为本人在使用 eclipse-php 和 xdebug 来 debug Phabricator 的时候 eclipse-php 很容易崩溃，而 PhpStorm 就没有任何问题，总之，花钱的东西就是好用。</li>\n</ul>\n<h2 id=\"Phabricator-部署\"><a href=\"#Phabricator-部署\" class=\"headerlink\" title=\"Phabricator 部署\"></a>Phabricator 部署</h2><p>在 eclipse-php 中新建一个 php 项目, 地址在 <code>D:\\php-workspace\\phabricator</code>, 在 Git Bash 中进入该目录, 执行如下命令拉取 Phabricator 代码</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/phacility/libphutil.git</span><br><span class=\"line\">git clone https://github.com/phacility/arcanist.git</span><br><span class=\"line\">git clone https://github.com/phacility/phabricator.git</span><br></pre></td></tr></table></figure>\n<p>完毕后, 将 arcanist, libphutil, phabricator 三个文件夹 以 File System 的形式导入到php项目中</p>\n<p>启动 wampserver, 在浏览器中打开 <code>http://localhost/index.php</code> 进入 WampServer 管理页面,在下面的 Tools 栏中点击 <code>Add a Virtual Host</code> 链接创建一个VirtualHost, </p>\n<p>第一栏填写 test.pha.com<br>第二栏不填<br>第三栏填写 D:\\php-workspace\\phabricator\\phabricator\\webroot</p>\n<p>点击保存, 成功后会在 WampServer 主页下面的 Your VirtualHost 栏中增加 test.pha.com 站点, 这时候在 <code>C:\\Windows\\System32\\drivers\\etc</code> 中会增加如下信息</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">::1 test.pha.com</span><br></pre></td></tr></table></figure>\n<p>在 <code>C:\\wamp64\\bin\\apache\\apache2.4.23\\conf\\extra\\httpd-vhosts.conf</code> 中会增加如下信息</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;VirtualHost *:80&gt;</span><br><span class=\"line\">\tServerName test.pha.com</span><br><span class=\"line\">\tDocumentRoot &quot;d:/php-workspace/phabricator/phabricator/webroot&quot;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tRewriteEngine on</span><br><span class=\"line\">    RewriteRule ^(.*)$          /index.php?__path__=$1  [B,L,QSA]</span><br><span class=\"line\">\t&lt;Directory  &quot;d:/php-workspace/phabricator/phabricator/webroot/&quot;&gt;</span><br><span class=\"line\">\t\tOptions +Indexes +Includes +FollowSymLinks +MultiViews</span><br><span class=\"line\">\t\tAllowOverride All</span><br><span class=\"line\">\t\tRequire local</span><br><span class=\"line\">\t&lt;/Directory&gt;</span><br><span class=\"line\">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure>\n<p>这个时候就可以通过 <code>test.pha.com</code> 访问 Phabricator 了,如果提示数据库未配置,或者需要执行 <code>upgrade</code> 操作</p>\n<p>那么通过 Git Bash cd 到 <code>D:\\php-workspace\\phabricator\\phabricator</code> 目录, 执行如下命令来设置 mysql 的相关信息</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php scripts/setup/manage_config.php set mysql.host localhost</span><br><span class=\"line\">php scripts/setup/manage_config.php set mysql.port 3306</span><br><span class=\"line\">php scripts/setup/manage_config.php set mysql.user root</span><br><span class=\"line\">php scripts/setup/manage_config.php set mysql.pass 123</span><br></pre></td></tr></table></figure>\n<p>通过如下命令进行 upgrade</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php scripts/sql/manage_storage.php upgrade</span><br></pre></td></tr></table></figure>\n<p>这里之所以不能和官方wiki那样通过 <code>./bin/config set mysql.host localhost</code> 的原因是 bin 目录下面在 Linux 环境中都是符号链接, 通过 Git Clone 到 Windows 环境后变成了文件</p>\n<h2 id=\"扩展phabricator验证\"><a href=\"#扩展phabricator验证\" class=\"headerlink\" title=\"扩展phabricator验证\"></a>扩展phabricator验证</h2><ul>\n<li><a href=\"https://popozhu.github.io/2016/05/31/扩展phabricator验证/\" target=\"_blank\" rel=\"external\">扩展phabricator验证</a></li>\n</ul>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ul>\n<li><a href=\"https://admin.phacility.com/book/phacility/\" target=\"_blank\" rel=\"external\">Phabricator 用户手册</a></li>\n<li><a href=\"https://httpd.apache.org/docs/2.4/vhosts/examples.html\" target=\"_blank\" rel=\"external\">VirtualHost 配置参考</a></li>\n<li><a href=\"http://pjdong1990.iteye.com/blog/1610305\" target=\"_blank\" rel=\"external\">Eclipse集成PDT+XDebug调试PHP脚本</a></li>\n<li><a href=\"https://secure.phabricator.com/diviner/\" target=\"_blank\" rel=\"external\">Phabricator 技术文档</a></li>\n<li><a href=\"https://secure.phabricator.com/book/phabcontrib/\" target=\"_blank\" rel=\"external\">Phabricator 二次开发入门</a></li>\n<li><a href=\"https://secure.phabricator.com/book/phabcontrib/article/phabricator_code_layout/\" target=\"_blank\" rel=\"external\">Phabricator 基本代码结构</a></li>\n<li><a href=\"https://xdebug.org/wizard.php\" target=\"_blank\" rel=\"external\">xdebug 配置向导</a></li>\n</ul>\n","excerpt":"","more":"<h2 id=\"基本开发工具\"><a href=\"#基本开发工具\" class=\"headerlink\" title=\"基本开发工具\"></a>基本开发工具</h2><ul>\n<li><a href=\"http://mirror.rise.ph/eclipse/technology/epp/downloads/release/oxygen/R/eclipse-php-oxygen-R-win32-x86_64.zip\">eclipse-php-oxygen-R-win32-x86_64.zip</a></li>\n<li><a href=\"https://wampserver-64bit.en.softonic.com/\">wampserver3.0.6_x64_apache2.4.23_mysql5.7.14_php5.6.25-7.0.10.exe</a></li>\n<li><a href=\"https://git-for-windows.github.io/\">git-for-windows-2.13.2</a></li>\n</ul>\n<p>其中 wampserver 安装在 <code>C:\\wamp64</code></p>\n<p>eclipse-php 需要在 <code>Window -&gt; Preferences -&gt; PHP</code> 设置安装好的 PHP,Debug,Execution Environments 等信息,具体参考-&gt;<a href=\"http://tiame.iteye.com/blog/1454234\">这里</a></p>\n<ul>\n<li>这里最终推荐使用 PhpStorm 来二次开发 Phabricator，因为本人在使用 eclipse-php 和 xdebug 来 debug Phabricator 的时候 eclipse-php 很容易崩溃，而 PhpStorm 就没有任何问题，总之，花钱的东西就是好用。</li>\n</ul>\n<h2 id=\"Phabricator-部署\"><a href=\"#Phabricator-部署\" class=\"headerlink\" title=\"Phabricator 部署\"></a>Phabricator 部署</h2><p>在 eclipse-php 中新建一个 php 项目, 地址在 <code>D:\\php-workspace\\phabricator</code>, 在 Git Bash 中进入该目录, 执行如下命令拉取 Phabricator 代码</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/phacility/libphutil.git</span><br><span class=\"line\">git clone https://github.com/phacility/arcanist.git</span><br><span class=\"line\">git clone https://github.com/phacility/phabricator.git</span><br></pre></td></tr></table></figure>\n<p>完毕后, 将 arcanist, libphutil, phabricator 三个文件夹 以 File System 的形式导入到php项目中</p>\n<p>启动 wampserver, 在浏览器中打开 <code>http://localhost/index.php</code> 进入 WampServer 管理页面,在下面的 Tools 栏中点击 <code>Add a Virtual Host</code> 链接创建一个VirtualHost, </p>\n<p>第一栏填写 test.pha.com<br>第二栏不填<br>第三栏填写 D:\\php-workspace\\phabricator\\phabricator\\webroot</p>\n<p>点击保存, 成功后会在 WampServer 主页下面的 Your VirtualHost 栏中增加 test.pha.com 站点, 这时候在 <code>C:\\Windows\\System32\\drivers\\etc</code> 中会增加如下信息</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">::1 test.pha.com</span><br></pre></td></tr></table></figure>\n<p>在 <code>C:\\wamp64\\bin\\apache\\apache2.4.23\\conf\\extra\\httpd-vhosts.conf</code> 中会增加如下信息</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;VirtualHost *:80&gt;</span><br><span class=\"line\">\tServerName test.pha.com</span><br><span class=\"line\">\tDocumentRoot &quot;d:/php-workspace/phabricator/phabricator/webroot&quot;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tRewriteEngine on</span><br><span class=\"line\">    RewriteRule ^(.*)$          /index.php?__path__=$1  [B,L,QSA]</span><br><span class=\"line\">\t&lt;Directory  &quot;d:/php-workspace/phabricator/phabricator/webroot/&quot;&gt;</span><br><span class=\"line\">\t\tOptions +Indexes +Includes +FollowSymLinks +MultiViews</span><br><span class=\"line\">\t\tAllowOverride All</span><br><span class=\"line\">\t\tRequire local</span><br><span class=\"line\">\t&lt;/Directory&gt;</span><br><span class=\"line\">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure>\n<p>这个时候就可以通过 <code>test.pha.com</code> 访问 Phabricator 了,如果提示数据库未配置,或者需要执行 <code>upgrade</code> 操作</p>\n<p>那么通过 Git Bash cd 到 <code>D:\\php-workspace\\phabricator\\phabricator</code> 目录, 执行如下命令来设置 mysql 的相关信息</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php scripts/setup/manage_config.php set mysql.host localhost</span><br><span class=\"line\">php scripts/setup/manage_config.php set mysql.port 3306</span><br><span class=\"line\">php scripts/setup/manage_config.php set mysql.user root</span><br><span class=\"line\">php scripts/setup/manage_config.php set mysql.pass 123</span><br></pre></td></tr></table></figure>\n<p>通过如下命令进行 upgrade</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php scripts/sql/manage_storage.php upgrade</span><br></pre></td></tr></table></figure>\n<p>这里之所以不能和官方wiki那样通过 <code>./bin/config set mysql.host localhost</code> 的原因是 bin 目录下面在 Linux 环境中都是符号链接, 通过 Git Clone 到 Windows 环境后变成了文件</p>\n<h2 id=\"扩展phabricator验证\"><a href=\"#扩展phabricator验证\" class=\"headerlink\" title=\"扩展phabricator验证\"></a>扩展phabricator验证</h2><ul>\n<li><a href=\"https://popozhu.github.io/2016/05/31/扩展phabricator验证/\">扩展phabricator验证</a></li>\n</ul>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ul>\n<li><a href=\"https://admin.phacility.com/book/phacility/\">Phabricator 用户手册</a></li>\n<li><a href=\"https://httpd.apache.org/docs/2.4/vhosts/examples.html\">VirtualHost 配置参考</a></li>\n<li><a href=\"http://pjdong1990.iteye.com/blog/1610305\">Eclipse集成PDT+XDebug调试PHP脚本</a></li>\n<li><a href=\"https://secure.phabricator.com/diviner/\">Phabricator 技术文档</a></li>\n<li><a href=\"https://secure.phabricator.com/book/phabcontrib/\">Phabricator 二次开发入门</a></li>\n<li><a href=\"https://secure.phabricator.com/book/phabcontrib/article/phabricator_code_layout/\">Phabricator 基本代码结构</a></li>\n<li><a href=\"https://xdebug.org/wizard.php\">xdebug 配置向导</a></li>\n</ul>\n"},{"title":"关于Java多线程在提升程序性能上的一些实践","title_url":"Java-Thread-Runnable-Executor-Practice","date":"2016-08-29T16:00:00.000Z","description":"关于Java多线程在提升程序性能上的一些实践","_content":"\n## 需要使用多个线程的背景以及约束\n\n- 多个任务并行，不分先后\n\n- 对资源没有争抢\n\n- 需要在所有任务都执行完毕后再返回给调用者\n\n在以上条件下无需过多考虑同步问题，能使用的线程数只取决于机器的性能。\n\n## 使用串行执行的方式带来的性能问题\n\n程序的执行逻辑是从上到下，从左到右。长期的编程习惯使我们想当然的在日常开发中使用串行的开发思维来编写程序，使本来可以通过多线程并行的方式来执行任务，由于习惯还是通过单线程串行的方式。具体如下。\n```java\n// 假设有10个任务，每个任务花费的时间如下\nprivate long[] spendTime = new long[] { 1000, 2000, 3000, 5000, 500, 100, 10, 9000, 1000, 6000 };\n\n/**\n * 在单线程的情况下\n */\n@SuppressWarnings(\"static-access\")\n@Test\npublic void TestWithoutExecuteService() {\n\tlong begin = System.currentTimeMillis();\n\tfor (long l : spendTime) {\n\t\ttry {\n\t\t\tThread.currentThread().sleep(l);\n\t\t} catch (InterruptedException e) {\n\t\t\te.printStackTrace();\n\t\t}\n\t}\n\n\tSystem.out.println(\"total spend : \" + (System.currentTimeMillis() - begin));\n}\n```\n\n## 通过 Thread 和 Runnable 来实现\n\n上面通过串行的方式执行任务，所花时间是所有任务执行时间之和。如果通过多个线程并行执行任务，那么在确保所有任务执行完毕，所花时间取决于耗时最长的那个任务。\n通过 Thread 和 Runnable 来实现需要维持一个变量来确保所有的任务都执行完毕了，引入同步变量增加了程序的复杂度，具体实现如下。\n```java\n/**\n * 使用一般的多线程来完成并行任务，也就是 Thread,Runnable\n */\n@Test\npublic void TestWithMultiThread() {\n\tlong begin = System.currentTimeMillis();\n\t// 通过一个同步的Map来确保所有的任务都执行完毕\n\tMap<String, String> result = Collections.synchronizedMap(new HashMap<String, String>());\n\n\tList<Thread> taskList = new ArrayList<Thread>();\n\tfor (long l : spendTime) {\n\t\tThread taskThread = new Thread(new TaskThread2(l, result));\n\t\ttaskList.add(taskThread);\n\t\ttaskThread.start();\n\t}\n\twhile (true) { // 这部分代码可以确保所有的线程都执行完毕了\n\t\tif (result.size() == taskList.size()) {\n\t\t\tbreak;\n\t\t}\n\t}\n\tfor (Iterator<String> it = result.keySet().iterator(); it.hasNext();) {\n\t\tString key = it.next();\n\t\tSystem.out.println(key + result.get(key));\n\t}\n\tSystem.out.println(\"total spend : \" + (System.currentTimeMillis() - begin));\n}\n\n/**\n * 使用Runnable来实现线程\n * \n * @author ck\n *\n */\nprivate class TaskThread2 implements Runnable {\n\n\tprivate long processTime;\n\tprivate Map<String, String> result;\n\n\tpublic TaskThread2(long processTime, Map<String, String> result) {\n\t\tthis.processTime = processTime;\n\t\tthis.result = result;\n\t}\n\n\t@SuppressWarnings(\"static-access\")\n\t@Override\n\tpublic void run() {\n\t\ttry {\n\t\t\tThread.currentThread().sleep(processTime);\n\t\t} catch (InterruptedException e) {\n\t\t\te.printStackTrace();\n\t\t}\n\t\tresult.put(Thread.currentThread().getName(), \": SUCCESS, spend: \" + processTime);\n\t}\n\n}\n```\n\n## 通过ExecutorService来实现\n\n在传统的方法中需要引入同步的变量来确保所有的任务都执行完毕，增加了程序的复杂程度，因为线程在执行完毕后无法通知调用者是否执行完毕，缺少通知机制。如果通过ExecutorService来实现，那么在提交任务后，只需要调用invokeAll方法，调用者线程将会阻塞，直到所有的任务都执行完毕，调用者线程才能继续向下执行，大大简化了程度复杂度。具体如下。\n```java\n/**\n * 在使用 ExecuteService 的情况下，通过invokeAll确保所有的线程都执行完毕\n */\n@Test\npublic void TestWithExecuteService() {\n\tlong begin = System.currentTimeMillis();\n\n\tExecutorService executorService = Executors.newCachedThreadPool();\n\n\tList<TaskThread> taskList = new ArrayList<TaskThread>();\n\tfor (long l : spendTime) {\n\t\ttaskList.add(new TaskThread(l));\n\t}\n\ttry {\n\t\tList<Future<String>> taskResult = executorService.invokeAll(taskList); // 可以确保所有的线程都执行完成\n\t\tif (taskResult != null) {\n\t\t\tfor (Future<String> future : taskResult) {\n\t\t\t\tSystem.out.println(future.get()); // 获取线程的执行结果\n\t\t\t}\n\t\t}\n\t} catch (Exception e) {\n\t\te.printStackTrace();\n\t} finally {\n\t\texecutorService.shutdown();\n\t}\n\n\tSystem.out.println(\"total spend : \" + (System.currentTimeMillis() - begin));\n}\n```\n\n## 总结\n\n`java.util.concurrent` 包下面还有很多有意思的类和接口方便多线程的开发，以后还会继续探索，以具体的例子和对比来显示使用和不使用这些类和接口带来的好处。关于Java多线程方面的知识，最近在看一本书，强烈推荐=>《Java并发编程实践》。\n关于本页面涉及到的所有的代码点击[这里](https://github.com/toulezu/play/tree/master/TestThread01)。\n\n","source":"_posts/关于Java多线程在提升程序性能上的一些实践.md","raw":"---\ntitle: 关于Java多线程在提升程序性能上的一些实践\ntitle_url: Java-Thread-Runnable-Executor-Practice\ndate: 2016-08-30\ntags: [Java,Thread,Runnable,Executor]\ncategories: 多线程\ndescription: 关于Java多线程在提升程序性能上的一些实践\n---\n\n## 需要使用多个线程的背景以及约束\n\n- 多个任务并行，不分先后\n\n- 对资源没有争抢\n\n- 需要在所有任务都执行完毕后再返回给调用者\n\n在以上条件下无需过多考虑同步问题，能使用的线程数只取决于机器的性能。\n\n## 使用串行执行的方式带来的性能问题\n\n程序的执行逻辑是从上到下，从左到右。长期的编程习惯使我们想当然的在日常开发中使用串行的开发思维来编写程序，使本来可以通过多线程并行的方式来执行任务，由于习惯还是通过单线程串行的方式。具体如下。\n```java\n// 假设有10个任务，每个任务花费的时间如下\nprivate long[] spendTime = new long[] { 1000, 2000, 3000, 5000, 500, 100, 10, 9000, 1000, 6000 };\n\n/**\n * 在单线程的情况下\n */\n@SuppressWarnings(\"static-access\")\n@Test\npublic void TestWithoutExecuteService() {\n\tlong begin = System.currentTimeMillis();\n\tfor (long l : spendTime) {\n\t\ttry {\n\t\t\tThread.currentThread().sleep(l);\n\t\t} catch (InterruptedException e) {\n\t\t\te.printStackTrace();\n\t\t}\n\t}\n\n\tSystem.out.println(\"total spend : \" + (System.currentTimeMillis() - begin));\n}\n```\n\n## 通过 Thread 和 Runnable 来实现\n\n上面通过串行的方式执行任务，所花时间是所有任务执行时间之和。如果通过多个线程并行执行任务，那么在确保所有任务执行完毕，所花时间取决于耗时最长的那个任务。\n通过 Thread 和 Runnable 来实现需要维持一个变量来确保所有的任务都执行完毕了，引入同步变量增加了程序的复杂度，具体实现如下。\n```java\n/**\n * 使用一般的多线程来完成并行任务，也就是 Thread,Runnable\n */\n@Test\npublic void TestWithMultiThread() {\n\tlong begin = System.currentTimeMillis();\n\t// 通过一个同步的Map来确保所有的任务都执行完毕\n\tMap<String, String> result = Collections.synchronizedMap(new HashMap<String, String>());\n\n\tList<Thread> taskList = new ArrayList<Thread>();\n\tfor (long l : spendTime) {\n\t\tThread taskThread = new Thread(new TaskThread2(l, result));\n\t\ttaskList.add(taskThread);\n\t\ttaskThread.start();\n\t}\n\twhile (true) { // 这部分代码可以确保所有的线程都执行完毕了\n\t\tif (result.size() == taskList.size()) {\n\t\t\tbreak;\n\t\t}\n\t}\n\tfor (Iterator<String> it = result.keySet().iterator(); it.hasNext();) {\n\t\tString key = it.next();\n\t\tSystem.out.println(key + result.get(key));\n\t}\n\tSystem.out.println(\"total spend : \" + (System.currentTimeMillis() - begin));\n}\n\n/**\n * 使用Runnable来实现线程\n * \n * @author ck\n *\n */\nprivate class TaskThread2 implements Runnable {\n\n\tprivate long processTime;\n\tprivate Map<String, String> result;\n\n\tpublic TaskThread2(long processTime, Map<String, String> result) {\n\t\tthis.processTime = processTime;\n\t\tthis.result = result;\n\t}\n\n\t@SuppressWarnings(\"static-access\")\n\t@Override\n\tpublic void run() {\n\t\ttry {\n\t\t\tThread.currentThread().sleep(processTime);\n\t\t} catch (InterruptedException e) {\n\t\t\te.printStackTrace();\n\t\t}\n\t\tresult.put(Thread.currentThread().getName(), \": SUCCESS, spend: \" + processTime);\n\t}\n\n}\n```\n\n## 通过ExecutorService来实现\n\n在传统的方法中需要引入同步的变量来确保所有的任务都执行完毕，增加了程序的复杂程度，因为线程在执行完毕后无法通知调用者是否执行完毕，缺少通知机制。如果通过ExecutorService来实现，那么在提交任务后，只需要调用invokeAll方法，调用者线程将会阻塞，直到所有的任务都执行完毕，调用者线程才能继续向下执行，大大简化了程度复杂度。具体如下。\n```java\n/**\n * 在使用 ExecuteService 的情况下，通过invokeAll确保所有的线程都执行完毕\n */\n@Test\npublic void TestWithExecuteService() {\n\tlong begin = System.currentTimeMillis();\n\n\tExecutorService executorService = Executors.newCachedThreadPool();\n\n\tList<TaskThread> taskList = new ArrayList<TaskThread>();\n\tfor (long l : spendTime) {\n\t\ttaskList.add(new TaskThread(l));\n\t}\n\ttry {\n\t\tList<Future<String>> taskResult = executorService.invokeAll(taskList); // 可以确保所有的线程都执行完成\n\t\tif (taskResult != null) {\n\t\t\tfor (Future<String> future : taskResult) {\n\t\t\t\tSystem.out.println(future.get()); // 获取线程的执行结果\n\t\t\t}\n\t\t}\n\t} catch (Exception e) {\n\t\te.printStackTrace();\n\t} finally {\n\t\texecutorService.shutdown();\n\t}\n\n\tSystem.out.println(\"total spend : \" + (System.currentTimeMillis() - begin));\n}\n```\n\n## 总结\n\n`java.util.concurrent` 包下面还有很多有意思的类和接口方便多线程的开发，以后还会继续探索，以具体的例子和对比来显示使用和不使用这些类和接口带来的好处。关于Java多线程方面的知识，最近在看一本书，强烈推荐=>《Java并发编程实践》。\n关于本页面涉及到的所有的代码点击[这里](https://github.com/toulezu/play/tree/master/TestThread01)。\n\n","slug":"关于Java多线程在提升程序性能上的一些实践","published":1,"updated":"2016-10-10T01:58:06.787Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj5jgsbeb000u2cez2ckikuoq","content":"<h2 id=\"需要使用多个线程的背景以及约束\"><a href=\"#需要使用多个线程的背景以及约束\" class=\"headerlink\" title=\"需要使用多个线程的背景以及约束\"></a>需要使用多个线程的背景以及约束</h2><ul>\n<li><p>多个任务并行，不分先后</p>\n</li>\n<li><p>对资源没有争抢</p>\n</li>\n<li><p>需要在所有任务都执行完毕后再返回给调用者</p>\n</li>\n</ul>\n<p>在以上条件下无需过多考虑同步问题，能使用的线程数只取决于机器的性能。</p>\n<h2 id=\"使用串行执行的方式带来的性能问题\"><a href=\"#使用串行执行的方式带来的性能问题\" class=\"headerlink\" title=\"使用串行执行的方式带来的性能问题\"></a>使用串行执行的方式带来的性能问题</h2><p>程序的执行逻辑是从上到下，从左到右。长期的编程习惯使我们想当然的在日常开发中使用串行的开发思维来编写程序，使本来可以通过多线程并行的方式来执行任务，由于习惯还是通过单线程串行的方式。具体如下。<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 假设有10个任务，每个任务花费的时间如下</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">long</span>[] spendTime = <span class=\"keyword\">new</span> <span class=\"keyword\">long</span>[] &#123; <span class=\"number\">1000</span>, <span class=\"number\">2000</span>, <span class=\"number\">3000</span>, <span class=\"number\">5000</span>, <span class=\"number\">500</span>, <span class=\"number\">100</span>, <span class=\"number\">10</span>, <span class=\"number\">9000</span>, <span class=\"number\">1000</span>, <span class=\"number\">6000</span> &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span><br><span class=\"line\"> * 在单线程的情况下</span><br><span class=\"line\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@SuppressWarnings</span>(<span class=\"string\">\"static-access\"</span>)</span><br><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">TestWithoutExecuteService</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">long</span> begin = System.currentTimeMillis();</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">long</span> l : spendTime) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tThread.currentThread().sleep(l);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tSystem.out.println(<span class=\"string\">\"total spend : \"</span> + (System.currentTimeMillis() - begin));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"通过-Thread-和-Runnable-来实现\"><a href=\"#通过-Thread-和-Runnable-来实现\" class=\"headerlink\" title=\"通过 Thread 和 Runnable 来实现\"></a>通过 Thread 和 Runnable 来实现</h2><p>上面通过串行的方式执行任务，所花时间是所有任务执行时间之和。如果通过多个线程并行执行任务，那么在确保所有任务执行完毕，所花时间取决于耗时最长的那个任务。<br>通过 Thread 和 Runnable 来实现需要维持一个变量来确保所有的任务都执行完毕了，引入同步变量增加了程序的复杂度，具体实现如下。<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span><br><span class=\"line\"> * 使用一般的多线程来完成并行任务，也就是 Thread,Runnable</span><br><span class=\"line\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">TestWithMultiThread</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">long</span> begin = System.currentTimeMillis();</span><br><span class=\"line\">\t<span class=\"comment\">// 通过一个同步的Map来确保所有的任务都执行完毕</span></span><br><span class=\"line\">\tMap&lt;String, String&gt; result = Collections.synchronizedMap(<span class=\"keyword\">new</span> HashMap&lt;String, String&gt;());</span><br><span class=\"line\"></span><br><span class=\"line\">\tList&lt;Thread&gt; taskList = <span class=\"keyword\">new</span> ArrayList&lt;Thread&gt;();</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">long</span> l : spendTime) &#123;</span><br><span class=\"line\">\t\tThread taskThread = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> TaskThread2(l, result));</span><br><span class=\"line\">\t\ttaskList.add(taskThread);</span><br><span class=\"line\">\t\ttaskThread.start();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123; <span class=\"comment\">// 这部分代码可以确保所有的线程都执行完毕了</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (result.size() == taskList.size()) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (Iterator&lt;String&gt; it = result.keySet().iterator(); it.hasNext();) &#123;</span><br><span class=\"line\">\t\tString key = it.next();</span><br><span class=\"line\">\t\tSystem.out.println(key + result.get(key));</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tSystem.out.println(<span class=\"string\">\"total spend : \"</span> + (System.currentTimeMillis() - begin));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span><br><span class=\"line\"> * 使用Runnable来实现线程</span><br><span class=\"line\"> * </span><br><span class=\"line\"> * <span class=\"doctag\">@author</span> ck</span><br><span class=\"line\"> *</span><br><span class=\"line\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TaskThread2</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">long</span> processTime;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> Map&lt;String, String&gt; result;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">TaskThread2</span><span class=\"params\">(<span class=\"keyword\">long</span> processTime, Map&lt;String, String&gt; result)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>.processTime = processTime;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>.result = result;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@SuppressWarnings</span>(<span class=\"string\">\"static-access\"</span>)</span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tThread.currentThread().sleep(processTime);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tresult.put(Thread.currentThread().getName(), <span class=\"string\">\": SUCCESS, spend: \"</span> + processTime);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"通过ExecutorService来实现\"><a href=\"#通过ExecutorService来实现\" class=\"headerlink\" title=\"通过ExecutorService来实现\"></a>通过ExecutorService来实现</h2><p>在传统的方法中需要引入同步的变量来确保所有的任务都执行完毕，增加了程序的复杂程度，因为线程在执行完毕后无法通知调用者是否执行完毕，缺少通知机制。如果通过ExecutorService来实现，那么在提交任务后，只需要调用invokeAll方法，调用者线程将会阻塞，直到所有的任务都执行完毕，调用者线程才能继续向下执行，大大简化了程度复杂度。具体如下。<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span><br><span class=\"line\"> * 在使用 ExecuteService 的情况下，通过invokeAll确保所有的线程都执行完毕</span><br><span class=\"line\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">TestWithExecuteService</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">long</span> begin = System.currentTimeMillis();</span><br><span class=\"line\"></span><br><span class=\"line\">\tExecutorService executorService = Executors.newCachedThreadPool();</span><br><span class=\"line\"></span><br><span class=\"line\">\tList&lt;TaskThread&gt; taskList = <span class=\"keyword\">new</span> ArrayList&lt;TaskThread&gt;();</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">long</span> l : spendTime) &#123;</span><br><span class=\"line\">\t\ttaskList.add(<span class=\"keyword\">new</span> TaskThread(l));</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\tList&lt;Future&lt;String&gt;&gt; taskResult = executorService.invokeAll(taskList); <span class=\"comment\">// 可以确保所有的线程都执行完成</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (taskResult != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (Future&lt;String&gt; future : taskResult) &#123;</span><br><span class=\"line\">\t\t\t\tSystem.out.println(future.get()); <span class=\"comment\">// 获取线程的执行结果</span></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">\t\te.printStackTrace();</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">\t\texecutorService.shutdown();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tSystem.out.println(<span class=\"string\">\"total spend : \"</span> + (System.currentTimeMillis() - begin));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p><code>java.util.concurrent</code> 包下面还有很多有意思的类和接口方便多线程的开发，以后还会继续探索，以具体的例子和对比来显示使用和不使用这些类和接口带来的好处。关于Java多线程方面的知识，最近在看一本书，强烈推荐=&gt;《Java并发编程实践》。<br>关于本页面涉及到的所有的代码点击<a href=\"https://github.com/toulezu/play/tree/master/TestThread01\" target=\"_blank\" rel=\"external\">这里</a>。</p>\n","excerpt":"","more":"<h2 id=\"需要使用多个线程的背景以及约束\"><a href=\"#需要使用多个线程的背景以及约束\" class=\"headerlink\" title=\"需要使用多个线程的背景以及约束\"></a>需要使用多个线程的背景以及约束</h2><ul>\n<li><p>多个任务并行，不分先后</p>\n</li>\n<li><p>对资源没有争抢</p>\n</li>\n<li><p>需要在所有任务都执行完毕后再返回给调用者</p>\n</li>\n</ul>\n<p>在以上条件下无需过多考虑同步问题，能使用的线程数只取决于机器的性能。</p>\n<h2 id=\"使用串行执行的方式带来的性能问题\"><a href=\"#使用串行执行的方式带来的性能问题\" class=\"headerlink\" title=\"使用串行执行的方式带来的性能问题\"></a>使用串行执行的方式带来的性能问题</h2><p>程序的执行逻辑是从上到下，从左到右。长期的编程习惯使我们想当然的在日常开发中使用串行的开发思维来编写程序，使本来可以通过多线程并行的方式来执行任务，由于习惯还是通过单线程串行的方式。具体如下。<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 假设有10个任务，每个任务花费的时间如下</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">long</span>[] spendTime = <span class=\"keyword\">new</span> <span class=\"keyword\">long</span>[] &#123; <span class=\"number\">1000</span>, <span class=\"number\">2000</span>, <span class=\"number\">3000</span>, <span class=\"number\">5000</span>, <span class=\"number\">500</span>, <span class=\"number\">100</span>, <span class=\"number\">10</span>, <span class=\"number\">9000</span>, <span class=\"number\">1000</span>, <span class=\"number\">6000</span> &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span><br><span class=\"line\"> * 在单线程的情况下</span><br><span class=\"line\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@SuppressWarnings</span>(<span class=\"string\">\"static-access\"</span>)</span><br><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">TestWithoutExecuteService</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">long</span> begin = System.currentTimeMillis();</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">long</span> l : spendTime) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tThread.currentThread().sleep(l);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tSystem.out.println(<span class=\"string\">\"total spend : \"</span> + (System.currentTimeMillis() - begin));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"通过-Thread-和-Runnable-来实现\"><a href=\"#通过-Thread-和-Runnable-来实现\" class=\"headerlink\" title=\"通过 Thread 和 Runnable 来实现\"></a>通过 Thread 和 Runnable 来实现</h2><p>上面通过串行的方式执行任务，所花时间是所有任务执行时间之和。如果通过多个线程并行执行任务，那么在确保所有任务执行完毕，所花时间取决于耗时最长的那个任务。<br>通过 Thread 和 Runnable 来实现需要维持一个变量来确保所有的任务都执行完毕了，引入同步变量增加了程序的复杂度，具体实现如下。<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span><br><span class=\"line\"> * 使用一般的多线程来完成并行任务，也就是 Thread,Runnable</span><br><span class=\"line\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">TestWithMultiThread</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">long</span> begin = System.currentTimeMillis();</span><br><span class=\"line\">\t<span class=\"comment\">// 通过一个同步的Map来确保所有的任务都执行完毕</span></span><br><span class=\"line\">\tMap&lt;String, String&gt; result = Collections.synchronizedMap(<span class=\"keyword\">new</span> HashMap&lt;String, String&gt;());</span><br><span class=\"line\"></span><br><span class=\"line\">\tList&lt;Thread&gt; taskList = <span class=\"keyword\">new</span> ArrayList&lt;Thread&gt;();</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">long</span> l : spendTime) &#123;</span><br><span class=\"line\">\t\tThread taskThread = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> TaskThread2(l, result));</span><br><span class=\"line\">\t\ttaskList.add(taskThread);</span><br><span class=\"line\">\t\ttaskThread.start();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123; <span class=\"comment\">// 这部分代码可以确保所有的线程都执行完毕了</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (result.size() == taskList.size()) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (Iterator&lt;String&gt; it = result.keySet().iterator(); it.hasNext();) &#123;</span><br><span class=\"line\">\t\tString key = it.next();</span><br><span class=\"line\">\t\tSystem.out.println(key + result.get(key));</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tSystem.out.println(<span class=\"string\">\"total spend : \"</span> + (System.currentTimeMillis() - begin));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span><br><span class=\"line\"> * 使用Runnable来实现线程</span><br><span class=\"line\"> * </span><br><span class=\"line\"> * <span class=\"doctag\">@author</span> ck</span><br><span class=\"line\"> *</span><br><span class=\"line\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TaskThread2</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">long</span> processTime;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> Map&lt;String, String&gt; result;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">TaskThread2</span><span class=\"params\">(<span class=\"keyword\">long</span> processTime, Map&lt;String, String&gt; result)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>.processTime = processTime;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>.result = result;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@SuppressWarnings</span>(<span class=\"string\">\"static-access\"</span>)</span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tThread.currentThread().sleep(processTime);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tresult.put(Thread.currentThread().getName(), <span class=\"string\">\": SUCCESS, spend: \"</span> + processTime);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"通过ExecutorService来实现\"><a href=\"#通过ExecutorService来实现\" class=\"headerlink\" title=\"通过ExecutorService来实现\"></a>通过ExecutorService来实现</h2><p>在传统的方法中需要引入同步的变量来确保所有的任务都执行完毕，增加了程序的复杂程度，因为线程在执行完毕后无法通知调用者是否执行完毕，缺少通知机制。如果通过ExecutorService来实现，那么在提交任务后，只需要调用invokeAll方法，调用者线程将会阻塞，直到所有的任务都执行完毕，调用者线程才能继续向下执行，大大简化了程度复杂度。具体如下。<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span><br><span class=\"line\"> * 在使用 ExecuteService 的情况下，通过invokeAll确保所有的线程都执行完毕</span><br><span class=\"line\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">TestWithExecuteService</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">long</span> begin = System.currentTimeMillis();</span><br><span class=\"line\"></span><br><span class=\"line\">\tExecutorService executorService = Executors.newCachedThreadPool();</span><br><span class=\"line\"></span><br><span class=\"line\">\tList&lt;TaskThread&gt; taskList = <span class=\"keyword\">new</span> ArrayList&lt;TaskThread&gt;();</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">long</span> l : spendTime) &#123;</span><br><span class=\"line\">\t\ttaskList.add(<span class=\"keyword\">new</span> TaskThread(l));</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\tList&lt;Future&lt;String&gt;&gt; taskResult = executorService.invokeAll(taskList); <span class=\"comment\">// 可以确保所有的线程都执行完成</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (taskResult != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (Future&lt;String&gt; future : taskResult) &#123;</span><br><span class=\"line\">\t\t\t\tSystem.out.println(future.get()); <span class=\"comment\">// 获取线程的执行结果</span></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">\t\te.printStackTrace();</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">\t\texecutorService.shutdown();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tSystem.out.println(<span class=\"string\">\"total spend : \"</span> + (System.currentTimeMillis() - begin));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p><code>java.util.concurrent</code> 包下面还有很多有意思的类和接口方便多线程的开发，以后还会继续探索，以具体的例子和对比来显示使用和不使用这些类和接口带来的好处。关于Java多线程方面的知识，最近在看一本书，强烈推荐=&gt;《Java并发编程实践》。<br>关于本页面涉及到的所有的代码点击<a href=\"https://github.com/toulezu/play/tree/master/TestThread01\">这里</a>。</p>\n"},{"title":"写在github上的第一篇博客","title_url":"blog-github-some-thinking","date":"2016-05-31T16:00:00.000Z","description":"关于技术和生活的一些感想","_content":"\n这是我的第一篇写在 github 上的博客，但不会是最后一篇。\n\n在这里，我将分享自己在技术学习上的心得，和一些读书笔记，以及在看过他人技术类博客之后的一些个人感想，总之，在这里将会展现我技术，人生成长的点点滴滴。\n\n- 关于技术，我的分享点将侧重于`Java`，`数据库`，`JavaScript`，`Android`，以及对一些开源技术的学习。\n\n- 关于人生，我将分享个人的技术成长心路，对技术发展的看法，对社会生活百态的感想，对爱情，家庭以及生活的感悟。\n","source":"_posts/写在github上的第一篇博客.md","raw":"---\ntitle: 写在github上的第一篇博客\ntitle_url: blog-github-some-thinking\ndate: 2016-06-01\ntags: 感想\ncategories: 生活\ndescription: 关于技术和生活的一些感想\n---\n\n这是我的第一篇写在 github 上的博客，但不会是最后一篇。\n\n在这里，我将分享自己在技术学习上的心得，和一些读书笔记，以及在看过他人技术类博客之后的一些个人感想，总之，在这里将会展现我技术，人生成长的点点滴滴。\n\n- 关于技术，我的分享点将侧重于`Java`，`数据库`，`JavaScript`，`Android`，以及对一些开源技术的学习。\n\n- 关于人生，我将分享个人的技术成长心路，对技术发展的看法，对社会生活百态的感想，对爱情，家庭以及生活的感悟。\n","slug":"写在github上的第一篇博客","published":1,"updated":"2016-10-10T01:58:06.791Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj5jgsbee000x2cez8zg9ud9a","content":"<p>这是我的第一篇写在 github 上的博客，但不会是最后一篇。</p>\n<p>在这里，我将分享自己在技术学习上的心得，和一些读书笔记，以及在看过他人技术类博客之后的一些个人感想，总之，在这里将会展现我技术，人生成长的点点滴滴。</p>\n<ul>\n<li><p>关于技术，我的分享点将侧重于<code>Java</code>，<code>数据库</code>，<code>JavaScript</code>，<code>Android</code>，以及对一些开源技术的学习。</p>\n</li>\n<li><p>关于人生，我将分享个人的技术成长心路，对技术发展的看法，对社会生活百态的感想，对爱情，家庭以及生活的感悟。</p>\n</li>\n</ul>\n","excerpt":"","more":"<p>这是我的第一篇写在 github 上的博客，但不会是最后一篇。</p>\n<p>在这里，我将分享自己在技术学习上的心得，和一些读书笔记，以及在看过他人技术类博客之后的一些个人感想，总之，在这里将会展现我技术，人生成长的点点滴滴。</p>\n<ul>\n<li><p>关于技术，我的分享点将侧重于<code>Java</code>，<code>数据库</code>，<code>JavaScript</code>，<code>Android</code>，以及对一些开源技术的学习。</p>\n</li>\n<li><p>关于人生，我将分享个人的技术成长心路，对技术发展的看法，对社会生活百态的感想，对爱情，家庭以及生活的感悟。</p>\n</li>\n</ul>\n"},{"title":"Java 分段从文件中读取数据的一个例子","title_url":"java-read-file-piece","date":"2016-10-30T16:00:00.000Z","description":"Java 分段从文件中读取数据的一个例子","_content":"\n```java\n\n/**\n * 分段从文件中读取数据\n * \n * @author chen_k\n *\n */\n@Component\npublic class GrabDataService {\n\t\n\t/**\n\t * 每次从文件中读取的行数，默认 5000 行\n\t */\n\tpublic static final int LINE_COUNT = 5000;\n\t\n\t/**\n\t * 文件默认编码\n\t */\n\tpublic static final String FILE_ENCODING = \"UTF-8\";\n\n\tprivate static final Logger log = LoggerFactory.getLogger(GrabDataService.class);\n\t\n\t/**\n\t * 文件的唯一标识Map，用于记录从文件的哪一行开始读取\n\t */\n\tprivate Map<String, Integer> counterMap = Collections.synchronizedMap(new HashMap<String, Integer>());\n\t\n\t/**\n\t * 每次从文件中读取固定行数的记录\n\t * @param msgKey 文件的唯一标识\n\t * @param filePath 文件路径\n\t * @return List<Map<Integer, String>> 读取的文件内容\n\t */\n\tpublic List<Map<Integer, String>> getFileData(String msgKey, String filePath) {\n\t\tList<Map<Integer, String>> dataList = new ArrayList<>();\n\t\t\n\t\tint line = 0;\n\t\tif (counterMap.get(msgKey) == null) {\n\t\t\tcounterMap.put(msgKey, line);\n\t\t} else {\n\t\t\tline = counterMap.get(msgKey);\n\t\t}\n\t\t\n\t\ttry {\n\t\t\tFile file = new File(filePath);\n\t\t\tif (file.isFile() && file.exists()) { // 判断文件是否存在\n\t\t\t\tInputStreamReader read = new InputStreamReader(new FileInputStream(file), FILE_ENCODING);// 考虑到编码格式\n\t\t\t\tBufferedReader bufferedReader = new BufferedReader(read);\n\t\t\t\tString lineTxt = null;\n\t\t\t\t\n\t\t\t\tint index = 1;\n\t\t\t\twhile ((lineTxt = bufferedReader.readLine()) != null) {\n\t\t\t\t\t// 每次取的时候从上次最后的行开始\n\t\t\t\t\tif (index > line) {\n\t\t\t\t\t\tMap<Integer, String> data = new HashMap<>();\n\t\t\t\t\t\tdata.put(index, lineTxt);\n\t\t\t\t\t\tdataList.add(data);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// 每次只取文件的 5000 条\n\t\t\t\t\t\tif ((index - line) == LINE_COUNT) {\n\t\t\t\t\t\t\tline = index;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tindex ++;\n\t\t\t\t}\n\t\t\t\t// 说明文件已经读完，插入一个读完的标记, file.renameTo(file) 用于判断当前文件是否被其他程序写入内容或占用\n\t\t\t\tif (lineTxt == null && file.renameTo(file)) {\n\t\t\t\t\tMap<Integer, String> data = new HashMap<>();\n\t\t\t\t\tdata.put(-1, \"END OF FILE\");\n\t\t\t\t\tdataList.add(data);\n\t\t\t\t\t\n\t\t\t\t\tline = index;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tread.close();\n\t\t\t\tbufferedReader.close();\n\t\t\t} else {\n\t\t\t\tlog.error(\"找不到指定的文件:{}\", new Object[]{filePath});\n\t\t\t}\n\t\t} catch (Exception e) {\n\t\t\tlog.error(\"读取文件内容出现异常\", e);\n\t\t} finally {\n\t\t\t// 记录下一次从文件的哪一行开始读取\n\t\t\tcounterMap.put(msgKey, line);\n\t\t\tlog.info(\"msgKey={},filePath={},line={}\", new Object[]{msgKey,filePath,line});\n\t\t}\n\t\t\n\t\treturn dataList;\n\t}\n\t\n\t/**\n\t * 重置从文件的开始读取行数\n\t * \n\t * @param msgKey 文件的唯一标识\n\t * @param offset 开始读取行数\n\t */\n\tpublic void relocateTo(String msgKey, int offset) {\n\t\tcounterMap.put(msgKey, offset);\n\t}\n\t\n\tpublic GrabDataService() {\n\t}\n\n}\n```","source":"_posts/Java 分段从文件中读取数据的一个例子.md","raw":"---\ntitle: Java 分段从文件中读取数据的一个例子\ntitle_url: java-read-file-piece\ndate: 2016-10-31\ntags: [Java]\ncategories: 技术\ndescription: Java 分段从文件中读取数据的一个例子\n---\n\n```java\n\n/**\n * 分段从文件中读取数据\n * \n * @author chen_k\n *\n */\n@Component\npublic class GrabDataService {\n\t\n\t/**\n\t * 每次从文件中读取的行数，默认 5000 行\n\t */\n\tpublic static final int LINE_COUNT = 5000;\n\t\n\t/**\n\t * 文件默认编码\n\t */\n\tpublic static final String FILE_ENCODING = \"UTF-8\";\n\n\tprivate static final Logger log = LoggerFactory.getLogger(GrabDataService.class);\n\t\n\t/**\n\t * 文件的唯一标识Map，用于记录从文件的哪一行开始读取\n\t */\n\tprivate Map<String, Integer> counterMap = Collections.synchronizedMap(new HashMap<String, Integer>());\n\t\n\t/**\n\t * 每次从文件中读取固定行数的记录\n\t * @param msgKey 文件的唯一标识\n\t * @param filePath 文件路径\n\t * @return List<Map<Integer, String>> 读取的文件内容\n\t */\n\tpublic List<Map<Integer, String>> getFileData(String msgKey, String filePath) {\n\t\tList<Map<Integer, String>> dataList = new ArrayList<>();\n\t\t\n\t\tint line = 0;\n\t\tif (counterMap.get(msgKey) == null) {\n\t\t\tcounterMap.put(msgKey, line);\n\t\t} else {\n\t\t\tline = counterMap.get(msgKey);\n\t\t}\n\t\t\n\t\ttry {\n\t\t\tFile file = new File(filePath);\n\t\t\tif (file.isFile() && file.exists()) { // 判断文件是否存在\n\t\t\t\tInputStreamReader read = new InputStreamReader(new FileInputStream(file), FILE_ENCODING);// 考虑到编码格式\n\t\t\t\tBufferedReader bufferedReader = new BufferedReader(read);\n\t\t\t\tString lineTxt = null;\n\t\t\t\t\n\t\t\t\tint index = 1;\n\t\t\t\twhile ((lineTxt = bufferedReader.readLine()) != null) {\n\t\t\t\t\t// 每次取的时候从上次最后的行开始\n\t\t\t\t\tif (index > line) {\n\t\t\t\t\t\tMap<Integer, String> data = new HashMap<>();\n\t\t\t\t\t\tdata.put(index, lineTxt);\n\t\t\t\t\t\tdataList.add(data);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// 每次只取文件的 5000 条\n\t\t\t\t\t\tif ((index - line) == LINE_COUNT) {\n\t\t\t\t\t\t\tline = index;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tindex ++;\n\t\t\t\t}\n\t\t\t\t// 说明文件已经读完，插入一个读完的标记, file.renameTo(file) 用于判断当前文件是否被其他程序写入内容或占用\n\t\t\t\tif (lineTxt == null && file.renameTo(file)) {\n\t\t\t\t\tMap<Integer, String> data = new HashMap<>();\n\t\t\t\t\tdata.put(-1, \"END OF FILE\");\n\t\t\t\t\tdataList.add(data);\n\t\t\t\t\t\n\t\t\t\t\tline = index;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tread.close();\n\t\t\t\tbufferedReader.close();\n\t\t\t} else {\n\t\t\t\tlog.error(\"找不到指定的文件:{}\", new Object[]{filePath});\n\t\t\t}\n\t\t} catch (Exception e) {\n\t\t\tlog.error(\"读取文件内容出现异常\", e);\n\t\t} finally {\n\t\t\t// 记录下一次从文件的哪一行开始读取\n\t\t\tcounterMap.put(msgKey, line);\n\t\t\tlog.info(\"msgKey={},filePath={},line={}\", new Object[]{msgKey,filePath,line});\n\t\t}\n\t\t\n\t\treturn dataList;\n\t}\n\t\n\t/**\n\t * 重置从文件的开始读取行数\n\t * \n\t * @param msgKey 文件的唯一标识\n\t * @param offset 开始读取行数\n\t */\n\tpublic void relocateTo(String msgKey, int offset) {\n\t\tcounterMap.put(msgKey, offset);\n\t}\n\t\n\tpublic GrabDataService() {\n\t}\n\n}\n```","slug":"Java 分段从文件中读取数据的一个例子","published":1,"updated":"2017-05-27T01:38:56.392Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj5jgsbeh00102cezqnwb921h","content":"<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span><br><span class=\"line\"> * 分段从文件中读取数据</span><br><span class=\"line\"> * </span><br><span class=\"line\"> * <span class=\"doctag\">@author</span> chen_k</span><br><span class=\"line\"> *</span><br><span class=\"line\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">GrabDataService</span> </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">/**</span><br><span class=\"line\">\t * 每次从文件中读取的行数，默认 5000 行</span><br><span class=\"line\">\t */</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> LINE_COUNT = <span class=\"number\">5000</span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">/**</span><br><span class=\"line\">\t * 文件默认编码</span><br><span class=\"line\">\t */</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String FILE_ENCODING = <span class=\"string\">\"UTF-8\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Logger log = LoggerFactory.getLogger(GrabDataService.class);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">/**</span><br><span class=\"line\">\t * 文件的唯一标识Map，用于记录从文件的哪一行开始读取</span><br><span class=\"line\">\t */</span></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> Map&lt;String, Integer&gt; counterMap = Collections.synchronizedMap(<span class=\"keyword\">new</span> HashMap&lt;String, Integer&gt;());</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">/**</span><br><span class=\"line\">\t * 每次从文件中读取固定行数的记录</span><br><span class=\"line\">\t * <span class=\"doctag\">@param</span> msgKey 文件的唯一标识</span><br><span class=\"line\">\t * <span class=\"doctag\">@param</span> filePath 文件路径</span><br><span class=\"line\">\t * <span class=\"doctag\">@return</span> List&lt;Map&lt;Integer, String&gt;&gt; 读取的文件内容</span><br><span class=\"line\">\t */</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> List&lt;Map&lt;Integer, String&gt;&gt; getFileData(String msgKey, String filePath) &#123;</span><br><span class=\"line\">\t\tList&lt;Map&lt;Integer, String&gt;&gt; dataList = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> line = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (counterMap.get(msgKey) == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\tcounterMap.put(msgKey, line);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tline = counterMap.get(msgKey);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tFile file = <span class=\"keyword\">new</span> File(filePath);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (file.isFile() &amp;&amp; file.exists()) &#123; <span class=\"comment\">// 判断文件是否存在</span></span><br><span class=\"line\">\t\t\t\tInputStreamReader read = <span class=\"keyword\">new</span> InputStreamReader(<span class=\"keyword\">new</span> FileInputStream(file), FILE_ENCODING);<span class=\"comment\">// 考虑到编码格式</span></span><br><span class=\"line\">\t\t\t\tBufferedReader bufferedReader = <span class=\"keyword\">new</span> BufferedReader(read);</span><br><span class=\"line\">\t\t\t\tString lineTxt = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">int</span> index = <span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">while</span> ((lineTxt = bufferedReader.readLine()) != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// 每次取的时候从上次最后的行开始</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (index &gt; line) &#123;</span><br><span class=\"line\">\t\t\t\t\t\tMap&lt;Integer, String&gt; data = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">\t\t\t\t\t\tdata.put(index, lineTxt);</span><br><span class=\"line\">\t\t\t\t\t\tdataList.add(data);</span><br><span class=\"line\">\t\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"comment\">// 每次只取文件的 5000 条</span></span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span> ((index - line) == LINE_COUNT) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\tline = index;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\tindex ++;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 说明文件已经读完，插入一个读完的标记, file.renameTo(file) 用于判断当前文件是否被其他程序写入内容或占用</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (lineTxt == <span class=\"keyword\">null</span> &amp;&amp; file.renameTo(file)) &#123;</span><br><span class=\"line\">\t\t\t\t\tMap&lt;Integer, String&gt; data = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">\t\t\t\t\tdata.put(-<span class=\"number\">1</span>, <span class=\"string\">\"END OF FILE\"</span>);</span><br><span class=\"line\">\t\t\t\t\tdataList.add(data);</span><br><span class=\"line\">\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t\tline = index;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">\t\t\t\tread.close();</span><br><span class=\"line\">\t\t\t\tbufferedReader.close();</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\tlog.error(<span class=\"string\">\"找不到指定的文件:&#123;&#125;\"</span>, <span class=\"keyword\">new</span> Object[]&#123;filePath&#125;);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">\t\t\tlog.error(<span class=\"string\">\"读取文件内容出现异常\"</span>, e);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 记录下一次从文件的哪一行开始读取</span></span><br><span class=\"line\">\t\t\tcounterMap.put(msgKey, line);</span><br><span class=\"line\">\t\t\tlog.info(<span class=\"string\">\"msgKey=&#123;&#125;,filePath=&#123;&#125;,line=&#123;&#125;\"</span>, <span class=\"keyword\">new</span> Object[]&#123;msgKey,filePath,line&#125;);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> dataList;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">/**</span><br><span class=\"line\">\t * 重置从文件的开始读取行数</span><br><span class=\"line\">\t * </span><br><span class=\"line\">\t * <span class=\"doctag\">@param</span> msgKey 文件的唯一标识</span><br><span class=\"line\">\t * <span class=\"doctag\">@param</span> offset 开始读取行数</span><br><span class=\"line\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">relocateTo</span><span class=\"params\">(String msgKey, <span class=\"keyword\">int</span> offset)</span> </span>&#123;</span><br><span class=\"line\">\t\tcounterMap.put(msgKey, offset);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">GrabDataService</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","excerpt":"","more":"<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span><br><span class=\"line\"> * 分段从文件中读取数据</span><br><span class=\"line\"> * </span><br><span class=\"line\"> * <span class=\"doctag\">@author</span> chen_k</span><br><span class=\"line\"> *</span><br><span class=\"line\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">GrabDataService</span> </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">/**</span><br><span class=\"line\">\t * 每次从文件中读取的行数，默认 5000 行</span><br><span class=\"line\">\t */</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> LINE_COUNT = <span class=\"number\">5000</span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">/**</span><br><span class=\"line\">\t * 文件默认编码</span><br><span class=\"line\">\t */</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String FILE_ENCODING = <span class=\"string\">\"UTF-8\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Logger log = LoggerFactory.getLogger(GrabDataService.class);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">/**</span><br><span class=\"line\">\t * 文件的唯一标识Map，用于记录从文件的哪一行开始读取</span><br><span class=\"line\">\t */</span></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> Map&lt;String, Integer&gt; counterMap = Collections.synchronizedMap(<span class=\"keyword\">new</span> HashMap&lt;String, Integer&gt;());</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">/**</span><br><span class=\"line\">\t * 每次从文件中读取固定行数的记录</span><br><span class=\"line\">\t * <span class=\"doctag\">@param</span> msgKey 文件的唯一标识</span><br><span class=\"line\">\t * <span class=\"doctag\">@param</span> filePath 文件路径</span><br><span class=\"line\">\t * <span class=\"doctag\">@return</span> List&lt;Map&lt;Integer, String&gt;&gt; 读取的文件内容</span><br><span class=\"line\">\t */</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> List&lt;Map&lt;Integer, String&gt;&gt; getFileData(String msgKey, String filePath) &#123;</span><br><span class=\"line\">\t\tList&lt;Map&lt;Integer, String&gt;&gt; dataList = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> line = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (counterMap.get(msgKey) == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\tcounterMap.put(msgKey, line);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tline = counterMap.get(msgKey);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tFile file = <span class=\"keyword\">new</span> File(filePath);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (file.isFile() &amp;&amp; file.exists()) &#123; <span class=\"comment\">// 判断文件是否存在</span></span><br><span class=\"line\">\t\t\t\tInputStreamReader read = <span class=\"keyword\">new</span> InputStreamReader(<span class=\"keyword\">new</span> FileInputStream(file), FILE_ENCODING);<span class=\"comment\">// 考虑到编码格式</span></span><br><span class=\"line\">\t\t\t\tBufferedReader bufferedReader = <span class=\"keyword\">new</span> BufferedReader(read);</span><br><span class=\"line\">\t\t\t\tString lineTxt = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">int</span> index = <span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">while</span> ((lineTxt = bufferedReader.readLine()) != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"comment\">// 每次取的时候从上次最后的行开始</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (index &gt; line) &#123;</span><br><span class=\"line\">\t\t\t\t\t\tMap&lt;Integer, String&gt; data = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">\t\t\t\t\t\tdata.put(index, lineTxt);</span><br><span class=\"line\">\t\t\t\t\t\tdataList.add(data);</span><br><span class=\"line\">\t\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"comment\">// 每次只取文件的 5000 条</span></span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span> ((index - line) == LINE_COUNT) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\tline = index;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\tindex ++;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 说明文件已经读完，插入一个读完的标记, file.renameTo(file) 用于判断当前文件是否被其他程序写入内容或占用</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (lineTxt == <span class=\"keyword\">null</span> &amp;&amp; file.renameTo(file)) &#123;</span><br><span class=\"line\">\t\t\t\t\tMap&lt;Integer, String&gt; data = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">\t\t\t\t\tdata.put(-<span class=\"number\">1</span>, <span class=\"string\">\"END OF FILE\"</span>);</span><br><span class=\"line\">\t\t\t\t\tdataList.add(data);</span><br><span class=\"line\">\t\t\t\t\t</span><br><span class=\"line\">\t\t\t\t\tline = index;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">\t\t\t\tread.close();</span><br><span class=\"line\">\t\t\t\tbufferedReader.close();</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\tlog.error(<span class=\"string\">\"找不到指定的文件:&#123;&#125;\"</span>, <span class=\"keyword\">new</span> Object[]&#123;filePath&#125;);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">\t\t\tlog.error(<span class=\"string\">\"读取文件内容出现异常\"</span>, e);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 记录下一次从文件的哪一行开始读取</span></span><br><span class=\"line\">\t\t\tcounterMap.put(msgKey, line);</span><br><span class=\"line\">\t\t\tlog.info(<span class=\"string\">\"msgKey=&#123;&#125;,filePath=&#123;&#125;,line=&#123;&#125;\"</span>, <span class=\"keyword\">new</span> Object[]&#123;msgKey,filePath,line&#125;);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> dataList;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">/**</span><br><span class=\"line\">\t * 重置从文件的开始读取行数</span><br><span class=\"line\">\t * </span><br><span class=\"line\">\t * <span class=\"doctag\">@param</span> msgKey 文件的唯一标识</span><br><span class=\"line\">\t * <span class=\"doctag\">@param</span> offset 开始读取行数</span><br><span class=\"line\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">relocateTo</span><span class=\"params\">(String msgKey, <span class=\"keyword\">int</span> offset)</span> </span>&#123;</span><br><span class=\"line\">\t\tcounterMap.put(msgKey, offset);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">GrabDataService</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"在 Phabricator workborad 的卡片上显示开始和结束时间","title_url":"Phabricator-workborad-card-task","date":"2017-07-24T16:00:00.000Z","description":"在 Phabricator workborad 的卡片上显示开始和结束时间","_content":"\n## 需求背景\n\n在 Phabricator workborad 的卡片上需要显示更多的信息,比如任务的开始和结束时间等等.\n\n## workboard 的渲染过程\n\n根据项目 workboard 的访问路径 `http://test.pha.com/project/board/9/` 和 PhabricatorProjectApplication 中定义的路由规则,可以找到 workboard 对应的 Controller 为 PhabricatorProjectBoardViewController. \n\n由此找到具体渲染 workboard 上卡片的具体过程如下\n\n```php\nPhabricatorProjectBoardViewController 362\n\tPhabricatorBoardRenderingEngine ->renderCard 56\n\t\tProjectBoardTaskCard ->getItem \n```\n\n在 getItem 方法中可以发现每个 workboard 卡片对应一个 PHUIObjectItemView 对象\n\n## 具体的修改\n\n其中 getItem 方法对应的修改如下\n\n```php\npublic function getItem() {\n    $task = $this->getTask();\n    $owner = $this->getOwner();\n    $can_edit = $this->getCanEdit();\n    $viewer = $this->getViewer();\n\n    $color_map = ManiphestTaskPriority::getColorMap();\n    $bar_color = idx($color_map, $task->getPriority(), 'grey');\n\n    // 获取每个任务对象的完整字段\n    $maniphest_fields = id(new ManiphestEditEngine())\n     ->setViewer($viewer)\n     ->loadObjectFields($task);\n\n    // 获取每个任务对象的自定义字段的 开始时间 和 结束时间\n    $start_date = '';\n    $end_date = '';\n    foreach ($maniphest_fields as $key => $field) {\n      if (strstr($key, 'start date')) {\n        $start_date = $field->getValueForDefaults();\n      }\n      if (strstr($key, 'finish-date')) {\n        $end_date = $field->getValueForDefaults();\n      }\n    }\n\n    $start = '';\n    if ($start_date !== '') {\n      $start = date(\"m-d H:i\", $start_date);\n    }\n\n    $end = '';\n    if ($end_date !== '') {\n      $end = date(\"m-d H:i\", $end_date);\n    }\n\n    $card = id(new PHUIObjectItemView())\n      ->setObject($task)\n      ->setUser($viewer)\n      ->setObjectName('T'.$task->getID())\n      ->setHeader($task->getTitle().' '.$start.'-'.$end)\n      ->setGrippable($can_edit)\n      ->setHref('/T'.$task->getID())\n      ->addSigil('project-card')\n      ->setDisabled($task->isClosed())\n      ->addAction(\n        id(new PHUIListItemView())\n        ->setName(pht('Edit'))\n        ->setIcon('fa-pencil')\n        ->addSigil('edit-project-card')\n        ->setHref('/maniphest/task/edit/'.$task->getID().'/'))\n      ->setBarColor($bar_color);\n\n    if ($owner) {\n      $card->addHandleIcon($owner, $owner->getName());\n    }\n\n    $cover_file = $this->getCoverImageFile();\n    if ($cover_file) {\n      $card->setCoverImage($cover_file->getBestURI());\n    }\n\n    if (ManiphestTaskPoints::getIsEnabled()) {\n      $points = $task->getPoints();\n      if ($points !== null) {\n        $points_tag = id(new PHUITagView())\n          ->setType(PHUITagView::TYPE_SHADE)\n          ->setColor(PHUITagView::COLOR_GREY)\n          ->setSlimShady(true)\n          ->setName($points)\n          ->addClass('phui-workcard-points');\n        $card->addAttribute($points_tag);\n      }\n    }\n\n    $subtype = $task->newSubtypeObject();\n    if ($subtype && $subtype->hasTagView()) {\n      $subtype_tag = $subtype->newTagView()\n        ->setSlimShady(true);\n      $card->addAttribute($subtype_tag);\n    }\n\n    if ($task->isClosed()) {\n      $icon = ManiphestTaskStatus::getStatusIcon($task->getStatus());\n      $icon = id(new PHUIIconView())\n        ->setIcon($icon.' grey');\n      $card->addAttribute($icon);\n      $card->setBarColor('grey');\n    }\n\n    $project_handles = $this->getProjectHandles();\n\n    // Remove any archived projects from the list.\n    if ($project_handles) {\n      foreach ($project_handles as $key => $handle) {\n        if ($handle->getStatus() == PhabricatorObjectHandle::STATUS_CLOSED) {\n          unset($project_handles[$key]);\n        }\n      }\n    }\n\n    if ($project_handles) {\n      $project_handles = array_reverse($project_handles);\n      $tag_list = id(new PHUIHandleTagListView())\n        ->setSlim(true)\n        ->setHandles($project_handles);\n      $card->addAttribute($tag_list);\n    }\n\n    $card->addClass('phui-workcard');\n\n    return $card;\n  }\n```\n\n上面方法中的 $task 由于默认没有自定义字段,并且开始时间和结束时间是定义在自定义字段中的,这里通过如下方式获取到任务对象 $task 的完整字段\n\n```php\n// 获取每个任务对象的完整字段\n$maniphest_fields = id(new ManiphestEditEngine())\n ->setViewer($viewer)\n ->loadObjectFields($task);\n```\n\n其中的 loadObjectFields 方法定义在 ManiphestEditEngine 的父类 PhabricatorEditEngine 中,具体如下\n\n```php\n  /**\n   * 获取对象的所有字段对象(PhabricatorCustomFieldEditField)\n   *\n   * author ck\n   *\n   * @param $object\n   * @return array|dict\n   */\n  public function loadObjectFields($object) {\n    $this->loadDefaultConfiguration();\n    return $this->buildEditFields($object);\n  }\n```\n\n## 参考加载编辑任务的流程\n\n这里获取到任务对象 $task 所有的字段,具体参考到了点击编辑任务到加载一个任务的编辑页面的流程,具体如下\n\n```php\nManiphestTaskEditController\n\tManiphestEditEngine\n\t\textends PhabricatorEditEngine -> buildResponse -> buildEditResponse -> buildEditFields\n```\n\n- 其中 buildEditFields 方法可以拿到一个任务对象的所有字段,包括自定义字段\t\t\n\n- 其中 buildResponse 方法中根据从请求对象 $request 中获取一个 $task 对象的id 获取了一个 $task 对象\n\n```php\n$capabilities = array();\n...\n$id = $request->getURIData('id');\n....\n$object = $this->newObjectFromID($id, $capabilities);\n```\n\n## 总结\n\n通过做这个需求，了解了 Phabricator 如下的技术细节\n\n- workboard 的渲染过程\n- PhabricatorEditEngine 加载一个对象的过程","source":"_posts/在 Phabricator workborad 的卡片上显示开始和结束时间.md","raw":"---\ntitle: 在 Phabricator workborad 的卡片上显示开始和结束时间\ntitle_url: Phabricator-workborad-card-task\ndate: 2017-07-25\ntags: Phabricator\ncategories: [Phabricator,PHP]\ndescription: 在 Phabricator workborad 的卡片上显示开始和结束时间\n---\n\n## 需求背景\n\n在 Phabricator workborad 的卡片上需要显示更多的信息,比如任务的开始和结束时间等等.\n\n## workboard 的渲染过程\n\n根据项目 workboard 的访问路径 `http://test.pha.com/project/board/9/` 和 PhabricatorProjectApplication 中定义的路由规则,可以找到 workboard 对应的 Controller 为 PhabricatorProjectBoardViewController. \n\n由此找到具体渲染 workboard 上卡片的具体过程如下\n\n```php\nPhabricatorProjectBoardViewController 362\n\tPhabricatorBoardRenderingEngine ->renderCard 56\n\t\tProjectBoardTaskCard ->getItem \n```\n\n在 getItem 方法中可以发现每个 workboard 卡片对应一个 PHUIObjectItemView 对象\n\n## 具体的修改\n\n其中 getItem 方法对应的修改如下\n\n```php\npublic function getItem() {\n    $task = $this->getTask();\n    $owner = $this->getOwner();\n    $can_edit = $this->getCanEdit();\n    $viewer = $this->getViewer();\n\n    $color_map = ManiphestTaskPriority::getColorMap();\n    $bar_color = idx($color_map, $task->getPriority(), 'grey');\n\n    // 获取每个任务对象的完整字段\n    $maniphest_fields = id(new ManiphestEditEngine())\n     ->setViewer($viewer)\n     ->loadObjectFields($task);\n\n    // 获取每个任务对象的自定义字段的 开始时间 和 结束时间\n    $start_date = '';\n    $end_date = '';\n    foreach ($maniphest_fields as $key => $field) {\n      if (strstr($key, 'start date')) {\n        $start_date = $field->getValueForDefaults();\n      }\n      if (strstr($key, 'finish-date')) {\n        $end_date = $field->getValueForDefaults();\n      }\n    }\n\n    $start = '';\n    if ($start_date !== '') {\n      $start = date(\"m-d H:i\", $start_date);\n    }\n\n    $end = '';\n    if ($end_date !== '') {\n      $end = date(\"m-d H:i\", $end_date);\n    }\n\n    $card = id(new PHUIObjectItemView())\n      ->setObject($task)\n      ->setUser($viewer)\n      ->setObjectName('T'.$task->getID())\n      ->setHeader($task->getTitle().' '.$start.'-'.$end)\n      ->setGrippable($can_edit)\n      ->setHref('/T'.$task->getID())\n      ->addSigil('project-card')\n      ->setDisabled($task->isClosed())\n      ->addAction(\n        id(new PHUIListItemView())\n        ->setName(pht('Edit'))\n        ->setIcon('fa-pencil')\n        ->addSigil('edit-project-card')\n        ->setHref('/maniphest/task/edit/'.$task->getID().'/'))\n      ->setBarColor($bar_color);\n\n    if ($owner) {\n      $card->addHandleIcon($owner, $owner->getName());\n    }\n\n    $cover_file = $this->getCoverImageFile();\n    if ($cover_file) {\n      $card->setCoverImage($cover_file->getBestURI());\n    }\n\n    if (ManiphestTaskPoints::getIsEnabled()) {\n      $points = $task->getPoints();\n      if ($points !== null) {\n        $points_tag = id(new PHUITagView())\n          ->setType(PHUITagView::TYPE_SHADE)\n          ->setColor(PHUITagView::COLOR_GREY)\n          ->setSlimShady(true)\n          ->setName($points)\n          ->addClass('phui-workcard-points');\n        $card->addAttribute($points_tag);\n      }\n    }\n\n    $subtype = $task->newSubtypeObject();\n    if ($subtype && $subtype->hasTagView()) {\n      $subtype_tag = $subtype->newTagView()\n        ->setSlimShady(true);\n      $card->addAttribute($subtype_tag);\n    }\n\n    if ($task->isClosed()) {\n      $icon = ManiphestTaskStatus::getStatusIcon($task->getStatus());\n      $icon = id(new PHUIIconView())\n        ->setIcon($icon.' grey');\n      $card->addAttribute($icon);\n      $card->setBarColor('grey');\n    }\n\n    $project_handles = $this->getProjectHandles();\n\n    // Remove any archived projects from the list.\n    if ($project_handles) {\n      foreach ($project_handles as $key => $handle) {\n        if ($handle->getStatus() == PhabricatorObjectHandle::STATUS_CLOSED) {\n          unset($project_handles[$key]);\n        }\n      }\n    }\n\n    if ($project_handles) {\n      $project_handles = array_reverse($project_handles);\n      $tag_list = id(new PHUIHandleTagListView())\n        ->setSlim(true)\n        ->setHandles($project_handles);\n      $card->addAttribute($tag_list);\n    }\n\n    $card->addClass('phui-workcard');\n\n    return $card;\n  }\n```\n\n上面方法中的 $task 由于默认没有自定义字段,并且开始时间和结束时间是定义在自定义字段中的,这里通过如下方式获取到任务对象 $task 的完整字段\n\n```php\n// 获取每个任务对象的完整字段\n$maniphest_fields = id(new ManiphestEditEngine())\n ->setViewer($viewer)\n ->loadObjectFields($task);\n```\n\n其中的 loadObjectFields 方法定义在 ManiphestEditEngine 的父类 PhabricatorEditEngine 中,具体如下\n\n```php\n  /**\n   * 获取对象的所有字段对象(PhabricatorCustomFieldEditField)\n   *\n   * author ck\n   *\n   * @param $object\n   * @return array|dict\n   */\n  public function loadObjectFields($object) {\n    $this->loadDefaultConfiguration();\n    return $this->buildEditFields($object);\n  }\n```\n\n## 参考加载编辑任务的流程\n\n这里获取到任务对象 $task 所有的字段,具体参考到了点击编辑任务到加载一个任务的编辑页面的流程,具体如下\n\n```php\nManiphestTaskEditController\n\tManiphestEditEngine\n\t\textends PhabricatorEditEngine -> buildResponse -> buildEditResponse -> buildEditFields\n```\n\n- 其中 buildEditFields 方法可以拿到一个任务对象的所有字段,包括自定义字段\t\t\n\n- 其中 buildResponse 方法中根据从请求对象 $request 中获取一个 $task 对象的id 获取了一个 $task 对象\n\n```php\n$capabilities = array();\n...\n$id = $request->getURIData('id');\n....\n$object = $this->newObjectFromID($id, $capabilities);\n```\n\n## 总结\n\n通过做这个需求，了解了 Phabricator 如下的技术细节\n\n- workboard 的渲染过程\n- PhabricatorEditEngine 加载一个对象的过程","slug":"在 Phabricator workborad 的卡片上显示开始和结束时间","published":1,"updated":"2017-07-25T10:53:36.063Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj5jgsbem00132cezfp2e7nch","content":"<h2 id=\"需求背景\"><a href=\"#需求背景\" class=\"headerlink\" title=\"需求背景\"></a>需求背景</h2><p>在 Phabricator workborad 的卡片上需要显示更多的信息,比如任务的开始和结束时间等等.</p>\n<h2 id=\"workboard-的渲染过程\"><a href=\"#workboard-的渲染过程\" class=\"headerlink\" title=\"workboard 的渲染过程\"></a>workboard 的渲染过程</h2><p>根据项目 workboard 的访问路径 <code>http://test.pha.com/project/board/9/</code> 和 PhabricatorProjectApplication 中定义的路由规则,可以找到 workboard 对应的 Controller 为 PhabricatorProjectBoardViewController. </p>\n<p>由此找到具体渲染 workboard 上卡片的具体过程如下</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PhabricatorProjectBoardViewController <span class=\"number\">362</span></span><br><span class=\"line\">\tPhabricatorBoardRenderingEngine -&gt;renderCard <span class=\"number\">56</span></span><br><span class=\"line\">\t\tProjectBoardTaskCard -&gt;getItem</span><br></pre></td></tr></table></figure>\n<p>在 getItem 方法中可以发现每个 workboard 卡片对应一个 PHUIObjectItemView 对象</p>\n<h2 id=\"具体的修改\"><a href=\"#具体的修改\" class=\"headerlink\" title=\"具体的修改\"></a>具体的修改</h2><p>其中 getItem 方法对应的修改如下</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getItem</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    $task = <span class=\"keyword\">$this</span>-&gt;getTask();</span><br><span class=\"line\">    $owner = <span class=\"keyword\">$this</span>-&gt;getOwner();</span><br><span class=\"line\">    $can_edit = <span class=\"keyword\">$this</span>-&gt;getCanEdit();</span><br><span class=\"line\">    $viewer = <span class=\"keyword\">$this</span>-&gt;getViewer();</span><br><span class=\"line\"></span><br><span class=\"line\">    $color_map = ManiphestTaskPriority::getColorMap();</span><br><span class=\"line\">    $bar_color = idx($color_map, $task-&gt;getPriority(), <span class=\"string\">'grey'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 获取每个任务对象的完整字段</span></span><br><span class=\"line\">    $maniphest_fields = id(<span class=\"keyword\">new</span> ManiphestEditEngine())</span><br><span class=\"line\">     -&gt;setViewer($viewer)</span><br><span class=\"line\">     -&gt;loadObjectFields($task);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 获取每个任务对象的自定义字段的 开始时间 和 结束时间</span></span><br><span class=\"line\">    $start_date = <span class=\"string\">''</span>;</span><br><span class=\"line\">    $end_date = <span class=\"string\">''</span>;</span><br><span class=\"line\">    <span class=\"keyword\">foreach</span> ($maniphest_fields <span class=\"keyword\">as</span> $key =&gt; $field) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (strstr($key, <span class=\"string\">'start date'</span>)) &#123;</span><br><span class=\"line\">        $start_date = $field-&gt;getValueForDefaults();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (strstr($key, <span class=\"string\">'finish-date'</span>)) &#123;</span><br><span class=\"line\">        $end_date = $field-&gt;getValueForDefaults();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $start = <span class=\"string\">''</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ($start_date !== <span class=\"string\">''</span>) &#123;</span><br><span class=\"line\">      $start = date(<span class=\"string\">\"m-d H:i\"</span>, $start_date);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $end = <span class=\"string\">''</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ($end_date !== <span class=\"string\">''</span>) &#123;</span><br><span class=\"line\">      $end = date(<span class=\"string\">\"m-d H:i\"</span>, $end_date);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $card = id(<span class=\"keyword\">new</span> PHUIObjectItemView())</span><br><span class=\"line\">      -&gt;setObject($task)</span><br><span class=\"line\">      -&gt;setUser($viewer)</span><br><span class=\"line\">      -&gt;setObjectName(<span class=\"string\">'T'</span>.$task-&gt;getID())</span><br><span class=\"line\">      -&gt;setHeader($task-&gt;getTitle().<span class=\"string\">' '</span>.$start.<span class=\"string\">'-'</span>.$end)</span><br><span class=\"line\">      -&gt;setGrippable($can_edit)</span><br><span class=\"line\">      -&gt;setHref(<span class=\"string\">'/T'</span>.$task-&gt;getID())</span><br><span class=\"line\">      -&gt;addSigil(<span class=\"string\">'project-card'</span>)</span><br><span class=\"line\">      -&gt;setDisabled($task-&gt;isClosed())</span><br><span class=\"line\">      -&gt;addAction(</span><br><span class=\"line\">        id(<span class=\"keyword\">new</span> PHUIListItemView())</span><br><span class=\"line\">        -&gt;setName(pht(<span class=\"string\">'Edit'</span>))</span><br><span class=\"line\">        -&gt;setIcon(<span class=\"string\">'fa-pencil'</span>)</span><br><span class=\"line\">        -&gt;addSigil(<span class=\"string\">'edit-project-card'</span>)</span><br><span class=\"line\">        -&gt;setHref(<span class=\"string\">'/maniphest/task/edit/'</span>.$task-&gt;getID().<span class=\"string\">'/'</span>))</span><br><span class=\"line\">      -&gt;setBarColor($bar_color);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ($owner) &#123;</span><br><span class=\"line\">      $card-&gt;addHandleIcon($owner, $owner-&gt;getName());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $cover_file = <span class=\"keyword\">$this</span>-&gt;getCoverImageFile();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ($cover_file) &#123;</span><br><span class=\"line\">      $card-&gt;setCoverImage($cover_file-&gt;getBestURI());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ManiphestTaskPoints::getIsEnabled()) &#123;</span><br><span class=\"line\">      $points = $task-&gt;getPoints();</span><br><span class=\"line\">      <span class=\"keyword\">if</span> ($points !== <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        $points_tag = id(<span class=\"keyword\">new</span> PHUITagView())</span><br><span class=\"line\">          -&gt;setType(PHUITagView::TYPE_SHADE)</span><br><span class=\"line\">          -&gt;setColor(PHUITagView::COLOR_GREY)</span><br><span class=\"line\">          -&gt;setSlimShady(<span class=\"keyword\">true</span>)</span><br><span class=\"line\">          -&gt;setName($points)</span><br><span class=\"line\">          -&gt;addClass(<span class=\"string\">'phui-workcard-points'</span>);</span><br><span class=\"line\">        $card-&gt;addAttribute($points_tag);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $subtype = $task-&gt;newSubtypeObject();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ($subtype &amp;&amp; $subtype-&gt;hasTagView()) &#123;</span><br><span class=\"line\">      $subtype_tag = $subtype-&gt;newTagView()</span><br><span class=\"line\">        -&gt;setSlimShady(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">      $card-&gt;addAttribute($subtype_tag);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ($task-&gt;isClosed()) &#123;</span><br><span class=\"line\">      $icon = ManiphestTaskStatus::getStatusIcon($task-&gt;getStatus());</span><br><span class=\"line\">      $icon = id(<span class=\"keyword\">new</span> PHUIIconView())</span><br><span class=\"line\">        -&gt;setIcon($icon.<span class=\"string\">' grey'</span>);</span><br><span class=\"line\">      $card-&gt;addAttribute($icon);</span><br><span class=\"line\">      $card-&gt;setBarColor(<span class=\"string\">'grey'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $project_handles = <span class=\"keyword\">$this</span>-&gt;getProjectHandles();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Remove any archived projects from the list.</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ($project_handles) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">foreach</span> ($project_handles <span class=\"keyword\">as</span> $key =&gt; $handle) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ($handle-&gt;getStatus() == PhabricatorObjectHandle::STATUS_CLOSED) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">unset</span>($project_handles[$key]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ($project_handles) &#123;</span><br><span class=\"line\">      $project_handles = array_reverse($project_handles);</span><br><span class=\"line\">      $tag_list = id(<span class=\"keyword\">new</span> PHUIHandleTagListView())</span><br><span class=\"line\">        -&gt;setSlim(<span class=\"keyword\">true</span>)</span><br><span class=\"line\">        -&gt;setHandles($project_handles);</span><br><span class=\"line\">      $card-&gt;addAttribute($tag_list);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $card-&gt;addClass(<span class=\"string\">'phui-workcard'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> $card;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<p>上面方法中的 $task 由于默认没有自定义字段,并且开始时间和结束时间是定义在自定义字段中的,这里通过如下方式获取到任务对象 $task 的完整字段</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 获取每个任务对象的完整字段</span></span><br><span class=\"line\">$maniphest_fields = id(<span class=\"keyword\">new</span> ManiphestEditEngine())</span><br><span class=\"line\"> -&gt;setViewer($viewer)</span><br><span class=\"line\"> -&gt;loadObjectFields($task);</span><br></pre></td></tr></table></figure>\n<p>其中的 loadObjectFields 方法定义在 ManiphestEditEngine 的父类 PhabricatorEditEngine 中,具体如下</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span><br><span class=\"line\"> * 获取对象的所有字段对象(PhabricatorCustomFieldEditField)</span><br><span class=\"line\"> *</span><br><span class=\"line\"> * author ck</span><br><span class=\"line\"> *</span><br><span class=\"line\"> * <span class=\"doctag\">@param</span> $object</span><br><span class=\"line\"> * <span class=\"doctag\">@return</span> array|dict</span><br><span class=\"line\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">loadObjectFields</span><span class=\"params\">($object)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">$this</span>-&gt;loadDefaultConfiguration();</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;buildEditFields($object);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"参考加载编辑任务的流程\"><a href=\"#参考加载编辑任务的流程\" class=\"headerlink\" title=\"参考加载编辑任务的流程\"></a>参考加载编辑任务的流程</h2><p>这里获取到任务对象 $task 所有的字段,具体参考到了点击编辑任务到加载一个任务的编辑页面的流程,具体如下</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ManiphestTaskEditController</span><br><span class=\"line\">\tManiphestEditEngine</span><br><span class=\"line\">\t\textends PhabricatorEditEngine -&gt; buildResponse -&gt; buildEditResponse -&gt; buildEditFields</span><br></pre></td></tr></table></figure>\n<ul>\n<li><p>其中 buildEditFields 方法可以拿到一个任务对象的所有字段,包括自定义字段        </p>\n</li>\n<li><p>其中 buildResponse 方法中根据从请求对象 $request 中获取一个 $task 对象的id 获取了一个 $task 对象</p>\n</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$capabilities = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">...</span><br><span class=\"line\">$id = $request-&gt;getURIData(<span class=\"string\">'id'</span>);</span><br><span class=\"line\">....</span><br><span class=\"line\">$object = <span class=\"keyword\">$this</span>-&gt;newObjectFromID($id, $capabilities);</span><br></pre></td></tr></table></figure>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>通过做这个需求，了解了 Phabricator 如下的技术细节</p>\n<ul>\n<li>workboard 的渲染过程</li>\n<li>PhabricatorEditEngine 加载一个对象的过程</li>\n</ul>\n","excerpt":"","more":"<h2 id=\"需求背景\"><a href=\"#需求背景\" class=\"headerlink\" title=\"需求背景\"></a>需求背景</h2><p>在 Phabricator workborad 的卡片上需要显示更多的信息,比如任务的开始和结束时间等等.</p>\n<h2 id=\"workboard-的渲染过程\"><a href=\"#workboard-的渲染过程\" class=\"headerlink\" title=\"workboard 的渲染过程\"></a>workboard 的渲染过程</h2><p>根据项目 workboard 的访问路径 <code>http://test.pha.com/project/board/9/</code> 和 PhabricatorProjectApplication 中定义的路由规则,可以找到 workboard 对应的 Controller 为 PhabricatorProjectBoardViewController. </p>\n<p>由此找到具体渲染 workboard 上卡片的具体过程如下</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PhabricatorProjectBoardViewController <span class=\"number\">362</span></span><br><span class=\"line\">\tPhabricatorBoardRenderingEngine -&gt;renderCard <span class=\"number\">56</span></span><br><span class=\"line\">\t\tProjectBoardTaskCard -&gt;getItem</span><br></pre></td></tr></table></figure>\n<p>在 getItem 方法中可以发现每个 workboard 卡片对应一个 PHUIObjectItemView 对象</p>\n<h2 id=\"具体的修改\"><a href=\"#具体的修改\" class=\"headerlink\" title=\"具体的修改\"></a>具体的修改</h2><p>其中 getItem 方法对应的修改如下</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getItem</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    $task = <span class=\"keyword\">$this</span>-&gt;getTask();</span><br><span class=\"line\">    $owner = <span class=\"keyword\">$this</span>-&gt;getOwner();</span><br><span class=\"line\">    $can_edit = <span class=\"keyword\">$this</span>-&gt;getCanEdit();</span><br><span class=\"line\">    $viewer = <span class=\"keyword\">$this</span>-&gt;getViewer();</span><br><span class=\"line\"></span><br><span class=\"line\">    $color_map = ManiphestTaskPriority::getColorMap();</span><br><span class=\"line\">    $bar_color = idx($color_map, $task-&gt;getPriority(), <span class=\"string\">'grey'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 获取每个任务对象的完整字段</span></span><br><span class=\"line\">    $maniphest_fields = id(<span class=\"keyword\">new</span> ManiphestEditEngine())</span><br><span class=\"line\">     -&gt;setViewer($viewer)</span><br><span class=\"line\">     -&gt;loadObjectFields($task);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 获取每个任务对象的自定义字段的 开始时间 和 结束时间</span></span><br><span class=\"line\">    $start_date = <span class=\"string\">''</span>;</span><br><span class=\"line\">    $end_date = <span class=\"string\">''</span>;</span><br><span class=\"line\">    <span class=\"keyword\">foreach</span> ($maniphest_fields <span class=\"keyword\">as</span> $key =&gt; $field) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (strstr($key, <span class=\"string\">'start date'</span>)) &#123;</span><br><span class=\"line\">        $start_date = $field-&gt;getValueForDefaults();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (strstr($key, <span class=\"string\">'finish-date'</span>)) &#123;</span><br><span class=\"line\">        $end_date = $field-&gt;getValueForDefaults();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $start = <span class=\"string\">''</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ($start_date !== <span class=\"string\">''</span>) &#123;</span><br><span class=\"line\">      $start = date(<span class=\"string\">\"m-d H:i\"</span>, $start_date);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $end = <span class=\"string\">''</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ($end_date !== <span class=\"string\">''</span>) &#123;</span><br><span class=\"line\">      $end = date(<span class=\"string\">\"m-d H:i\"</span>, $end_date);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $card = id(<span class=\"keyword\">new</span> PHUIObjectItemView())</span><br><span class=\"line\">      -&gt;setObject($task)</span><br><span class=\"line\">      -&gt;setUser($viewer)</span><br><span class=\"line\">      -&gt;setObjectName(<span class=\"string\">'T'</span>.$task-&gt;getID())</span><br><span class=\"line\">      -&gt;setHeader($task-&gt;getTitle().<span class=\"string\">' '</span>.$start.<span class=\"string\">'-'</span>.$end)</span><br><span class=\"line\">      -&gt;setGrippable($can_edit)</span><br><span class=\"line\">      -&gt;setHref(<span class=\"string\">'/T'</span>.$task-&gt;getID())</span><br><span class=\"line\">      -&gt;addSigil(<span class=\"string\">'project-card'</span>)</span><br><span class=\"line\">      -&gt;setDisabled($task-&gt;isClosed())</span><br><span class=\"line\">      -&gt;addAction(</span><br><span class=\"line\">        id(<span class=\"keyword\">new</span> PHUIListItemView())</span><br><span class=\"line\">        -&gt;setName(pht(<span class=\"string\">'Edit'</span>))</span><br><span class=\"line\">        -&gt;setIcon(<span class=\"string\">'fa-pencil'</span>)</span><br><span class=\"line\">        -&gt;addSigil(<span class=\"string\">'edit-project-card'</span>)</span><br><span class=\"line\">        -&gt;setHref(<span class=\"string\">'/maniphest/task/edit/'</span>.$task-&gt;getID().<span class=\"string\">'/'</span>))</span><br><span class=\"line\">      -&gt;setBarColor($bar_color);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ($owner) &#123;</span><br><span class=\"line\">      $card-&gt;addHandleIcon($owner, $owner-&gt;getName());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $cover_file = <span class=\"keyword\">$this</span>-&gt;getCoverImageFile();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ($cover_file) &#123;</span><br><span class=\"line\">      $card-&gt;setCoverImage($cover_file-&gt;getBestURI());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ManiphestTaskPoints::getIsEnabled()) &#123;</span><br><span class=\"line\">      $points = $task-&gt;getPoints();</span><br><span class=\"line\">      <span class=\"keyword\">if</span> ($points !== <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        $points_tag = id(<span class=\"keyword\">new</span> PHUITagView())</span><br><span class=\"line\">          -&gt;setType(PHUITagView::TYPE_SHADE)</span><br><span class=\"line\">          -&gt;setColor(PHUITagView::COLOR_GREY)</span><br><span class=\"line\">          -&gt;setSlimShady(<span class=\"keyword\">true</span>)</span><br><span class=\"line\">          -&gt;setName($points)</span><br><span class=\"line\">          -&gt;addClass(<span class=\"string\">'phui-workcard-points'</span>);</span><br><span class=\"line\">        $card-&gt;addAttribute($points_tag);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $subtype = $task-&gt;newSubtypeObject();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ($subtype &amp;&amp; $subtype-&gt;hasTagView()) &#123;</span><br><span class=\"line\">      $subtype_tag = $subtype-&gt;newTagView()</span><br><span class=\"line\">        -&gt;setSlimShady(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">      $card-&gt;addAttribute($subtype_tag);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ($task-&gt;isClosed()) &#123;</span><br><span class=\"line\">      $icon = ManiphestTaskStatus::getStatusIcon($task-&gt;getStatus());</span><br><span class=\"line\">      $icon = id(<span class=\"keyword\">new</span> PHUIIconView())</span><br><span class=\"line\">        -&gt;setIcon($icon.<span class=\"string\">' grey'</span>);</span><br><span class=\"line\">      $card-&gt;addAttribute($icon);</span><br><span class=\"line\">      $card-&gt;setBarColor(<span class=\"string\">'grey'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $project_handles = <span class=\"keyword\">$this</span>-&gt;getProjectHandles();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Remove any archived projects from the list.</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ($project_handles) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">foreach</span> ($project_handles <span class=\"keyword\">as</span> $key =&gt; $handle) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ($handle-&gt;getStatus() == PhabricatorObjectHandle::STATUS_CLOSED) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">unset</span>($project_handles[$key]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ($project_handles) &#123;</span><br><span class=\"line\">      $project_handles = array_reverse($project_handles);</span><br><span class=\"line\">      $tag_list = id(<span class=\"keyword\">new</span> PHUIHandleTagListView())</span><br><span class=\"line\">        -&gt;setSlim(<span class=\"keyword\">true</span>)</span><br><span class=\"line\">        -&gt;setHandles($project_handles);</span><br><span class=\"line\">      $card-&gt;addAttribute($tag_list);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $card-&gt;addClass(<span class=\"string\">'phui-workcard'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> $card;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<p>上面方法中的 $task 由于默认没有自定义字段,并且开始时间和结束时间是定义在自定义字段中的,这里通过如下方式获取到任务对象 $task 的完整字段</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 获取每个任务对象的完整字段</span></span><br><span class=\"line\">$maniphest_fields = id(<span class=\"keyword\">new</span> ManiphestEditEngine())</span><br><span class=\"line\"> -&gt;setViewer($viewer)</span><br><span class=\"line\"> -&gt;loadObjectFields($task);</span><br></pre></td></tr></table></figure>\n<p>其中的 loadObjectFields 方法定义在 ManiphestEditEngine 的父类 PhabricatorEditEngine 中,具体如下</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span><br><span class=\"line\"> * 获取对象的所有字段对象(PhabricatorCustomFieldEditField)</span><br><span class=\"line\"> *</span><br><span class=\"line\"> * author ck</span><br><span class=\"line\"> *</span><br><span class=\"line\"> * <span class=\"doctag\">@param</span> $object</span><br><span class=\"line\"> * <span class=\"doctag\">@return</span> array|dict</span><br><span class=\"line\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">loadObjectFields</span><span class=\"params\">($object)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">$this</span>-&gt;loadDefaultConfiguration();</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;buildEditFields($object);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"参考加载编辑任务的流程\"><a href=\"#参考加载编辑任务的流程\" class=\"headerlink\" title=\"参考加载编辑任务的流程\"></a>参考加载编辑任务的流程</h2><p>这里获取到任务对象 $task 所有的字段,具体参考到了点击编辑任务到加载一个任务的编辑页面的流程,具体如下</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ManiphestTaskEditController</span><br><span class=\"line\">\tManiphestEditEngine</span><br><span class=\"line\">\t\textends PhabricatorEditEngine -&gt; buildResponse -&gt; buildEditResponse -&gt; buildEditFields</span><br></pre></td></tr></table></figure>\n<ul>\n<li><p>其中 buildEditFields 方法可以拿到一个任务对象的所有字段,包括自定义字段        </p>\n</li>\n<li><p>其中 buildResponse 方法中根据从请求对象 $request 中获取一个 $task 对象的id 获取了一个 $task 对象</p>\n</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$capabilities = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">...</span><br><span class=\"line\">$id = $request-&gt;getURIData(<span class=\"string\">'id'</span>);</span><br><span class=\"line\">....</span><br><span class=\"line\">$object = <span class=\"keyword\">$this</span>-&gt;newObjectFromID($id, $capabilities);</span><br></pre></td></tr></table></figure>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>通过做这个需求，了解了 Phabricator 如下的技术细节</p>\n<ul>\n<li>workboard 的渲染过程</li>\n<li>PhabricatorEditEngine 加载一个对象的过程</li>\n</ul>\n"},{"title":"在 Phabricator 项目列表中增加任务数和最新任务的链接","title_url":"Phabricator-list-item-task","date":"2017-07-24T16:00:00.000Z","description":"在 Phabricator 项目列表中增加任务数和最新任务的链接","_content":"\n\n## 需求背景\n\n在 Phabricator 项目和任务之间的衔接并不连贯,根据反馈需要在项目列表中增加显示任务数和最新任务的链接.\n\n## Controller 间的跳转\n\n根据 PhabricatorProjectApplication 中的路由配置,当访问默认的项目列表具体的 Controller 就是 PhabricatorProjectListController\n\nPhabricatorProjectListController 中 handleRequest 方法如下\n\n```php\n  public function handleRequest(AphrontRequest $request) {\n    return id(new PhabricatorProjectSearchEngine())\n      ->setController($this)\n      ->buildResponse();\n  }\n```\n\n- 找到对应 PhabricatorProjectSearchEngine 的 buildResponse 方法如下\n\n```php\n  public function buildResponse() {\n    $controller = $this->getController();\n    $request = $controller->getRequest();\n\n    $search = id(new PhabricatorApplicationSearchController())\n      ->setQueryKey($request->getURIData('queryKey'))\n      ->setSearchEngine($this);\n\n    return $controller->delegateToController($search);\n  }\n```\n\n其中 delegateToController 方法是由 AphrontController 定义的,具体的继承关系如下\n\n```\nPhabricatorProjectListController\n\textends PhabricatorProjectController\n\t\textends PhabricatorController\n\t\t\textends AphrontController\n```\n\ndelegateToController 方法具体定义如下\n\n```php\n  final public function delegateToController(AphrontController $controller) {\n    $request = $this->getRequest();\n\n    $controller->setDelegatingController($this);\n    $controller->setRequest($request);\n\n    $application = $this->getCurrentApplication();\n    if ($application) {\n      $controller->setCurrentApplication($application);\n    }\n\n    return $controller->handleRequest($request);\n  }\n```\n\n- 其中传入的 $controller 对象是 PhabricatorApplicationSearchController, 由此我们可以知道 `$controller->handleRequest($request)` 是调用 PhabricatorApplicationSearchController 中的 handleRequest 方法, \n但是 PhabricatorApplicationSearchController 中并没有 handleRequest 方法, 说明调用的是 AphrontController 定义的\n\n- 其中的 handleRequest 方法具体定义如下\n\n```php\n  public function handleRequest(AphrontRequest $request) {\n    if (method_exists($this, 'processRequest')) {\n      return $this->processRequest();\n    }\n\n    throw new PhutilMethodNotImplementedException(\n      pht(\n        'Controllers must implement either %s (recommended) '.\n        'or %s (deprecated).',\n        'handleRequest()',\n        'processRequest()'));\n  }\n```\n\n其中 method_exists 方法中第一个参数表示当前对象, 第二个参数表示对象里面的方法,如果当前对象中有该方法,返回true,随后执行 processRequest 方法\n\n从上面的 Controller 继承关系中我们来一一查找下\n\t\n```php\nPhabricatorProjectListController // 没有 processRequest 方法\n\textends PhabricatorProjectController // 没有 processRequest 方法\n\t\textends PhabricatorController // 没有 processRequest 方法\n\t\t\textends AphrontController // 没有 processRequest 方法\n```\n\n发现都没有 processRequest 方法, 再来看看 PhabricatorApplicationSearchController 继承关系\n\n```php\nPhabricatorApplicationSearchController  //有 processRequest 方法\n\textends PhabricatorSearchBaseController // 没有 processRequest 方法\n\t\textends PhabricatorController // 没有 processRequest 方法\n\t\t\textends AphrontController // 没有 processRequest 方法\n```\n\n从上面的分析中可以得出的结论是 PhabricatorProjectListController 得到请求后经过 AphrontController 的 delegateToController 和 handleRequest 方法处理后最终是由 PhabricatorApplicationSearchController 的 processRequest 方法完成最终数据处理的.\n\n## 数据渲染过程\n\n在 PhabricatorApplicationSearchController 中的 processSearchRequest 方法中有如下关键的几行代码\n\n```\n$objects = $engine->executeQuery($query, $pager);\n....\n$list = $engine->renderResults($objects, $saved_query);\n.....\nif ($list->getTable()) {\n\t$box->setTable($list->getTable());\n}\n```\n\n其中 $engine 对象就是 PhabricatorProjectListController 中传入的 PhabricatorProjectSearchEngine, 这里调用了 renderResults 方法返回了一个列表数据,这些数据就是页面上展示的项目列表. PhabricatorProjectSearchEngine 的继承关系如下\n\n```php\nPhabricatorProjectSearchEngine-> // 有 renderResultList 没有 executeQuery 和 renderResults\n\textends PhabricatorApplicationSearchEngine // 有 executeQuery 和 renderResults , renderResultList 是 abstract 的,由子类实现\n```\n\n- 其中 executeQuery 用于执行具体的查询,将项目数据从数据库加载到应用中\n\n- 其中 renderResultList 具体如下,方法中的 PhabricatorProjectListView 负责将数据渲染为 HTML\n\n```php\n  protected function renderResultList(\n    array $projects,\n    PhabricatorSavedQuery $query,\n    array $handles) {\n    assert_instances_of($projects, 'PhabricatorProject');\n    $viewer = $this->requireViewer();\n\n    $list = id(new PhabricatorProjectListView())\n      ->setUser($viewer)\n      ->setProjects($projects)\n      ->setShowWatching(true)\n      ->setShowMember(true)\n      ->renderList();\n\n    return id(new PhabricatorApplicationSearchResultView())\n      ->setObjectList($list)\n      ->setNoDataString(pht('No projects found.'));\n  }\n```\n\n## 具体的修改\n\n- 下面的这个方法根据项目的 phid 获取项目对应的 Edge 对象列表, 此时的 Edge 对象中的 src 字段表示 PhabricatorProject 对象中的 phid 字段, dst 字段表示 ManiphestTask 对象中的 phid 字段\n\n- 具体位于 phabricator\\src\\infrastructure\\edges\\query\\PhabricatorEdgeQuery.php\n\n```php\n  /**\n   * 加载一组 Edge 数据\n   * @param $src_phid\n   * @param $edge_type\n   * @return mixed\n   */\n  public static function loadEdgeDatas($src_phid, $edge_type) {\n    $edges = id(new PhabricatorEdgeQuery())\n        ->withSourcePHIDs(array($src_phid))\n        ->withEdgeTypes(array($edge_type))\n        ->execute();\n\n    return $edges[$src_phid][$edge_type];\n  }\n```\n\n- PhabricatorProjectListView 对象中的 renderList 方法修改如下\n\n```php\n  public function renderList() {\n    $viewer = $this->getUser();\n    $viewer_phid = $viewer->getPHID();\n    $projects = $this->getProjects();\n\n    $handles = $viewer->loadHandles(mpull($projects, 'getPHID'));\n\n    $no_data = pht('No projects found.');\n    if ($this->noDataString) {\n      $no_data = $this->noDataString;\n    }\n\n    $list = id(new PHUIObjectItemListView())\n      ->setUser($viewer)\n      ->setNoDataString($no_data);\n\n    foreach ($projects as $key => $project) {\n      // 加载一个maniphest对象\n      $taskEdge = PhabricatorEdgeQuery::loadEdgeDatas(\n            $project->getPHID(),\n            '42',\n            '');\n\n      $task = new ManiphestTask();\n\n      $tasklink = \"\";\n      if (!empty($taskEdge)) {\n        foreach ($taskEdge as $key => $value) {\n          $taskPHID = $key;\n          $task = id(new ManiphestTask())->loadOneWhere(\"phid = '\".$key.\"'\");\n          if ($task !== null) {\n            // 任务的链接\n            $tasklink = phutil_tag(\n             'a',\n             array(\n              'href' => \"/T\".$task->getID(),\n              'class' => 'phui-oi-link',\n              'title' => $task->getTitle(),\n             ),\n             $task->getTitle());\n            // 这里只要最新的一个任务\n            break;\n          }\n        }\n      }\n\n      $id = $project->getID();\n\n      $icon = $project->getDisplayIconIcon();\n      $icon_icon = id(new PHUIIconView())\n        ->setIcon($icon);\n\n      $icon_name = $project->getDisplayIconName();\n\n      // 这里加上任务数量和最新的任务链接\n      $item = id(new PHUIObjectItemView())\n        ->setHeader($project->getName())\n        ->setHref(\"/project/view/{$id}/\")\n        ->setImageURI($project->getProfileImageURI())\n        ->addAttribute(\n          array(\n            $icon_icon,\n            ' ',\n            $icon_name,\n            ' ',\n            count($taskEdge),\n            ' ',\n            $tasklink,\n          ));\n\n      if ($project->getStatus() == PhabricatorProjectStatus::STATUS_ARCHIVED) {\n        $item->addIcon('fa-ban', pht('Archived'));\n        $item->setDisabled(true);\n      }\n\n      if ($this->showMember) {\n        $is_member = $project->isUserMember($viewer_phid);\n        if ($is_member) {\n          $item->addIcon('fa-user', pht('Member'));\n        }\n      }\n\n      if ($this->showWatching) {\n        $is_watcher = $project->isUserWatcher($viewer_phid);\n        if ($is_watcher) {\n          $item->addIcon('fa-eye', pht('Watching'));\n        }\n      }\n\n      $list->addItem($item);\n    }\n\n    return $list;\n  }\n```\n\n## 最终的效果\n\n![project-maniphest](http://7xt8a6.com1.z0.glb.clouddn.com/project-1.PNG)\n\n## 总结\n\n通过做这个需求，了解了 Phabricator 如下的技术细节\n\n- Controller 间的流转细节\n- 每个应用之间通过 Edge 进行关系连接，一对一，一对多的关系\n- 列表页面的渲染","source":"_posts/在 Phabricator 项目列表中增加任务数和最新任务的链接.md","raw":"---\ntitle: 在 Phabricator 项目列表中增加任务数和最新任务的链接\ntitle_url: Phabricator-list-item-task\ndate: 2017-07-25\ntags: Phabricator\ncategories: [Phabricator,PHP]\ndescription: 在 Phabricator 项目列表中增加任务数和最新任务的链接\n---\n\n\n## 需求背景\n\n在 Phabricator 项目和任务之间的衔接并不连贯,根据反馈需要在项目列表中增加显示任务数和最新任务的链接.\n\n## Controller 间的跳转\n\n根据 PhabricatorProjectApplication 中的路由配置,当访问默认的项目列表具体的 Controller 就是 PhabricatorProjectListController\n\nPhabricatorProjectListController 中 handleRequest 方法如下\n\n```php\n  public function handleRequest(AphrontRequest $request) {\n    return id(new PhabricatorProjectSearchEngine())\n      ->setController($this)\n      ->buildResponse();\n  }\n```\n\n- 找到对应 PhabricatorProjectSearchEngine 的 buildResponse 方法如下\n\n```php\n  public function buildResponse() {\n    $controller = $this->getController();\n    $request = $controller->getRequest();\n\n    $search = id(new PhabricatorApplicationSearchController())\n      ->setQueryKey($request->getURIData('queryKey'))\n      ->setSearchEngine($this);\n\n    return $controller->delegateToController($search);\n  }\n```\n\n其中 delegateToController 方法是由 AphrontController 定义的,具体的继承关系如下\n\n```\nPhabricatorProjectListController\n\textends PhabricatorProjectController\n\t\textends PhabricatorController\n\t\t\textends AphrontController\n```\n\ndelegateToController 方法具体定义如下\n\n```php\n  final public function delegateToController(AphrontController $controller) {\n    $request = $this->getRequest();\n\n    $controller->setDelegatingController($this);\n    $controller->setRequest($request);\n\n    $application = $this->getCurrentApplication();\n    if ($application) {\n      $controller->setCurrentApplication($application);\n    }\n\n    return $controller->handleRequest($request);\n  }\n```\n\n- 其中传入的 $controller 对象是 PhabricatorApplicationSearchController, 由此我们可以知道 `$controller->handleRequest($request)` 是调用 PhabricatorApplicationSearchController 中的 handleRequest 方法, \n但是 PhabricatorApplicationSearchController 中并没有 handleRequest 方法, 说明调用的是 AphrontController 定义的\n\n- 其中的 handleRequest 方法具体定义如下\n\n```php\n  public function handleRequest(AphrontRequest $request) {\n    if (method_exists($this, 'processRequest')) {\n      return $this->processRequest();\n    }\n\n    throw new PhutilMethodNotImplementedException(\n      pht(\n        'Controllers must implement either %s (recommended) '.\n        'or %s (deprecated).',\n        'handleRequest()',\n        'processRequest()'));\n  }\n```\n\n其中 method_exists 方法中第一个参数表示当前对象, 第二个参数表示对象里面的方法,如果当前对象中有该方法,返回true,随后执行 processRequest 方法\n\n从上面的 Controller 继承关系中我们来一一查找下\n\t\n```php\nPhabricatorProjectListController // 没有 processRequest 方法\n\textends PhabricatorProjectController // 没有 processRequest 方法\n\t\textends PhabricatorController // 没有 processRequest 方法\n\t\t\textends AphrontController // 没有 processRequest 方法\n```\n\n发现都没有 processRequest 方法, 再来看看 PhabricatorApplicationSearchController 继承关系\n\n```php\nPhabricatorApplicationSearchController  //有 processRequest 方法\n\textends PhabricatorSearchBaseController // 没有 processRequest 方法\n\t\textends PhabricatorController // 没有 processRequest 方法\n\t\t\textends AphrontController // 没有 processRequest 方法\n```\n\n从上面的分析中可以得出的结论是 PhabricatorProjectListController 得到请求后经过 AphrontController 的 delegateToController 和 handleRequest 方法处理后最终是由 PhabricatorApplicationSearchController 的 processRequest 方法完成最终数据处理的.\n\n## 数据渲染过程\n\n在 PhabricatorApplicationSearchController 中的 processSearchRequest 方法中有如下关键的几行代码\n\n```\n$objects = $engine->executeQuery($query, $pager);\n....\n$list = $engine->renderResults($objects, $saved_query);\n.....\nif ($list->getTable()) {\n\t$box->setTable($list->getTable());\n}\n```\n\n其中 $engine 对象就是 PhabricatorProjectListController 中传入的 PhabricatorProjectSearchEngine, 这里调用了 renderResults 方法返回了一个列表数据,这些数据就是页面上展示的项目列表. PhabricatorProjectSearchEngine 的继承关系如下\n\n```php\nPhabricatorProjectSearchEngine-> // 有 renderResultList 没有 executeQuery 和 renderResults\n\textends PhabricatorApplicationSearchEngine // 有 executeQuery 和 renderResults , renderResultList 是 abstract 的,由子类实现\n```\n\n- 其中 executeQuery 用于执行具体的查询,将项目数据从数据库加载到应用中\n\n- 其中 renderResultList 具体如下,方法中的 PhabricatorProjectListView 负责将数据渲染为 HTML\n\n```php\n  protected function renderResultList(\n    array $projects,\n    PhabricatorSavedQuery $query,\n    array $handles) {\n    assert_instances_of($projects, 'PhabricatorProject');\n    $viewer = $this->requireViewer();\n\n    $list = id(new PhabricatorProjectListView())\n      ->setUser($viewer)\n      ->setProjects($projects)\n      ->setShowWatching(true)\n      ->setShowMember(true)\n      ->renderList();\n\n    return id(new PhabricatorApplicationSearchResultView())\n      ->setObjectList($list)\n      ->setNoDataString(pht('No projects found.'));\n  }\n```\n\n## 具体的修改\n\n- 下面的这个方法根据项目的 phid 获取项目对应的 Edge 对象列表, 此时的 Edge 对象中的 src 字段表示 PhabricatorProject 对象中的 phid 字段, dst 字段表示 ManiphestTask 对象中的 phid 字段\n\n- 具体位于 phabricator\\src\\infrastructure\\edges\\query\\PhabricatorEdgeQuery.php\n\n```php\n  /**\n   * 加载一组 Edge 数据\n   * @param $src_phid\n   * @param $edge_type\n   * @return mixed\n   */\n  public static function loadEdgeDatas($src_phid, $edge_type) {\n    $edges = id(new PhabricatorEdgeQuery())\n        ->withSourcePHIDs(array($src_phid))\n        ->withEdgeTypes(array($edge_type))\n        ->execute();\n\n    return $edges[$src_phid][$edge_type];\n  }\n```\n\n- PhabricatorProjectListView 对象中的 renderList 方法修改如下\n\n```php\n  public function renderList() {\n    $viewer = $this->getUser();\n    $viewer_phid = $viewer->getPHID();\n    $projects = $this->getProjects();\n\n    $handles = $viewer->loadHandles(mpull($projects, 'getPHID'));\n\n    $no_data = pht('No projects found.');\n    if ($this->noDataString) {\n      $no_data = $this->noDataString;\n    }\n\n    $list = id(new PHUIObjectItemListView())\n      ->setUser($viewer)\n      ->setNoDataString($no_data);\n\n    foreach ($projects as $key => $project) {\n      // 加载一个maniphest对象\n      $taskEdge = PhabricatorEdgeQuery::loadEdgeDatas(\n            $project->getPHID(),\n            '42',\n            '');\n\n      $task = new ManiphestTask();\n\n      $tasklink = \"\";\n      if (!empty($taskEdge)) {\n        foreach ($taskEdge as $key => $value) {\n          $taskPHID = $key;\n          $task = id(new ManiphestTask())->loadOneWhere(\"phid = '\".$key.\"'\");\n          if ($task !== null) {\n            // 任务的链接\n            $tasklink = phutil_tag(\n             'a',\n             array(\n              'href' => \"/T\".$task->getID(),\n              'class' => 'phui-oi-link',\n              'title' => $task->getTitle(),\n             ),\n             $task->getTitle());\n            // 这里只要最新的一个任务\n            break;\n          }\n        }\n      }\n\n      $id = $project->getID();\n\n      $icon = $project->getDisplayIconIcon();\n      $icon_icon = id(new PHUIIconView())\n        ->setIcon($icon);\n\n      $icon_name = $project->getDisplayIconName();\n\n      // 这里加上任务数量和最新的任务链接\n      $item = id(new PHUIObjectItemView())\n        ->setHeader($project->getName())\n        ->setHref(\"/project/view/{$id}/\")\n        ->setImageURI($project->getProfileImageURI())\n        ->addAttribute(\n          array(\n            $icon_icon,\n            ' ',\n            $icon_name,\n            ' ',\n            count($taskEdge),\n            ' ',\n            $tasklink,\n          ));\n\n      if ($project->getStatus() == PhabricatorProjectStatus::STATUS_ARCHIVED) {\n        $item->addIcon('fa-ban', pht('Archived'));\n        $item->setDisabled(true);\n      }\n\n      if ($this->showMember) {\n        $is_member = $project->isUserMember($viewer_phid);\n        if ($is_member) {\n          $item->addIcon('fa-user', pht('Member'));\n        }\n      }\n\n      if ($this->showWatching) {\n        $is_watcher = $project->isUserWatcher($viewer_phid);\n        if ($is_watcher) {\n          $item->addIcon('fa-eye', pht('Watching'));\n        }\n      }\n\n      $list->addItem($item);\n    }\n\n    return $list;\n  }\n```\n\n## 最终的效果\n\n![project-maniphest](http://7xt8a6.com1.z0.glb.clouddn.com/project-1.PNG)\n\n## 总结\n\n通过做这个需求，了解了 Phabricator 如下的技术细节\n\n- Controller 间的流转细节\n- 每个应用之间通过 Edge 进行关系连接，一对一，一对多的关系\n- 列表页面的渲染","slug":"在 Phabricator 项目列表中增加任务数和最新任务的链接","published":1,"updated":"2017-07-25T10:54:15.676Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj5jgsbet00172cez5543bn1o","content":"<h2 id=\"需求背景\"><a href=\"#需求背景\" class=\"headerlink\" title=\"需求背景\"></a>需求背景</h2><p>在 Phabricator 项目和任务之间的衔接并不连贯,根据反馈需要在项目列表中增加显示任务数和最新任务的链接.</p>\n<h2 id=\"Controller-间的跳转\"><a href=\"#Controller-间的跳转\" class=\"headerlink\" title=\"Controller 间的跳转\"></a>Controller 间的跳转</h2><p>根据 PhabricatorProjectApplication 中的路由配置,当访问默认的项目列表具体的 Controller 就是 PhabricatorProjectListController</p>\n<p>PhabricatorProjectListController 中 handleRequest 方法如下</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleRequest</span><span class=\"params\">(AphrontRequest $request)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> id(<span class=\"keyword\">new</span> PhabricatorProjectSearchEngine())</span><br><span class=\"line\">    -&gt;setController(<span class=\"keyword\">$this</span>)</span><br><span class=\"line\">    -&gt;buildResponse();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>找到对应 PhabricatorProjectSearchEngine 的 buildResponse 方法如下</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">buildResponse</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  $controller = <span class=\"keyword\">$this</span>-&gt;getController();</span><br><span class=\"line\">  $request = $controller-&gt;getRequest();</span><br><span class=\"line\"></span><br><span class=\"line\">  $search = id(<span class=\"keyword\">new</span> PhabricatorApplicationSearchController())</span><br><span class=\"line\">    -&gt;setQueryKey($request-&gt;getURIData(<span class=\"string\">'queryKey'</span>))</span><br><span class=\"line\">    -&gt;setSearchEngine(<span class=\"keyword\">$this</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> $controller-&gt;delegateToController($search);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>其中 delegateToController 方法是由 AphrontController 定义的,具体的继承关系如下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PhabricatorProjectListController</span><br><span class=\"line\">\textends PhabricatorProjectController</span><br><span class=\"line\">\t\textends PhabricatorController</span><br><span class=\"line\">\t\t\textends AphrontController</span><br></pre></td></tr></table></figure>\n<p>delegateToController 方法具体定义如下</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">delegateToController</span><span class=\"params\">(AphrontController $controller)</span> </span>&#123;</span><br><span class=\"line\">  $request = <span class=\"keyword\">$this</span>-&gt;getRequest();</span><br><span class=\"line\"></span><br><span class=\"line\">  $controller-&gt;setDelegatingController(<span class=\"keyword\">$this</span>);</span><br><span class=\"line\">  $controller-&gt;setRequest($request);</span><br><span class=\"line\"></span><br><span class=\"line\">  $application = <span class=\"keyword\">$this</span>-&gt;getCurrentApplication();</span><br><span class=\"line\">  <span class=\"keyword\">if</span> ($application) &#123;</span><br><span class=\"line\">    $controller-&gt;setCurrentApplication($application);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> $controller-&gt;handleRequest($request);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><p>其中传入的 $controller 对象是 PhabricatorApplicationSearchController, 由此我们可以知道 <code>$controller-&gt;handleRequest($request)</code> 是调用 PhabricatorApplicationSearchController 中的 handleRequest 方法,<br>但是 PhabricatorApplicationSearchController 中并没有 handleRequest 方法, 说明调用的是 AphrontController 定义的</p>\n</li>\n<li><p>其中的 handleRequest 方法具体定义如下</p>\n</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleRequest</span><span class=\"params\">(AphrontRequest $request)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (method_exists(<span class=\"keyword\">$this</span>, <span class=\"string\">'processRequest'</span>)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;processRequest();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> PhutilMethodNotImplementedException(</span><br><span class=\"line\">    pht(</span><br><span class=\"line\">      <span class=\"string\">'Controllers must implement either %s (recommended) '</span>.</span><br><span class=\"line\">      <span class=\"string\">'or %s (deprecated).'</span>,</span><br><span class=\"line\">      <span class=\"string\">'handleRequest()'</span>,</span><br><span class=\"line\">      <span class=\"string\">'processRequest()'</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>其中 method_exists 方法中第一个参数表示当前对象, 第二个参数表示对象里面的方法,如果当前对象中有该方法,返回true,随后执行 processRequest 方法</p>\n<p>从上面的 Controller 继承关系中我们来一一查找下</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PhabricatorProjectListController <span class=\"comment\">// 没有 processRequest 方法</span></span><br><span class=\"line\">\textends PhabricatorProjectController <span class=\"comment\">// 没有 processRequest 方法</span></span><br><span class=\"line\">\t\textends PhabricatorController <span class=\"comment\">// 没有 processRequest 方法</span></span><br><span class=\"line\">\t\t\textends AphrontController <span class=\"comment\">// 没有 processRequest 方法</span></span><br></pre></td></tr></table></figure>\n<p>发现都没有 processRequest 方法, 再来看看 PhabricatorApplicationSearchController 继承关系</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PhabricatorApplicationSearchController  <span class=\"comment\">//有 processRequest 方法</span></span><br><span class=\"line\">\textends PhabricatorSearchBaseController <span class=\"comment\">// 没有 processRequest 方法</span></span><br><span class=\"line\">\t\textends PhabricatorController <span class=\"comment\">// 没有 processRequest 方法</span></span><br><span class=\"line\">\t\t\textends AphrontController <span class=\"comment\">// 没有 processRequest 方法</span></span><br></pre></td></tr></table></figure>\n<p>从上面的分析中可以得出的结论是 PhabricatorProjectListController 得到请求后经过 AphrontController 的 delegateToController 和 handleRequest 方法处理后最终是由 PhabricatorApplicationSearchController 的 processRequest 方法完成最终数据处理的.</p>\n<h2 id=\"数据渲染过程\"><a href=\"#数据渲染过程\" class=\"headerlink\" title=\"数据渲染过程\"></a>数据渲染过程</h2><p>在 PhabricatorApplicationSearchController 中的 processSearchRequest 方法中有如下关键的几行代码</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$objects = $engine-&gt;executeQuery($query, $pager);</span><br><span class=\"line\">....</span><br><span class=\"line\">$list = $engine-&gt;renderResults($objects, $saved_query);</span><br><span class=\"line\">.....</span><br><span class=\"line\">if ($list-&gt;getTable()) &#123;</span><br><span class=\"line\">\t$box-&gt;setTable($list-&gt;getTable());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>其中 $engine 对象就是 PhabricatorProjectListController 中传入的 PhabricatorProjectSearchEngine, 这里调用了 renderResults 方法返回了一个列表数据,这些数据就是页面上展示的项目列表. PhabricatorProjectSearchEngine 的继承关系如下</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PhabricatorProjectSearchEngine-&gt; <span class=\"comment\">// 有 renderResultList 没有 executeQuery 和 renderResults</span></span><br><span class=\"line\">\textends PhabricatorApplicationSearchEngine <span class=\"comment\">// 有 executeQuery 和 renderResults , renderResultList 是 abstract 的,由子类实现</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li><p>其中 executeQuery 用于执行具体的查询,将项目数据从数据库加载到应用中</p>\n</li>\n<li><p>其中 renderResultList 具体如下,方法中的 PhabricatorProjectListView 负责将数据渲染为 HTML</p>\n</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">renderResultList</span><span class=\"params\">(</span><br><span class=\"line\">  array $projects,</span><br><span class=\"line\">  PhabricatorSavedQuery $query,</span><br><span class=\"line\">  array $handles)</span> </span>&#123;</span><br><span class=\"line\">  assert_instances_of($projects, <span class=\"string\">'PhabricatorProject'</span>);</span><br><span class=\"line\">  $viewer = <span class=\"keyword\">$this</span>-&gt;requireViewer();</span><br><span class=\"line\"></span><br><span class=\"line\">  $list = id(<span class=\"keyword\">new</span> PhabricatorProjectListView())</span><br><span class=\"line\">    -&gt;setUser($viewer)</span><br><span class=\"line\">    -&gt;setProjects($projects)</span><br><span class=\"line\">    -&gt;setShowWatching(<span class=\"keyword\">true</span>)</span><br><span class=\"line\">    -&gt;setShowMember(<span class=\"keyword\">true</span>)</span><br><span class=\"line\">    -&gt;renderList();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> id(<span class=\"keyword\">new</span> PhabricatorApplicationSearchResultView())</span><br><span class=\"line\">    -&gt;setObjectList($list)</span><br><span class=\"line\">    -&gt;setNoDataString(pht(<span class=\"string\">'No projects found.'</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"具体的修改\"><a href=\"#具体的修改\" class=\"headerlink\" title=\"具体的修改\"></a>具体的修改</h2><ul>\n<li><p>下面的这个方法根据项目的 phid 获取项目对应的 Edge 对象列表, 此时的 Edge 对象中的 src 字段表示 PhabricatorProject 对象中的 phid 字段, dst 字段表示 ManiphestTask 对象中的 phid 字段</p>\n</li>\n<li><p>具体位于 phabricator\\src\\infrastructure\\edges\\query\\PhabricatorEdgeQuery.php</p>\n</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span><br><span class=\"line\"> * 加载一组 Edge 数据</span><br><span class=\"line\"> * <span class=\"doctag\">@param</span> $src_phid</span><br><span class=\"line\"> * <span class=\"doctag\">@param</span> $edge_type</span><br><span class=\"line\"> * <span class=\"doctag\">@return</span> mixed</span><br><span class=\"line\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">loadEdgeDatas</span><span class=\"params\">($src_phid, $edge_type)</span> </span>&#123;</span><br><span class=\"line\">  $edges = id(<span class=\"keyword\">new</span> PhabricatorEdgeQuery())</span><br><span class=\"line\">      -&gt;withSourcePHIDs(<span class=\"keyword\">array</span>($src_phid))</span><br><span class=\"line\">      -&gt;withEdgeTypes(<span class=\"keyword\">array</span>($edge_type))</span><br><span class=\"line\">      -&gt;execute();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> $edges[$src_phid][$edge_type];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>PhabricatorProjectListView 对象中的 renderList 方法修改如下</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">renderList</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  $viewer = <span class=\"keyword\">$this</span>-&gt;getUser();</span><br><span class=\"line\">  $viewer_phid = $viewer-&gt;getPHID();</span><br><span class=\"line\">  $projects = <span class=\"keyword\">$this</span>-&gt;getProjects();</span><br><span class=\"line\"></span><br><span class=\"line\">  $handles = $viewer-&gt;loadHandles(mpull($projects, <span class=\"string\">'getPHID'</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">  $no_data = pht(<span class=\"string\">'No projects found.'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;noDataString) &#123;</span><br><span class=\"line\">    $no_data = <span class=\"keyword\">$this</span>-&gt;noDataString;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  $list = id(<span class=\"keyword\">new</span> PHUIObjectItemListView())</span><br><span class=\"line\">    -&gt;setUser($viewer)</span><br><span class=\"line\">    -&gt;setNoDataString($no_data);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">foreach</span> ($projects <span class=\"keyword\">as</span> $key =&gt; $project) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 加载一个maniphest对象</span></span><br><span class=\"line\">    $taskEdge = PhabricatorEdgeQuery::loadEdgeDatas(</span><br><span class=\"line\">          $project-&gt;getPHID(),</span><br><span class=\"line\">          <span class=\"string\">'42'</span>,</span><br><span class=\"line\">          <span class=\"string\">''</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    $task = <span class=\"keyword\">new</span> ManiphestTask();</span><br><span class=\"line\"></span><br><span class=\"line\">    $tasklink = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"keyword\">empty</span>($taskEdge)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">foreach</span> ($taskEdge <span class=\"keyword\">as</span> $key =&gt; $value) &#123;</span><br><span class=\"line\">        $taskPHID = $key;</span><br><span class=\"line\">        $task = id(<span class=\"keyword\">new</span> ManiphestTask())-&gt;loadOneWhere(<span class=\"string\">\"phid = '\"</span>.$key.<span class=\"string\">\"'\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ($task !== <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">          <span class=\"comment\">// 任务的链接</span></span><br><span class=\"line\">          $tasklink = phutil_tag(</span><br><span class=\"line\">           <span class=\"string\">'a'</span>,</span><br><span class=\"line\">           <span class=\"keyword\">array</span>(</span><br><span class=\"line\">            <span class=\"string\">'href'</span> =&gt; <span class=\"string\">\"/T\"</span>.$task-&gt;getID(),</span><br><span class=\"line\">            <span class=\"string\">'class'</span> =&gt; <span class=\"string\">'phui-oi-link'</span>,</span><br><span class=\"line\">            <span class=\"string\">'title'</span> =&gt; $task-&gt;getTitle(),</span><br><span class=\"line\">           ),</span><br><span class=\"line\">           $task-&gt;getTitle());</span><br><span class=\"line\">          <span class=\"comment\">// 这里只要最新的一个任务</span></span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $id = $project-&gt;getID();</span><br><span class=\"line\"></span><br><span class=\"line\">    $icon = $project-&gt;getDisplayIconIcon();</span><br><span class=\"line\">    $icon_icon = id(<span class=\"keyword\">new</span> PHUIIconView())</span><br><span class=\"line\">      -&gt;setIcon($icon);</span><br><span class=\"line\"></span><br><span class=\"line\">    $icon_name = $project-&gt;getDisplayIconName();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 这里加上任务数量和最新的任务链接</span></span><br><span class=\"line\">    $item = id(<span class=\"keyword\">new</span> PHUIObjectItemView())</span><br><span class=\"line\">      -&gt;setHeader($project-&gt;getName())</span><br><span class=\"line\">      -&gt;setHref(<span class=\"string\">\"/project/view/&#123;$id&#125;/\"</span>)</span><br><span class=\"line\">      -&gt;setImageURI($project-&gt;getProfileImageURI())</span><br><span class=\"line\">      -&gt;addAttribute(</span><br><span class=\"line\">        <span class=\"keyword\">array</span>(</span><br><span class=\"line\">          $icon_icon,</span><br><span class=\"line\">          <span class=\"string\">' '</span>,</span><br><span class=\"line\">          $icon_name,</span><br><span class=\"line\">          <span class=\"string\">' '</span>,</span><br><span class=\"line\">          count($taskEdge),</span><br><span class=\"line\">          <span class=\"string\">' '</span>,</span><br><span class=\"line\">          $tasklink,</span><br><span class=\"line\">        ));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ($project-&gt;getStatus() == PhabricatorProjectStatus::STATUS_ARCHIVED) &#123;</span><br><span class=\"line\">      $item-&gt;addIcon(<span class=\"string\">'fa-ban'</span>, pht(<span class=\"string\">'Archived'</span>));</span><br><span class=\"line\">      $item-&gt;setDisabled(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;showMember) &#123;</span><br><span class=\"line\">      $is_member = $project-&gt;isUserMember($viewer_phid);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> ($is_member) &#123;</span><br><span class=\"line\">        $item-&gt;addIcon(<span class=\"string\">'fa-user'</span>, pht(<span class=\"string\">'Member'</span>));</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;showWatching) &#123;</span><br><span class=\"line\">      $is_watcher = $project-&gt;isUserWatcher($viewer_phid);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> ($is_watcher) &#123;</span><br><span class=\"line\">        $item-&gt;addIcon(<span class=\"string\">'fa-eye'</span>, pht(<span class=\"string\">'Watching'</span>));</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $list-&gt;addItem($item);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> $list;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"最终的效果\"><a href=\"#最终的效果\" class=\"headerlink\" title=\"最终的效果\"></a>最终的效果</h2><p><img src=\"http://7xt8a6.com1.z0.glb.clouddn.com/project-1.PNG\" alt=\"project-maniphest\"></p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>通过做这个需求，了解了 Phabricator 如下的技术细节</p>\n<ul>\n<li>Controller 间的流转细节</li>\n<li>每个应用之间通过 Edge 进行关系连接，一对一，一对多的关系</li>\n<li>列表页面的渲染</li>\n</ul>\n","excerpt":"","more":"<h2 id=\"需求背景\"><a href=\"#需求背景\" class=\"headerlink\" title=\"需求背景\"></a>需求背景</h2><p>在 Phabricator 项目和任务之间的衔接并不连贯,根据反馈需要在项目列表中增加显示任务数和最新任务的链接.</p>\n<h2 id=\"Controller-间的跳转\"><a href=\"#Controller-间的跳转\" class=\"headerlink\" title=\"Controller 间的跳转\"></a>Controller 间的跳转</h2><p>根据 PhabricatorProjectApplication 中的路由配置,当访问默认的项目列表具体的 Controller 就是 PhabricatorProjectListController</p>\n<p>PhabricatorProjectListController 中 handleRequest 方法如下</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleRequest</span><span class=\"params\">(AphrontRequest $request)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> id(<span class=\"keyword\">new</span> PhabricatorProjectSearchEngine())</span><br><span class=\"line\">    -&gt;setController(<span class=\"keyword\">$this</span>)</span><br><span class=\"line\">    -&gt;buildResponse();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>找到对应 PhabricatorProjectSearchEngine 的 buildResponse 方法如下</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">buildResponse</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  $controller = <span class=\"keyword\">$this</span>-&gt;getController();</span><br><span class=\"line\">  $request = $controller-&gt;getRequest();</span><br><span class=\"line\"></span><br><span class=\"line\">  $search = id(<span class=\"keyword\">new</span> PhabricatorApplicationSearchController())</span><br><span class=\"line\">    -&gt;setQueryKey($request-&gt;getURIData(<span class=\"string\">'queryKey'</span>))</span><br><span class=\"line\">    -&gt;setSearchEngine(<span class=\"keyword\">$this</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> $controller-&gt;delegateToController($search);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>其中 delegateToController 方法是由 AphrontController 定义的,具体的继承关系如下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PhabricatorProjectListController</span><br><span class=\"line\">\textends PhabricatorProjectController</span><br><span class=\"line\">\t\textends PhabricatorController</span><br><span class=\"line\">\t\t\textends AphrontController</span><br></pre></td></tr></table></figure>\n<p>delegateToController 方法具体定义如下</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">delegateToController</span><span class=\"params\">(AphrontController $controller)</span> </span>&#123;</span><br><span class=\"line\">  $request = <span class=\"keyword\">$this</span>-&gt;getRequest();</span><br><span class=\"line\"></span><br><span class=\"line\">  $controller-&gt;setDelegatingController(<span class=\"keyword\">$this</span>);</span><br><span class=\"line\">  $controller-&gt;setRequest($request);</span><br><span class=\"line\"></span><br><span class=\"line\">  $application = <span class=\"keyword\">$this</span>-&gt;getCurrentApplication();</span><br><span class=\"line\">  <span class=\"keyword\">if</span> ($application) &#123;</span><br><span class=\"line\">    $controller-&gt;setCurrentApplication($application);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> $controller-&gt;handleRequest($request);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><p>其中传入的 $controller 对象是 PhabricatorApplicationSearchController, 由此我们可以知道 <code>$controller-&gt;handleRequest($request)</code> 是调用 PhabricatorApplicationSearchController 中的 handleRequest 方法,<br>但是 PhabricatorApplicationSearchController 中并没有 handleRequest 方法, 说明调用的是 AphrontController 定义的</p>\n</li>\n<li><p>其中的 handleRequest 方法具体定义如下</p>\n</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleRequest</span><span class=\"params\">(AphrontRequest $request)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (method_exists(<span class=\"keyword\">$this</span>, <span class=\"string\">'processRequest'</span>)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;processRequest();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> PhutilMethodNotImplementedException(</span><br><span class=\"line\">    pht(</span><br><span class=\"line\">      <span class=\"string\">'Controllers must implement either %s (recommended) '</span>.</span><br><span class=\"line\">      <span class=\"string\">'or %s (deprecated).'</span>,</span><br><span class=\"line\">      <span class=\"string\">'handleRequest()'</span>,</span><br><span class=\"line\">      <span class=\"string\">'processRequest()'</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>其中 method_exists 方法中第一个参数表示当前对象, 第二个参数表示对象里面的方法,如果当前对象中有该方法,返回true,随后执行 processRequest 方法</p>\n<p>从上面的 Controller 继承关系中我们来一一查找下</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PhabricatorProjectListController <span class=\"comment\">// 没有 processRequest 方法</span></span><br><span class=\"line\">\textends PhabricatorProjectController <span class=\"comment\">// 没有 processRequest 方法</span></span><br><span class=\"line\">\t\textends PhabricatorController <span class=\"comment\">// 没有 processRequest 方法</span></span><br><span class=\"line\">\t\t\textends AphrontController <span class=\"comment\">// 没有 processRequest 方法</span></span><br></pre></td></tr></table></figure>\n<p>发现都没有 processRequest 方法, 再来看看 PhabricatorApplicationSearchController 继承关系</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PhabricatorApplicationSearchController  <span class=\"comment\">//有 processRequest 方法</span></span><br><span class=\"line\">\textends PhabricatorSearchBaseController <span class=\"comment\">// 没有 processRequest 方法</span></span><br><span class=\"line\">\t\textends PhabricatorController <span class=\"comment\">// 没有 processRequest 方法</span></span><br><span class=\"line\">\t\t\textends AphrontController <span class=\"comment\">// 没有 processRequest 方法</span></span><br></pre></td></tr></table></figure>\n<p>从上面的分析中可以得出的结论是 PhabricatorProjectListController 得到请求后经过 AphrontController 的 delegateToController 和 handleRequest 方法处理后最终是由 PhabricatorApplicationSearchController 的 processRequest 方法完成最终数据处理的.</p>\n<h2 id=\"数据渲染过程\"><a href=\"#数据渲染过程\" class=\"headerlink\" title=\"数据渲染过程\"></a>数据渲染过程</h2><p>在 PhabricatorApplicationSearchController 中的 processSearchRequest 方法中有如下关键的几行代码</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$objects = $engine-&gt;executeQuery($query, $pager);</span><br><span class=\"line\">....</span><br><span class=\"line\">$list = $engine-&gt;renderResults($objects, $saved_query);</span><br><span class=\"line\">.....</span><br><span class=\"line\">if ($list-&gt;getTable()) &#123;</span><br><span class=\"line\">\t$box-&gt;setTable($list-&gt;getTable());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>其中 $engine 对象就是 PhabricatorProjectListController 中传入的 PhabricatorProjectSearchEngine, 这里调用了 renderResults 方法返回了一个列表数据,这些数据就是页面上展示的项目列表. PhabricatorProjectSearchEngine 的继承关系如下</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PhabricatorProjectSearchEngine-&gt; <span class=\"comment\">// 有 renderResultList 没有 executeQuery 和 renderResults</span></span><br><span class=\"line\">\textends PhabricatorApplicationSearchEngine <span class=\"comment\">// 有 executeQuery 和 renderResults , renderResultList 是 abstract 的,由子类实现</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li><p>其中 executeQuery 用于执行具体的查询,将项目数据从数据库加载到应用中</p>\n</li>\n<li><p>其中 renderResultList 具体如下,方法中的 PhabricatorProjectListView 负责将数据渲染为 HTML</p>\n</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">protected</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">renderResultList</span><span class=\"params\">(</span><br><span class=\"line\">  array $projects,</span><br><span class=\"line\">  PhabricatorSavedQuery $query,</span><br><span class=\"line\">  array $handles)</span> </span>&#123;</span><br><span class=\"line\">  assert_instances_of($projects, <span class=\"string\">'PhabricatorProject'</span>);</span><br><span class=\"line\">  $viewer = <span class=\"keyword\">$this</span>-&gt;requireViewer();</span><br><span class=\"line\"></span><br><span class=\"line\">  $list = id(<span class=\"keyword\">new</span> PhabricatorProjectListView())</span><br><span class=\"line\">    -&gt;setUser($viewer)</span><br><span class=\"line\">    -&gt;setProjects($projects)</span><br><span class=\"line\">    -&gt;setShowWatching(<span class=\"keyword\">true</span>)</span><br><span class=\"line\">    -&gt;setShowMember(<span class=\"keyword\">true</span>)</span><br><span class=\"line\">    -&gt;renderList();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> id(<span class=\"keyword\">new</span> PhabricatorApplicationSearchResultView())</span><br><span class=\"line\">    -&gt;setObjectList($list)</span><br><span class=\"line\">    -&gt;setNoDataString(pht(<span class=\"string\">'No projects found.'</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"具体的修改\"><a href=\"#具体的修改\" class=\"headerlink\" title=\"具体的修改\"></a>具体的修改</h2><ul>\n<li><p>下面的这个方法根据项目的 phid 获取项目对应的 Edge 对象列表, 此时的 Edge 对象中的 src 字段表示 PhabricatorProject 对象中的 phid 字段, dst 字段表示 ManiphestTask 对象中的 phid 字段</p>\n</li>\n<li><p>具体位于 phabricator\\src\\infrastructure\\edges\\query\\PhabricatorEdgeQuery.php</p>\n</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span><br><span class=\"line\"> * 加载一组 Edge 数据</span><br><span class=\"line\"> * <span class=\"doctag\">@param</span> $src_phid</span><br><span class=\"line\"> * <span class=\"doctag\">@param</span> $edge_type</span><br><span class=\"line\"> * <span class=\"doctag\">@return</span> mixed</span><br><span class=\"line\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">loadEdgeDatas</span><span class=\"params\">($src_phid, $edge_type)</span> </span>&#123;</span><br><span class=\"line\">  $edges = id(<span class=\"keyword\">new</span> PhabricatorEdgeQuery())</span><br><span class=\"line\">      -&gt;withSourcePHIDs(<span class=\"keyword\">array</span>($src_phid))</span><br><span class=\"line\">      -&gt;withEdgeTypes(<span class=\"keyword\">array</span>($edge_type))</span><br><span class=\"line\">      -&gt;execute();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> $edges[$src_phid][$edge_type];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>PhabricatorProjectListView 对象中的 renderList 方法修改如下</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">renderList</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  $viewer = <span class=\"keyword\">$this</span>-&gt;getUser();</span><br><span class=\"line\">  $viewer_phid = $viewer-&gt;getPHID();</span><br><span class=\"line\">  $projects = <span class=\"keyword\">$this</span>-&gt;getProjects();</span><br><span class=\"line\"></span><br><span class=\"line\">  $handles = $viewer-&gt;loadHandles(mpull($projects, <span class=\"string\">'getPHID'</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">  $no_data = pht(<span class=\"string\">'No projects found.'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;noDataString) &#123;</span><br><span class=\"line\">    $no_data = <span class=\"keyword\">$this</span>-&gt;noDataString;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  $list = id(<span class=\"keyword\">new</span> PHUIObjectItemListView())</span><br><span class=\"line\">    -&gt;setUser($viewer)</span><br><span class=\"line\">    -&gt;setNoDataString($no_data);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">foreach</span> ($projects <span class=\"keyword\">as</span> $key =&gt; $project) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 加载一个maniphest对象</span></span><br><span class=\"line\">    $taskEdge = PhabricatorEdgeQuery::loadEdgeDatas(</span><br><span class=\"line\">          $project-&gt;getPHID(),</span><br><span class=\"line\">          <span class=\"string\">'42'</span>,</span><br><span class=\"line\">          <span class=\"string\">''</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    $task = <span class=\"keyword\">new</span> ManiphestTask();</span><br><span class=\"line\"></span><br><span class=\"line\">    $tasklink = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"keyword\">empty</span>($taskEdge)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">foreach</span> ($taskEdge <span class=\"keyword\">as</span> $key =&gt; $value) &#123;</span><br><span class=\"line\">        $taskPHID = $key;</span><br><span class=\"line\">        $task = id(<span class=\"keyword\">new</span> ManiphestTask())-&gt;loadOneWhere(<span class=\"string\">\"phid = '\"</span>.$key.<span class=\"string\">\"'\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ($task !== <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">          <span class=\"comment\">// 任务的链接</span></span><br><span class=\"line\">          $tasklink = phutil_tag(</span><br><span class=\"line\">           <span class=\"string\">'a'</span>,</span><br><span class=\"line\">           <span class=\"keyword\">array</span>(</span><br><span class=\"line\">            <span class=\"string\">'href'</span> =&gt; <span class=\"string\">\"/T\"</span>.$task-&gt;getID(),</span><br><span class=\"line\">            <span class=\"string\">'class'</span> =&gt; <span class=\"string\">'phui-oi-link'</span>,</span><br><span class=\"line\">            <span class=\"string\">'title'</span> =&gt; $task-&gt;getTitle(),</span><br><span class=\"line\">           ),</span><br><span class=\"line\">           $task-&gt;getTitle());</span><br><span class=\"line\">          <span class=\"comment\">// 这里只要最新的一个任务</span></span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $id = $project-&gt;getID();</span><br><span class=\"line\"></span><br><span class=\"line\">    $icon = $project-&gt;getDisplayIconIcon();</span><br><span class=\"line\">    $icon_icon = id(<span class=\"keyword\">new</span> PHUIIconView())</span><br><span class=\"line\">      -&gt;setIcon($icon);</span><br><span class=\"line\"></span><br><span class=\"line\">    $icon_name = $project-&gt;getDisplayIconName();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 这里加上任务数量和最新的任务链接</span></span><br><span class=\"line\">    $item = id(<span class=\"keyword\">new</span> PHUIObjectItemView())</span><br><span class=\"line\">      -&gt;setHeader($project-&gt;getName())</span><br><span class=\"line\">      -&gt;setHref(<span class=\"string\">\"/project/view/&#123;$id&#125;/\"</span>)</span><br><span class=\"line\">      -&gt;setImageURI($project-&gt;getProfileImageURI())</span><br><span class=\"line\">      -&gt;addAttribute(</span><br><span class=\"line\">        <span class=\"keyword\">array</span>(</span><br><span class=\"line\">          $icon_icon,</span><br><span class=\"line\">          <span class=\"string\">' '</span>,</span><br><span class=\"line\">          $icon_name,</span><br><span class=\"line\">          <span class=\"string\">' '</span>,</span><br><span class=\"line\">          count($taskEdge),</span><br><span class=\"line\">          <span class=\"string\">' '</span>,</span><br><span class=\"line\">          $tasklink,</span><br><span class=\"line\">        ));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ($project-&gt;getStatus() == PhabricatorProjectStatus::STATUS_ARCHIVED) &#123;</span><br><span class=\"line\">      $item-&gt;addIcon(<span class=\"string\">'fa-ban'</span>, pht(<span class=\"string\">'Archived'</span>));</span><br><span class=\"line\">      $item-&gt;setDisabled(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;showMember) &#123;</span><br><span class=\"line\">      $is_member = $project-&gt;isUserMember($viewer_phid);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> ($is_member) &#123;</span><br><span class=\"line\">        $item-&gt;addIcon(<span class=\"string\">'fa-user'</span>, pht(<span class=\"string\">'Member'</span>));</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;showWatching) &#123;</span><br><span class=\"line\">      $is_watcher = $project-&gt;isUserWatcher($viewer_phid);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> ($is_watcher) &#123;</span><br><span class=\"line\">        $item-&gt;addIcon(<span class=\"string\">'fa-eye'</span>, pht(<span class=\"string\">'Watching'</span>));</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $list-&gt;addItem($item);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> $list;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"最终的效果\"><a href=\"#最终的效果\" class=\"headerlink\" title=\"最终的效果\"></a>最终的效果</h2><p><img src=\"http://7xt8a6.com1.z0.glb.clouddn.com/project-1.PNG\" alt=\"project-maniphest\"></p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>通过做这个需求，了解了 Phabricator 如下的技术细节</p>\n<ul>\n<li>Controller 间的流转细节</li>\n<li>每个应用之间通过 Edge 进行关系连接，一对一，一对多的关系</li>\n<li>列表页面的渲染</li>\n</ul>\n"},{"title":"在Junit单元测试中通过@PropertySource来获取Bean中的@Value属性值","title_url":"Spring-Junit-PropertySource-Value","date":"2016-09-29T16:00:00.000Z","description":"在Junit单元测试中通过@PropertySource来获取Bean中的@Value属性值","_content":"\n## 使用场景说明\n\n- 在平时开发的时候，为了测试Spring中的一个Bean，通常要通过`@ContextConfiguration`注解来加载一些XML配置，问题是XML配置越来越多，现在要减少甚至去除XML配置，从而简化开发\n\n- 古老的项目由于历史问题没有使用Junit来测试Bean导致现在切换过来复杂\n\n- 有时候只想在Junit中测试几个Bean\n\n- 避免加载XML配置，直接从properties文件中获取@Value属性值\n\n## 使用说明\n\n- 使用`@Configuration`注解将XML配置转换成在Bean中完成，`@PropertySource`注解用于指定properties文件\n```Java\n/**\n * 通过该类可以代替在xml中如下的配置\n * \n * \n *\t\n  \t  <bean class=\"org.springframework.context.support.PropertySourcesPlaceholderConfigurer\">\n        <property name=\"ignoreUnresolvablePlaceholders\" value=\"true\"/>\n        <property name=\"locations\">\n          <list>\n            <value>classpath:jdbc.properties</value>\n          </list>\n        </property>\n      </bean>\n * @author chen_k\n *\n */\n@Configuration\n@PropertySource(value = { \"classpath:jdbc.properties\" })\npublic class SpringPropertiesConfigure {\n\n\t@Bean\n    public static PropertySourcesPlaceholderConfigurer propertySourcesPlaceholderConfigurer() {\n        return new PropertySourcesPlaceholderConfigurer();\n    }\n}\n```\n\n- 使用`@ContextConfiguration`的`classes`属性来加载相关的几个Bean。DBService类中几个字段通过`@Value`从properties文件获取值\n```Java\n@ContextConfiguration(classes = {DBService.class, SpringPropertiesConfigure.class})\npublic class TestDBService extends BaseTest {\n\n\t@Autowired\n\tprivate DBService dBService;\n\t\n\t@Test\n\tpublic void testGetDBInfo() {\n\t\tString dbInfo = dBService.toString();\n\t\tAssert.assertNotNull(dbInfo);\n\t\tSystem.out.println(dbInfo);\n\t}\n}\n```\n\n## 完整的代码\n\n- 点击*[这里](https://github.com/toulezu/play/tree/master/SpringBoot/testSpringBoot)*\n\n## 参考\n\n- [Populating Spring @Value during Unit Test](http://stackoverflow.com/questions/17353327/populating-spring-value-during-unit-test?noredirect=1&lq=1)\n- [Spring @PropertySource & @Value annotations example](http://websystique.com/spring/spring-propertysource-value-annotations-example/)\n- [使用RunWith注解改变JUnit的默认执行类，并实现自已的Listener](http://blog.csdn.net/fenglibing/article/details/8584602)\n- [Spring基于注解TestContext 测试框架使用详解](http://blog.csdn.net/yaerfeng/article/details/25368447)\n\n","source":"_posts/在Junit单元测试中通过@PropertySource来获取Bean中的@Value属性值.md","raw":"---\ntitle: 在Junit单元测试中通过@PropertySource来获取Bean中的@Value属性值\ntitle_url: Spring-Junit-PropertySource-Value\ndate: 2016-09-30\ntags: [Spring,Junit]\ncategories: Spring\ndescription: 在Junit单元测试中通过@PropertySource来获取Bean中的@Value属性值\n---\n\n## 使用场景说明\n\n- 在平时开发的时候，为了测试Spring中的一个Bean，通常要通过`@ContextConfiguration`注解来加载一些XML配置，问题是XML配置越来越多，现在要减少甚至去除XML配置，从而简化开发\n\n- 古老的项目由于历史问题没有使用Junit来测试Bean导致现在切换过来复杂\n\n- 有时候只想在Junit中测试几个Bean\n\n- 避免加载XML配置，直接从properties文件中获取@Value属性值\n\n## 使用说明\n\n- 使用`@Configuration`注解将XML配置转换成在Bean中完成，`@PropertySource`注解用于指定properties文件\n```Java\n/**\n * 通过该类可以代替在xml中如下的配置\n * \n * \n *\t\n  \t  <bean class=\"org.springframework.context.support.PropertySourcesPlaceholderConfigurer\">\n        <property name=\"ignoreUnresolvablePlaceholders\" value=\"true\"/>\n        <property name=\"locations\">\n          <list>\n            <value>classpath:jdbc.properties</value>\n          </list>\n        </property>\n      </bean>\n * @author chen_k\n *\n */\n@Configuration\n@PropertySource(value = { \"classpath:jdbc.properties\" })\npublic class SpringPropertiesConfigure {\n\n\t@Bean\n    public static PropertySourcesPlaceholderConfigurer propertySourcesPlaceholderConfigurer() {\n        return new PropertySourcesPlaceholderConfigurer();\n    }\n}\n```\n\n- 使用`@ContextConfiguration`的`classes`属性来加载相关的几个Bean。DBService类中几个字段通过`@Value`从properties文件获取值\n```Java\n@ContextConfiguration(classes = {DBService.class, SpringPropertiesConfigure.class})\npublic class TestDBService extends BaseTest {\n\n\t@Autowired\n\tprivate DBService dBService;\n\t\n\t@Test\n\tpublic void testGetDBInfo() {\n\t\tString dbInfo = dBService.toString();\n\t\tAssert.assertNotNull(dbInfo);\n\t\tSystem.out.println(dbInfo);\n\t}\n}\n```\n\n## 完整的代码\n\n- 点击*[这里](https://github.com/toulezu/play/tree/master/SpringBoot/testSpringBoot)*\n\n## 参考\n\n- [Populating Spring @Value during Unit Test](http://stackoverflow.com/questions/17353327/populating-spring-value-during-unit-test?noredirect=1&lq=1)\n- [Spring @PropertySource & @Value annotations example](http://websystique.com/spring/spring-propertysource-value-annotations-example/)\n- [使用RunWith注解改变JUnit的默认执行类，并实现自已的Listener](http://blog.csdn.net/fenglibing/article/details/8584602)\n- [Spring基于注解TestContext 测试框架使用详解](http://blog.csdn.net/yaerfeng/article/details/25368447)\n\n","slug":"在Junit单元测试中通过@PropertySource来获取Bean中的@Value属性值","published":1,"updated":"2017-05-27T01:39:06.683Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj5jgsbev001a2cezpp59m47o","content":"<h2 id=\"使用场景说明\"><a href=\"#使用场景说明\" class=\"headerlink\" title=\"使用场景说明\"></a>使用场景说明</h2><ul>\n<li><p>在平时开发的时候，为了测试Spring中的一个Bean，通常要通过<code>@ContextConfiguration</code>注解来加载一些XML配置，问题是XML配置越来越多，现在要减少甚至去除XML配置，从而简化开发</p>\n</li>\n<li><p>古老的项目由于历史问题没有使用Junit来测试Bean导致现在切换过来复杂</p>\n</li>\n<li><p>有时候只想在Junit中测试几个Bean</p>\n</li>\n<li><p>避免加载XML配置，直接从properties文件中获取@Value属性值</p>\n</li>\n</ul>\n<h2 id=\"使用说明\"><a href=\"#使用说明\" class=\"headerlink\" title=\"使用说明\"></a>使用说明</h2><ul>\n<li><p>使用<code>@Configuration</code>注解将XML配置转换成在Bean中完成，<code>@PropertySource</code>注解用于指定properties文件</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span><br><span class=\"line\"> * 通过该类可以代替在xml中如下的配置</span><br><span class=\"line\"> * </span><br><span class=\"line\"> * </span><br><span class=\"line\"> *\t</span><br><span class=\"line\">  \t  &lt;bean class=\"org.springframework.context.support.PropertySourcesPlaceholderConfigurer\"&gt;</span><br><span class=\"line\">        &lt;property name=\"ignoreUnresolvablePlaceholders\" value=\"true\"/&gt;</span><br><span class=\"line\">        &lt;property name=\"locations\"&gt;</span><br><span class=\"line\">          &lt;list&gt;</span><br><span class=\"line\">            &lt;value&gt;classpath:jdbc.properties&lt;/value&gt;</span><br><span class=\"line\">          &lt;/list&gt;</span><br><span class=\"line\">        &lt;/property&gt;</span><br><span class=\"line\">      &lt;/bean&gt;</span><br><span class=\"line\"> * <span class=\"doctag\">@author</span> chen_k</span><br><span class=\"line\"> *</span><br><span class=\"line\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@PropertySource</span>(value = &#123; <span class=\"string\">\"classpath:jdbc.properties\"</span> &#125;)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SpringPropertiesConfigure</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> PropertySourcesPlaceholderConfigurer <span class=\"title\">propertySourcesPlaceholderConfigurer</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> PropertySourcesPlaceholderConfigurer();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>使用<code>@ContextConfiguration</code>的<code>classes</code>属性来加载相关的几个Bean。DBService类中几个字段通过<code>@Value</code>从properties文件获取值</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@ContextConfiguration</span>(classes = &#123;DBService.class, SpringPropertiesConfigure.class&#125;)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestDBService</span> <span class=\"keyword\">extends</span> <span class=\"title\">BaseTest</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Autowired</span></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> DBService dBService;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@Test</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testGetDBInfo</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tString dbInfo = dBService.toString();</span><br><span class=\"line\">\t\tAssert.assertNotNull(dbInfo);</span><br><span class=\"line\">\t\tSystem.out.println(dbInfo);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"完整的代码\"><a href=\"#完整的代码\" class=\"headerlink\" title=\"完整的代码\"></a>完整的代码</h2><ul>\n<li>点击<em><a href=\"https://github.com/toulezu/play/tree/master/SpringBoot/testSpringBoot\" target=\"_blank\" rel=\"external\">这里</a></em></li>\n</ul>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ul>\n<li><a href=\"http://stackoverflow.com/questions/17353327/populating-spring-value-during-unit-test?noredirect=1&amp;lq=1\" target=\"_blank\" rel=\"external\">Populating Spring @Value during Unit Test</a></li>\n<li><a href=\"http://websystique.com/spring/spring-propertysource-value-annotations-example/\" target=\"_blank\" rel=\"external\">Spring @PropertySource &amp; @Value annotations example</a></li>\n<li><a href=\"http://blog.csdn.net/fenglibing/article/details/8584602\" target=\"_blank\" rel=\"external\">使用RunWith注解改变JUnit的默认执行类，并实现自已的Listener</a></li>\n<li><a href=\"http://blog.csdn.net/yaerfeng/article/details/25368447\" target=\"_blank\" rel=\"external\">Spring基于注解TestContext 测试框架使用详解</a></li>\n</ul>\n","excerpt":"","more":"<h2 id=\"使用场景说明\"><a href=\"#使用场景说明\" class=\"headerlink\" title=\"使用场景说明\"></a>使用场景说明</h2><ul>\n<li><p>在平时开发的时候，为了测试Spring中的一个Bean，通常要通过<code>@ContextConfiguration</code>注解来加载一些XML配置，问题是XML配置越来越多，现在要减少甚至去除XML配置，从而简化开发</p>\n</li>\n<li><p>古老的项目由于历史问题没有使用Junit来测试Bean导致现在切换过来复杂</p>\n</li>\n<li><p>有时候只想在Junit中测试几个Bean</p>\n</li>\n<li><p>避免加载XML配置，直接从properties文件中获取@Value属性值</p>\n</li>\n</ul>\n<h2 id=\"使用说明\"><a href=\"#使用说明\" class=\"headerlink\" title=\"使用说明\"></a>使用说明</h2><ul>\n<li><p>使用<code>@Configuration</code>注解将XML配置转换成在Bean中完成，<code>@PropertySource</code>注解用于指定properties文件</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span><br><span class=\"line\"> * 通过该类可以代替在xml中如下的配置</span><br><span class=\"line\"> * </span><br><span class=\"line\"> * </span><br><span class=\"line\"> *\t</span><br><span class=\"line\">  \t  &lt;bean class=\"org.springframework.context.support.PropertySourcesPlaceholderConfigurer\"&gt;</span><br><span class=\"line\">        &lt;property name=\"ignoreUnresolvablePlaceholders\" value=\"true\"/&gt;</span><br><span class=\"line\">        &lt;property name=\"locations\"&gt;</span><br><span class=\"line\">          &lt;list&gt;</span><br><span class=\"line\">            &lt;value&gt;classpath:jdbc.properties&lt;/value&gt;</span><br><span class=\"line\">          &lt;/list&gt;</span><br><span class=\"line\">        &lt;/property&gt;</span><br><span class=\"line\">      &lt;/bean&gt;</span><br><span class=\"line\"> * <span class=\"doctag\">@author</span> chen_k</span><br><span class=\"line\"> *</span><br><span class=\"line\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@PropertySource</span>(value = &#123; <span class=\"string\">\"classpath:jdbc.properties\"</span> &#125;)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SpringPropertiesConfigure</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> PropertySourcesPlaceholderConfigurer <span class=\"title\">propertySourcesPlaceholderConfigurer</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> PropertySourcesPlaceholderConfigurer();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>使用<code>@ContextConfiguration</code>的<code>classes</code>属性来加载相关的几个Bean。DBService类中几个字段通过<code>@Value</code>从properties文件获取值</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@ContextConfiguration</span>(classes = &#123;DBService.class, SpringPropertiesConfigure.class&#125;)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestDBService</span> <span class=\"keyword\">extends</span> <span class=\"title\">BaseTest</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Autowired</span></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> DBService dBService;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@Test</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testGetDBInfo</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tString dbInfo = dBService.toString();</span><br><span class=\"line\">\t\tAssert.assertNotNull(dbInfo);</span><br><span class=\"line\">\t\tSystem.out.println(dbInfo);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"完整的代码\"><a href=\"#完整的代码\" class=\"headerlink\" title=\"完整的代码\"></a>完整的代码</h2><ul>\n<li>点击<em><a href=\"https://github.com/toulezu/play/tree/master/SpringBoot/testSpringBoot\">这里</a></em></li>\n</ul>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ul>\n<li><a href=\"http://stackoverflow.com/questions/17353327/populating-spring-value-during-unit-test?noredirect=1&amp;lq=1\">Populating Spring @Value during Unit Test</a></li>\n<li><a href=\"http://websystique.com/spring/spring-propertysource-value-annotations-example/\">Spring @PropertySource &amp; @Value annotations example</a></li>\n<li><a href=\"http://blog.csdn.net/fenglibing/article/details/8584602\">使用RunWith注解改变JUnit的默认执行类，并实现自已的Listener</a></li>\n<li><a href=\"http://blog.csdn.net/yaerfeng/article/details/25368447\">Spring基于注解TestContext 测试框架使用详解</a></li>\n</ul>\n"},{"title":"对 Spring 中一些常见的 Annotation 的理解","title_url":"Spring-Annotation","date":"2017-05-22T16:00:00.000Z","description":"对 Spring 中一些常见的 Annotation 的理解","_content":"\n## `@Service`\n\n作用于类上,自动根据bean的类名实例化一个首写字母为小写的bean，如果需要自己改名字则:`@Service(\"你自己改的bean名\")`, 默认是单例模式(singleton),用于业务层.\n\n## `@Component`\n\n功能和 `@Service` 类似,用于一些功能组件,或者帮助类.\n\n## `@Repository`\n\n功能和 `@Service` 类似,用于持久层(Dao)\n\n## `@Controller`\n\n功能和 `@Service` 类似,用于控制层(Controller),或者Web层\n\n## `@Autowired` 和 `@Resource`\n\n- 都作用于类成员变量、方法及构造函数上,用于成员变量自动注入\n- 只不过 `@Resource` 默认按 byName 自动注入,而 `@Autowired` 默认安装 byType 而已.\n- `@Resource` 可以带上 `@Resource(name=\"myCar\")` 或者 `@Resource(type=Car.class)` 来区分是通过 byName 还是 byType 自动注入.\n\n## `@Qualifier`\n- 对于 `@Autowired` 如果容器中有多个类型相同而名称不同的类型需要自动注入,需要多加一个 `@Qualifier(\"office\")` 来区分不同的类型\n```\npublic class Boss {  \n\n    @Autowired  \n    @Qualifier(\"office\")  \n    private Office office;  \n    …  \n} \n```\n这种情况如果都通过注解来定义Bean是不会存在的.\n\n## `@PostConstruct` 和 `@PreDestroy`\n这两个注释只能应用于方法上。标注了 `@PostConstruct` 注释的方法将在类实例化后调用，而标注了 `@PreDestroy` 的方法将在类销毁之前调用。  \n\n## 关于 context:annotation-config\n\n使用以上注解都必须在 Spring 的核心配置文件中加入如下配置\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>  \n<beans xmlns=\"http://www.springframework.org/schema/beans\"  \n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"  \n     xmlns:context=\"http://www.springframework.org/schema/context\"  \n     xsi:schemaLocation=\"http://www.springframework.org/schema/beans   \n http://www.springframework.org/schema/beans/spring-beans-2.5.xsd  \n http://www.springframework.org/schema/context   \n http://www.springframework.org/schema/context/spring-context-2.5.xsd\">  \n   \n    <context:annotation-config/>\n    \n    <bean id=\"boss\" class=\"com.test.Boss\"/>  \n    <bean id=\"office\" class=\"com.test.Office\">  \n        <property name=\"officeNo\" value=\"001\"/>  \n    </bean>  \n    <bean id=\"car\" class=\"com.test.Car\" scope=\"singleton\">  \n        <property name=\"brand\" value=\" 红旗 CA72\"/>  \n        <property name=\"price\" value=\"2000\"/>\n    </bean>  \n</beans>  \n```\n\n`<context:annotation-config/>` 将隐式地向 Spring 容器注册 AutowiredAnnotationBeanPostProcessor、CommonAnnotationBeanPostProcessor、PersistenceAnnotationBeanPostProcessor 以及 equiredAnnotationBeanPostProcessor 这 4 个 BeanPostProcessor。  \n该配置将处理容器中已有的Bean的依赖注入问题,在容器初始化的时候将容器中的实体中含有 `@Autowired` 或者 `@Resource` 的Bean自动注入相应的依赖Bean\n\n## 关于 context:component-scan\n\n这个配置更强大,不但启用了对类包进行扫描以实现注解驱动的**Bean定义**的功能，同时还启用了注解驱动的**依赖注入**的功能（即还隐式地在内部注册了 AutowiredAnnotationBeanPostProcessor 和 CommonAnnotationBeanPostProcessor），因此当使用 `<context:component-scan/>` 后，就可以将 `<context:annotation-config/>` 移除了。 \n最终的配置可以简化成如下的样子\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>  \n<beans xmlns=\"http://www.springframework.org/schema/beans\"  \n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"  \n     xmlns:context=\"http://www.springframework.org/schema/context\"  \n     xsi:schemaLocation=\"http://www.springframework.org/schema/beans   \n http://www.springframework.org/schema/beans/spring-beans-2.5.xsd  \n http://www.springframework.org/schema/context   \n http://www.springframework.org/schema/context/spring-context-2.5.xsd\">  \n   \n    <context:component-scan base-package=\"com.test\"/>\n    \n</beans>\n```\n\n## 参考\n\n- [使用Spring2.5的Autowired实现注释型的IOC](http://crabboy.iteye.com/blog/339840)\n- [Spring @Qualifier 注释](http://wiki.jikexueyuan.com/project/spring/annotation-based-configuration/spring-qualifier-annotation.html)","source":"_posts/对 Spring 中一些常见的 Annotation 的理解.md","raw":"---\ntitle: 对 Spring 中一些常见的 Annotation 的理解\ntitle_url: Spring-Annotation\ndate: 2017-05-23\ntags: [Spring,Annotation]\ncategories: 技术\ndescription: 对 Spring 中一些常见的 Annotation 的理解\n---\n\n## `@Service`\n\n作用于类上,自动根据bean的类名实例化一个首写字母为小写的bean，如果需要自己改名字则:`@Service(\"你自己改的bean名\")`, 默认是单例模式(singleton),用于业务层.\n\n## `@Component`\n\n功能和 `@Service` 类似,用于一些功能组件,或者帮助类.\n\n## `@Repository`\n\n功能和 `@Service` 类似,用于持久层(Dao)\n\n## `@Controller`\n\n功能和 `@Service` 类似,用于控制层(Controller),或者Web层\n\n## `@Autowired` 和 `@Resource`\n\n- 都作用于类成员变量、方法及构造函数上,用于成员变量自动注入\n- 只不过 `@Resource` 默认按 byName 自动注入,而 `@Autowired` 默认安装 byType 而已.\n- `@Resource` 可以带上 `@Resource(name=\"myCar\")` 或者 `@Resource(type=Car.class)` 来区分是通过 byName 还是 byType 自动注入.\n\n## `@Qualifier`\n- 对于 `@Autowired` 如果容器中有多个类型相同而名称不同的类型需要自动注入,需要多加一个 `@Qualifier(\"office\")` 来区分不同的类型\n```\npublic class Boss {  \n\n    @Autowired  \n    @Qualifier(\"office\")  \n    private Office office;  \n    …  \n} \n```\n这种情况如果都通过注解来定义Bean是不会存在的.\n\n## `@PostConstruct` 和 `@PreDestroy`\n这两个注释只能应用于方法上。标注了 `@PostConstruct` 注释的方法将在类实例化后调用，而标注了 `@PreDestroy` 的方法将在类销毁之前调用。  \n\n## 关于 context:annotation-config\n\n使用以上注解都必须在 Spring 的核心配置文件中加入如下配置\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>  \n<beans xmlns=\"http://www.springframework.org/schema/beans\"  \n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"  \n     xmlns:context=\"http://www.springframework.org/schema/context\"  \n     xsi:schemaLocation=\"http://www.springframework.org/schema/beans   \n http://www.springframework.org/schema/beans/spring-beans-2.5.xsd  \n http://www.springframework.org/schema/context   \n http://www.springframework.org/schema/context/spring-context-2.5.xsd\">  \n   \n    <context:annotation-config/>\n    \n    <bean id=\"boss\" class=\"com.test.Boss\"/>  \n    <bean id=\"office\" class=\"com.test.Office\">  \n        <property name=\"officeNo\" value=\"001\"/>  \n    </bean>  \n    <bean id=\"car\" class=\"com.test.Car\" scope=\"singleton\">  \n        <property name=\"brand\" value=\" 红旗 CA72\"/>  \n        <property name=\"price\" value=\"2000\"/>\n    </bean>  \n</beans>  \n```\n\n`<context:annotation-config/>` 将隐式地向 Spring 容器注册 AutowiredAnnotationBeanPostProcessor、CommonAnnotationBeanPostProcessor、PersistenceAnnotationBeanPostProcessor 以及 equiredAnnotationBeanPostProcessor 这 4 个 BeanPostProcessor。  \n该配置将处理容器中已有的Bean的依赖注入问题,在容器初始化的时候将容器中的实体中含有 `@Autowired` 或者 `@Resource` 的Bean自动注入相应的依赖Bean\n\n## 关于 context:component-scan\n\n这个配置更强大,不但启用了对类包进行扫描以实现注解驱动的**Bean定义**的功能，同时还启用了注解驱动的**依赖注入**的功能（即还隐式地在内部注册了 AutowiredAnnotationBeanPostProcessor 和 CommonAnnotationBeanPostProcessor），因此当使用 `<context:component-scan/>` 后，就可以将 `<context:annotation-config/>` 移除了。 \n最终的配置可以简化成如下的样子\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>  \n<beans xmlns=\"http://www.springframework.org/schema/beans\"  \n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"  \n     xmlns:context=\"http://www.springframework.org/schema/context\"  \n     xsi:schemaLocation=\"http://www.springframework.org/schema/beans   \n http://www.springframework.org/schema/beans/spring-beans-2.5.xsd  \n http://www.springframework.org/schema/context   \n http://www.springframework.org/schema/context/spring-context-2.5.xsd\">  \n   \n    <context:component-scan base-package=\"com.test\"/>\n    \n</beans>\n```\n\n## 参考\n\n- [使用Spring2.5的Autowired实现注释型的IOC](http://crabboy.iteye.com/blog/339840)\n- [Spring @Qualifier 注释](http://wiki.jikexueyuan.com/project/spring/annotation-based-configuration/spring-qualifier-annotation.html)","slug":"对 Spring 中一些常见的 Annotation 的理解","published":1,"updated":"2017-06-14T03:12:20.727Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj5jgsbey001f2cez39pgr2a8","content":"<h2 id=\"Service\"><a href=\"#Service\" class=\"headerlink\" title=\"@Service\"></a><code>@Service</code></h2><p>作用于类上,自动根据bean的类名实例化一个首写字母为小写的bean，如果需要自己改名字则:<code>@Service(&quot;你自己改的bean名&quot;)</code>, 默认是单例模式(singleton),用于业务层.</p>\n<h2 id=\"Component\"><a href=\"#Component\" class=\"headerlink\" title=\"@Component\"></a><code>@Component</code></h2><p>功能和 <code>@Service</code> 类似,用于一些功能组件,或者帮助类.</p>\n<h2 id=\"Repository\"><a href=\"#Repository\" class=\"headerlink\" title=\"@Repository\"></a><code>@Repository</code></h2><p>功能和 <code>@Service</code> 类似,用于持久层(Dao)</p>\n<h2 id=\"Controller\"><a href=\"#Controller\" class=\"headerlink\" title=\"@Controller\"></a><code>@Controller</code></h2><p>功能和 <code>@Service</code> 类似,用于控制层(Controller),或者Web层</p>\n<h2 id=\"Autowired-和-Resource\"><a href=\"#Autowired-和-Resource\" class=\"headerlink\" title=\"@Autowired 和 @Resource\"></a><code>@Autowired</code> 和 <code>@Resource</code></h2><ul>\n<li>都作用于类成员变量、方法及构造函数上,用于成员变量自动注入</li>\n<li>只不过 <code>@Resource</code> 默认按 byName 自动注入,而 <code>@Autowired</code> 默认安装 byType 而已.</li>\n<li><code>@Resource</code> 可以带上 <code>@Resource(name=&quot;myCar&quot;)</code> 或者 <code>@Resource(type=Car.class)</code> 来区分是通过 byName 还是 byType 自动注入.</li>\n</ul>\n<h2 id=\"Qualifier\"><a href=\"#Qualifier\" class=\"headerlink\" title=\"@Qualifier\"></a><code>@Qualifier</code></h2><ul>\n<li>对于 <code>@Autowired</code> 如果容器中有多个类型相同而名称不同的类型需要自动注入,需要多加一个 <code>@Qualifier(&quot;office&quot;)</code> 来区分不同的类型<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Boss &#123;  </span><br><span class=\"line\"></span><br><span class=\"line\">    @Autowired  </span><br><span class=\"line\">    @Qualifier(&quot;office&quot;)  </span><br><span class=\"line\">    private Office office;  </span><br><span class=\"line\">    …  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>这种情况如果都通过注解来定义Bean是不会存在的.</p>\n<h2 id=\"PostConstruct-和-PreDestroy\"><a href=\"#PostConstruct-和-PreDestroy\" class=\"headerlink\" title=\"@PostConstruct 和 @PreDestroy\"></a><code>@PostConstruct</code> 和 <code>@PreDestroy</code></h2><p>这两个注释只能应用于方法上。标注了 <code>@PostConstruct</code> 注释的方法将在类实例化后调用，而标注了 <code>@PreDestroy</code> 的方法将在类销毁之前调用。  </p>\n<h2 id=\"关于-context-annotation-config\"><a href=\"#关于-context-annotation-config\" class=\"headerlink\" title=\"关于 context:annotation-config\"></a>关于 context:annotation-config</h2><p>使用以上注解都必须在 Spring 的核心配置文件中加入如下配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?</span>xml version=<span class=\"string\">\"1.0\"</span> encoding=<span class=\"string\">\"UTF-8\"</span> <span class=\"meta\">?&gt;</span></span>  </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span>  </span><br><span class=\"line\">    <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span>  </span><br><span class=\"line\">     <span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span>  </span><br><span class=\"line\">     <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans   </span><br><span class=\"line\"> http://www.springframework.org/schema/beans/spring-beans-2.5.xsd  </span><br><span class=\"line\"> http://www.springframework.org/schema/context   </span><br><span class=\"line\"> http://www.springframework.org/schema/context/spring-context-2.5.xsd\"</span>&gt;</span>  </span><br><span class=\"line\">   </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">context:annotation-config</span>/&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"boss\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.test.Boss\"</span>/&gt;</span>  </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"office\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.test.Office\"</span>&gt;</span>  </span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"officeNo\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"001\"</span>/&gt;</span>  </span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span>  </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"car\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.test.Car\"</span> <span class=\"attr\">scope</span>=<span class=\"string\">\"singleton\"</span>&gt;</span>  </span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"brand\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\" 红旗 CA72\"</span>/&gt;</span>  </span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"price\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"2000\"</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span>  </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p><code>&lt;context:annotation-config/&gt;</code> 将隐式地向 Spring 容器注册 AutowiredAnnotationBeanPostProcessor、CommonAnnotationBeanPostProcessor、PersistenceAnnotationBeanPostProcessor 以及 equiredAnnotationBeanPostProcessor 这 4 个 BeanPostProcessor。<br>该配置将处理容器中已有的Bean的依赖注入问题,在容器初始化的时候将容器中的实体中含有 <code>@Autowired</code> 或者 <code>@Resource</code> 的Bean自动注入相应的依赖Bean</p>\n<h2 id=\"关于-context-component-scan\"><a href=\"#关于-context-component-scan\" class=\"headerlink\" title=\"关于 context:component-scan\"></a>关于 context:component-scan</h2><p>这个配置更强大,不但启用了对类包进行扫描以实现注解驱动的<strong>Bean定义</strong>的功能，同时还启用了注解驱动的<strong>依赖注入</strong>的功能（即还隐式地在内部注册了 AutowiredAnnotationBeanPostProcessor 和 CommonAnnotationBeanPostProcessor），因此当使用 <code>&lt;context:component-scan/&gt;</code> 后，就可以将 <code>&lt;context:annotation-config/&gt;</code> 移除了。<br>最终的配置可以简化成如下的样子</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?</span>xml version=<span class=\"string\">\"1.0\"</span> encoding=<span class=\"string\">\"UTF-8\"</span> <span class=\"meta\">?&gt;</span></span>  </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span>  </span><br><span class=\"line\">    <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span>  </span><br><span class=\"line\">     <span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span>  </span><br><span class=\"line\">     <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans   </span><br><span class=\"line\"> http://www.springframework.org/schema/beans/spring-beans-2.5.xsd  </span><br><span class=\"line\"> http://www.springframework.org/schema/context   </span><br><span class=\"line\"> http://www.springframework.org/schema/context/spring-context-2.5.xsd\"</span>&gt;</span>  </span><br><span class=\"line\">   </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.test\"</span>/&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ul>\n<li><a href=\"http://crabboy.iteye.com/blog/339840\" target=\"_blank\" rel=\"external\">使用Spring2.5的Autowired实现注释型的IOC</a></li>\n<li><a href=\"http://wiki.jikexueyuan.com/project/spring/annotation-based-configuration/spring-qualifier-annotation.html\" target=\"_blank\" rel=\"external\">Spring @Qualifier 注释</a></li>\n</ul>\n","excerpt":"","more":"<h2 id=\"Service\"><a href=\"#Service\" class=\"headerlink\" title=\"@Service\"></a><code>@Service</code></h2><p>作用于类上,自动根据bean的类名实例化一个首写字母为小写的bean，如果需要自己改名字则:<code>@Service(&quot;你自己改的bean名&quot;)</code>, 默认是单例模式(singleton),用于业务层.</p>\n<h2 id=\"Component\"><a href=\"#Component\" class=\"headerlink\" title=\"@Component\"></a><code>@Component</code></h2><p>功能和 <code>@Service</code> 类似,用于一些功能组件,或者帮助类.</p>\n<h2 id=\"Repository\"><a href=\"#Repository\" class=\"headerlink\" title=\"@Repository\"></a><code>@Repository</code></h2><p>功能和 <code>@Service</code> 类似,用于持久层(Dao)</p>\n<h2 id=\"Controller\"><a href=\"#Controller\" class=\"headerlink\" title=\"@Controller\"></a><code>@Controller</code></h2><p>功能和 <code>@Service</code> 类似,用于控制层(Controller),或者Web层</p>\n<h2 id=\"Autowired-和-Resource\"><a href=\"#Autowired-和-Resource\" class=\"headerlink\" title=\"@Autowired 和 @Resource\"></a><code>@Autowired</code> 和 <code>@Resource</code></h2><ul>\n<li>都作用于类成员变量、方法及构造函数上,用于成员变量自动注入</li>\n<li>只不过 <code>@Resource</code> 默认按 byName 自动注入,而 <code>@Autowired</code> 默认安装 byType 而已.</li>\n<li><code>@Resource</code> 可以带上 <code>@Resource(name=&quot;myCar&quot;)</code> 或者 <code>@Resource(type=Car.class)</code> 来区分是通过 byName 还是 byType 自动注入.</li>\n</ul>\n<h2 id=\"Qualifier\"><a href=\"#Qualifier\" class=\"headerlink\" title=\"@Qualifier\"></a><code>@Qualifier</code></h2><ul>\n<li>对于 <code>@Autowired</code> 如果容器中有多个类型相同而名称不同的类型需要自动注入,需要多加一个 <code>@Qualifier(&quot;office&quot;)</code> 来区分不同的类型<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Boss &#123;  </span><br><span class=\"line\"></span><br><span class=\"line\">    @Autowired  </span><br><span class=\"line\">    @Qualifier(&quot;office&quot;)  </span><br><span class=\"line\">    private Office office;  </span><br><span class=\"line\">    …  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>这种情况如果都通过注解来定义Bean是不会存在的.</p>\n<h2 id=\"PostConstruct-和-PreDestroy\"><a href=\"#PostConstruct-和-PreDestroy\" class=\"headerlink\" title=\"@PostConstruct 和 @PreDestroy\"></a><code>@PostConstruct</code> 和 <code>@PreDestroy</code></h2><p>这两个注释只能应用于方法上。标注了 <code>@PostConstruct</code> 注释的方法将在类实例化后调用，而标注了 <code>@PreDestroy</code> 的方法将在类销毁之前调用。  </p>\n<h2 id=\"关于-context-annotation-config\"><a href=\"#关于-context-annotation-config\" class=\"headerlink\" title=\"关于 context:annotation-config\"></a>关于 context:annotation-config</h2><p>使用以上注解都必须在 Spring 的核心配置文件中加入如下配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?</span>xml version=<span class=\"string\">\"1.0\"</span> encoding=<span class=\"string\">\"UTF-8\"</span> <span class=\"meta\">?&gt;</span></span>  </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span>  </span><br><span class=\"line\">    <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span>  </span><br><span class=\"line\">     <span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span>  </span><br><span class=\"line\">     <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans   </span><br><span class=\"line\"> http://www.springframework.org/schema/beans/spring-beans-2.5.xsd  </span><br><span class=\"line\"> http://www.springframework.org/schema/context   </span><br><span class=\"line\"> http://www.springframework.org/schema/context/spring-context-2.5.xsd\"</span>&gt;</span>  </span><br><span class=\"line\">   </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">context:annotation-config</span>/&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"boss\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.test.Boss\"</span>/&gt;</span>  </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"office\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.test.Office\"</span>&gt;</span>  </span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"officeNo\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"001\"</span>/&gt;</span>  </span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span>  </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"car\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.test.Car\"</span> <span class=\"attr\">scope</span>=<span class=\"string\">\"singleton\"</span>&gt;</span>  </span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"brand\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\" 红旗 CA72\"</span>/&gt;</span>  </span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"price\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"2000\"</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span>  </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p><code>&lt;context:annotation-config/&gt;</code> 将隐式地向 Spring 容器注册 AutowiredAnnotationBeanPostProcessor、CommonAnnotationBeanPostProcessor、PersistenceAnnotationBeanPostProcessor 以及 equiredAnnotationBeanPostProcessor 这 4 个 BeanPostProcessor。<br>该配置将处理容器中已有的Bean的依赖注入问题,在容器初始化的时候将容器中的实体中含有 <code>@Autowired</code> 或者 <code>@Resource</code> 的Bean自动注入相应的依赖Bean</p>\n<h2 id=\"关于-context-component-scan\"><a href=\"#关于-context-component-scan\" class=\"headerlink\" title=\"关于 context:component-scan\"></a>关于 context:component-scan</h2><p>这个配置更强大,不但启用了对类包进行扫描以实现注解驱动的<strong>Bean定义</strong>的功能，同时还启用了注解驱动的<strong>依赖注入</strong>的功能（即还隐式地在内部注册了 AutowiredAnnotationBeanPostProcessor 和 CommonAnnotationBeanPostProcessor），因此当使用 <code>&lt;context:component-scan/&gt;</code> 后，就可以将 <code>&lt;context:annotation-config/&gt;</code> 移除了。<br>最终的配置可以简化成如下的样子</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"meta\">&lt;?</span>xml version=<span class=\"string\">\"1.0\"</span> encoding=<span class=\"string\">\"UTF-8\"</span> <span class=\"meta\">?&gt;</span></span>  </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span>  </span><br><span class=\"line\">    <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span>  </span><br><span class=\"line\">     <span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span>  </span><br><span class=\"line\">     <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans   </span><br><span class=\"line\"> http://www.springframework.org/schema/beans/spring-beans-2.5.xsd  </span><br><span class=\"line\"> http://www.springframework.org/schema/context   </span><br><span class=\"line\"> http://www.springframework.org/schema/context/spring-context-2.5.xsd\"</span>&gt;</span>  </span><br><span class=\"line\">   </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.test\"</span>/&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ul>\n<li><a href=\"http://crabboy.iteye.com/blog/339840\">使用Spring2.5的Autowired实现注释型的IOC</a></li>\n<li><a href=\"http://wiki.jikexueyuan.com/project/spring/annotation-based-configuration/spring-qualifier-annotation.html\">Spring @Qualifier 注释</a></li>\n</ul>\n"},{"title":"对锁的理解","title_url":"lock-synchronized-volatile","date":"2017-06-08T16:00:00.000Z","description":"对锁的理解","_content":"\n## 关于锁的基本概念\n\n锁提供了两种主要特性：互斥（mutual exclusion） 和可见性（visibility）。\n\n互斥即一次只允许一个线程持有某个特定的锁，因此可使用该特性实现对共享数据的协调访问协议，这样，一次就只有一个线程能够使用该共享数据。\n\n可见性要更加复杂一些，它必须确保释放锁之前对共享数据做出的更改对于随后获得该锁的另一个线程是可见的 —— 如果没有同步机制提供的这种可见性保证，线程看到的共享变量可能是修改前的值或不一致的值，这将引发许多严重问题。\n\n## 互斥\n\n- 使用 `synchronized` 来确保线程的互斥,也就是确保线程对共享数据的原子性操作.\n\n## 可见性\n\n- 使用 `volatile` 来确保可见性,多个线程总能读到共享变量的最新值\n\n- 要使 `volatile` 变量提供理想的线程安全，必须同时满足下面两个条件：\n\n    1. 对变量的写操作不依赖于当前值(也就是不能进行 读取->修改->写入 的操作, 只能进行 修改->写入)。\n\n    2. 该变量没有包含在具有其他变量的不变式中。\n\n\n- 对于第二个条件,具体的例子如下\n\n```java\n@NotThreadSafe \npublic class NumberRange {\n    private int lower, upper;\n \n    public int getLower() { return lower; }\n    public int getUpper() { return upper; }\n \n    public void setLower(int value) { \n        if (value > upper) \n            throw new IllegalArgumentException(...);\n        lower = value;\n    }\n \n    public void setUpper(int value) { \n        if (value < lower) \n            throw new IllegalArgumentException(...);\n        upper = value;\n    }\n}\n```\n\n- 对于上面的例子,如果初始状态是 (0, 5)，同一时间内，线程 A 调用 setLower(4) 并且线程 B 调用 setUpper(3)，显然这两个操作交叉存入的值是不符合条件的，那么两个线程都会通过用于保护不变式的检查，使得最后的范围值是 (4, 3) —— 一个无效值。至于针对范围的其他操作，我们需要使 setLower() 和 setUpper() 操作原子化 —— 而将字段定义为 volatile 类型是无法实现这一目的的。\n\n## synchronized 和 volatile 组合使用\n\n- 结合使用的一个例子, 其中 `synchronized`一次只允许一个线程访问值, `volatile` 允许多个线程执行读操作, 这样组合使用后既可以保证操作的原子性,也可以确保所有的线程在**读**上能够取得很好的性能\n\n```java\n@ThreadSafe\npublic class CheesyCounter {\n    // Employs the cheap read-write lock trick\n    // All mutative operations MUST be done with the 'this' lock held\n    @GuardedBy(\"this\") private volatile int value;\n \n    public int getValue() { return value; }\n \n    public synchronized int increment() {\n        return value++;\n    }\n}\n```\n\n## 参考\n\n- [正确使用 Volatile 变量](https://www.ibm.com/developerworks/cn/java/j-jtp06197.html)","source":"_posts/对锁的理解.md","raw":"---\ntitle: 对锁的理解\ntitle_url: lock-synchronized-volatile\ndate: 2017-06-09\ntags: [Java,synchronized,volatile,锁]\ncategories: 多线程\ndescription: 对锁的理解\n---\n\n## 关于锁的基本概念\n\n锁提供了两种主要特性：互斥（mutual exclusion） 和可见性（visibility）。\n\n互斥即一次只允许一个线程持有某个特定的锁，因此可使用该特性实现对共享数据的协调访问协议，这样，一次就只有一个线程能够使用该共享数据。\n\n可见性要更加复杂一些，它必须确保释放锁之前对共享数据做出的更改对于随后获得该锁的另一个线程是可见的 —— 如果没有同步机制提供的这种可见性保证，线程看到的共享变量可能是修改前的值或不一致的值，这将引发许多严重问题。\n\n## 互斥\n\n- 使用 `synchronized` 来确保线程的互斥,也就是确保线程对共享数据的原子性操作.\n\n## 可见性\n\n- 使用 `volatile` 来确保可见性,多个线程总能读到共享变量的最新值\n\n- 要使 `volatile` 变量提供理想的线程安全，必须同时满足下面两个条件：\n\n    1. 对变量的写操作不依赖于当前值(也就是不能进行 读取->修改->写入 的操作, 只能进行 修改->写入)。\n\n    2. 该变量没有包含在具有其他变量的不变式中。\n\n\n- 对于第二个条件,具体的例子如下\n\n```java\n@NotThreadSafe \npublic class NumberRange {\n    private int lower, upper;\n \n    public int getLower() { return lower; }\n    public int getUpper() { return upper; }\n \n    public void setLower(int value) { \n        if (value > upper) \n            throw new IllegalArgumentException(...);\n        lower = value;\n    }\n \n    public void setUpper(int value) { \n        if (value < lower) \n            throw new IllegalArgumentException(...);\n        upper = value;\n    }\n}\n```\n\n- 对于上面的例子,如果初始状态是 (0, 5)，同一时间内，线程 A 调用 setLower(4) 并且线程 B 调用 setUpper(3)，显然这两个操作交叉存入的值是不符合条件的，那么两个线程都会通过用于保护不变式的检查，使得最后的范围值是 (4, 3) —— 一个无效值。至于针对范围的其他操作，我们需要使 setLower() 和 setUpper() 操作原子化 —— 而将字段定义为 volatile 类型是无法实现这一目的的。\n\n## synchronized 和 volatile 组合使用\n\n- 结合使用的一个例子, 其中 `synchronized`一次只允许一个线程访问值, `volatile` 允许多个线程执行读操作, 这样组合使用后既可以保证操作的原子性,也可以确保所有的线程在**读**上能够取得很好的性能\n\n```java\n@ThreadSafe\npublic class CheesyCounter {\n    // Employs the cheap read-write lock trick\n    // All mutative operations MUST be done with the 'this' lock held\n    @GuardedBy(\"this\") private volatile int value;\n \n    public int getValue() { return value; }\n \n    public synchronized int increment() {\n        return value++;\n    }\n}\n```\n\n## 参考\n\n- [正确使用 Volatile 变量](https://www.ibm.com/developerworks/cn/java/j-jtp06197.html)","slug":"对锁的理解","published":1,"updated":"2017-06-14T03:06:18.526Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj5jgsbf1001i2cezqfqzk8do","content":"<h2 id=\"关于锁的基本概念\"><a href=\"#关于锁的基本概念\" class=\"headerlink\" title=\"关于锁的基本概念\"></a>关于锁的基本概念</h2><p>锁提供了两种主要特性：互斥（mutual exclusion） 和可见性（visibility）。</p>\n<p>互斥即一次只允许一个线程持有某个特定的锁，因此可使用该特性实现对共享数据的协调访问协议，这样，一次就只有一个线程能够使用该共享数据。</p>\n<p>可见性要更加复杂一些，它必须确保释放锁之前对共享数据做出的更改对于随后获得该锁的另一个线程是可见的 —— 如果没有同步机制提供的这种可见性保证，线程看到的共享变量可能是修改前的值或不一致的值，这将引发许多严重问题。</p>\n<h2 id=\"互斥\"><a href=\"#互斥\" class=\"headerlink\" title=\"互斥\"></a>互斥</h2><ul>\n<li>使用 <code>synchronized</code> 来确保线程的互斥,也就是确保线程对共享数据的原子性操作.</li>\n</ul>\n<h2 id=\"可见性\"><a href=\"#可见性\" class=\"headerlink\" title=\"可见性\"></a>可见性</h2><ul>\n<li><p>使用 <code>volatile</code> 来确保可见性,多个线程总能读到共享变量的最新值</p>\n</li>\n<li><p>要使 <code>volatile</code> 变量提供理想的线程安全，必须同时满足下面两个条件：</p>\n<ol>\n<li><p>对变量的写操作不依赖于当前值(也就是不能进行 读取-&gt;修改-&gt;写入 的操作, 只能进行 修改-&gt;写入)。</p>\n</li>\n<li><p>该变量没有包含在具有其他变量的不变式中。</p>\n</li>\n</ol>\n</li>\n</ul>\n<ul>\n<li>对于第二个条件,具体的例子如下</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@NotThreadSafe</span> </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">NumberRange</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> lower, upper;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">getLower</span><span class=\"params\">()</span> </span>&#123; <span class=\"keyword\">return</span> lower; &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">getUpper</span><span class=\"params\">()</span> </span>&#123; <span class=\"keyword\">return</span> upper; &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setLower</span><span class=\"params\">(<span class=\"keyword\">int</span> value)</span> </span>&#123; </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (value &gt; upper) </span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(...);</span><br><span class=\"line\">        lower = value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUpper</span><span class=\"params\">(<span class=\"keyword\">int</span> value)</span> </span>&#123; </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (value &lt; lower) </span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(...);</span><br><span class=\"line\">        upper = value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>对于上面的例子,如果初始状态是 (0, 5)，同一时间内，线程 A 调用 setLower(4) 并且线程 B 调用 setUpper(3)，显然这两个操作交叉存入的值是不符合条件的，那么两个线程都会通过用于保护不变式的检查，使得最后的范围值是 (4, 3) —— 一个无效值。至于针对范围的其他操作，我们需要使 setLower() 和 setUpper() 操作原子化 —— 而将字段定义为 volatile 类型是无法实现这一目的的。</li>\n</ul>\n<h2 id=\"synchronized-和-volatile-组合使用\"><a href=\"#synchronized-和-volatile-组合使用\" class=\"headerlink\" title=\"synchronized 和 volatile 组合使用\"></a>synchronized 和 volatile 组合使用</h2><ul>\n<li>结合使用的一个例子, 其中 <code>synchronized</code>一次只允许一个线程访问值, <code>volatile</code> 允许多个线程执行读操作, 这样组合使用后既可以保证操作的原子性,也可以确保所有的线程在<strong>读</strong>上能够取得很好的性能</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@ThreadSafe</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CheesyCounter</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// Employs the cheap read-write lock trick</span></span><br><span class=\"line\">    <span class=\"comment\">// All mutative operations MUST be done with the 'this' lock held</span></span><br><span class=\"line\">    <span class=\"meta\">@GuardedBy</span>(<span class=\"string\">\"this\"</span>) <span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> <span class=\"keyword\">int</span> value;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">getValue</span><span class=\"params\">()</span> </span>&#123; <span class=\"keyword\">return</span> value; &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">int</span> <span class=\"title\">increment</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> value++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ul>\n<li><a href=\"https://www.ibm.com/developerworks/cn/java/j-jtp06197.html\" target=\"_blank\" rel=\"external\">正确使用 Volatile 变量</a></li>\n</ul>\n","excerpt":"","more":"<h2 id=\"关于锁的基本概念\"><a href=\"#关于锁的基本概念\" class=\"headerlink\" title=\"关于锁的基本概念\"></a>关于锁的基本概念</h2><p>锁提供了两种主要特性：互斥（mutual exclusion） 和可见性（visibility）。</p>\n<p>互斥即一次只允许一个线程持有某个特定的锁，因此可使用该特性实现对共享数据的协调访问协议，这样，一次就只有一个线程能够使用该共享数据。</p>\n<p>可见性要更加复杂一些，它必须确保释放锁之前对共享数据做出的更改对于随后获得该锁的另一个线程是可见的 —— 如果没有同步机制提供的这种可见性保证，线程看到的共享变量可能是修改前的值或不一致的值，这将引发许多严重问题。</p>\n<h2 id=\"互斥\"><a href=\"#互斥\" class=\"headerlink\" title=\"互斥\"></a>互斥</h2><ul>\n<li>使用 <code>synchronized</code> 来确保线程的互斥,也就是确保线程对共享数据的原子性操作.</li>\n</ul>\n<h2 id=\"可见性\"><a href=\"#可见性\" class=\"headerlink\" title=\"可见性\"></a>可见性</h2><ul>\n<li><p>使用 <code>volatile</code> 来确保可见性,多个线程总能读到共享变量的最新值</p>\n</li>\n<li><p>要使 <code>volatile</code> 变量提供理想的线程安全，必须同时满足下面两个条件：</p>\n<ol>\n<li><p>对变量的写操作不依赖于当前值(也就是不能进行 读取-&gt;修改-&gt;写入 的操作, 只能进行 修改-&gt;写入)。</p>\n</li>\n<li><p>该变量没有包含在具有其他变量的不变式中。</p>\n</li>\n</ol>\n</li>\n</ul>\n<ul>\n<li>对于第二个条件,具体的例子如下</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@NotThreadSafe</span> </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">NumberRange</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> lower, upper;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">getLower</span><span class=\"params\">()</span> </span>&#123; <span class=\"keyword\">return</span> lower; &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">getUpper</span><span class=\"params\">()</span> </span>&#123; <span class=\"keyword\">return</span> upper; &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setLower</span><span class=\"params\">(<span class=\"keyword\">int</span> value)</span> </span>&#123; </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (value &gt; upper) </span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(...);</span><br><span class=\"line\">        lower = value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUpper</span><span class=\"params\">(<span class=\"keyword\">int</span> value)</span> </span>&#123; </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (value &lt; lower) </span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(...);</span><br><span class=\"line\">        upper = value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>对于上面的例子,如果初始状态是 (0, 5)，同一时间内，线程 A 调用 setLower(4) 并且线程 B 调用 setUpper(3)，显然这两个操作交叉存入的值是不符合条件的，那么两个线程都会通过用于保护不变式的检查，使得最后的范围值是 (4, 3) —— 一个无效值。至于针对范围的其他操作，我们需要使 setLower() 和 setUpper() 操作原子化 —— 而将字段定义为 volatile 类型是无法实现这一目的的。</li>\n</ul>\n<h2 id=\"synchronized-和-volatile-组合使用\"><a href=\"#synchronized-和-volatile-组合使用\" class=\"headerlink\" title=\"synchronized 和 volatile 组合使用\"></a>synchronized 和 volatile 组合使用</h2><ul>\n<li>结合使用的一个例子, 其中 <code>synchronized</code>一次只允许一个线程访问值, <code>volatile</code> 允许多个线程执行读操作, 这样组合使用后既可以保证操作的原子性,也可以确保所有的线程在<strong>读</strong>上能够取得很好的性能</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@ThreadSafe</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CheesyCounter</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// Employs the cheap read-write lock trick</span></span><br><span class=\"line\">    <span class=\"comment\">// All mutative operations MUST be done with the 'this' lock held</span></span><br><span class=\"line\">    <span class=\"meta\">@GuardedBy</span>(<span class=\"string\">\"this\"</span>) <span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> <span class=\"keyword\">int</span> value;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">getValue</span><span class=\"params\">()</span> </span>&#123; <span class=\"keyword\">return</span> value; &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">int</span> <span class=\"title\">increment</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> value++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ul>\n<li><a href=\"https://www.ibm.com/developerworks/cn/java/j-jtp06197.html\">正确使用 Volatile 变量</a></li>\n</ul>\n"},{"title":"总结一下关于Spring中bean的scope属性","title_url":"Spring-bean-scope-usage","date":"2016-07-12T16:00:00.000Z","description":"总结一下关于Spring中bean的scope属性，主要是Controller的singleton和prototype的区别，并举例说明","_content":"\n## 关于Spring bean的scope属性\n\n- Spring的bean默认是singleton-单例模式的，即Spring容器只存在一个共享的bean实例\n\n- 对于singleton-单例模式，如果有共享变量会导致线程不安全\n\n- 如果为prototype-原型模式，那么每次对bean的请求都会创建一个新的bean实例\n\n- prototype-原型模式是线程安全的，Spring中的Controller默认是singleton\n\n- 可以在类上面通过`@Scope(\"prototype\")`设置为多例，或者在xml中设置`scope=\"prototype\"`\n\n- singleton-单例模式相对prototype-原型模式性能更高，因为不会每次对bean的请求都会创建一个新的bean实例\n\n- 二者选择的原则：有状态的bean都使用prototype，而对无状态的bean则应该使用singleton\n\n- 有无状态是指bean中有无成员变量\n\n- Struts2的Action默认是多例的，原因在于Struts2将表单数据作为Action的成员变量\n\n- scope还可以设置成request、session和global session\n\n## 举例说明Controller的singleton和prototype的区别\n\n- TestController如下\n```java\n@Controller\n@RequestMapping(\"/test\")\n@Api(basePath = \"/test\", value = \"test\", description = \"测试相关接口\", position = 8)\npublic class TestController {\n\t\n\tprivate Map<String, String> cacheData = Collections.synchronizedMap(new HashMap<String, String>());\n\n\t@ResponseBody\n\t@RequestMapping(value = \"/test_cache\", method = RequestMethod.GET, produces = \"application/json; charset=utf-8\")\n\t@ApiOperation(value = \"测试scope\", notes = \"测试scope\", response = KVBean.class, responseContainer = \"List\")\n\tpublic List<KVBean> getTestCache(@RequestParam String key, @RequestParam String value) throws Exception {\n\t\t\n\t\tSystem.out.println(Thread.currentThread().getName());\n\t\tcacheData.put(key, value);\n\t\t\n\t\tList<KVBean> data = new ArrayList<KVBean>();\n\t\tfor (Entry<String, String> it : cacheData.entrySet()) {\n\t\t\tdata.add(new KVBean(it.getKey(), it.getValue()));\n\t\t}\n\t\t\n\t\treturn data;\n\t}\n\t\n}\n```\n\n- 第一次在浏览器中输入\n`http://localhost:8080/plainWebApi/test/test_cache?key=1&value=1`\n返回\n`[{\"key\":\"1\",\"value\":\"1\",\"next\":null}]`\n第二次在浏览器中输入\n`http://localhost:8080/plainWebApi/test/test_cache?key=2&value=2`\n返回\n`[{\"key\":\"1\",\"value\":\"1\",\"next\":null},{\"key\":\"2\",\"value\":\"2\",\"next\":null}]`\n可见对于两次请求cacheData都是同一个对象，TestController当然也没有被new。\n\n- 增加`@Scope(value = \"prototype\")`的TestController如下\n```java\n@Controller\n@RequestMapping(\"/test\")\n@Api(basePath = \"/test\", value = \"test\", description = \"测试相关接口\", position = 8)\n@Scope(value = \"prototype\")\npublic class TestController {\n\t\n\tprivate Map<String, String> cacheData = Collections.synchronizedMap(new HashMap<String, String>());\n\n\t@ResponseBody\n\t@RequestMapping(value = \"/test_cache\", method = RequestMethod.GET, produces = \"application/json; charset=utf-8\")\n\t@ApiOperation(value = \"测试scope\", notes = \"测试scope\", response = KVBean.class, responseContainer = \"List\")\n\tpublic List<KVBean> getTestCache(@RequestParam String key, @RequestParam String value) throws Exception {\n\t\t\n\t\tSystem.out.println(Thread.currentThread().getName());\n\t\tcacheData.put(key, value);\n\t\t\n\t\tList<KVBean> data = new ArrayList<KVBean>();\n\t\tfor (Entry<String, String> it : cacheData.entrySet()) {\n\t\t\tdata.add(new KVBean(it.getKey(), it.getValue()));\n\t\t}\n\t\t\n\t\treturn data;\n\t}\n\t\n}\n```\n\n- 同样第一次在浏览器中输入\n`http://localhost:8080/plainWebApi/test/test_cache?key=1&value=1`\n返回\n`[{\"key\":\"1\",\"value\":\"1\",\"next\":null}]`\n第二次在浏览器中输入\n`http://localhost:8080/plainWebApi/test/test_cache?key=2&value=2`\n返回\n`[{\"key\":\"2\",\"value\":\"2\",\"next\":null}]`\n可见对于两次请求cacheData都是不是一个对象，TestController当然也不是同一个。\n\n## 例子的详细代码\n\n- [点这里](https://github.com/toulezu/play/tree/master/plainWebApi)\n\n## 参考：\n- [Struts action的单例与多例](http://my.oschina.net/davidzhang/blog/67429)\n- [在spring来管理实例对象prototype和singleton的选择.针对action如何使用](http://www.cnblogs.com/shipengzhi/articles/2099694.html)\n- [Spring MVC Controller单例陷阱](http://lavasoft.blog.51cto.com/62575/1394669)\n- [struts+spring action应配置为scope=\"prototype\"](http://www.cnblogs.com/JemBai/archive/2010/11/10/1873954.html)\n- [struts2 Action获取表单数据](http://blog.csdn.net/lsh6688/article/details/7863322)\n","source":"_posts/总结一下Spring中Bean的单例和多例.md","raw":"---\ntitle: 总结一下关于Spring中bean的scope属性\ntitle_url: Spring-bean-scope-usage\ndate: 2016-07-13\ntags: Spring\ncategories: 技术\ndescription: 总结一下关于Spring中bean的scope属性，主要是Controller的singleton和prototype的区别，并举例说明\n---\n\n## 关于Spring bean的scope属性\n\n- Spring的bean默认是singleton-单例模式的，即Spring容器只存在一个共享的bean实例\n\n- 对于singleton-单例模式，如果有共享变量会导致线程不安全\n\n- 如果为prototype-原型模式，那么每次对bean的请求都会创建一个新的bean实例\n\n- prototype-原型模式是线程安全的，Spring中的Controller默认是singleton\n\n- 可以在类上面通过`@Scope(\"prototype\")`设置为多例，或者在xml中设置`scope=\"prototype\"`\n\n- singleton-单例模式相对prototype-原型模式性能更高，因为不会每次对bean的请求都会创建一个新的bean实例\n\n- 二者选择的原则：有状态的bean都使用prototype，而对无状态的bean则应该使用singleton\n\n- 有无状态是指bean中有无成员变量\n\n- Struts2的Action默认是多例的，原因在于Struts2将表单数据作为Action的成员变量\n\n- scope还可以设置成request、session和global session\n\n## 举例说明Controller的singleton和prototype的区别\n\n- TestController如下\n```java\n@Controller\n@RequestMapping(\"/test\")\n@Api(basePath = \"/test\", value = \"test\", description = \"测试相关接口\", position = 8)\npublic class TestController {\n\t\n\tprivate Map<String, String> cacheData = Collections.synchronizedMap(new HashMap<String, String>());\n\n\t@ResponseBody\n\t@RequestMapping(value = \"/test_cache\", method = RequestMethod.GET, produces = \"application/json; charset=utf-8\")\n\t@ApiOperation(value = \"测试scope\", notes = \"测试scope\", response = KVBean.class, responseContainer = \"List\")\n\tpublic List<KVBean> getTestCache(@RequestParam String key, @RequestParam String value) throws Exception {\n\t\t\n\t\tSystem.out.println(Thread.currentThread().getName());\n\t\tcacheData.put(key, value);\n\t\t\n\t\tList<KVBean> data = new ArrayList<KVBean>();\n\t\tfor (Entry<String, String> it : cacheData.entrySet()) {\n\t\t\tdata.add(new KVBean(it.getKey(), it.getValue()));\n\t\t}\n\t\t\n\t\treturn data;\n\t}\n\t\n}\n```\n\n- 第一次在浏览器中输入\n`http://localhost:8080/plainWebApi/test/test_cache?key=1&value=1`\n返回\n`[{\"key\":\"1\",\"value\":\"1\",\"next\":null}]`\n第二次在浏览器中输入\n`http://localhost:8080/plainWebApi/test/test_cache?key=2&value=2`\n返回\n`[{\"key\":\"1\",\"value\":\"1\",\"next\":null},{\"key\":\"2\",\"value\":\"2\",\"next\":null}]`\n可见对于两次请求cacheData都是同一个对象，TestController当然也没有被new。\n\n- 增加`@Scope(value = \"prototype\")`的TestController如下\n```java\n@Controller\n@RequestMapping(\"/test\")\n@Api(basePath = \"/test\", value = \"test\", description = \"测试相关接口\", position = 8)\n@Scope(value = \"prototype\")\npublic class TestController {\n\t\n\tprivate Map<String, String> cacheData = Collections.synchronizedMap(new HashMap<String, String>());\n\n\t@ResponseBody\n\t@RequestMapping(value = \"/test_cache\", method = RequestMethod.GET, produces = \"application/json; charset=utf-8\")\n\t@ApiOperation(value = \"测试scope\", notes = \"测试scope\", response = KVBean.class, responseContainer = \"List\")\n\tpublic List<KVBean> getTestCache(@RequestParam String key, @RequestParam String value) throws Exception {\n\t\t\n\t\tSystem.out.println(Thread.currentThread().getName());\n\t\tcacheData.put(key, value);\n\t\t\n\t\tList<KVBean> data = new ArrayList<KVBean>();\n\t\tfor (Entry<String, String> it : cacheData.entrySet()) {\n\t\t\tdata.add(new KVBean(it.getKey(), it.getValue()));\n\t\t}\n\t\t\n\t\treturn data;\n\t}\n\t\n}\n```\n\n- 同样第一次在浏览器中输入\n`http://localhost:8080/plainWebApi/test/test_cache?key=1&value=1`\n返回\n`[{\"key\":\"1\",\"value\":\"1\",\"next\":null}]`\n第二次在浏览器中输入\n`http://localhost:8080/plainWebApi/test/test_cache?key=2&value=2`\n返回\n`[{\"key\":\"2\",\"value\":\"2\",\"next\":null}]`\n可见对于两次请求cacheData都是不是一个对象，TestController当然也不是同一个。\n\n## 例子的详细代码\n\n- [点这里](https://github.com/toulezu/play/tree/master/plainWebApi)\n\n## 参考：\n- [Struts action的单例与多例](http://my.oschina.net/davidzhang/blog/67429)\n- [在spring来管理实例对象prototype和singleton的选择.针对action如何使用](http://www.cnblogs.com/shipengzhi/articles/2099694.html)\n- [Spring MVC Controller单例陷阱](http://lavasoft.blog.51cto.com/62575/1394669)\n- [struts+spring action应配置为scope=\"prototype\"](http://www.cnblogs.com/JemBai/archive/2010/11/10/1873954.html)\n- [struts2 Action获取表单数据](http://blog.csdn.net/lsh6688/article/details/7863322)\n","slug":"总结一下Spring中Bean的单例和多例","published":1,"updated":"2016-10-10T01:58:06.795Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj5jgsbf4001n2cezrpb9oyi4","content":"<h2 id=\"关于Spring-bean的scope属性\"><a href=\"#关于Spring-bean的scope属性\" class=\"headerlink\" title=\"关于Spring bean的scope属性\"></a>关于Spring bean的scope属性</h2><ul>\n<li><p>Spring的bean默认是singleton-单例模式的，即Spring容器只存在一个共享的bean实例</p>\n</li>\n<li><p>对于singleton-单例模式，如果有共享变量会导致线程不安全</p>\n</li>\n<li><p>如果为prototype-原型模式，那么每次对bean的请求都会创建一个新的bean实例</p>\n</li>\n<li><p>prototype-原型模式是线程安全的，Spring中的Controller默认是singleton</p>\n</li>\n<li><p>可以在类上面通过<code>@Scope(&quot;prototype&quot;)</code>设置为多例，或者在xml中设置<code>scope=&quot;prototype&quot;</code></p>\n</li>\n<li><p>singleton-单例模式相对prototype-原型模式性能更高，因为不会每次对bean的请求都会创建一个新的bean实例</p>\n</li>\n<li><p>二者选择的原则：有状态的bean都使用prototype，而对无状态的bean则应该使用singleton</p>\n</li>\n<li><p>有无状态是指bean中有无成员变量</p>\n</li>\n<li><p>Struts2的Action默认是多例的，原因在于Struts2将表单数据作为Action的成员变量</p>\n</li>\n<li><p>scope还可以设置成request、session和global session</p>\n</li>\n</ul>\n<h2 id=\"举例说明Controller的singleton和prototype的区别\"><a href=\"#举例说明Controller的singleton和prototype的区别\" class=\"headerlink\" title=\"举例说明Controller的singleton和prototype的区别\"></a>举例说明Controller的singleton和prototype的区别</h2><ul>\n<li><p>TestController如下</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Controller</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/test\"</span>)</span><br><span class=\"line\"><span class=\"meta\">@Api</span>(basePath = <span class=\"string\">\"/test\"</span>, value = <span class=\"string\">\"test\"</span>, description = <span class=\"string\">\"测试相关接口\"</span>, position = <span class=\"number\">8</span>)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestController</span> </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> Map&lt;String, String&gt; cacheData = Collections.synchronizedMap(<span class=\"keyword\">new</span> HashMap&lt;String, String&gt;());</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\">\t<span class=\"meta\">@RequestMapping</span>(value = <span class=\"string\">\"/test_cache\"</span>, method = RequestMethod.GET, produces = <span class=\"string\">\"application/json; charset=utf-8\"</span>)</span><br><span class=\"line\">\t<span class=\"meta\">@ApiOperation</span>(value = <span class=\"string\">\"测试scope\"</span>, notes = <span class=\"string\">\"测试scope\"</span>, response = KVBean.class, responseContainer = <span class=\"string\">\"List\"</span>)</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> List&lt;KVBean&gt; <span class=\"title\">getTestCache</span><span class=\"params\">(@RequestParam String key, @RequestParam String value)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\tSystem.out.println(Thread.currentThread().getName());</span><br><span class=\"line\">\t\tcacheData.put(key, value);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\tList&lt;KVBean&gt; data = <span class=\"keyword\">new</span> ArrayList&lt;KVBean&gt;();</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (Entry&lt;String, String&gt; it : cacheData.entrySet()) &#123;</span><br><span class=\"line\">\t\t\tdata.add(<span class=\"keyword\">new</span> KVBean(it.getKey(), it.getValue()));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> data;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>第一次在浏览器中输入<br><code>http://localhost:8080/plainWebApi/test/test_cache?key=1&amp;value=1</code><br>返回<br><code>[{&quot;key&quot;:&quot;1&quot;,&quot;value&quot;:&quot;1&quot;,&quot;next&quot;:null}]</code><br>第二次在浏览器中输入<br><code>http://localhost:8080/plainWebApi/test/test_cache?key=2&amp;value=2</code><br>返回<br><code>[{&quot;key&quot;:&quot;1&quot;,&quot;value&quot;:&quot;1&quot;,&quot;next&quot;:null},{&quot;key&quot;:&quot;2&quot;,&quot;value&quot;:&quot;2&quot;,&quot;next&quot;:null}]</code><br>可见对于两次请求cacheData都是同一个对象，TestController当然也没有被new。</p>\n</li>\n<li><p>增加<code>@Scope(value = &quot;prototype&quot;)</code>的TestController如下</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Controller</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/test\"</span>)</span><br><span class=\"line\"><span class=\"meta\">@Api</span>(basePath = <span class=\"string\">\"/test\"</span>, value = <span class=\"string\">\"test\"</span>, description = <span class=\"string\">\"测试相关接口\"</span>, position = <span class=\"number\">8</span>)</span><br><span class=\"line\"><span class=\"meta\">@Scope</span>(value = <span class=\"string\">\"prototype\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestController</span> </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> Map&lt;String, String&gt; cacheData = Collections.synchronizedMap(<span class=\"keyword\">new</span> HashMap&lt;String, String&gt;());</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\">\t<span class=\"meta\">@RequestMapping</span>(value = <span class=\"string\">\"/test_cache\"</span>, method = RequestMethod.GET, produces = <span class=\"string\">\"application/json; charset=utf-8\"</span>)</span><br><span class=\"line\">\t<span class=\"meta\">@ApiOperation</span>(value = <span class=\"string\">\"测试scope\"</span>, notes = <span class=\"string\">\"测试scope\"</span>, response = KVBean.class, responseContainer = <span class=\"string\">\"List\"</span>)</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> List&lt;KVBean&gt; <span class=\"title\">getTestCache</span><span class=\"params\">(@RequestParam String key, @RequestParam String value)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\tSystem.out.println(Thread.currentThread().getName());</span><br><span class=\"line\">\t\tcacheData.put(key, value);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\tList&lt;KVBean&gt; data = <span class=\"keyword\">new</span> ArrayList&lt;KVBean&gt;();</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (Entry&lt;String, String&gt; it : cacheData.entrySet()) &#123;</span><br><span class=\"line\">\t\t\tdata.add(<span class=\"keyword\">new</span> KVBean(it.getKey(), it.getValue()));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> data;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>同样第一次在浏览器中输入<br><code>http://localhost:8080/plainWebApi/test/test_cache?key=1&amp;value=1</code><br>返回<br><code>[{&quot;key&quot;:&quot;1&quot;,&quot;value&quot;:&quot;1&quot;,&quot;next&quot;:null}]</code><br>第二次在浏览器中输入<br><code>http://localhost:8080/plainWebApi/test/test_cache?key=2&amp;value=2</code><br>返回<br><code>[{&quot;key&quot;:&quot;2&quot;,&quot;value&quot;:&quot;2&quot;,&quot;next&quot;:null}]</code><br>可见对于两次请求cacheData都是不是一个对象，TestController当然也不是同一个。</p>\n</li>\n</ul>\n<h2 id=\"例子的详细代码\"><a href=\"#例子的详细代码\" class=\"headerlink\" title=\"例子的详细代码\"></a>例子的详细代码</h2><ul>\n<li><a href=\"https://github.com/toulezu/play/tree/master/plainWebApi\" target=\"_blank\" rel=\"external\">点这里</a></li>\n</ul>\n<h2 id=\"参考：\"><a href=\"#参考：\" class=\"headerlink\" title=\"参考：\"></a>参考：</h2><ul>\n<li><a href=\"http://my.oschina.net/davidzhang/blog/67429\" target=\"_blank\" rel=\"external\">Struts action的单例与多例</a></li>\n<li><a href=\"http://www.cnblogs.com/shipengzhi/articles/2099694.html\" target=\"_blank\" rel=\"external\">在spring来管理实例对象prototype和singleton的选择.针对action如何使用</a></li>\n<li><a href=\"http://lavasoft.blog.51cto.com/62575/1394669\" target=\"_blank\" rel=\"external\">Spring MVC Controller单例陷阱</a></li>\n<li><a href=\"http://www.cnblogs.com/JemBai/archive/2010/11/10/1873954.html\" target=\"_blank\" rel=\"external\">struts+spring action应配置为scope=”prototype”</a></li>\n<li><a href=\"http://blog.csdn.net/lsh6688/article/details/7863322\" target=\"_blank\" rel=\"external\">struts2 Action获取表单数据</a></li>\n</ul>\n","excerpt":"","more":"<h2 id=\"关于Spring-bean的scope属性\"><a href=\"#关于Spring-bean的scope属性\" class=\"headerlink\" title=\"关于Spring bean的scope属性\"></a>关于Spring bean的scope属性</h2><ul>\n<li><p>Spring的bean默认是singleton-单例模式的，即Spring容器只存在一个共享的bean实例</p>\n</li>\n<li><p>对于singleton-单例模式，如果有共享变量会导致线程不安全</p>\n</li>\n<li><p>如果为prototype-原型模式，那么每次对bean的请求都会创建一个新的bean实例</p>\n</li>\n<li><p>prototype-原型模式是线程安全的，Spring中的Controller默认是singleton</p>\n</li>\n<li><p>可以在类上面通过<code>@Scope(&quot;prototype&quot;)</code>设置为多例，或者在xml中设置<code>scope=&quot;prototype&quot;</code></p>\n</li>\n<li><p>singleton-单例模式相对prototype-原型模式性能更高，因为不会每次对bean的请求都会创建一个新的bean实例</p>\n</li>\n<li><p>二者选择的原则：有状态的bean都使用prototype，而对无状态的bean则应该使用singleton</p>\n</li>\n<li><p>有无状态是指bean中有无成员变量</p>\n</li>\n<li><p>Struts2的Action默认是多例的，原因在于Struts2将表单数据作为Action的成员变量</p>\n</li>\n<li><p>scope还可以设置成request、session和global session</p>\n</li>\n</ul>\n<h2 id=\"举例说明Controller的singleton和prototype的区别\"><a href=\"#举例说明Controller的singleton和prototype的区别\" class=\"headerlink\" title=\"举例说明Controller的singleton和prototype的区别\"></a>举例说明Controller的singleton和prototype的区别</h2><ul>\n<li><p>TestController如下</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Controller</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/test\"</span>)</span><br><span class=\"line\"><span class=\"meta\">@Api</span>(basePath = <span class=\"string\">\"/test\"</span>, value = <span class=\"string\">\"test\"</span>, description = <span class=\"string\">\"测试相关接口\"</span>, position = <span class=\"number\">8</span>)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestController</span> </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> Map&lt;String, String&gt; cacheData = Collections.synchronizedMap(<span class=\"keyword\">new</span> HashMap&lt;String, String&gt;());</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\">\t<span class=\"meta\">@RequestMapping</span>(value = <span class=\"string\">\"/test_cache\"</span>, method = RequestMethod.GET, produces = <span class=\"string\">\"application/json; charset=utf-8\"</span>)</span><br><span class=\"line\">\t<span class=\"meta\">@ApiOperation</span>(value = <span class=\"string\">\"测试scope\"</span>, notes = <span class=\"string\">\"测试scope\"</span>, response = KVBean.class, responseContainer = <span class=\"string\">\"List\"</span>)</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> List&lt;KVBean&gt; <span class=\"title\">getTestCache</span><span class=\"params\">(@RequestParam String key, @RequestParam String value)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\tSystem.out.println(Thread.currentThread().getName());</span><br><span class=\"line\">\t\tcacheData.put(key, value);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\tList&lt;KVBean&gt; data = <span class=\"keyword\">new</span> ArrayList&lt;KVBean&gt;();</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (Entry&lt;String, String&gt; it : cacheData.entrySet()) &#123;</span><br><span class=\"line\">\t\t\tdata.add(<span class=\"keyword\">new</span> KVBean(it.getKey(), it.getValue()));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> data;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>第一次在浏览器中输入<br><code>http://localhost:8080/plainWebApi/test/test_cache?key=1&amp;value=1</code><br>返回<br><code>[{&quot;key&quot;:&quot;1&quot;,&quot;value&quot;:&quot;1&quot;,&quot;next&quot;:null}]</code><br>第二次在浏览器中输入<br><code>http://localhost:8080/plainWebApi/test/test_cache?key=2&amp;value=2</code><br>返回<br><code>[{&quot;key&quot;:&quot;1&quot;,&quot;value&quot;:&quot;1&quot;,&quot;next&quot;:null},{&quot;key&quot;:&quot;2&quot;,&quot;value&quot;:&quot;2&quot;,&quot;next&quot;:null}]</code><br>可见对于两次请求cacheData都是同一个对象，TestController当然也没有被new。</p>\n</li>\n<li><p>增加<code>@Scope(value = &quot;prototype&quot;)</code>的TestController如下</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Controller</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/test\"</span>)</span><br><span class=\"line\"><span class=\"meta\">@Api</span>(basePath = <span class=\"string\">\"/test\"</span>, value = <span class=\"string\">\"test\"</span>, description = <span class=\"string\">\"测试相关接口\"</span>, position = <span class=\"number\">8</span>)</span><br><span class=\"line\"><span class=\"meta\">@Scope</span>(value = <span class=\"string\">\"prototype\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestController</span> </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> Map&lt;String, String&gt; cacheData = Collections.synchronizedMap(<span class=\"keyword\">new</span> HashMap&lt;String, String&gt;());</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@ResponseBody</span></span><br><span class=\"line\">\t<span class=\"meta\">@RequestMapping</span>(value = <span class=\"string\">\"/test_cache\"</span>, method = RequestMethod.GET, produces = <span class=\"string\">\"application/json; charset=utf-8\"</span>)</span><br><span class=\"line\">\t<span class=\"meta\">@ApiOperation</span>(value = <span class=\"string\">\"测试scope\"</span>, notes = <span class=\"string\">\"测试scope\"</span>, response = KVBean.class, responseContainer = <span class=\"string\">\"List\"</span>)</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> List&lt;KVBean&gt; <span class=\"title\">getTestCache</span><span class=\"params\">(@RequestParam String key, @RequestParam String value)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\tSystem.out.println(Thread.currentThread().getName());</span><br><span class=\"line\">\t\tcacheData.put(key, value);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\tList&lt;KVBean&gt; data = <span class=\"keyword\">new</span> ArrayList&lt;KVBean&gt;();</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (Entry&lt;String, String&gt; it : cacheData.entrySet()) &#123;</span><br><span class=\"line\">\t\t\tdata.add(<span class=\"keyword\">new</span> KVBean(it.getKey(), it.getValue()));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> data;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>同样第一次在浏览器中输入<br><code>http://localhost:8080/plainWebApi/test/test_cache?key=1&amp;value=1</code><br>返回<br><code>[{&quot;key&quot;:&quot;1&quot;,&quot;value&quot;:&quot;1&quot;,&quot;next&quot;:null}]</code><br>第二次在浏览器中输入<br><code>http://localhost:8080/plainWebApi/test/test_cache?key=2&amp;value=2</code><br>返回<br><code>[{&quot;key&quot;:&quot;2&quot;,&quot;value&quot;:&quot;2&quot;,&quot;next&quot;:null}]</code><br>可见对于两次请求cacheData都是不是一个对象，TestController当然也不是同一个。</p>\n</li>\n</ul>\n<h2 id=\"例子的详细代码\"><a href=\"#例子的详细代码\" class=\"headerlink\" title=\"例子的详细代码\"></a>例子的详细代码</h2><ul>\n<li><a href=\"https://github.com/toulezu/play/tree/master/plainWebApi\">点这里</a></li>\n</ul>\n<h2 id=\"参考：\"><a href=\"#参考：\" class=\"headerlink\" title=\"参考：\"></a>参考：</h2><ul>\n<li><a href=\"http://my.oschina.net/davidzhang/blog/67429\">Struts action的单例与多例</a></li>\n<li><a href=\"http://www.cnblogs.com/shipengzhi/articles/2099694.html\">在spring来管理实例对象prototype和singleton的选择.针对action如何使用</a></li>\n<li><a href=\"http://lavasoft.blog.51cto.com/62575/1394669\">Spring MVC Controller单例陷阱</a></li>\n<li><a href=\"http://www.cnblogs.com/JemBai/archive/2010/11/10/1873954.html\">struts+spring action应配置为scope=”prototype”</a></li>\n<li><a href=\"http://blog.csdn.net/lsh6688/article/details/7863322\">struts2 Action获取表单数据</a></li>\n</ul>\n"},{"title":"MariaDB 在 RedHat Linux 上的安装过程以及 MySQL 相关命令的使用","title_url":"Linux-MariaDB-setup-MySql","date":"2017-05-14T16:00:00.000Z","description":"MariaDB 在 RedHat Linux 上的安装过程以及 MySQL 相关命令的使用","_content":"\n## 安装\n\n```\nyum install mariadb-server mariadb\n```\n如果提示已经有存在的包了,通过以下命令卸载\n\n```\nyum -y remove mysql-libs*\n```\n\n## 启动 MariaDB.service\n\n```\nsystemctl start mariadb.service\n```\n\n## 设置开机启动 MariaDB.service\n\n```\nsystemctl enable mariadb.service\n```\n\n## 验证是否安装成功\n\n```\nps -wef | grep mariadb | grep -v grep\n```\n\n## 修改root密码\n\nMariaDB Server 默认root密码为空,这里通过登入mysql后修改密码\n\n```\n[root@localhost ~]# mysql -u root\n```\n\n输入上面的命令后提示 `MariaDB [(none)]>`,然后输入以下命令:\n\n```\nuse mysql;\nupdate user set password=PASSWORD('new_password') where User='root';\nflush privileges;\nquit\n```\n\n## 通过命令登录mysql\n\n```\n[root@localhost ~]# mysql -u root -p\n```\n\n输入上面的命令后提示输入密码.\n\n\n## mysql 命令行窗口基本使用\n\n- `show databases;` 显示数据库列表\n- `use datamonitor;` 切换到指定的数据库\n- `show tables;` 显示某个数据库下所有\n- `desc dm_mail_info;` 显示某个表的详细信息\n- `source /etc/appData/datamonitor.sql` 将sql备份数据导入到数据库中\n\n## 参考\n\n- [RedHat Linux RPM方式安装MySQL5.6](http://blog.csdn.net/chenjinge7/article/details/46582527)","source":"_posts/MariaDB 在 RedHat Linux 上的安装过程以及 MySQL 相关命令的使用.md","raw":"---\ntitle: MariaDB 在 RedHat Linux 上的安装过程以及 MySQL 相关命令的使用\ntitle_url: Linux-MariaDB-setup-MySql\ndate: 2017-05-15\ntags: [Linux,MariaDB,MySql]\ncategories: 技术\ndescription: MariaDB 在 RedHat Linux 上的安装过程以及 MySQL 相关命令的使用\n---\n\n## 安装\n\n```\nyum install mariadb-server mariadb\n```\n如果提示已经有存在的包了,通过以下命令卸载\n\n```\nyum -y remove mysql-libs*\n```\n\n## 启动 MariaDB.service\n\n```\nsystemctl start mariadb.service\n```\n\n## 设置开机启动 MariaDB.service\n\n```\nsystemctl enable mariadb.service\n```\n\n## 验证是否安装成功\n\n```\nps -wef | grep mariadb | grep -v grep\n```\n\n## 修改root密码\n\nMariaDB Server 默认root密码为空,这里通过登入mysql后修改密码\n\n```\n[root@localhost ~]# mysql -u root\n```\n\n输入上面的命令后提示 `MariaDB [(none)]>`,然后输入以下命令:\n\n```\nuse mysql;\nupdate user set password=PASSWORD('new_password') where User='root';\nflush privileges;\nquit\n```\n\n## 通过命令登录mysql\n\n```\n[root@localhost ~]# mysql -u root -p\n```\n\n输入上面的命令后提示输入密码.\n\n\n## mysql 命令行窗口基本使用\n\n- `show databases;` 显示数据库列表\n- `use datamonitor;` 切换到指定的数据库\n- `show tables;` 显示某个数据库下所有\n- `desc dm_mail_info;` 显示某个表的详细信息\n- `source /etc/appData/datamonitor.sql` 将sql备份数据导入到数据库中\n\n## 参考\n\n- [RedHat Linux RPM方式安装MySQL5.6](http://blog.csdn.net/chenjinge7/article/details/46582527)","slug":"MariaDB 在 RedHat Linux 上的安装过程以及 MySQL 相关命令的使用","published":1,"updated":"2017-06-14T03:19:04.893Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj5jgsbf6001p2cez8oh54slc","content":"<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install mariadb-server mariadb</span><br></pre></td></tr></table></figure>\n<p>如果提示已经有存在的包了,通过以下命令卸载</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y remove mysql-libs*</span><br></pre></td></tr></table></figure>\n<h2 id=\"启动-MariaDB-service\"><a href=\"#启动-MariaDB-service\" class=\"headerlink\" title=\"启动 MariaDB.service\"></a>启动 MariaDB.service</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl start mariadb.service</span><br></pre></td></tr></table></figure>\n<h2 id=\"设置开机启动-MariaDB-service\"><a href=\"#设置开机启动-MariaDB-service\" class=\"headerlink\" title=\"设置开机启动 MariaDB.service\"></a>设置开机启动 MariaDB.service</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl enable mariadb.service</span><br></pre></td></tr></table></figure>\n<h2 id=\"验证是否安装成功\"><a href=\"#验证是否安装成功\" class=\"headerlink\" title=\"验证是否安装成功\"></a>验证是否安装成功</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps -wef | grep mariadb | grep -v grep</span><br></pre></td></tr></table></figure>\n<h2 id=\"修改root密码\"><a href=\"#修改root密码\" class=\"headerlink\" title=\"修改root密码\"></a>修改root密码</h2><p>MariaDB Server 默认root密码为空,这里通过登入mysql后修改密码</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# mysql -u root</span><br></pre></td></tr></table></figure>\n<p>输入上面的命令后提示 <code>MariaDB [(none)]&gt;</code>,然后输入以下命令:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">use mysql;</span><br><span class=\"line\">update user set password=PASSWORD(&apos;new_password&apos;) where User=&apos;root&apos;;</span><br><span class=\"line\">flush privileges;</span><br><span class=\"line\">quit</span><br></pre></td></tr></table></figure>\n<h2 id=\"通过命令登录mysql\"><a href=\"#通过命令登录mysql\" class=\"headerlink\" title=\"通过命令登录mysql\"></a>通过命令登录mysql</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# mysql -u root -p</span><br></pre></td></tr></table></figure>\n<p>输入上面的命令后提示输入密码.</p>\n<h2 id=\"mysql-命令行窗口基本使用\"><a href=\"#mysql-命令行窗口基本使用\" class=\"headerlink\" title=\"mysql 命令行窗口基本使用\"></a>mysql 命令行窗口基本使用</h2><ul>\n<li><code>show databases;</code> 显示数据库列表</li>\n<li><code>use datamonitor;</code> 切换到指定的数据库</li>\n<li><code>show tables;</code> 显示某个数据库下所有</li>\n<li><code>desc dm_mail_info;</code> 显示某个表的详细信息</li>\n<li><code>source /etc/appData/datamonitor.sql</code> 将sql备份数据导入到数据库中</li>\n</ul>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ul>\n<li><a href=\"http://blog.csdn.net/chenjinge7/article/details/46582527\" target=\"_blank\" rel=\"external\">RedHat Linux RPM方式安装MySQL5.6</a></li>\n</ul>\n","excerpt":"","more":"<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install mariadb-server mariadb</span><br></pre></td></tr></table></figure>\n<p>如果提示已经有存在的包了,通过以下命令卸载</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y remove mysql-libs*</span><br></pre></td></tr></table></figure>\n<h2 id=\"启动-MariaDB-service\"><a href=\"#启动-MariaDB-service\" class=\"headerlink\" title=\"启动 MariaDB.service\"></a>启动 MariaDB.service</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl start mariadb.service</span><br></pre></td></tr></table></figure>\n<h2 id=\"设置开机启动-MariaDB-service\"><a href=\"#设置开机启动-MariaDB-service\" class=\"headerlink\" title=\"设置开机启动 MariaDB.service\"></a>设置开机启动 MariaDB.service</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl enable mariadb.service</span><br></pre></td></tr></table></figure>\n<h2 id=\"验证是否安装成功\"><a href=\"#验证是否安装成功\" class=\"headerlink\" title=\"验证是否安装成功\"></a>验证是否安装成功</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps -wef | grep mariadb | grep -v grep</span><br></pre></td></tr></table></figure>\n<h2 id=\"修改root密码\"><a href=\"#修改root密码\" class=\"headerlink\" title=\"修改root密码\"></a>修改root密码</h2><p>MariaDB Server 默认root密码为空,这里通过登入mysql后修改密码</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# mysql -u root</span><br></pre></td></tr></table></figure>\n<p>输入上面的命令后提示 <code>MariaDB [(none)]&gt;</code>,然后输入以下命令:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">use mysql;</span><br><span class=\"line\">update user set password=PASSWORD(&apos;new_password&apos;) where User=&apos;root&apos;;</span><br><span class=\"line\">flush privileges;</span><br><span class=\"line\">quit</span><br></pre></td></tr></table></figure>\n<h2 id=\"通过命令登录mysql\"><a href=\"#通过命令登录mysql\" class=\"headerlink\" title=\"通过命令登录mysql\"></a>通过命令登录mysql</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# mysql -u root -p</span><br></pre></td></tr></table></figure>\n<p>输入上面的命令后提示输入密码.</p>\n<h2 id=\"mysql-命令行窗口基本使用\"><a href=\"#mysql-命令行窗口基本使用\" class=\"headerlink\" title=\"mysql 命令行窗口基本使用\"></a>mysql 命令行窗口基本使用</h2><ul>\n<li><code>show databases;</code> 显示数据库列表</li>\n<li><code>use datamonitor;</code> 切换到指定的数据库</li>\n<li><code>show tables;</code> 显示某个数据库下所有</li>\n<li><code>desc dm_mail_info;</code> 显示某个表的详细信息</li>\n<li><code>source /etc/appData/datamonitor.sql</code> 将sql备份数据导入到数据库中</li>\n</ul>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ul>\n<li><a href=\"http://blog.csdn.net/chenjinge7/article/details/46582527\">RedHat Linux RPM方式安装MySQL5.6</a></li>\n</ul>\n"},{"title":"在 Linux 上监控 Tomcat 是否关闭, 如果关闭自动重启","title_url":"Linux-monitor-Tomcat","date":"2017-05-14T16:00:00.000Z","description":"在 Linux 上监控 Tomcat 是否关闭, 如果关闭自动重启","_content":"\n## 新建cron文件`auto.cron`如下\n\n- 每分钟执行一次监控\n- 每天早上10点清理Tomcat的 catalina.out 文件\n\n```\n# auto restart tomcat\n*/1 * * * * sh /opt/AppData/cron/shell/tomcat_check_and_start.sh\n0 10 * * * cat /dev/null > /opt/AppData/tomcat/logs/catalina.out\n```\n\n## crontab的文件格式\n\n分 | 时 | 日 | 月 | 星期 | 要执行的命令\n---|---|---|---|---|---\n分钟0～59 | 小时0～23（0表示子夜）| 日1～31 | 月1～12 | 星期0～7（0和7表示星期天）| 要运行的命令\n\n## 监控tomcat进程脚本如下\n\n```\n#!/bin/bash\n# 首先找到tomcat根目录， 确保当前脚本在tomcat根目录下\ntomcat_path=/opt/AppData/tomcat-datamonitor\n\n# 找到tomcat的进程id\ntomcat_pid=$(ps -ef|grep $tomcat_path|gawk '$0 !~/grep/ {print $2}' |tr -s '\\n' ' ')\nif [ -z \"$tomcat_pid\" ];then\n  sh $tomcat_path/bin/startup.sh\n  echo tomcat is dead,restart at `date \"+%Y-%m-%d %H:%M:%S\"` >> $tomcat_path/tomcat_auto_restart.log\nfi\n```\n\n## 使定时监控生效\n\n```\ncrontab auto.cron\n```\n\n**注意:执行该命令前先执行下`crontab -l`看看已经存在的定时任务,以避免覆盖已经存在的定时任务**\n\n使用 `crontab -l`可以列出当前用户生效的定时任务\n\n## 参考\n\n- [linux下添加定时任务](http://blog.csdn.net/hi_kevin/article/details/8983746)\n- [crontab 定时任务](http://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/crontab.html)","source":"_posts/在 Linux 上监控 Tomcat 是否关闭, 如果关闭自动重启.md","raw":"---\ntitle: 在 Linux 上监控 Tomcat 是否关闭, 如果关闭自动重启\ntitle_url: Linux-monitor-Tomcat\ndate: 2017-05-15\ntags: [Linux,系统监控,Tomcat]\ncategories: 技术\ndescription: 在 Linux 上监控 Tomcat 是否关闭, 如果关闭自动重启\n---\n\n## 新建cron文件`auto.cron`如下\n\n- 每分钟执行一次监控\n- 每天早上10点清理Tomcat的 catalina.out 文件\n\n```\n# auto restart tomcat\n*/1 * * * * sh /opt/AppData/cron/shell/tomcat_check_and_start.sh\n0 10 * * * cat /dev/null > /opt/AppData/tomcat/logs/catalina.out\n```\n\n## crontab的文件格式\n\n分 | 时 | 日 | 月 | 星期 | 要执行的命令\n---|---|---|---|---|---\n分钟0～59 | 小时0～23（0表示子夜）| 日1～31 | 月1～12 | 星期0～7（0和7表示星期天）| 要运行的命令\n\n## 监控tomcat进程脚本如下\n\n```\n#!/bin/bash\n# 首先找到tomcat根目录， 确保当前脚本在tomcat根目录下\ntomcat_path=/opt/AppData/tomcat-datamonitor\n\n# 找到tomcat的进程id\ntomcat_pid=$(ps -ef|grep $tomcat_path|gawk '$0 !~/grep/ {print $2}' |tr -s '\\n' ' ')\nif [ -z \"$tomcat_pid\" ];then\n  sh $tomcat_path/bin/startup.sh\n  echo tomcat is dead,restart at `date \"+%Y-%m-%d %H:%M:%S\"` >> $tomcat_path/tomcat_auto_restart.log\nfi\n```\n\n## 使定时监控生效\n\n```\ncrontab auto.cron\n```\n\n**注意:执行该命令前先执行下`crontab -l`看看已经存在的定时任务,以避免覆盖已经存在的定时任务**\n\n使用 `crontab -l`可以列出当前用户生效的定时任务\n\n## 参考\n\n- [linux下添加定时任务](http://blog.csdn.net/hi_kevin/article/details/8983746)\n- [crontab 定时任务](http://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/crontab.html)","slug":"在 Linux 上监控 Tomcat 是否关闭, 如果关闭自动重启","published":1,"updated":"2017-05-27T01:59:30.690Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj5jgsbf8001s2cez9y1w1ftq","content":"<h2 id=\"新建cron文件auto-cron如下\"><a href=\"#新建cron文件auto-cron如下\" class=\"headerlink\" title=\"新建cron文件auto.cron如下\"></a>新建cron文件<code>auto.cron</code>如下</h2><ul>\n<li>每分钟执行一次监控</li>\n<li>每天早上10点清理Tomcat的 catalina.out 文件</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># auto restart tomcat</span><br><span class=\"line\">*/1 * * * * sh /opt/AppData/cron/shell/tomcat_check_and_start.sh</span><br><span class=\"line\">0 10 * * * cat /dev/null &gt; /opt/AppData/tomcat/logs/catalina.out</span><br></pre></td></tr></table></figure>\n<h2 id=\"crontab的文件格式\"><a href=\"#crontab的文件格式\" class=\"headerlink\" title=\"crontab的文件格式\"></a>crontab的文件格式</h2><table>\n<thead>\n<tr>\n<th>分</th>\n<th>时</th>\n<th>日</th>\n<th>月</th>\n<th>星期</th>\n<th>要执行的命令</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>分钟0～59</td>\n<td>小时0～23（0表示子夜）</td>\n<td>日1～31</td>\n<td>月1～12</td>\n<td>星期0～7（0和7表示星期天）</td>\n<td>要运行的命令</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"监控tomcat进程脚本如下\"><a href=\"#监控tomcat进程脚本如下\" class=\"headerlink\" title=\"监控tomcat进程脚本如下\"></a>监控tomcat进程脚本如下</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\"># 首先找到tomcat根目录， 确保当前脚本在tomcat根目录下</span><br><span class=\"line\">tomcat_path=/opt/AppData/tomcat-datamonitor</span><br><span class=\"line\"></span><br><span class=\"line\"># 找到tomcat的进程id</span><br><span class=\"line\">tomcat_pid=$(ps -ef|grep $tomcat_path|gawk &apos;$0 !~/grep/ &#123;print $2&#125;&apos; |tr -s &apos;\\n&apos; &apos; &apos;)</span><br><span class=\"line\">if [ -z &quot;$tomcat_pid&quot; ];then</span><br><span class=\"line\">  sh $tomcat_path/bin/startup.sh</span><br><span class=\"line\">  echo tomcat is dead,restart at `date &quot;+%Y-%m-%d %H:%M:%S&quot;` &gt;&gt; $tomcat_path/tomcat_auto_restart.log</span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure>\n<h2 id=\"使定时监控生效\"><a href=\"#使定时监控生效\" class=\"headerlink\" title=\"使定时监控生效\"></a>使定时监控生效</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">crontab auto.cron</span><br></pre></td></tr></table></figure>\n<p><strong>注意:执行该命令前先执行下<code>crontab -l</code>看看已经存在的定时任务,以避免覆盖已经存在的定时任务</strong></p>\n<p>使用 <code>crontab -l</code>可以列出当前用户生效的定时任务</p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ul>\n<li><a href=\"http://blog.csdn.net/hi_kevin/article/details/8983746\" target=\"_blank\" rel=\"external\">linux下添加定时任务</a></li>\n<li><a href=\"http://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/crontab.html\" target=\"_blank\" rel=\"external\">crontab 定时任务</a></li>\n</ul>\n","excerpt":"","more":"<h2 id=\"新建cron文件auto-cron如下\"><a href=\"#新建cron文件auto-cron如下\" class=\"headerlink\" title=\"新建cron文件auto.cron如下\"></a>新建cron文件<code>auto.cron</code>如下</h2><ul>\n<li>每分钟执行一次监控</li>\n<li>每天早上10点清理Tomcat的 catalina.out 文件</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># auto restart tomcat</span><br><span class=\"line\">*/1 * * * * sh /opt/AppData/cron/shell/tomcat_check_and_start.sh</span><br><span class=\"line\">0 10 * * * cat /dev/null &gt; /opt/AppData/tomcat/logs/catalina.out</span><br></pre></td></tr></table></figure>\n<h2 id=\"crontab的文件格式\"><a href=\"#crontab的文件格式\" class=\"headerlink\" title=\"crontab的文件格式\"></a>crontab的文件格式</h2><table>\n<thead>\n<tr>\n<th>分</th>\n<th>时</th>\n<th>日</th>\n<th>月</th>\n<th>星期</th>\n<th>要执行的命令</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>分钟0～59</td>\n<td>小时0～23（0表示子夜）</td>\n<td>日1～31</td>\n<td>月1～12</td>\n<td>星期0～7（0和7表示星期天）</td>\n<td>要运行的命令</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"监控tomcat进程脚本如下\"><a href=\"#监控tomcat进程脚本如下\" class=\"headerlink\" title=\"监控tomcat进程脚本如下\"></a>监控tomcat进程脚本如下</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\"># 首先找到tomcat根目录， 确保当前脚本在tomcat根目录下</span><br><span class=\"line\">tomcat_path=/opt/AppData/tomcat-datamonitor</span><br><span class=\"line\"></span><br><span class=\"line\"># 找到tomcat的进程id</span><br><span class=\"line\">tomcat_pid=$(ps -ef|grep $tomcat_path|gawk &apos;$0 !~/grep/ &#123;print $2&#125;&apos; |tr -s &apos;\\n&apos; &apos; &apos;)</span><br><span class=\"line\">if [ -z &quot;$tomcat_pid&quot; ];then</span><br><span class=\"line\">  sh $tomcat_path/bin/startup.sh</span><br><span class=\"line\">  echo tomcat is dead,restart at `date &quot;+%Y-%m-%d %H:%M:%S&quot;` &gt;&gt; $tomcat_path/tomcat_auto_restart.log</span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure>\n<h2 id=\"使定时监控生效\"><a href=\"#使定时监控生效\" class=\"headerlink\" title=\"使定时监控生效\"></a>使定时监控生效</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">crontab auto.cron</span><br></pre></td></tr></table></figure>\n<p><strong>注意:执行该命令前先执行下<code>crontab -l</code>看看已经存在的定时任务,以避免覆盖已经存在的定时任务</strong></p>\n<p>使用 <code>crontab -l</code>可以列出当前用户生效的定时任务</p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ul>\n<li><a href=\"http://blog.csdn.net/hi_kevin/article/details/8983746\">linux下添加定时任务</a></li>\n<li><a href=\"http://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/crontab.html\">crontab 定时任务</a></li>\n</ul>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cj5jgsbdn00082cezkzihore4","category_id":"cj5jgsbdh00052cezy35zgfme","_id":"cj5jgsbdy000e2cez58qkstbp"},{"post_id":"cj5jgsbd300012cezk9tsbpd8","category_id":"cj5jgsbdh00052cezy35zgfme","_id":"cj5jgsbe2000i2cezymg7lq3c"},{"post_id":"cj5jgsbdu000d2cez7sngc8zy","category_id":"cj5jgsbdh00052cezy35zgfme","_id":"cj5jgsbe5000l2cezdo8x0ue0"},{"post_id":"cj5jgsbdb00032cez7wj3i85z","category_id":"cj5jgsbdh00052cezy35zgfme","_id":"cj5jgsbe9000q2cezaxbjsoeb"},{"post_id":"cj5jgsbdy000f2cez8xj1bwlg","category_id":"cj5jgsbdh00052cezy35zgfme","_id":"cj5jgsbeb000t2cezd4g1nzq2"},{"post_id":"cj5jgsbe2000k2cez89yjen7c","category_id":"cj5jgsbdh00052cezy35zgfme","_id":"cj5jgsbee000w2cezxlm264gr"},{"post_id":"cj5jgsbdl00072cezed5jklhg","category_id":"cj5jgsbe0000g2ceznmylltkq","_id":"cj5jgsbeg000z2cez0o5yg1bz"},{"post_id":"cj5jgsbe5000n2cezydance39","category_id":"cj5jgsbdh00052cezy35zgfme","_id":"cj5jgsbek00112cez1gs22twe"},{"post_id":"cj5jgsbdp000a2cezlp7wfa8n","category_id":"cj5jgsbe7000o2cez1xcsxcme","_id":"cj5jgsbet00162cezj5ekv4mc"},{"post_id":"cj5jgsbeh00102cezqnwb921h","category_id":"cj5jgsbdh00052cezy35zgfme","_id":"cj5jgsbev00192cezis00i7qt"},{"post_id":"cj5jgsbe9000r2cezscscfhln","category_id":"cj5jgsbe7000o2cez1xcsxcme","_id":"cj5jgsbey001e2cezp1vvy7yj"},{"post_id":"cj5jgsbe9000r2cezscscfhln","category_id":"cj5jgsbeg000y2cezaytqx7d6","_id":"cj5jgsbf1001h2cezf42o7ba2"},{"post_id":"cj5jgsbem00132cezfp2e7nch","category_id":"cj5jgsbe7000o2cez1xcsxcme","_id":"cj5jgsbf4001m2cezkc6d5vb2"},{"post_id":"cj5jgsbem00132cezfp2e7nch","category_id":"cj5jgsbeg000y2cezaytqx7d6","_id":"cj5jgsbf6001o2cez3sxd3dfk"},{"post_id":"cj5jgsbet00172cez5543bn1o","category_id":"cj5jgsbe7000o2cez1xcsxcme","_id":"cj5jgsbf8001r2cezw0b88k3k"},{"post_id":"cj5jgsbet00172cez5543bn1o","category_id":"cj5jgsbeg000y2cezaytqx7d6","_id":"cj5jgsbfc001u2cezvuvkhasu"},{"post_id":"cj5jgsbeb000u2cez2ckikuoq","category_id":"cj5jgsbes00142cezk56xu3jk","_id":"cj5jgsbfd001w2cezut5uz3l1"},{"post_id":"cj5jgsbey001f2cez39pgr2a8","category_id":"cj5jgsbdh00052cezy35zgfme","_id":"cj5jgsbfe001y2cezbvtkxija"},{"post_id":"cj5jgsbee000x2cez8zg9ud9a","category_id":"cj5jgsbex001d2cez94rl1jm4","_id":"cj5jgsbff001z2cez6vmdze5y"},{"post_id":"cj5jgsbf1001i2cezqfqzk8do","category_id":"cj5jgsbes00142cezk56xu3jk","_id":"cj5jgsbff00212cezhqz6aqqj"},{"post_id":"cj5jgsbf4001n2cezrpb9oyi4","category_id":"cj5jgsbdh00052cezy35zgfme","_id":"cj5jgsbfg00232cezzvh58hv9"},{"post_id":"cj5jgsbf6001p2cez8oh54slc","category_id":"cj5jgsbdh00052cezy35zgfme","_id":"cj5jgsbfi00262cezphb5lq7c"},{"post_id":"cj5jgsbev001a2cezpp59m47o","category_id":"cj5jgsbf3001l2cezsu0qz9i3","_id":"cj5jgsbfi00282cezba2t9q9a"},{"post_id":"cj5jgsbf8001s2cez9y1w1ftq","category_id":"cj5jgsbdh00052cezy35zgfme","_id":"cj5jgsbfj002a2cezjk2u3tlv"}],"PostTag":[{"post_id":"cj5jgsbd300012cezk9tsbpd8","tag_id":"cj5jgsbde00042cezep0ehouh","_id":"cj5jgsbdu000c2cezaoypm6w5"},{"post_id":"cj5jgsbdb00032cez7wj3i85z","tag_id":"cj5jgsbdo00092cez0gasvuog","_id":"cj5jgsbe2000j2cezjtwluoqh"},{"post_id":"cj5jgsbdy000f2cez8xj1bwlg","tag_id":"cj5jgsbde00042cezep0ehouh","_id":"cj5jgsbe5000m2cezokofle92"},{"post_id":"cj5jgsbdl00072cezed5jklhg","tag_id":"cj5jgsbe1000h2cezvxy75rna","_id":"cj5jgsbeb000s2cezdwwkj3rt"},{"post_id":"cj5jgsbeh00102cezqnwb921h","tag_id":"cj5jgsbde00042cezep0ehouh","_id":"cj5jgsbes00152cezb35c6586"},{"post_id":"cj5jgsbdn00082cezkzihore4","tag_id":"cj5jgsbe7000p2cezusgf1zbu","_id":"cj5jgsbev00182cezqvnbsdny"},{"post_id":"cj5jgsbdn00082cezkzihore4","tag_id":"cj5jgsbed000v2cezf4dsjuzr","_id":"cj5jgsbex001c2cez9sckveen"},{"post_id":"cj5jgsbet00172cez5543bn1o","tag_id":"cj5jgsbel00122cezepmw6dz4","_id":"cj5jgsbf0001g2cez5vnqrtu2"},{"post_id":"cj5jgsbdp000a2cezlp7wfa8n","tag_id":"cj5jgsbel00122cezepmw6dz4","_id":"cj5jgsbf3001k2cezowtqin4u"},{"post_id":"cj5jgsbdu000d2cez7sngc8zy","tag_id":"cj5jgsbex001b2cezwyeth5b8","_id":"cj5jgsbfa001t2cezvoabh0p0"},{"post_id":"cj5jgsbdu000d2cez7sngc8zy","tag_id":"cj5jgsbf3001j2cez9u86158s","_id":"cj5jgsbfd001v2cezgxwrzex8"},{"post_id":"cj5jgsbe2000k2cez89yjen7c","tag_id":"cj5jgsbf8001q2cez04dqu53v","_id":"cj5jgsbff00222cezaxbnv362"},{"post_id":"cj5jgsbe2000k2cez89yjen7c","tag_id":"cj5jgsbfd001x2cez1mo49ft7","_id":"cj5jgsbfg00242cezhqovhgyv"},{"post_id":"cj5jgsbe5000n2cezydance39","tag_id":"cj5jgsbff00202cez1s1l3gec","_id":"cj5jgsbfi00272cez4qn953oc"},{"post_id":"cj5jgsbe9000r2cezscscfhln","tag_id":"cj5jgsbel00122cezepmw6dz4","_id":"cj5jgsbfj002b2cezemnon4pi"},{"post_id":"cj5jgsbeb000u2cez2ckikuoq","tag_id":"cj5jgsbde00042cezep0ehouh","_id":"cj5jgsbfl002f2cezt8vmlno4"},{"post_id":"cj5jgsbeb000u2cez2ckikuoq","tag_id":"cj5jgsbfi00292ceznxy7jxz1","_id":"cj5jgsbfm002g2cezy1ifdkp3"},{"post_id":"cj5jgsbeb000u2cez2ckikuoq","tag_id":"cj5jgsbfk002c2cezp0m1iaiz","_id":"cj5jgsbfm002i2ceziibuvdsq"},{"post_id":"cj5jgsbeb000u2cez2ckikuoq","tag_id":"cj5jgsbfk002d2cezjwisezxt","_id":"cj5jgsbfn002j2cezsi356jvd"},{"post_id":"cj5jgsbee000x2cez8zg9ud9a","tag_id":"cj5jgsbfl002e2cezn5s4jxzk","_id":"cj5jgsbfp002l2cezn0m5n1sd"},{"post_id":"cj5jgsbem00132cezfp2e7nch","tag_id":"cj5jgsbel00122cezepmw6dz4","_id":"cj5jgsbfp002m2cez1i8ythr6"},{"post_id":"cj5jgsbev001a2cezpp59m47o","tag_id":"cj5jgsbfn002k2cezixmz0sxy","_id":"cj5jgsbfs002p2cez5p7n3bsd"},{"post_id":"cj5jgsbev001a2cezpp59m47o","tag_id":"cj5jgsbfd001x2cez1mo49ft7","_id":"cj5jgsbfs002q2cezf5ln76zs"},{"post_id":"cj5jgsbey001f2cez39pgr2a8","tag_id":"cj5jgsbfn002k2cezixmz0sxy","_id":"cj5jgsbfu002t2cez4sltdd38"},{"post_id":"cj5jgsbey001f2cez39pgr2a8","tag_id":"cj5jgsbfs002r2cez18qfd80p","_id":"cj5jgsbfu002u2cezs6gu9xtv"},{"post_id":"cj5jgsbf1001i2cezqfqzk8do","tag_id":"cj5jgsbde00042cezep0ehouh","_id":"cj5jgsbfx002y2cezf36fsbon"},{"post_id":"cj5jgsbf1001i2cezqfqzk8do","tag_id":"cj5jgsbft002s2cezbqeokt86","_id":"cj5jgsbfx002z2cezx46ruvhb"},{"post_id":"cj5jgsbf1001i2cezqfqzk8do","tag_id":"cj5jgsbfu002v2cez5w3tp0c1","_id":"cj5jgsbfy00312cezdbsixrmk"},{"post_id":"cj5jgsbf1001i2cezqfqzk8do","tag_id":"cj5jgsbfv002w2ceziw2qfg9u","_id":"cj5jgsbfy00322cezr721p6cb"},{"post_id":"cj5jgsbf4001n2cezrpb9oyi4","tag_id":"cj5jgsbfn002k2cezixmz0sxy","_id":"cj5jgsbfz00342cezjmw8cntr"},{"post_id":"cj5jgsbf6001p2cez8oh54slc","tag_id":"cj5jgsbfx00302cez59729qg7","_id":"cj5jgsbg100372cezbturjml6"},{"post_id":"cj5jgsbf6001p2cez8oh54slc","tag_id":"cj5jgsbfy00332cez1pu47dkg","_id":"cj5jgsbg100382cezzf4nmla2"},{"post_id":"cj5jgsbf6001p2cez8oh54slc","tag_id":"cj5jgsbfz00352cezkmqiwhav","_id":"cj5jgsbg2003a2cezmvqy0dua"},{"post_id":"cj5jgsbf8001s2cez9y1w1ftq","tag_id":"cj5jgsbfx00302cez59729qg7","_id":"cj5jgsbg3003c2cezupcgmx44"},{"post_id":"cj5jgsbf8001s2cez9y1w1ftq","tag_id":"cj5jgsbg200392cezexlu77gc","_id":"cj5jgsbg3003d2cez68ipkeho"},{"post_id":"cj5jgsbf8001s2cez9y1w1ftq","tag_id":"cj5jgsbg3003b2cezhban3vxr","_id":"cj5jgsbg4003e2cez4o740mb6"}],"Tag":[{"name":"Java","_id":"cj5jgsbde00042cezep0ehouh"},{"name":"ELK","_id":"cj5jgsbdo00092cez0gasvuog"},{"name":"PHP","_id":"cj5jgsbe1000h2cezvxy75rna"},{"name":"Log4j","_id":"cj5jgsbe7000p2cezusgf1zbu"},{"name":"Logstash","_id":"cj5jgsbed000v2cezf4dsjuzr"},{"name":"Phabricator","_id":"cj5jgsbel00122cezepmw6dz4"},{"name":"Swagger2","_id":"cj5jgsbex001b2cezwyeth5b8"},{"name":"SpringMVC","_id":"cj5jgsbf3001j2cez9u86158s"},{"name":"Maven","_id":"cj5jgsbf8001q2cez04dqu53v"},{"name":"Junit","_id":"cj5jgsbfd001x2cez1mo49ft7"},{"name":"自动部署","_id":"cj5jgsbff00202cez1s1l3gec"},{"name":"Thread","_id":"cj5jgsbfi00292ceznxy7jxz1"},{"name":"Runnable","_id":"cj5jgsbfk002c2cezp0m1iaiz"},{"name":"Executor","_id":"cj5jgsbfk002d2cezjwisezxt"},{"name":"感想","_id":"cj5jgsbfl002e2cezn5s4jxzk"},{"name":"Spring","_id":"cj5jgsbfn002k2cezixmz0sxy"},{"name":"Annotation","_id":"cj5jgsbfs002r2cez18qfd80p"},{"name":"synchronized","_id":"cj5jgsbft002s2cezbqeokt86"},{"name":"volatile","_id":"cj5jgsbfu002v2cez5w3tp0c1"},{"name":"锁","_id":"cj5jgsbfv002w2ceziw2qfg9u"},{"name":"Linux","_id":"cj5jgsbfx00302cez59729qg7"},{"name":"MariaDB","_id":"cj5jgsbfy00332cez1pu47dkg"},{"name":"MySql","_id":"cj5jgsbfz00352cezkmqiwhav"},{"name":"系统监控","_id":"cj5jgsbg200392cezexlu77gc"},{"name":"Tomcat","_id":"cj5jgsbg3003b2cezhban3vxr"}]}}